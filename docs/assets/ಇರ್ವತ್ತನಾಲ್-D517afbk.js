import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as f}from"./client-misc-B8CxQsfg.js";import{b as Z,s as J,h as Q,t as B}from"./fourier-shared-DpvWsPe-.js";import{p as j,d as W,b as X,P as _}from"./path-shape-CZZKMsju.js";import{m as a}from"./misc-BHUyxQfl.js";import{g as A,e as Y}from"./utility-Dgy6CMn3.js";function tt(){document.body.style.backgroundColor="transparent",f.selectorQueryAll("[data-hide-background]",SVGElement).forEach(c=>c.style.display="none")}function et(){const c=f.selectorQuery("[data-hide-background]",SVGElement);c.parentElement?.append(c)}const U=new URLSearchParams(window.location.search);let H=!1;U.get("hide_background")=="1"?tt():U.get("only_background")=="1"&&et();{const t=f.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const nt=1024;class st{#t;constructor(t){t instanceof SVGGElement||(t=f.selectorQuery(t,SVGGElement)),this.#t=f.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(e=>{const r=f.selectorQuery("text",SVGTextElement,e),n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.classList.add("background"),e.insertBefore(n,r),{top:e,spinner:f.selectorQuery(".spinner",SVGPolygonElement,e),text:r,background:n}})}show(t,e){this.#t.forEach((r,n,u)=>{if(n>=t.length)r.top.style.display="none";else{r.top.style.display="";const S=t[n];let x=S.frequency.toString();n==u.length-1&&u.length<t.length&&(x+=", â€¦"),r.background.innerHTML=r.text.innerHTML=x,r.spinner.style.transform=`rotate(${e*S.frequency+S.phase+a.FULL_CIRCLE/4}rad)`}})}}function T(c,t){if(c>=t)throw new Error("wtf");const e=a.makeLinear(c,0,t,1);function r(n){if(n<=c)return 0;if(n>=t)return 1;const u=e(n);return Y(u)}return r}let q=()=>{};window.showFrame=c=>{q(c)};class ${constructor(t,e){this.getTransform=e,this.#t=t,this.#n=f.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=f.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new $(f.getById("right",SVGGElement),t=>j(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const z=new W;class rt{constructor(t,e,r=0,n=e-r){this.stepCount=t,this.period=e,this.#t=a.makeBoundedLinear(r,0,n,1),this.endTime=e*t}#t;endTime;get(t){let e=Math.floor(t/this.period),r;e<0?(e=0,r=0):e>=this.stepCount?(e=this.stepCount-1,r=this.period):r=t%this.period;const n=this.#t(r);return{index:e,t:n}}}class ot{constructor(t){this.pathString=t,this.samples=Z(t,nt),this.terms=J(this.samples),this.keyframes=a.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t){const e=this.makeGetPath2();function r(n){const{index:u,t:S}=t.get(n);return e(u,S)}return r}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],r=this.stepCount,n=p=>Math.max(...t.slice(0,p).map(y=>Math.abs(y.frequency))),u=p=>{if(p==0)return 8;{const d=n(p);return 8*Math.min(d,50)+7}},S=a.initializedArray(r,p=>{const d=e[p],y=e[p+1];if(d==0&&y==1&&t[0].frequency==0){let V=function(o){return`${l.x*o},${l.y*o}`};const l=a.assertNonNullable(Q(t[0])),i=T(0,.5),s=T(0,1);return o=>{const h=s(o),w=V(h),E=i(o),b=V(E);return`M ${w} L ${b}`}}else if(d==y){const V=B(t,d),l=u(y),s=_.glitchFreeParametric(V,l).rawPath;return o=>s}else{const l=.2/Math.abs(t[d].frequency),i=a.makeBoundedLinear(0,-l,1,1+l),s=B(t,d),o=B(t,y-d,d),h=u(y);if(d==0||d==1&&Q(t[0])){const w=Q(t[0])??{x:0,y:0};return E=>{const b=i(E),g=b-l,k=b+l,C=T(g,k),m=Math.min(1,k);if(m<=0)return`M${w.x},${w.y} L${w.x},${w.y}`;{let P=function(v){v=v*m;const L=s(v),R=1-C(v);if(R==0)return L;{const I=o(v);return{x:L.x+R*I.x,y:L.y+R*I.y}}};const F=Math.ceil(Math.max(h,150)*m);return _.glitchFreeParametric(P,F).rawPath}}}else return w=>{const E=i(w),b=T(E-l,E+l);function g(C){const m=s(C),P=1-b(C);if(P==0)return m;{const F=o(C);return{x:m.x+P*F.x,y:m.y+P*F.y}}}return _.glitchFreeParametric(g,h).rawPath}}});function x(p,d){const y=S[p];return y(d)}return x}}class O{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}timer;#n;#e;#s;#r;#o;base;constructor(t){this.base=t.base,this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,z.d=this.#n,this.#o=this.#e.getTransform(z.getBBox());const e=7e3,r=750;this.timer=new rt(t.base.stepCount,e,r);const n=t.base.makeGetPath1(this.timer);this.#t=u=>{const S=n(u);this.#e.setLivePath(S)}}}function at(...c){q=t=>{c.forEach(e=>e.show(t))}}let N;setTimeout(()=>{if(H)return;let c=NaN;N=new f.AnimationLoop(t=>{isNaN(c)&&(c=t);const e=t-c;q(e)}),window.animationLoop=N},1);function it(c){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),N?.cancel(),{source:"fourier-smackdown.ts",script:c,seconds:7*14+20,devicePixelRatio}}window.initScreenCapture=it;class ct{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class M{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=a.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,r)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new M([...this.pathSoFar,n],this.remainingEdges.toSpliced(r,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,r=new Set;for(const n of this.get(t)){const u=n.slice(0,n.length-1),S=this.#n(u);if(!r.has(S)){yield n,r.add(S);const x=this.#e(u,e).map(p=>this.#n(p));for(const p of x)r.add(p)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const r=new Array;for(let n=1;n<t.length;n++){const u=t[n],S=(u+1)%e,x=A(t,n+1);S==x?r.push(a.initializedArray(t.length,p=>{const d=A(t,p+n);return a.positiveModulo(d-u,e)})):A(t,n-1)==S&&r.push(a.initializedArray(t.length,d=>{const y=A(t,n-d);return a.positiveModulo(y-u,e)}))}return r}static getSamples(){function t(e,...r){return a.initializedArray(e,n=>r.map(u=>new ct(n,(n+u)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=M;function lt(){const c=M.getSamples(),t=M.getUnique(c.pentagram);console.log(t,t.constructor.name);for(const e of t);}lt();{let c=function(l,i=0){i==0&&console.table(l.terms.slice(0,20));const s=[],o=l.terms,h=o.length,w=7,E=14,b=o.splice(3,3),g=[];for(b.forEach((m,P)=>{(i&2**P)>0?(s.push([m]),g.push([])):(s.push([]),g.push([m]))});s.length<E-1-g.length;){let m;s.length<6?m=1:s.length<8?m=2:m=3;const P=o.splice(0,m);if(P.length!=m)throw new Error("wtf");s.push(P)}const k=s.splice(5,1)[0];if(s.splice(0,0,k),s.splice(w,0,[...o]),s.push(...g),console.log(s),s.length!=E)throw new Error("wtf");if(o.length=0,o.length!=0)throw new Error("wtf");const C=l.keyframes;if(C.length=0,C.push(0),s.forEach(m=>{o.push(...m),C.push(o.length)}),o.length!=h)throw new Error("wtf")};class t{constructor(i){throw new Error("wtf")}static points=a.initializedArray(5,i=>{const s=a.FULL_CIRCLE*i/5+a.FULL_CIRCLE/4,o=Math.cos(s),h=Math.sin(s);return{x:o,y:h}});static allPaths=[...M.getUnique(M.getSamples().pentagram)]}class e{constructor(i){throw new Error("wtf")}static points=a.initializedArray(6,i=>{const s=a.FULL_CIRCLE*i/6+a.FULL_CIRCLE/4,o=Math.cos(s),h=Math.sin(s);return{x:o,y:h}});static allPaths=[...M.getUnique(M.getSamples().dodecahedron)];static makePathShape(i){const s=this.allPaths[i],o=X.M(r[0].x,r[0].y);return s.forEach((h,w)=>{if(w==0){if(h!=0)throw new Error("wtf")}else{const{x:E,y:b}=r[h],g=s[w-1];switch(a.positiveModulo(h-g,6)){case 1:{o.arc(0,0,E,b,"cw");break}case 2:case 4:{o.L(E,b);break}case 5:{o.arc(0,0,E,b,"ccw");break}default:throw new Error("wtf")}}}),o.pathShape}}const r=e.points,n=e.allPaths,u=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],S=a.Random.fromString("fourier-smackdown.ts");a.initializedArray(n.length,()=>{const l=S()*3|0,i=u[l];return u.splice(l,1),u.push(i),i});const x=39,p=[{color:"red",destRect:{x:.5,y:4.5,width:3,height:3},index:x},{color:"var(--blue)",destRect:{x:4.5,y:1.5,width:3,height:3},index:x},{color:"lime",destRect:{x:4.5,y:5.5,width:3,height:3},index:x},{color:"yellow",destRect:{x:8.5,y:.5,width:3,height:3},index:x},{color:"magenta",destRect:{x:8.5,y:4.5,width:3,height:3},index:x},{color:"orange",destRect:{x:12.5,y:1.5,width:3,height:3},index:x},{color:"#e2e2e2",destRect:{x:12.5,y:5.5,width:3,height:3},index:x}],d=p.map(({index:l})=>{const i=e.makePathShape(l).rawPath;return new ot(i)});console.log(d),d.forEach((l,i)=>{c(l,i+1)});const y=new Array,V=f.selectorQuery("g#foreground",SVGGElement);for(const[l,i]of a.zip(p,d)){const{color:s,destRect:o,search:h}=l,w=h===void 0?document.createElementNS("http://www.w3.org/2000/svg","g"):f.selectorQuery(`g.frequencies[data-frequencies="${h}"]`,SVGGElement),E=h===void 0?V.appendChild(a.assertClass(f.selectorQuery("defs g[data-fourier-top]",SVGGElement).cloneNode(!0),SVGGElement)):f.selectorQuery(`[data-fourier-top="${h}"]`,SVGGElement);E.style.setProperty("--color",s);const b=new $(E,C=>j(C,o,"srcRect fits completely into destRect"));w.style.fill=s;const g={base:i,destination:b,liveColor:s,referenceColor:s},k=new O(g);y.push(k),console.log(k)}{let l=function(g){const{index:k,t:C}=o.get(g);i.show(h[k],C*a.FULL_CIRCLE)};const i=new st('[data-frequencies="red"]'),s=a.assertClass(y.at(-1),O),o=s.timer,h=new Array,{keyframes:w,terms:E}=s.base;w.forEach((g,k)=>{const C=k-1;if(C>=0){const m=w[C],P=E.slice(m,g);h.push(P)}});const b=h.splice(h.length-3,3,...h.slice(1,4));if(b.length!=3)throw new Error("wtf");b.forEach(g=>{if(g.length!=0)throw new Error("wtf")}),console.log(h),y.push({show:l})}{let l=function(F,G){const L=[F,F+a.FULL_CIRCLE/3,F-a.FULL_CIRCLE/3].map(K=>m(Math.sin(K)));L.push(0),L.push(P(Math.cos(G)));const R=L.join(" "),D=[R,R,R,"0 0 0 0 1"].join(`
`);o.setAttribute("values",D)},i=function(F){const G=h.map(v=>[]);F.forEach(v=>{if(v.length!=h.length)throw new Error("wtf");v.forEach((L,R)=>{G[R].push(L)})});for(const[v,L]of a.zip(h,G))v.setAttribute("tableValues",L.join(" "))},s=function(F){const G=F/24e4*a.FULL_CIRCLE*2,v=F/24e4*a.FULL_CIRCLE/2;l(G,v)};const o=f.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),h=[f.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),f.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),f.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],k=[[[25,25,112],[70,130,180],[147,112,219],[60,179,113],[199,21,133],[0,206,209],[216,191,216]],[[65,105,225],[204,85,0],[255,160,122],[255,182,193],[255,245,157],[175,238,238]],[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],[[70,100,80],[90,120,100],[110,140,120],[130,160,140],[150,180,160],[170,200,180]]].at(-1),C=a.makeLinear(0,0,255,1);k.forEach(F=>F.forEach((G,v,L)=>L[v]=C(G)));const m=a.makeLinear(-1,-.05,1,.8),P=a.makeLinear(1,0,-1,-.4);window.updateValues=l,i(k),y.push({show:s})}if(console.log(y),at(...y),U.get("thumbnail")=="1"){H=!0;const l=new Array;Array.from(V.children).forEach(s=>{const o=a.assertClass(s,SVGElement);o.dataset.live===void 0?o.style.display="none":(console.log("live",o.dataset.live),l.push(o))}),q(2e4),f.selectorQueryAll("[data-reference]",SVGPathElement).forEach(s=>s.style.display="none");const i=f.selectorQueryAll("#starfield rect",SVGRectElement);i[0].parentElement.style.transform="scale(3)",i.forEach(s=>{s.style.transformOrigin=`${50/3}% 9%`}),i[1].style.transform="rotate(1.75deg)",i[2].style.transform="rotate(-2deg)",window.showFrame=s=>{console.info("ignoring showFrame()",s)}}}{const c=a.Random.fromString("Good Night ðŸŒ›"),t=f.selectorQuery("[data-favorite]",SVGCircleElement),e=a.makeLinear(0,.025,2,.15);for(let r=0;r<150;r++){const n=a.assertClass(t.cloneNode(!0),SVGCircleElement);n.cx.baseVal.value=c()*16,n.cy.baseVal.value=c()*9,n.r.baseVal.value=e(c()+c()),t.parentElement.append(n)}}
