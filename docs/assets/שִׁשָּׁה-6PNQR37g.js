import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as L}from"./client-misc-DWuUZUgy.js";import{d as j,D,m as Q,T as b}from"./letters-more-BQP86_Gw.js";import{c as R,R as M,b as P,r as W,a as $}from"./utility-CsOzd0ZV.js";import{Q as T,P as B}from"./path-shape-BZC9YcLk.js";import{l as z}from"./math-to-path-CmBV3YOL.js";import{c as V}from"./path-debugger-widget-CbKrLFvj.js";const S=L("input",HTMLTextAreaElement),d=L("main",SVGElement),v=L("completionRatio",HTMLInputElement);{const t=new b().font,{normal:o}=j(t),a=L("available",HTMLSpanElement);a.innerText=[...o].sort().join(" ")}const G=V();G.insertBefore("debuggerBefore");const N=V();N.insertBefore("debuggerAfter");class w{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,d.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){w.doCleanup(),this.startImpl(),w.#t=this}doCleanup(){}}class J extends w{startImpl(){const t=new b;t.restart();const o=S.value,a=t.addText(o);t.displayText(a,d),d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}class K extends w{startImpl(){const t=new b;t.restart();const o=S.value,a=t.addText(o);d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const h=b.join(a),n=document.createElementNS("http://www.w3.org/2000/svg","g");n.classList.add("handwriting"),d.appendChild(n);let s=.01;h.splitOnMove().forEach(r=>{const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",r.rawPath),n.appendChild(i);const p=s,c=i.getTotalLength();s=p+c,i.style.setProperty("--offset",p.toString()),i.style.setProperty("--length",c.toString())});const l=new AbortController;this.doCleanup=()=>l.abort();const u=s,e=()=>{const r=v.valueAsNumber*u;P(r),n.style.setProperty("--total-position",r.toString())};e(),v.addEventListener("input",e,{signal:l.signal})}static start(){new this().start()}}class U extends w{startImpl(){const t=new b;t.restart();const o=S.value,a=t.addText(o);d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const h=b.join(a),n=document.createElementNS("http://www.w3.org/2000/svg","g");n.classList.add("handwriting","skywriting"),d.appendChild(n);let s=.01;h.splitOnMove().forEach(i=>{const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",i.rawPath),n.appendChild(p);const c=s,f=p.getTotalLength();s=c+f,p.style.setProperty("--offset",c.toString()),p.style.setProperty("--length",f.toString())});const l=new AbortController;this.doCleanup=()=>l.abort();const e=s+40,r=()=>{const i=v.valueAsNumber*e;P(i),n.style.setProperty("--total-position",i.toString())};r(),v.addEventListener("input",r,{signal:l.signal})}static start(){new this().start()}}function X(g,t){const o=R(g,t),a=1*W;return Math.abs(o)<a}class E extends w{static makeRoughShape(t,o,a){const h=t.commands.map(s=>s instanceof T?s:T.line2({x:s.x0,y:s.y0},s)),n=new Array;return t.splitOnMove().forEach(s=>{const l=s.commands,u=l.flatMap((c,f)=>f==0?[]:{x:c.x0,y:c.y0});function e(c,f){const m=o*(f?Math.SQRT1_2:1)*a(),y=a()*Math.PI*2,x=$(m,y),C=c.x+x.x,k=c.y+x.y;return{x:C,y:k,offset:x,initial:c}}const r=l[0],i=[e({x:r.x0,y:r.y0},"½")];u.forEach(c=>{i.push(e(c))});const p=l[l.length-1];if(i.push(e(p)),i.length!=l.length+1||l.length!=u.length+1)throw new Error("wtf");l.forEach((c,f)=>{const m=i[f],y=i[f+1],x=c instanceof T?{x:c.x1,y:c.y1}:z(m,y,Math.random()),C={x:x.x+(m.offset.x+y.offset.x)/2,y:x.y+(m.offset.y+y.offset.y)/2},k=e(C,"½");if(n.push(T.controlPoints(m.x,m.y,k.x,k.y,y.x,y.y)),f>0&&X(h.at(n.length-2).requestedOutgoingAngle,h.at(n.length-1).requestedIncomingAngle)){const I=n.pop(),A=n.pop(),q=A.requestedOutgoingAngle+R(A.requestedOutgoingAngle,I.requestedIncomingAngle)/2,F=A.newAngles(void 0,q);n.push(F);const H=I.newAngles(q,void 0);n.push(H)}})}),{before:new B(h),after:new B(n)}}static makeRoughFont(t,o){const a=new Map;(o==""||o===void 0)&&(o=M.newSeed());const h=M.create(o);t.forEach((s,l)=>{const u=new D(()=>this.makeRoughShape(s.shape,s.fontMetrics.strokeWidth*1.5,h).after,s.advance,s.fontMetrics);a.set(l,u)});const n=a;return n.seed=o,n}static#t=M.create("[1729402151840,42,2115899219,1537839617]");static#e=[];static makeRough(t){function o({shape0:e,shape1:r},i){const p=[{offset:0,d:e.cssPath},{offset:1,d:r.cssPath}],c=i.animate(p,{duration:1,fill:"both"});return c.pause(),c}const a=[...this.#e],h=[...t],n=[];for(;!(a.length==0||h.length==0||a[0].char!=h[0].char);){const e=a.shift(),r=h.shift();n.push({...r,shape0:e.shape0,shape1:e.shape1,animation:o(e,r.element)})}const s=[];for(;!(a.length==0||h.length==0||a.at(-1).char!=h.at(-1).char);){const e=a.pop(),r=h.pop();n.push({...r,shape0:e.shape0,shape1:e.shape1,animation:o(e,r.element)})}const l=h.map(e=>{const r=E.makeRoughShape(e.shape,e.description.fontMetrics.strokeWidth*1.5,E.#t),i=r.before,p=r.after;return{...e,shape0:i,shape1:p,animation:o({shape0:i,shape1:p},e.element)}}),u=[...n,...l,...s];return this.#e=u,u}startImpl(){const t=new b;t.font=Q(7);const o=t.font.get("0").fontMetrics;t.lineHeight=o.bottom-o.capitalTop,t.restart();const a=S.value,h=t.addText(a),n=t.displayText(h,d),s=E.makeRough(n);s.forEach(e=>{e.element.addEventListener("click",()=>{console.log(e),G.pathShape=e.shape,N.pathShape=e.shape1}),e.element.style.cursor="grab"}),d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const l=new AbortController;this.doCleanup=()=>l.abort();const u=()=>{const e=v.valueAsNumber;P(e),s.forEach(({animation:r})=>{r.currentTime=e})};u(),v.addEventListener("input",u,{signal:l.signal})}static start(){new this().start()}}S.addEventListener("input",()=>{w.restartCurrent()});function O(){const g=document.querySelector('input[name="type"]:checked')?.id;switch(g){case"simpleType":{J.start();break}case"handwritingType":{new K().start();break}case"skywritingType":{new U().start();break}case"roughType":{new E().start();break}default:throw new Error(`invalid id: ${g}`)}}O();document.querySelectorAll('input[name="type"]').forEach(g=>{g.addEventListener("click",O)});
