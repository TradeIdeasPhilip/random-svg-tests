import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as E}from"./client-misc-B8CxQsfg.js";import{b as J,s as W,h as Q,t as z}from"./fourier-shared-DpvWsPe-.js";import{p as H,d as X,b as Y,P as I}from"./path-shape-CZZKMsju.js";import{m as o}from"./misc-BHUyxQfl.js";import{g as M,e as ee}from"./utility-Dgy6CMn3.js";function te(){document.body.style.backgroundColor="transparent",E.selectorQueryAll("[data-hide-background]",SVGElement).forEach(m=>m.style.display="none")}function ne(){const m=E.selectorQuery("[data-hide-background]",SVGElement);m.parentElement?.append(m)}const U=new URLSearchParams(window.location.search);let D=!1;U.get("hide_background")=="1"?te():U.get("only_background")=="1"&&ne();{const e=E.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");e.filter="url(#watercolor)";const t=1;e.scale(t,t)}const se=1024;class re{constructor(e,t){this.terms=t,e instanceof SVGGElement||(e=E.selectorQuery(e,SVGGElement)),this.#e=E.selectorQueryAll("g.frequency",SVGGElement,0,1/0,e).map(a=>{const s=E.selectorQuery("text",SVGTextElement,a),d=document.createElementNS("http://www.w3.org/2000/svg","text");return d.classList.add("background"),a.insertBefore(d,s),{top:a,spinner:E.selectorQuery(".spinner",SVGPolygonElement,a),text:s,background:d}})}#e;show(e,t){this.#e.forEach((a,s)=>{if(s>=e)a.top.style.display="none";else{a.top.style.display="";const d=this.terms[s];a.background.innerHTML=a.text.innerHTML=d.frequency.toString(),a.spinner.style.transform=`rotate(${t*d.frequency+d.phase+o.FULL_CIRCLE/4}rad)`}})}}function B(m,e){if(m>=e)throw new Error("wtf");const t=o.makeLinear(m,0,e,1);function a(s){if(s<=m)return 0;if(s>=e)return 1;const d=t(s);return ee(d)}return a}let q=()=>{};window.showFrame=m=>{q(m)};class ${constructor(e,t){this.getTransform=t,this.#e=E.selectorQuery(e,SVGGElement),this.#n=E.selectorQuery("[data-reference]",SVGPathElement,this.#e),this.#t=E.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#e)}#e;#n;#t;hide(){this.#e.style.display="none"}show(e,t){this.#e.style.display="",this.#n.style.stroke=e}setReferencePath(e){this.#n.setAttribute("d",e)}setLivePath(e){this.#t.forEach(t=>t.setAttribute("d",e))}setTransform(e){const t=e.a;this.#e.style.transform=e.toString(),this.#e.style.setProperty("--path-scale",t.toString())}static right=new $("#right",e=>H(e,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const j=new X;class oe{constructor(e){this.pathString=e,this.samples=J(e,se),this.terms=W(this.samples),this.keyframes=o.initializedArray(21,t=>t)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(e,t=0,a=e-t){const s=this.makeGetPath2(),d=o.makeBoundedLinear(t,0,a,1),C=this.stepCount;function k(y){let u=Math.floor(y/e),n;u<0?(u=0,n=0):u>=C?(u=C-1,n=e):n=y%e;const h=d(n);return{pathString:s(u,h),index:u,t:h}}return k}makeGetPath2(){const e=[...this.terms],t=[...this.keyframes],a=this.stepCount,s=y=>Math.max(...e.slice(0,y).map(n=>Math.abs(n.frequency))),d=y=>{const u=s(y);return 8*Math.min(u,50)+7},C=o.initializedArray(a,y=>{const u=t[y],n=t[y+1];if(u==0&&n==1&&e[0].frequency==0){let h=function(f){return`${r.x*f},${r.y*f}`};const r=o.assertNonNullable(Q(e[0])),i=B(0,.5),p=B(0,1);return f=>{const g=p(f),w=h(g),F=i(f),S=h(F);return`M ${w} L ${S}`}}else{const r=.2/s(n),i=o.makeBoundedLinear(0,-r,1,1+r),p=z(e,u),f=z(e,n-u,u),g=d(n);if(u==0||u==1&&Q(e[0])){const w=Q(e[0])??{x:0,y:0};return F=>{const S=i(F),G=S-r,A=S+r,L=B(G,A),x=Math.min(1,A);if(x<=0)return`M${w.x},${w.y} L${w.x},${w.y}`;{let c=function(v){v=v*x;const R=p(v),P=1-L(v);if(P==0)return R;{const T=f(v);return{x:R.x+P*T.x,y:R.y+P*T.y}}};const l=Math.ceil(Math.max(g,150)*x);return I.glitchFreeParametric(c,l).rawPath}}}else return w=>{const F=i(w),S=B(F-r,F+r);function G(L){const x=p(L),c=1-S(L);if(c==0)return x;{const l=f(L);return{x:x.x+c*l.x,y:x.y+c*l.y}}}return I.glitchFreeParametric(G,g).rawPath}}});function k(y,u){const n=C[y];return n(u)}return k}}class ae{hide(){this.#t.hide()}#e;show(e){this.#t.show(this.#s,this.#r),this.#t.setReferencePath(this.#n),this.#t.setTransform(this.#o),this.#e(e)}endTime;#n;#t;#s;#r;#o;constructor(e,t){this.#n=e.base.pathString,this.#t=e.destination,this.#s=e.referenceColor,this.#r=e.liveColor,j.d=this.#n,this.#o=this.#t.getTransform(j.getBBox());const a=7500,s=750;this.endTime=a*e.base.stepCount;const d=e.base.makeGetPath1(a,0,a-s),C=new re(t,e.base.terms);this.#e=k=>{const{pathString:y,index:u,t:n}=d(k);this.#t.setLivePath(y),C.show(e.base.keyframes[u+1],n*o.FULL_CIRCLE)}}}function ie(...m){q=e=>{m.forEach(t=>t.show(e))}}let O;setTimeout(()=>{if(D)return;let m=NaN;O=new E.AnimationLoop(e=>{isNaN(m)&&(m=e);const t=e-m;q(t)}),window.animationLoop=O},1);function ce(m){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(e=>{if(!(e instanceof SVGElement||e instanceof HTMLElement))throw new Error("wtf");e.style.display="none"}),O?.cancel(),{source:"fourier-smackdown.ts",script:m,seconds:120,devicePixelRatio}}window.initScreenCapture=ce;class le{constructor(e,t){this.vertex1=e,this.vertex2=t}has(e){return e==this.vertex1||e==this.vertex2}other(e){if(this.vertex1==e)return this.vertex2;if(this.vertex2==e)return this.vertex1}}class V{constructor(e,t){this.pathSoFar=e,this.remainingEdges=t}oneStep(){const e=o.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((t,a)=>{const s=t.other(e);return s===void 0||this.pathSoFar.length==1&&s!=1?[]:new V([...this.pathSoFar,s],this.remainingEdges.toSpliced(a,1))})}*#e(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const e=this.oneStep();for(const t of e)yield*t.#e()}}static*get(e){yield*new this([0],e).#e()}static*getUnique(e){const t=Math.max(...e.map(s=>Math.max(s.vertex1,s.vertex2)))+1,a=new Set;for(const s of this.get(e)){const d=s.slice(0,s.length-1),C=this.#n(d);if(!a.has(C)){yield s,a.add(C);const k=this.#t(d,t).map(y=>this.#n(y));for(const y of k)a.add(y)}}}static#n(e){return String.fromCharCode(...e.map(t=>t+65))}static#t(e,t){const a=new Array;for(let s=1;s<e.length;s++){const d=e[s],C=(d+1)%t,k=M(e,s+1);C==k?a.push(o.initializedArray(e.length,y=>{const u=M(e,y+s);return o.positiveModulo(u-d,t)})):M(e,s-1)==C&&a.push(o.initializedArray(e.length,u=>{const n=M(e,s-u);return o.positiveModulo(n-d,t)}))}return a}static getSamples(){function e(t,...a){return o.initializedArray(t,s=>a.map(d=>new le(s,(s+d)%t))).flat()}return{pentagram:e(5,1,2),dodecahedron:e(6,1,2),square:e(4,1),hex:e(10,1)}}}window.Progress=V;function he(){const m=V.getSamples(),e=V.getUnique(m.pentagram);console.log(e,e.constructor.name);for(const t of e);}he();{let m=function(n,h=8){const r=[],i=n.terms,p=i.length;r.push();for(let g=0;g<5;g++){const w=o.assertNonNullable(i.shift());r.push([w])}for(let g=0;g<10;g++){const w=i.splice(0,2);if(w.length!=2)throw new Error("wtf");r.push(w)}if(console.log({bins:r,terms:i}),r.splice(h,0,[...i]),console.log(r),i.length=0,i.length!=0)throw new Error("wtf");const f=n.keyframes;if(f.length=0,f.push(0),r.forEach(g=>{i.push(...g),f.push(i.length)}),i.length!=p)throw new Error("wtf")};class e{constructor(h){throw new Error("wtf")}static points=o.initializedArray(5,h=>{const r=o.FULL_CIRCLE*h/5+o.FULL_CIRCLE/4,i=Math.cos(r),p=Math.sin(r);return{x:i,y:p}});static allPaths=[...V.getUnique(V.getSamples().pentagram)]}class t{constructor(h){throw new Error("wtf")}static points=o.initializedArray(6,h=>{const r=o.FULL_CIRCLE*h/6+o.FULL_CIRCLE/4,i=Math.cos(r),p=Math.sin(r);return{x:i,y:p}});static allPaths=[...V.getUnique(V.getSamples().dodecahedron)];static makePathShape(h){const r=this.allPaths[h],i=Y.M(a[0].x,a[0].y);return r.forEach((p,f)=>{if(f==0){if(p!=0)throw new Error("wtf")}else{const{x:g,y:w}=a[p],F=r[f-1];switch(o.positiveModulo(p-F,6)){case 1:{i.arc(0,0,g,w,"cw");break}case 2:case 4:{i.L(g,w);break}case 5:{i.arc(0,0,g,w,"ccw");break}default:throw new Error("wtf")}}}),i.pathShape}}const a=t.points,s=t.allPaths,d=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],C=o.Random.fromString("fourier-smackdown.ts");o.initializedArray(s.length,()=>{const n=C()*3|0,h=d[n];return d.splice(n,1),d.push(h),h});const k=[{color:"#black",destRect:{x:.5,y:.5,width:5,height:5},index:29,colorName:"red"},{color:"black",destRect:{x:5.5,y:3.5,width:5,height:5},index:29,colorName:"white"},{color:"black",destRect:{x:10.5,y:.5,width:5,height:5},index:29,colorName:"blue"}],y=k.map(({index:n})=>{const h=t.makePathShape(n).rawPath;return new oe(h)});console.log(y),m(y[0],6),m(y[1],6),m(y[2],6);const u=new Array;for(const[n,h]of o.zip(k,y)){const{color:r,destRect:i}=n,p=n.colorName??n.color,f=E.selectorQuery(`g.frequencies[data-frequencies="${p}"]`,SVGGElement),g=new $(`[data-fourier-top="${p}"]`,S=>H(S,i,"srcRect fits completely into destRect"));f.style.fill=r;const w={base:h,destination:g,liveColor:r,referenceColor:r},F=new ae(w,f);u.push(F),console.log(F)}{let n=function(x,c){const b=[x,x+o.FULL_CIRCLE/3,x-o.FULL_CIRCLE/3].map(T=>A(Math.sin(T)));b.push(0),b.push(L(Math.cos(c)));const v=b.join(" "),P=[v,v,v,"0 0 0 0 1"].join(`
`);i.setAttribute("values",P)},h=function(x){const c=p.map(l=>[]);x.forEach(l=>{if(l.length!=p.length)throw new Error("wtf");l.forEach((b,v)=>{c[v].push(b)})});for(const[l,b]of o.zip(p,c))l.setAttribute("tableValues",b.join(" "))},r=function(x){const c=(x+24e4)/18e4*o.FULL_CIRCLE,l=x/24e4*o.FULL_CIRCLE/2;n(c,l)};const i=E.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),p=[E.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),E.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),E.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],S=[[[25,25,112],[70,130,180],[147,112,219],[60,179,113],[199,21,133],[0,206,209],[216,191,216]],[[65,105,225],[204,85,0],[255,160,122],[255,182,193],[255,245,157],[175,238,238]],[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],[[70,100,80],[90,120,100],[110,140,120],[130,160,140],[150,180,160],[170,200,180]]].at(-1),G=o.makeLinear(0,0,255,1);S.forEach(x=>x.forEach((c,l,b)=>b[l]=G(c)));const A=o.makeLinear(-1,-.05,1,.8),L=o.makeLinear(1,0,-1,-.4);window.updateValues=n,h(S),u.push({show:r})}{let n=function(c){if(i.innerHTML="",c!=""){c.split(`
`).forEach((K,Z)=>{const N=document.createElementNS("http://www.w3.org/2000/svg","text");i.append(N),N.style.setProperty("--index",Z.toString()),N.textContent=K});const b=i.getBBox(),v=b.x+b.width,R=b.y+b.height,P=.1,T=16-v-P,_=9-R-P;i.style.transform=`translate(${T}px, ${_}px)`,p.x.baseVal.value=T-P*2,p.y.baseVal.value=_-P*4}else p.x.baseVal.value=17,p.y.baseVal.value=10},h=function(c){const l=o.assertClass(w.cloneNode(!0),SVGFilterElement);return c??=`lava-lamp-${F++}`,l.id=c,g.parentElement?.appendChild(l),{filter:l,id:c}},r=function(c){let l;c<8500?l=0:c<16e3?l=1:c<34750?l=2:c<5e4?l=3:c<58500?l=4:c<75e3?l=5:c<106e3?l=6:l=7,L.forEach((b,v)=>{const R=v>=l-1;b.style.display=R?"none":""}),n(f[l])};const i=E.getById("lava-lamp-text",SVGGElement),p=E.getById("lava-lamp-rect",SVGRectElement);window.setLavaLampText=n,n(`Hello
world!`);const f=["",`<filter
  id="lava-lamp"
  color-interpolation-filters="sRGB"
  filterUnits="objectBoundingBox"
  x="0"
  y="0"
  width="1"
  height="1"
  primitiveUnits="userSpaceOnUse"
>
`,`<feTurbulence
  type="fractalNoise"
  baseFrequency="0.3 0.75"
  numOctaves="1"
  seed="1971"
  stitchTiles="stitch"
  x="0%"
  y="0%"
  width="100%"
  height="100%"
/>
`,`<feColorMatrix
  type="matrix"
  values="1.2 0.3 -0.3 0 -0.105
          0.  0.   0.  0  0
          0.  0.   0.  0  0
          0.  0.   0.  0  1"
  x="0%"
  y="0%"
  width="100%"
  height="100%"
/>
`,`<feColorMatrix
  type="matrix"
  values="1 0 0 0 0
          1 0 0 0 0
          1 0 0 0 0
          0 0 0 0 1"
  x="0%"
  y="0%"
  width="100%"
  height="100%"
/>
`,`<feGaussianBlur stdDeviation="0.05" />
`,`<feComponentTransfer x="0%" y="0%" width="100%" height="100%">
  <feFuncR type="discrete" tableValues="1 0 0 1 1 0 1" />
  <feFuncG type="discrete" tableValues="0 1 0 0 1 1 1" />
  <feFuncB type="discrete" tableValues="0 0 1 1 0 1 1" />
  <feFuncA type="linear" slope="0" intercept="1" />
</feComponentTransfer>
`,`</filter>
`],g=E.getById("lava-lamp",SVGFilterElement),w=o.assertClass(g.cloneNode(!0),SVGFilterElement);w.id="";let F=1;const S=w.childElementCount;console.log({filterElementCount:S,master:w,duplicate:h});for(let c=0;c<S;c++){const l=h();Array.from(l.filter.children).slice(c+1).forEach(b=>{b.remove()})}const G=h("lava-lamp-without");o.assertClass(G.filter.children[S-2],SVGFEGaussianBlurElement).remove();const L=E.selectorQueryAll("#lava-lamp-pieces *",SVGRectElement);if(L.length+2!=f.length)throw new Error("wtf");u.push({show:r})}if(console.log(u),ie(...u),U.get("thumbnail")=="1"){const n=E.selectorQuery("g#foreground",SVGGElement);D=!0;const h=new Array;Array.from(n.children).forEach(f=>{const g=o.assertClass(f,SVGElement);g.dataset.live===void 0?g.style.display="none":(console.log("live",g.dataset.live),h.push(g))});const r=E.selectorQueryAll("#starfield rect",SVGRectElement);r[0].parentElement.style.transform="scale(3)",r.forEach(f=>{f.style.transformOrigin=`${50/3}% 22%`}),r[1].style.transform="rotate(1.75deg)",r[2].style.transform="rotate(-1.5deg)",q(3e4),E.selectorQueryAll("[data-reference]",SVGPathElement).forEach(f=>f.style.display="none");const i=E.selectorQuery('[data-fourier-top="red"]',SVGGElement),p=getComputedStyle(i).transform;i.style.transform=p+" scale(2) translate(0px, 0.2px)",window.showFrame=f=>{console.info("ignoring showFrame()",f)}}}
