import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as S}from"./client-misc-B8CxQsfg.js";import{b as H,s as D,h as Q,t as B}from"./fourier-shared-DpvWsPe-.js";import{p as O,d as K,b as Z,P as N}from"./path-shape-CZZKMsju.js";import{m as c}from"./misc-BHUyxQfl.js";import{g as M,e as J}from"./utility-Dgy6CMn3.js";function W(){document.body.style.backgroundColor="transparent",S.selectorQueryAll("[data-hide-background]",SVGElement).forEach(f=>f.style.display="none")}function X(){const f=S.selectorQuery("[data-hide-background]",SVGElement);f.parentElement?.append(f)}const $=new URLSearchParams(window.location.search);let j=!1;$.get("hide_background")=="1"?W():$.get("only_background")=="1"&&X();{const t=S.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const Y=1024;class tt{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=S.selectorQuery(t,SVGGElement)),this.#t=S.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(s=>{const n=S.selectorQuery("text",SVGTextElement,s),m=document.createElementNS("http://www.w3.org/2000/svg","text");return m.classList.add("background"),s.insertBefore(m,n),{top:s,spinner:S.selectorQuery(".spinner",SVGPolygonElement,s),text:n,background:m}})}#t;show(t,e){this.#t.forEach((s,n)=>{if(n>=t)s.top.style.display="none";else{s.top.style.display="";const m=this.terms[n];s.background.innerHTML=s.text.innerHTML=m.frequency.toString(),s.spinner.style.transform=`rotate(${e*m.frequency+m.phase+c.FULL_CIRCLE/4}rad)`}})}}function R(f,t){if(f>=t)throw new Error("wtf");const e=c.makeLinear(f,0,t,1);function s(n){if(n<=f)return 0;if(n>=t)return 1;const m=e(n);return J(m)}return s}let q=()=>{};window.showFrame=f=>{q(f)};class U{constructor(t,e){this.getTransform=e,this.#t=S.selectorQuery(t,SVGGElement),this.#n=S.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=S.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new U("#right",t=>O(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const z=new K;class et{constructor(t){this.pathString=t,this.samples=H(t,Y),this.terms=D(this.samples),this.keyframes=c.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,s=t-e){const n=this.makeGetPath2(),m=c.makeBoundedLinear(e,0,s,1),C=this.stepCount;function P(w){let d=Math.floor(w/t),y;d<0?(d=0,y=0):d>=C?(d=C-1,y=t):y=w%t;const l=m(y);return{pathString:n(d,l),index:d,t:l}}return P}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],s=this.stepCount,n=w=>Math.max(...t.slice(0,w).map(y=>Math.abs(y.frequency))),m=w=>8*n(w)+7,C=c.initializedArray(s,w=>{const d=e[w],y=e[w+1];if(d==0&&y==1&&t[0].frequency==0){let l=function(i){return`${r.x*i},${r.y*i}`};const r=c.assertNonNullable(Q(t[0])),h=R(0,.5),a=R(0,1);return i=>{const u=a(i),o=l(u),k=h(i),b=l(k);return`M ${o} L ${b}`}}else{const r=.2/n(y),h=c.makeBoundedLinear(0,-r,1,1+r),a=B(t,d),i=B(t,y-d,d),u=m(y);if(d==0||d==1&&Q(t[0])){const o=Q(t[0])??{x:0,y:0};return k=>{const b=h(k),x=b-r,g=b+r,p=R(x,g),E=Math.min(1,g);if(E<=0)return`M${o.x},${o.y} L${o.x},${o.y}`;{let F=function(G){G=G*E;const V=a(G),T=1-p(G);if(T==0)return V;{const _=i(G);return{x:V.x+T*_.x,y:V.y+T*_.y}}};const L=Math.ceil(Math.max(u,150)*E);return N.glitchFreeParametric(F,L).rawPath}}}else return o=>{const k=h(o),b=R(k-r,k+r);function x(p){const E=a(p),F=1-b(p);if(F==0)return E;{const L=i(p);return{x:E.x+F*L.x,y:E.y+F*L.y}}}return N.glitchFreeParametric(x,u).rawPath}}});function P(w,d){const y=C[w];return y(d)}return P}}class nt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#r,this.#s),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#r;#s;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#r=t.referenceColor,this.#s=t.liveColor,z.d=this.#n,this.#o=this.#e.getTransform(z.getBBox());const s=6e3,n=750;this.endTime=s*t.base.stepCount;const m=t.base.makeGetPath1(s,0,s-n),C=new tt(e,t.base.terms);this.#t=P=>{const{pathString:w,index:d,t:y}=m(P);this.#e.setLivePath(w),C.show(t.base.keyframes[d+1],y*c.FULL_CIRCLE)}}}function rt(...f){q=t=>{f.forEach(e=>e.show(t))}}let I;setTimeout(()=>{if(j)return;let f=NaN;I=new S.AnimationLoop(t=>{isNaN(f)&&(f=t);const e=t-f;q(e)}),window.animationLoop=I},1);function st(f){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),I?.cancel(),{source:"fourier-smackdown.ts",script:f,seconds:120,devicePixelRatio}}window.initScreenCapture=st;class ot{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class v{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=c.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,s)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new v([...this.pathSoFar,n],this.remainingEdges.toSpliced(s,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,s=new Set;for(const n of this.get(t)){const m=n.slice(0,n.length-1),C=this.#n(m);if(!s.has(C)){yield n,s.add(C);const P=this.#e(m,e).map(w=>this.#n(w));for(const w of P)s.add(w)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const s=new Array;for(let n=1;n<t.length;n++){const m=t[n],C=(m+1)%e,P=M(t,n+1);C==P?s.push(c.initializedArray(t.length,w=>{const d=M(t,w+n);return c.positiveModulo(d-m,e)})):M(t,n-1)==C&&s.push(c.initializedArray(t.length,d=>{const y=M(t,n-d);return c.positiveModulo(y-m,e)}))}return s}static getSamples(){function t(e,...s){return c.initializedArray(e,n=>s.map(m=>new ot(n,(n+m)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=v;function at(){const f=v.getSamples(),t=v.getUnique(f.pentagram);console.log(t,t.constructor.name);for(const e of t);}at();{let f=function(l,r=".chapter"){typeof r=="string"&&(r=S.selectorQuery(r,SVGTextElement)),r.innerHTML=`#${l} of ${s.allPaths.length}`},t=function(l,r,h){l.sort((o,k)=>k.amplitude-o.amplitude);const a=new Array,i=new Array;let u;return l.forEach(o=>{u!==void 0&&o.amplitude<u?i.push(o):(o.frequency+h)%r==0?(a.push(o),u===void 0&&(u=o.amplitude*.05)):i.push(o)}),l.length=0,l.push(...a,...i),console.log(a,i,l),{frontLength:a.length}};class e{constructor(r){throw new Error("wtf")}static points=c.initializedArray(5,r=>{const h=c.FULL_CIRCLE*r/5+c.FULL_CIRCLE/4,a=Math.cos(h),i=Math.sin(h);return{x:a,y:i}});static allPaths=[...v.getUnique(v.getSamples().pentagram)]}class s{constructor(r){throw new Error("wtf")}static points=c.initializedArray(6,r=>{const h=c.FULL_CIRCLE*r/6+c.FULL_CIRCLE/4,a=Math.cos(h),i=Math.sin(h);return{x:a,y:i}});static allPaths=[...v.getUnique(v.getSamples().dodecahedron)];static makePathShape(r){const h=this.allPaths[r],a=Z.M(n[0].x,n[0].y);return h.forEach((i,u)=>{if(u==0){if(i!=0)throw new Error("wtf")}else{const{x:o,y:k}=n[i],b=h[u-1];switch(c.positiveModulo(i-b,6)){case 1:{a.arc(0,0,o,k,"cw");break}case 2:case 4:{a.L(o,k);break}case 5:{a.arc(0,0,o,k,"ccw");break}default:throw new Error("wtf")}}}),a.pathShape}}const n=s.points,m=s.allPaths,C=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],P=c.Random.fromString("fourier-smackdown.ts");c.initializedArray(m.length,()=>{const l=P()*3|0,r=C[l];return C.splice(l,1),C.push(r),r});const w=[{color:"#black",destRect:{x:.5,y:.5,width:5,height:5},index:24,colorName:"red"},{color:"black",destRect:{x:5.5,y:3.5,width:5,height:5},index:24,colorName:"white"},{color:"black",destRect:{x:10.5,y:.5,width:5,height:5},index:24,colorName:"blue"}];f(24);const d=w.map(({index:l})=>{const r=s.makePathShape(l).rawPath;return new et(r)});t(d[0].terms,3,1),t(d[1].terms,4,-1),t(d[2].terms,5,-1),console.log(d);const y=new Array;for(const[l,r]of c.zip(w,d)){const{color:h,destRect:a}=l,i=l.colorName??l.color,u=S.selectorQuery(`g.frequencies[data-frequencies="${i}"]`,SVGGElement),o=new U(`[data-fourier-top="${i}"]`,x=>O(x,a,"srcRect fits completely into destRect"));u.style.fill=h;const k={base:r,destination:o,liveColor:h,referenceColor:h},b=new nt(k,u);y.push(b),console.log(b)}{let l=function(g,p){const F=[g,g+c.FULL_CIRCLE/3,g-c.FULL_CIRCLE/3].map(V=>b(Math.sin(V)));F.push(0),F.push(x(Math.cos(p)));const L=F.join(" "),G=[L,L,L,"0 0 0 0 1"].join(`
`);a.setAttribute("values",G)},r=function(g){const p=i.map(E=>[]);g.forEach(E=>{if(E.length!=i.length)throw new Error("wtf");E.forEach((F,L)=>{p[L].push(F)})});for(const[E,F]of c.zip(i,p))E.setAttribute("tableValues",F.join(" "))},h=function(g){const p=(g+24e4)/18e4*c.FULL_CIRCLE,E=g/24e4*c.FULL_CIRCLE/2;l(p,E)};const a=S.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),i=[S.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),S.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),S.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],o=[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],k=c.makeLinear(0,0,255,1);o.forEach(g=>g.forEach((p,E,F)=>F[E]=k(p)));const b=c.makeLinear(-1,-.05,1,.8),x=c.makeLinear(1,0,-1,-.4);window.updateValues=l,r(o),y.push({show:h})}{let l=function(h){const a=c.Random.fromString(h),i=120*60;function u(){return .65+a()*.15}function o(){return .8+a()*.1}function k(){return .2+a()*.3}function b(p,E){return p+Math.floor(a()*(E-p+1))}const x=new Array;function g(p,E,F){const L=b(E,F);for(let A=0;A<L;A++)x.push(p())}for(;x.length<i;)if(g(u,60,90),a()<.15){let p=b(2,3);for(;g(k,2,3),p--,!(p<=0);)g(u,3,5)}else{let p=b(3,5);for(;g(o,2,5),p--,!(p<=0);)g(u,3,5)}return x},r=function(h,a,i=a){const u=S.selectorQuery(`#${h} feDropShadow`,SVGFEDropShadowElement),o=S.selectorQuery(`[data-fourier-top="${a}"] [data-live]:not([filter])`,SVGPathElement);function k(g){u.setAttribute("flood-color",g),o.style.stroke=g}const b=l(i);function x(g){const p=Math.floor(g/1e3*30)%b.length,F=`rgba(255, 240, 230, ${b[p]})`;k(F)}y.push({show:x})};r("big-shadow0","red"),r("big-shadow1","white"),r("big-shadow2","blue")}if(console.log(y),rt(...y),$.get("thumbnail")=="1"){const l=S.selectorQuery("g#foreground",SVGGElement);j=!0;const r=new Array;Array.from(l.children).forEach(u=>{const o=c.assertClass(u,SVGElement);o.dataset.live===void 0?o.style.display="none":(console.log("live",o.dataset.live),r.push(o))});const h=S.selectorQueryAll("#starfield rect",SVGRectElement);h[0].parentElement.style.transform="scale(3)",h.forEach(u=>{u.style.transformOrigin=`${50/3}% 22%`}),h[1].style.transform="rotate(1.75deg)",h[2].style.transform="rotate(-1.5deg)",q(3e4),S.selectorQueryAll("[data-reference]",SVGPathElement).forEach(u=>u.style.display="none");const a=S.selectorQuery('[data-fourier-top="red"]',SVGGElement),i=getComputedStyle(a).transform;a.style.transform=i+" scale(2) translate(0px, 0.2px)",window.showFrame=u=>{console.info("ignoring showFrame()",u)}}}
