import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as H,s as D,h as q,t as I}from"./fourier-shared-DpvWsPe-.js";import{p as z,d as K,b as Z,P as $}from"./path-shape-CZZKMsju.js";import{m as a}from"./misc-BHUyxQfl.js";import{g as V,e as J}from"./utility-Dgy6CMn3.js";function W(){document.body.style.backgroundColor="transparent",y.selectorQueryAll("[data-hide-background]",SVGElement).forEach(c=>c.style.display="none")}function X(){const c=y.selectorQuery("[data-hide-background]",SVGElement);c.parentElement?.append(c)}const Q=new URLSearchParams(window.location.search);let j=!1;Q.get("hide_background")=="1"?W():Q.get("only_background")=="1"&&X();{const t=y.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const Y=1024;class tt{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=y.selectorQuery(t,SVGGElement)),this.#t=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(o=>{const n=y.selectorQuery("text",SVGTextElement,o),l=document.createElementNS("http://www.w3.org/2000/svg","text");return l.classList.add("background"),o.insertBefore(l,n),{top:o,spinner:y.selectorQuery(".spinner",SVGPolygonElement,o),text:n,background:l}})}#t;show(t,e){this.#t.forEach((o,n)=>{if(n>=t)o.top.style.display="none";else{o.top.style.display="";const l=this.terms[n];o.background.innerHTML=o.text.innerHTML=l.frequency.toString(),o.spinner.style.transform=`rotate(${e*l.frequency+l.phase+a.FULL_CIRCLE/4}rad)`}})}}function M(c,t){if(c>=t)throw new Error("wtf");const e=a.makeLinear(c,0,t,1);function o(n){if(n<=c)return 0;if(n>=t)return 1;const l=e(n);return J(l)}return o}let R=()=>{};window.showFrame=c=>{R(c)};class U{constructor(t,e){this.getTransform=e,this.#t=y.selectorQuery(t,SVGGElement),this.#n=y.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=y.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new U("#right",t=>z(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const O=new K;class et{constructor(t){this.pathString=t,this.samples=H(t,Y),this.terms=D(this.samples),this.keyframes=a.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,o=t-e){const n=this.makeGetPath2(),l=a.makeBoundedLinear(e,0,o,1),S=this.stepCount;function C(f){let h=Math.floor(f/t),r;h<0?(h=0,r=0):h>=S?(h=S-1,r=t):r=f%t;const u=l(r);return{pathString:n(h,u),index:h,t:u}}return C}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],o=this.stepCount,n=f=>Math.max(...t.slice(0,f).map(r=>Math.abs(r.frequency))),l=f=>{const h=n(f);return 8*Math.min(h,50)+7},S=a.initializedArray(o,f=>{const h=e[f],r=e[f+1];if(h==0&&r==1&&t[0].frequency==0){let u=function(m){return`${s.x*m},${s.y*m}`};const s=a.assertNonNullable(q(t[0])),i=M(0,.5),g=M(0,1);return m=>{const d=g(m),p=u(d),b=i(m),F=u(b);return`M ${p} L ${F}`}}else{const s=.2/n(r),i=a.makeBoundedLinear(0,-s,1,1+s),g=I(t,h),m=I(t,r-h,h),d=l(r);if(h==0||h==1&&q(t[0])){const p=q(t[0])??{x:0,y:0};return b=>{const F=i(b),k=F-s,x=F+s,E=M(k,x),w=Math.min(1,x);if(w<=0)return`M${p.x},${p.y} L${p.x},${p.y}`;{let L=function(v){v=v*w;const A=g(v),T=1-E(v);if(T==0)return A;{const B=m(v);return{x:A.x+T*B.x,y:A.y+T*B.y}}};const G=Math.ceil(Math.max(d,150)*w);return $.glitchFreeParametric(L,G).rawPath}}}else return p=>{const b=i(p),F=M(b-s,b+s);function k(E){const w=g(E),L=1-F(E);if(L==0)return w;{const G=m(E);return{x:w.x+L*G.x,y:w.y+L*G.y}}}return $.glitchFreeParametric(k,d).rawPath}}});function C(f,h){const r=S[f];return r(h)}return C}}class nt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#s;#r;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,O.d=this.#n,this.#o=this.#e.getTransform(O.getBBox());const o=7500,n=750;this.endTime=o*t.base.stepCount;const l=t.base.makeGetPath1(o,0,o-n),S=new tt(e,t.base.terms);this.#t=C=>{const{pathString:f,index:h,t:r}=l(C);this.#e.setLivePath(f),S.show(t.base.keyframes[h+1],r*a.FULL_CIRCLE)}}}function st(...c){R=t=>{c.forEach(e=>e.show(t))}}let N;setTimeout(()=>{if(j)return;let c=NaN;N=new y.AnimationLoop(t=>{isNaN(c)&&(c=t);const e=t-c;R(e)}),window.animationLoop=N},1);function rt(c){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),N?.cancel(),{source:"fourier-smackdown.ts",script:c,seconds:120,devicePixelRatio}}window.initScreenCapture=rt;class ot{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class P{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=a.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,o)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new P([...this.pathSoFar,n],this.remainingEdges.toSpliced(o,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,o=new Set;for(const n of this.get(t)){const l=n.slice(0,n.length-1),S=this.#n(l);if(!o.has(S)){yield n,o.add(S);const C=this.#e(l,e).map(f=>this.#n(f));for(const f of C)o.add(f)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const o=new Array;for(let n=1;n<t.length;n++){const l=t[n],S=(l+1)%e,C=V(t,n+1);S==C?o.push(a.initializedArray(t.length,f=>{const h=V(t,f+n);return a.positiveModulo(h-l,e)})):V(t,n-1)==S&&o.push(a.initializedArray(t.length,h=>{const r=V(t,n-h);return a.positiveModulo(r-l,e)}))}return o}static getSamples(){function t(e,...o){return a.initializedArray(e,n=>o.map(l=>new ot(n,(n+l)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=P;function at(){const c=P.getSamples(),t=P.getUnique(c.pentagram);console.log(t,t.constructor.name);for(const e of t);}at();{let c=function(r,u=8){const s=[],i=r.terms,g=i.length;s.push();for(let d=0;d<5;d++){const p=a.assertNonNullable(i.shift());s.push([p])}for(let d=0;d<10;d++){const p=i.splice(0,2);if(p.length!=2)throw new Error("wtf");s.push(p)}if(console.log({bins:s,terms:i}),s.splice(u,0,[...i]),console.log(s),i.length=0,i.length!=0)throw new Error("wtf");const m=r.keyframes;if(m.length=0,m.push(0),s.forEach(d=>{i.push(...d),m.push(i.length)}),i.length!=g)throw new Error("wtf")};class t{constructor(u){throw new Error("wtf")}static points=a.initializedArray(5,u=>{const s=a.FULL_CIRCLE*u/5+a.FULL_CIRCLE/4,i=Math.cos(s),g=Math.sin(s);return{x:i,y:g}});static allPaths=[...P.getUnique(P.getSamples().pentagram)]}class e{constructor(u){throw new Error("wtf")}static points=a.initializedArray(6,u=>{const s=a.FULL_CIRCLE*u/6+a.FULL_CIRCLE/4,i=Math.cos(s),g=Math.sin(s);return{x:i,y:g}});static allPaths=[...P.getUnique(P.getSamples().dodecahedron)];static makePathShape(u){const s=this.allPaths[u],i=Z.M(o[0].x,o[0].y);return s.forEach((g,m)=>{if(m==0){if(g!=0)throw new Error("wtf")}else{const{x:d,y:p}=o[g],b=s[m-1];switch(a.positiveModulo(g-b,6)){case 1:{i.arc(0,0,d,p,"cw");break}case 2:case 4:{i.L(d,p);break}case 5:{i.arc(0,0,d,p,"ccw");break}default:throw new Error("wtf")}}}),i.pathShape}}const o=e.points,n=e.allPaths,l=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],S=a.Random.fromString("fourier-smackdown.ts");a.initializedArray(n.length,()=>{const r=S()*3|0,u=l[r];return l.splice(r,1),l.push(u),u});const C=[{color:"#black",destRect:{x:.5,y:.5,width:5,height:5},index:26,colorName:"red"},{color:"black",destRect:{x:5.5,y:3.5,width:5,height:5},index:27,colorName:"white"},{color:"black",destRect:{x:10.5,y:.5,width:5,height:5},index:28,colorName:"blue"}],f=C.map(({index:r})=>{const u=e.makePathShape(r).rawPath;return new et(u)});console.log(f),c(f[0],12),c(f[1],10),c(f[2],8);const h=new Array;for(const[r,u]of a.zip(C,f)){const{color:s,destRect:i}=r,g=r.colorName??r.color,m=y.selectorQuery(`g.frequencies[data-frequencies="${g}"]`,SVGGElement),d=new U(`[data-fourier-top="${g}"]`,F=>z(F,i,"srcRect fits completely into destRect"));m.style.fill=s;const p={base:u,destination:d,liveColor:s,referenceColor:s},b=new nt(p,m);h.push(b),console.log(b)}{let r=function(k,x){const w=[k,k+a.FULL_CIRCLE/3,k-a.FULL_CIRCLE/3].map(v=>b(Math.sin(v)));w.push(0),w.push(F(Math.cos(x)));const L=w.join(" "),_=[L,L,L,"0 0 0 0 1"].join(`
`);i.setAttribute("values",_)},u=function(k){const x=g.map(E=>[]);k.forEach(E=>{if(E.length!=g.length)throw new Error("wtf");E.forEach((w,L)=>{x[L].push(w)})});for(const[E,w]of a.zip(g,x))E.setAttribute("tableValues",w.join(" "))},s=function(k){const x=(k+24e4)/18e4*a.FULL_CIRCLE,E=k/24e4*a.FULL_CIRCLE/2;r(x,E)};const i=y.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),g=[y.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),y.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),y.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],d=[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],p=a.makeLinear(0,0,255,1);d.forEach(k=>k.forEach((x,E,w)=>w[E]=p(x)));const b=a.makeLinear(-1,-.05,1,.8),F=a.makeLinear(1,0,-1,-.4);window.updateValues=r,u(d),h.push({show:s})}if(console.log(h),st(...h),Q.get("thumbnail")=="1"){const r=y.selectorQuery("g#foreground",SVGGElement);j=!0;const u=new Array;Array.from(r.children).forEach(m=>{const d=a.assertClass(m,SVGElement);d.dataset.live===void 0?d.style.display="none":(console.log("live",d.dataset.live),u.push(d))});const s=y.selectorQueryAll("#starfield rect",SVGRectElement);s[0].parentElement.style.transform="scale(3)",s.forEach(m=>{m.style.transformOrigin=`${50/3}% 22%`}),s[1].style.transform="rotate(1.75deg)",s[2].style.transform="rotate(-1.5deg)",R(3e4),y.selectorQueryAll("[data-reference]",SVGPathElement).forEach(m=>m.style.display="none");const i=y.selectorQuery('[data-fourier-top="red"]',SVGGElement),g=getComputedStyle(i).transform;i.style.transform=g+" scale(2) translate(0px, 0.2px)",window.showFrame=m=>{console.info("ignoring showFrame()",m)}}}
