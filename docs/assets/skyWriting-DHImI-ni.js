import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as T}from"./client-misc-leadhGo2.js";import{d as A,T as y,Q as L,P,D as N}from"./letters-more-9Sgwrhcp.js";import{b as C,a as I}from"./utility-DcEUXXL7.js";import{l as V}from"./math-to-path-CWuJ-zIl.js";const E=T("input",HTMLTextAreaElement),f=T("main",SVGElement);{const t=new y().font,{normal:o}=A(t),n=T("available",HTMLSpanElement);n.innerText=[...o].sort().join(" ")}class m{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,f.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){m.doCleanup(),this.startImpl(),m.#t=this}doCleanup(){}}class G extends m{startImpl(){const t=new y;t.restart();const o=E.value,n=t.addText(o);t.displayText(n,f),f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}const S=T("completionRatio",HTMLInputElement);class F extends m{startImpl(){const t=new y;t.restart();const o=E.value,n=t.addText(o);f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const a=y.join(n),e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("handwriting"),f.appendChild(e);let r=0;a.splitOnMove().forEach(c=>{const h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",c.rawPath),e.appendChild(h);const s=r,p=h.getTotalLength();r=s+p,h.style.setProperty("--offset",s.toString()),h.style.setProperty("--length",p.toString())});const i=new AbortController;this.doCleanup=()=>i.abort();const g=r,w=()=>{const c=S.valueAsNumber*g;C(c),e.style.setProperty("--total-position",c.toString())};w(),S.addEventListener("input",w,{signal:i.signal})}static start(){new this().start()}}class R extends m{startImpl(){const t=new y;t.restart();const o=E.value,n=t.addText(o);f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const a=y.join(n),e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("handwriting","skywriting"),f.appendChild(e);let r=0;a.splitOnMove().forEach(h=>{const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",h.rawPath),e.appendChild(s);const p=r,l=s.getTotalLength();r=p+l,s.style.setProperty("--offset",p.toString()),s.style.setProperty("--length",l.toString())});const i=new AbortController;this.doCleanup=()=>i.abort();const w=r+40,c=()=>{const h=S.valueAsNumber*w;C(h),e.style.setProperty("--total-position",h.toString())};c(),S.addEventListener("input",c,{signal:i.signal})}static start(){new this().start()}}function B(d){let t=NaN;for(const o of d.commands){const{incomingAngle:n,outgoingAngle:a}=o;if(C(n,a),!Number.isNaN(t)&&Math.abs(t-n)<Math.PI/180)return!1;t=a}return!0}class v extends m{static makeRoughShape(t,o){const n=new Array,a=new Array;return t.splitOnMove().forEach(e=>{if(B(e)){let r=function(s,p){const l=o*(p?Math.SQRT1_2:1)*Math.random(),u=Math.random()*Math.PI*2,x=I(l,u),b=s.x+x.x,M=s.y+x.y;return{x:b,y:M,offset:x,initial:s}};const i=e.commands,g=i.flatMap((s,p)=>p==0?[]:{x:s.x0,y:s.y0}),w=i[0],c=[r({x:w.x0,y:w.y0},"½")];g.forEach(s=>{c.push(r(s))});const h=i[i.length-1];if(c.push(r(h)),c.length!=i.length+1||i.length!=g.length+1)throw new Error("wtf");i.forEach((s,p)=>{const l=c[p],u=c[p+1],x=s instanceof L?{x:s.x1,y:s.y1}:V(l,u,Math.random()),b={x:x.x+(l.offset.x+u.offset.x)/2,y:x.y+(l.offset.y+u.offset.y)/2},M=r(b,"½");n.push(new L(l.initial.x,l.initial.y,b.x,b.y,u.initial.x,u.initial.y)),a.push(new L(l.x,l.y,M.x,M.y,u.x,u.y))})}else n.push(...e.commands),a.push(...e.commands)}),{before:new P(n),after:new P(a)}}static makeRoughFont(t){const o=new Map;return t.forEach((n,a)=>{const e=new N(()=>this.makeRoughShape(n.shape,n.fontMetrics.strokeWidth*1.5).before,n.advance,n.fontMetrics);o.set(a,e)}),o}static#t=[];static instantiate(t){const o=[...this.#t];let n=!0;const a=t.map(e=>{if(n){const r=o.at(0);if(r?.char===e.char)return o.shift(),{...e,shape:r.shape};n=!1}return e});for(let e=a.length-1;e>=0;e--){const r=o.pop();if(r===void 0)break;const i=a[e];if(r.char!=i.char)break;const g={...i,shape:r.shape};a[e]=g}return a}startImpl(){const t=new y;t.font=v.makeRoughFont(t.font),t.restart();const o=E.value,n=t.addText(o),a=v.instantiate(n);v.#t=t.displayText(a,f),f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}E.addEventListener("input",()=>{m.restartCurrent()});function k(){const d=document.querySelector('input[name="type"]:checked')?.id;switch(d){case"simpleType":{G.start();break}case"handwritingType":{new F().start();break}case"skywritingType":{new R().start();break}case"roughType":{new v().start();break}default:throw new Error(`invalid id: ${d}`)}}k();document.querySelectorAll('input[name="type"]').forEach(d=>{d.addEventListener("click",k)});
