import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as g}from"./client-misc-B8CxQsfg.js";import{b as H,s as D,h as q,t as I}from"./fourier-shared-NjkoHtEt.js";import{p as O,d as K,b as Z,P as U}from"./path-shape-CZZKMsju.js";import{m as h}from"./misc-BHUyxQfl.js";import{g as M,e as j}from"./utility-Dgy6CMn3.js";function J(){document.body.style.backgroundColor="transparent",g.selectorQueryAll("[data-hide-background]",SVGElement).forEach(c=>c.style.display="none")}function W(){const c=g.selectorQuery("[data-hide-background]",SVGElement);c.parentElement?.append(c)}const R=new URLSearchParams(window.location.search);if(R.get("hide_background")=="1")J();else if(R.get("only_background")=="1")W();else if(R.get("thumbnail")=="1"){const c=g.selectorQuery("g#foreground",SVGGElement);c.style.display="none";const t=g.selectorQuery("g#thumbnail-foreground",SVGGElement);t.style.display=""}{const t=g.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const _=1024;class X{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=g.selectorQuery(t,SVGGElement)),this.#t=g.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(o=>{const s=g.selectorQuery("text",SVGTextElement,o),l=document.createElementNS("http://www.w3.org/2000/svg","text");return l.classList.add("background"),o.insertBefore(l,s),{top:o,spinner:g.selectorQuery(".spinner",SVGPolygonElement,o),text:s,background:l}})}#t;show(t,e){this.#t.forEach((o,s)=>{if(s>=t)o.top.style.display="none";else{o.top.style.display="";const l=this.terms[s];o.background.innerHTML=o.text.innerHTML=l.frequency.toString(),o.spinner.style.transform=`rotate(${e*l.frequency+l.phase+h.FULL_CIRCLE/4}rad)`}})}}function G(c,t){if(c>=t)throw new Error("wtf");const e=h.makeLinear(c,0,t,1);function o(s){if(s<=c)return 0;if(s>=t)return 1;const l=e(s);return j(l)}return o}let N=()=>{};window.showFrame=c=>{N(c)};class ${constructor(t,e){this.getTransform=e,this.#t=g.selectorQuery(t,SVGGElement),this.#s=g.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=g.selectorQuery("[data-live]",SVGPathElement,this.#t)}#t;#s;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#s.style.stroke=t,this.#e.style.stroke=e}setReferencePath(t){this.#s.setAttribute("d",t)}setLivePath(t){this.#e.setAttribute("d",t)}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new $("#right",t=>O(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const z=new K;class Y{constructor(t){this.pathString=t,this.samples=H(t,_),this.terms=D(this.samples),this.keyframes=h.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,o=t-e){const s=this.makeGetPath2(),l=h.makeBoundedLinear(e,0,o,1),f=this.stepCount;function y(u){let n=Math.floor(u/t),r;n<0?(n=0,r=0):n>=f?(n=f-1,r=t):r=u%t;const a=l(r);return{pathString:s(n,a),index:n,t:a}}return y}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],o=this.stepCount,s=u=>Math.max(...t.slice(0,u).map(r=>Math.abs(r.frequency))),l=u=>8*s(u)+7,f=h.initializedArray(o,u=>{const n=e[u],r=e[u+1];if(n==0&&r==1&&t[0].frequency==0){let a=function(d){return`${i.x*d},${i.y*d}`};const i=h.assertNonNullable(q(t[0])),m=G(0,.5),p=G(0,1);return d=>{const w=p(d),S=a(w),x=m(d),E=a(x);return`M ${S} L ${E}`}}else{const i=.2/s(r),m=h.makeBoundedLinear(0,-i,1,1+i),p=I(t,n),d=I(t,r-n,n),w=l(r);if(n==0||n==1&&q(t[0])){const S=q(t[0])??{x:0,y:0};return x=>{const E=m(x),b=E-i,V=E+i,F=G(b,V),P=Math.min(1,V);if(P<=0)return`M${S.x},${S.y} L${S.x},${S.y}`;{let v=function(C){C=C*P;const A=p(C),T=1-F(C);if(T==0)return A;{const B=d(C);return{x:A.x+T*B.x,y:A.y+T*B.y}}};const L=Math.ceil(Math.max(w,150)*P);return U.glitchFreeParametric(v,L).rawPath}}}else return S=>{const x=m(S),E=G(x-i,x+i);function b(F){const P=p(F),v=1-E(F);if(v==0)return P;{const L=d(F);return{x:P.x+v*L.x,y:P.y+v*L.y}}}return U.glitchFreeParametric(b,w).rawPath}}});function y(u,n){const r=f[u];return r(n)}return y}}class tt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#n,this.#r),this.#e.setReferencePath(this.#s),this.#e.setTransform(this.#o),this.#t(t)}endTime;#s;#e;#n;#r;#o;constructor(t,e){this.#s=t.base.pathString,this.#e=t.destination,this.#n=t.referenceColor,this.#r=t.liveColor,z.d=this.#s,this.#o=this.#e.getTransform(z.getBBox());const o=6e3,s=750;this.endTime=o*t.base.stepCount;const l=t.base.makeGetPath1(o,0,o-s),f=new X(e,t.base.terms);this.#t=y=>{const{pathString:u,index:n,t:r}=l(y);this.#e.setLivePath(u),f.show(t.base.keyframes[n+1],r*h.FULL_CIRCLE)}}}function et(...c){N=t=>{c.forEach(e=>e.show(t))}}let Q;setTimeout(()=>{let c=NaN;Q=new g.AnimationLoop(t=>{isNaN(c)&&(c=t);const e=t-c;N(e)}),window.animationLoop=Q},1);function st(c){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),Q.cancel(),{source:"fourier-smackdown.ts",script:c,seconds:120,devicePixelRatio}}window.initScreenCapture=st;class nt{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class k{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=h.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,o)=>{const s=e.other(t);return s===void 0||this.pathSoFar.length==1&&s!=1?[]:new k([...this.pathSoFar,s],this.remainingEdges.toSpliced(o,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(s=>Math.max(s.vertex1,s.vertex2)))+1,o=new Set;for(const s of this.get(t)){const l=s.slice(0,s.length-1),f=this.#s(l);if(!o.has(f)){yield s,o.add(f);const y=this.#e(l,e).map(u=>this.#s(u));for(const u of y)o.add(u)}}}static#s(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const o=new Array;for(let s=1;s<t.length;s++){const l=t[s],f=(l+1)%e,y=M(t,s+1);f==y?o.push(h.initializedArray(t.length,u=>{const n=M(t,u+s);return h.positiveModulo(n-l,e)})):M(t,s-1)==f&&o.push(h.initializedArray(t.length,n=>{const r=M(t,s-n);return h.positiveModulo(r-l,e)}))}return o}static getSamples(){function t(e,...o){return h.initializedArray(e,s=>o.map(l=>new nt(s,(s+l)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=k;function rt(){const c=k.getSamples(),t=k.getUnique(c.pentagram);console.log(t,t.constructor.name);for(const e of t);}rt();{class c{constructor(r){throw new Error("wtf")}static points=h.initializedArray(5,r=>{const a=h.FULL_CIRCLE*r/5+h.FULL_CIRCLE/4,i=Math.cos(a),m=Math.sin(a);return{x:i,y:m}});static allPaths=[...k.getUnique(k.getSamples().pentagram)]}class t{constructor(r){throw new Error("wtf")}static points=h.initializedArray(6,r=>{const a=h.FULL_CIRCLE*r/6+h.FULL_CIRCLE/4,i=Math.cos(a),m=Math.sin(a);return{x:i,y:m}});static allPaths=[...k.getUnique(k.getSamples().dodecahedron)];static makePathShape(r){const a=this.allPaths[r],i=Z.M(e[0].x,e[0].y);return a.forEach((m,p)=>{if(p==0){if(m!=0)throw new Error("wtf")}else{const{x:d,y:w}=e[m],S=a[p-1];switch(h.positiveModulo(m-S,6)){case 1:{i.arc(0,0,d,w,"cw");break}case 2:case 4:{i.L(d,w);break}case 5:{i.arc(0,0,d,w,"ccw");break}default:throw new Error("wtf")}}}),i.pathShape}}const e=t.points,o=t.allPaths,s=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],l=h.Random.fromString("fourier-smackdown.ts");h.initializedArray(o.length,()=>{const n=l()*3|0,r=s[n];return s.splice(n,1),s.push(r),r});const f=[{color:"red",destRect:{x:.5,y:.5,width:5,height:5},index:12},{color:"white",destRect:{x:5.5,y:3.5,width:5,height:5},index:13},{color:"var(--blue)",destRect:{x:10.5,y:.5,width:5,height:5},index:14,colorName:"blue"}],y=f.map(({index:n})=>{const r=t.makePathShape(n).rawPath;return new Y(r)});{const n=new Map;y.forEach(a=>a.terms.forEach(({frequency:i,amplitude:m})=>{const d=(n.get(i)??0)+m;n.set(i,d)}));const r=Array.from(n.entries(),([a,i])=>({frequency:a,amplitude:i}));r.sort((a,i)=>i.amplitude-a.amplitude),r.splice(10,_),console.log(r),y.forEach(({terms:a})=>{r.forEach(({frequency:i},m)=>{const p=a.findIndex(w=>w.frequency==i);let d;p==-1?d={amplitude:0,phase:0,frequency:i}:[d]=a.splice(p,1),a.splice(m,0,d)})})}const u=new Array;for(const[n,r]of h.zip(f,y)){const{color:a,destRect:i,index:m}=n,p=n.colorName??n.color,d=g.selectorQuery(`g.frequencies[data-frequencies="${p}"]`,SVGGElement),w=new $(`[data-fourier-top="${p}"]`,b=>O(b,i,"srcRect fits completely into destRect"));d.style.fill=a;const S={base:r,destination:w,liveColor:a,referenceColor:a},x=new tt(S,d);u.push(x);const E=g.selectorQuery(`text.chapter[data-chapter="${p}"]`,SVGTextElement);E.innerHTML=`#${m}`,E.style.fill=a}et(...u)}
