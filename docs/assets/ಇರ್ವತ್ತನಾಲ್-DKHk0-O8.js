import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as b}from"./client-misc-B8CxQsfg.js";import{b as W,s as tt,h as O,t as $}from"./fourier-shared-BneanVCb.js";import{p as X,d as et,b as nt,P as z}from"./path-shape-DN4hoPl6.js";import{m as i}from"./misc-BHUyxQfl.js";import{g as q,e as st}from"./utility-Dgy6CMn3.js";function rt(){document.body.style.backgroundColor="transparent",b.selectorQueryAll("[data-hide-background]",SVGElement).forEach(a=>a.style.display="none")}function ot(){const a=b.selectorQuery("[data-hide-background]",SVGElement);a.parentElement?.append(a)}{const a=i.Random.fromString("Pastel 41"),t=b.selectorQuery("[data-favorite]",SVGCircleElement),e=i.makeLinear(0,.025,2,.15);for(let r=0;r<150;r++){const n=i.assertClass(t.cloneNode(!0),SVGCircleElement);n.cx.baseVal.value=a()*16,n.cy.baseVal.value=a()*9,n.r.baseVal.value=e(a()+a()),t.parentElement.append(n)}}const N=new URLSearchParams(window.location.search);let K=!1;N.get("hide_background")=="1"?rt():N.get("only_background")=="1"&&ot();{const t=b.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const at=1024;class U{static#t=b.selectorQuery("[data-motion-blur-spinners]",HTMLDivElement);#n;constructor(t={radius:1,centerX:2,centerY:2}){const e=document.createElement("div");e.classList.add("motion-blur-spinner"),U.#t.append(e);const r=this.#n=e.style;r.setProperty("--radius",t.radius.toString()),r.setProperty("--center-x",t.centerX.toString()),r.setProperty("--center-y",t.centerY.toString()),t.color&&r.setProperty("--color",t.color),this.hide()}#e;showRadians(t){const e=this.#e??t;this.#e=t;const r=this.#n;r.display="",r.setProperty("--main-angle",`${t}rad`),r.setProperty("--blur-angle",`${e}rad`)}hide(){this.#e=void 0,this.#n.display="none"}}function B(a,t){if(a>=t)throw new Error("wtf");const e=i.makeLinear(a,0,t,1);function r(n){if(n<=a)return 0;if(n>=t)return 1;const m=e(n);return st(m)}return r}let _=()=>{};window.showFrame=a=>{_(a)};class D{constructor(t,e){this.getTransform=e,this.#t=t,this.#n=b.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=b.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new D(b.getById("right",SVGGElement),t=>X(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const H=new et;class it{constructor(t,e,r=0,n=e-r){this.stepCount=t,this.period=e,this.#t=i.makeBoundedLinear(r,0,n,1),this.endTime=e*t}#t;endTime;get(t){let e=Math.floor(t/this.period),r;e<0?(e=0,r=0):e>=this.stepCount?(e=this.stepCount-1,r=this.period):r=t%this.period;const n=this.#t(r);return{index:e,t:n}}}class ct{constructor(t){this.pathString=t,this.samples=W(t,at),this.terms=tt(this.samples),this.keyframes=i.initializedArray(21,e=>e)}samples;terms;keyframes;bins(){const t=new Array;return this.keyframes.forEach((e,r,n)=>{const m=r-1;if(m>=0){const y=n[m],F=this.terms.slice(y,e);t.push(F)}}),t}get stepCount(){return this.keyframes.length-1}makeGetPath1(t){const e=this.makeGetPath2();function r(n){const{index:m,t:y}=t.get(n);return e(m,y)}return r}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],r=this.stepCount,n=f=>Math.max(...t.slice(0,f).map(g=>Math.abs(g.frequency))),m=f=>{if(f==0)return 8;{const o=n(f);return 8*Math.min(o,50)+7}},y=i.initializedArray(r,f=>{const o=e[f],g=e[f+1];if(o==0&&g==1&&t[0].frequency==0){let L=function(k){return`${P.x*k},${P.y*k}`};const P=i.assertNonNullable(O(t[0])),V=B(0,.5),v=B(0,1);return k=>{const c=v(k),s=L(c),l=V(k),h=L(l);return`M ${s} L ${h}`}}else if(o==g){const L=$(t,o),P=m(g),v=z.glitchFreeParametric(L,P).rawPath;return k=>v}else{const P=.2/Math.abs(t[o].frequency),V=i.makeBoundedLinear(0,-P,1,1+P),v=$(t,o),k=$(t,g-o,o),c=m(g);if(o==0||o==1&&O(t[0])){const s=O(t[0])??{x:0,y:0};return l=>{const h=V(l),u=h-P,w=h+P,p=B(u,w),S=Math.min(1,w);if(S<=0)return`M${s.x},${s.y} L${s.x},${s.y}`;{let E=function(x){x=x*S;const G=v(x),R=1-p(x);if(R==0)return G;{const I=k(x);return{x:G.x+R*I.x,y:G.y+R*I.y}}};const d=Math.ceil(Math.max(c,150)*S);return z.glitchFreeParametric(E,d).rawPath}}}else return s=>{const l=V(s),h=B(l-P,l+P);function u(p){const S=v(p),E=1-h(p);if(E==0)return S;{const d=k(p);return{x:S.x+E*d.x,y:S.y+E*d.y}}}return z.glitchFreeParametric(u,c).rawPath}}});function F(f,o){const g=y[f];return g(o)}return F}}class A{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}timer;#n;#e;#s;#r;#o;base;static PERIOD=7e3;static PAUSE=1e3;constructor(t){this.base=t.base,this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,H.d=this.#n,this.#o=this.#e.getTransform(H.getBBox()),this.timer=new it(t.base.stepCount,A.PERIOD,A.PAUSE);const e=t.base.makeGetPath1(this.timer);this.#t=r=>{const n=e(r);this.#e.setLivePath(n)}}}function lt(...a){_=t=>{a.forEach(e=>e.show(t))}}let Q;setTimeout(()=>{if(K)return;let a=NaN;Q=new b.AnimationLoop(t=>{isNaN(a)&&(a=t);const e=t-a;_(e)}),window.animationLoop=Q},1);function ht(a){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),Q?.cancel(),{source:"fourier-smackdown.ts",script:a,seconds:70,devicePixelRatio}}window.initScreenCapture=ht;class ut{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class M{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=i.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,r)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new M([...this.pathSoFar,n],this.remainingEdges.toSpliced(r,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,r=new Set;for(const n of this.get(t)){const m=n.slice(0,n.length-1),y=this.#n(m);if(!r.has(y)){yield n,r.add(y);const F=this.#e(m,e).map(f=>this.#n(f));for(const f of F)r.add(f)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const r=new Array;for(let n=1;n<t.length;n++){const m=t[n],y=(m+1)%e,F=q(t,n+1);y==F?r.push(i.initializedArray(t.length,f=>{const o=q(t,f+n);return i.positiveModulo(o-m,e)})):q(t,n-1)==y&&r.push(i.initializedArray(t.length,o=>{const g=q(t,n-o);return i.positiveModulo(g-m,e)}))}return r}static getSamples(){function t(e,...r){return i.initializedArray(e,n=>r.map(m=>new ut(n,(n+m)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=M;function dt(){const a=M.getSamples(),t=M.getUnique(a.pentagram);console.log(t,t.constructor.name);for(const e of t);}dt();{let a=function(c,s,l){const h=s-c,u=l-c,w=2*c,p=2*c;return{x:h,y:u,width:w,height:p}},t=function(c){return y.map(({dark:s})=>new U({...c,color:s})).reverse()};class e{constructor(s){throw new Error("wtf")}static points=i.initializedArray(5,s=>{const l=i.FULL_CIRCLE*s/5+i.FULL_CIRCLE/4,h=Math.cos(l),u=Math.sin(l);return{x:h,y:u}});static allPaths=[...M.getUnique(M.getSamples().pentagram)]}class r{constructor(s){throw new Error("wtf")}static points=i.initializedArray(6,s=>{const l=i.FULL_CIRCLE*s/6+i.FULL_CIRCLE/4,h=Math.cos(l),u=Math.sin(l);return{x:h,y:u}});static allPaths=[...M.getUnique(M.getSamples().dodecahedron)];static makePathShape(s){const l=this.allPaths[s],h=nt.M(n[0].x,n[0].y);return l.forEach((u,w)=>{if(w==0){if(u!=0)throw new Error("wtf")}else{const{x:p,y:S}=n[u],E=l[w-1];switch(i.positiveModulo(u-E,6)){case 1:{h.arc(0,0,p,S,"cw");break}case 2:case 4:{h.L(p,S);break}case 5:{h.arc(0,0,p,S,"ccw");break}default:throw new Error("wtf")}}}),h.pathShape}}const n=r.points,m=r.allPaths,y=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],F=i.Random.fromString("fourier-smackdown.ts");i.initializedArray(m.length,()=>{const c=F()*3|0,s=y[c];return y.splice(c,1),y.push(s),s});let f=62;const o=9/4,g=.65,L=[{color:"n/a",destRect:a(o*g,o,2.75*o),index:f},{color:"n/a",destRect:a(o*g,(o+16/2)/2,9-2.75*o),index:f},{color:"n/a",destRect:a(o*g,16/2,2.75*o),index:f},{color:"n/a",destRect:a(o*g,(16-o+16/2)/2,9-2.75*o),index:f},{color:"n/a",destRect:a(o*g,16-o,2.75*o),index:f}],P={radius:o*g,cx:[o,(o+16/2)/2,16/2,(16-o+16/2)/2,16-o],cy:[9-2.75*o,2.75*o]};console.log(P);const V=L.map(({index:c})=>{const s=r.makePathShape(c).rawPath;return new ct(s)});V.forEach(({terms:c,keyframes:s},l)=>{const h=c.length,u=[],w=10;for(;u.length<w-1;){let d;u.length<6?d=2:d=3;const C=c.splice(0,d);if(C.length!=d)throw new Error("wtf");u.push(C)}const p=[],S=[];u.forEach((d,C)=>{C%3<2?p.push(d):S.unshift(d)});const E=[...p,[...c],...S];if(E.length!=w)throw new Error("wtf");if(console.log(E),c.length=0,s.length=0,s.push(0),E.forEach((d,C,x)=>{c.push(...d),s.push(c.length)}),c.length!=h)throw new Error("wtf")}),console.log(V);const v=new Array,k=b.selectorQuery("g#foreground",SVGGElement);b.getById("chapterList",SVGTextElement),L.length-1;for(const[c,s,{light:l,dark:h},u]of i.zip(L,V,y,i.count())){const{destRect:w,search:p}=c,S=p===void 0?document.createElementNS("http://www.w3.org/2000/svg","g"):b.selectorQuery(`g.frequencies[data-frequencies="${p}"]`,SVGGElement),E=p===void 0?k.appendChild(i.assertClass(b.selectorQuery("defs g[data-fourier-top]",SVGGElement).cloneNode(!0),SVGGElement)):b.selectorQuery(`[data-fourier-top="${p}"]`,SVGGElement);E.style.setProperty("--color",l),E.style.setProperty("--blur-color",h);const d=new D(E,G=>X(G,w,"srcRect fits completely into destRect"));E.dataset.liveIndex=u.toString(),S.style.fill=h;const C={base:s,destination:d,liveColor:h,referenceColor:l},x=new A(C);v.push(x),console.log(x)}{let c=function(d){const{index:C,t:x}=S.get(d),G=x>=1?-1:C,R=x*i.FULL_CIRCLE;for(const[I,Y,Z]of i.zip(E,w,i.count()))if(Z>G)Y.forEach(T=>{T.hide()});else for(const[T,j]of i.zip(I,Y)){const J=R*T.frequency+T.phase;j.showRadians(J)}};const s=P.radius/4,l=P.cx,h=P.cy,u=s*1.5,w=[];if([-1,1].forEach(d=>{const C=h[0]+d*u;[l[0],l[2],l[4]].forEach(x=>{w.push(t({centerX:x,centerY:C,radius:s}))})}),[-1,1].forEach(d=>{const C=h[1]+d*u;[l[1],l[3]].forEach(x=>{w.push(t({centerX:x,centerY:C,radius:s}))})}),w.length!=10)throw new Error("wtf");const p=i.assertClass(v[0],A),S=p.timer,E=p.base.bins();v.push({show:c})}if(console.log(v),lt(...v),N.get("thumbnail")=="1"){K=!0;const c=new Array;Array.from(k.children).forEach(s=>{const l=i.assertClass(s,SVGElement);l.dataset.live===void 0?l.style.display="none":(console.log("live",l.dataset.live),c.push(l))}),v[0].show(14e3),v[1].show(28e3),v[2].show(42e3),window.showFrame=s=>{console.info(`ignoring showFrame(${s})`)},b.selectorQueryAll("[data-reference]",SVGPathElement).forEach(s=>s.style.display="none"),b.selectorQueryAll("#new-starfield circle",SVGCircleElement).forEach(s=>{s.style.transform="scale(3)",s.style.transformOrigin=`${s.cx.baseVal.value}px ${s.cy.baseVal.value}px`})}}
