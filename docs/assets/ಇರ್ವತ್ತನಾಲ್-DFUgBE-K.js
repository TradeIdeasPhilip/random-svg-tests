import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as H,s as D,h as T,t as B}from"./fourier-shared-DpvWsPe-.js";import{p as O,d as K,b as Z,P as N}from"./path-shape-CZZKMsju.js";import{m as i}from"./misc-BHUyxQfl.js";import{g as V,e as J}from"./utility-Dgy6CMn3.js";function W(){document.body.style.backgroundColor="transparent",y.selectorQueryAll("[data-hide-background]",SVGElement).forEach(d=>d.style.display="none")}function X(){const d=y.selectorQuery("[data-hide-background]",SVGElement);d.parentElement?.append(d)}const Q=new URLSearchParams(window.location.search);let j=!1;Q.get("hide_background")=="1"?W():Q.get("only_background")=="1"&&X();{const t=y.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const Y=1024;class tt{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=y.selectorQuery(t,SVGGElement)),this.#t=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(s=>{const n=y.selectorQuery("text",SVGTextElement,s),c=document.createElementNS("http://www.w3.org/2000/svg","text");return c.classList.add("background"),s.insertBefore(c,n),{top:s,spinner:y.selectorQuery(".spinner",SVGPolygonElement,s),text:n,background:c}})}#t;show(t,e){this.#t.forEach((s,n)=>{if(n>=t)s.top.style.display="none";else{s.top.style.display="";const c=this.terms[n];s.background.innerHTML=s.text.innerHTML=c.frequency.toString(),s.spinner.style.transform=`rotate(${e*c.frequency+c.phase+i.FULL_CIRCLE/4}rad)`}})}}function M(d,t){if(d>=t)throw new Error("wtf");const e=i.makeLinear(d,0,t,1);function s(n){if(n<=d)return 0;if(n>=t)return 1;const c=e(n);return J(c)}return s}let A=()=>{};window.showFrame=d=>{A(d)};class I{constructor(t,e){this.getTransform=e,this.#t=y.selectorQuery(t,SVGGElement),this.#n=y.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=y.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new I("#right",t=>O(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const z=new K;class et{constructor(t){this.pathString=t,this.samples=H(t,Y),this.terms=D(this.samples),this.keyframes=i.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,s=t-e){const n=this.makeGetPath2(),c=i.makeBoundedLinear(e,0,s,1),x=this.stepCount;function P(g){let l=Math.floor(g/t),r;l<0?(l=0,r=0):l>=x?(l=x-1,r=t):r=g%t;const o=c(r);return{pathString:n(l,o),index:l,t:o}}return P}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],s=this.stepCount,n=g=>Math.max(...t.slice(0,g).map(r=>Math.abs(r.frequency))),c=g=>8*n(g)+7,x=i.initializedArray(s,g=>{const l=e[g],r=e[g+1];if(l==0&&r==1&&t[0].frequency==0){let o=function(u){return`${a.x*u},${a.y*u}`};const a=i.assertNonNullable(T(t[0])),h=M(0,.5),f=M(0,1);return u=>{const w=f(u),k=o(w),b=h(u),F=o(b);return`M ${k} L ${F}`}}else{const a=.2/n(r),h=i.makeBoundedLinear(0,-a,1,1+a),f=B(t,l),u=B(t,r-l,l),w=c(r);if(l==0||l==1&&T(t[0])){const k=T(t[0])??{x:0,y:0};return b=>{const F=h(b),m=F-a,p=F+a,E=M(m,p),S=Math.min(1,p);if(S<=0)return`M${k.x},${k.y} L${k.x},${k.y}`;{let C=function(G){G=G*S;const R=f(G),q=1-E(G);if(q==0)return R;{const _=u(G);return{x:R.x+q*_.x,y:R.y+q*_.y}}};const v=Math.ceil(Math.max(w,150)*S);return N.glitchFreeParametric(C,v).rawPath}}}else return k=>{const b=h(k),F=M(b-a,b+a);function m(E){const S=f(E),C=1-F(E);if(C==0)return S;{const v=u(E);return{x:S.x+C*v.x,y:S.y+C*v.y}}}return N.glitchFreeParametric(m,w).rawPath}}});function P(g,l){const r=x[g];return r(l)}return P}}class nt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#r,this.#s),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#r;#s;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#r=t.referenceColor,this.#s=t.liveColor,z.d=this.#n,this.#o=this.#e.getTransform(z.getBBox());const s=6e3,n=750;this.endTime=s*t.base.stepCount;const c=t.base.makeGetPath1(s,0,s-n),x=new tt(e,t.base.terms);this.#t=P=>{const{pathString:g,index:l,t:r}=c(P);this.#e.setLivePath(g),x.show(t.base.keyframes[l+1],r*i.FULL_CIRCLE)}}}function rt(...d){A=t=>{d.forEach(e=>e.show(t))}}let $;setTimeout(()=>{if(j)return;let d=NaN;$=new y.AnimationLoop(t=>{isNaN(d)&&(d=t);const e=t-d;A(e)}),window.animationLoop=$},1);function st(d){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),$?.cancel(),{source:"fourier-smackdown.ts",script:d,seconds:120,devicePixelRatio}}window.initScreenCapture=st;class ot{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class L{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=i.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,s)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new L([...this.pathSoFar,n],this.remainingEdges.toSpliced(s,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,s=new Set;for(const n of this.get(t)){const c=n.slice(0,n.length-1),x=this.#n(c);if(!s.has(x)){yield n,s.add(x);const P=this.#e(c,e).map(g=>this.#n(g));for(const g of P)s.add(g)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const s=new Array;for(let n=1;n<t.length;n++){const c=t[n],x=(c+1)%e,P=V(t,n+1);x==P?s.push(i.initializedArray(t.length,g=>{const l=V(t,g+n);return i.positiveModulo(l-c,e)})):V(t,n-1)==x&&s.push(i.initializedArray(t.length,l=>{const r=V(t,n-l);return i.positiveModulo(r-c,e)}))}return s}static getSamples(){function t(e,...s){return i.initializedArray(e,n=>s.map(c=>new ot(n,(n+c)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=L;function at(){const d=L.getSamples(),t=L.getUnique(d.pentagram);console.log(t,t.constructor.name);for(const e of t);}at();{let d=function(r,o=".chapter"){typeof o=="string"&&(o=y.selectorQuery(o,SVGTextElement)),o.innerHTML=`#${r} of ${e.allPaths.length}`};class t{constructor(o){throw new Error("wtf")}static points=i.initializedArray(5,o=>{const a=i.FULL_CIRCLE*o/5+i.FULL_CIRCLE/4,h=Math.cos(a),f=Math.sin(a);return{x:h,y:f}});static allPaths=[...L.getUnique(L.getSamples().pentagram)]}class e{constructor(o){throw new Error("wtf")}static points=i.initializedArray(6,o=>{const a=i.FULL_CIRCLE*o/6+i.FULL_CIRCLE/4,h=Math.cos(a),f=Math.sin(a);return{x:h,y:f}});static allPaths=[...L.getUnique(L.getSamples().dodecahedron)];static makePathShape(o){const a=this.allPaths[o],h=Z.M(s[0].x,s[0].y);return a.forEach((f,u)=>{if(u==0){if(f!=0)throw new Error("wtf")}else{const{x:w,y:k}=s[f],b=a[u-1];switch(i.positiveModulo(f-b,6)){case 1:{h.arc(0,0,w,k,"cw");break}case 2:case 4:{h.L(w,k);break}case 5:{h.arc(0,0,w,k,"ccw");break}default:throw new Error("wtf")}}}),h.pathShape}}const s=e.points,n=e.allPaths,c=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],x=i.Random.fromString("fourier-smackdown.ts");i.initializedArray(n.length,()=>{const r=x()*3|0,o=c[r];return c.splice(r,1),c.push(o),o});const P=[{color:"#black",destRect:{x:.5,y:.5,width:5,height:5},index:25,colorName:"red"},{color:"black",destRect:{x:5.5,y:3.5,width:5,height:5},index:25,colorName:"white"},{color:"black",destRect:{x:10.5,y:.5,width:5,height:5},index:25,colorName:"blue"}];d(25);const g=P.map(({index:r})=>{const o=e.makePathShape(r).rawPath;return new et(o)});console.log(g);const l=new Array;for(const[r,o]of i.zip(P,g)){const{color:a,destRect:h}=r,f=r.colorName??r.color,u=y.selectorQuery(`g.frequencies[data-frequencies="${f}"]`,SVGGElement),w=new I(`[data-fourier-top="${f}"]`,F=>O(F,h,"srcRect fits completely into destRect"));u.style.fill=a;const k={base:o,destination:w,liveColor:a,referenceColor:a},b=new nt(k,u);l.push(b),console.log(b)}{let r=function(m,p){const S=[m,m+i.FULL_CIRCLE/3,m-i.FULL_CIRCLE/3].map(G=>b(Math.sin(G)));S.push(0),S.push(F(Math.cos(p)));const C=S.join(" "),U=[C,C,C,"0 0 0 0 1"].join(`
`);h.setAttribute("values",U)},o=function(m){const p=f.map(E=>[]);m.forEach(E=>{if(E.length!=f.length)throw new Error("wtf");E.forEach((S,C)=>{p[C].push(S)})});for(const[E,S]of i.zip(f,p))E.setAttribute("tableValues",S.join(" "))},a=function(m){const p=(m+24e4)/18e4*i.FULL_CIRCLE,E=m/24e4*i.FULL_CIRCLE/2;r(p,E)};const h=y.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),f=[y.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),y.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),y.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],w=[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],k=i.makeLinear(0,0,255,1);w.forEach(m=>m.forEach((p,E,S)=>S[E]=k(p)));const b=i.makeLinear(-1,-.05,1,.8),F=i.makeLinear(1,0,-1,-.4);window.updateValues=r,o(w),l.push({show:a})}{let r=function(a){const h=i.Random.fromString(a),f=120*60;function u(){return .65+h()*.15}function w(){return .8+h()*.1}function k(){return .2+h()*.3}function b(p,E){return p+Math.floor(h()*(E-p+1))}const F=new Array;function m(p,E,S){const C=b(E,S);for(let v=0;v<C;v++)F.push(p())}for(;F.length<f;)if(m(u,60,90),h()<.15){let p=b(2,3);for(;m(k,2,3),p--,!(p<=0);)m(u,3,5)}else{let p=b(3,5);for(;m(w,2,5),p--,!(p<=0);)m(u,3,5)}return F},o=function(a,h,f=h){const u=y.selectorQuery(`#${a} feDropShadow`,SVGFEDropShadowElement),w=y.selectorQuery(`[data-fourier-top="${h}"] [data-live]:not([filter])`,SVGPathElement);function k(m){u.setAttribute("flood-color",m),w.style.stroke=m}const b=r(f);function F(m){const p=Math.floor(m/1e3*30)%b.length,S=`rgba(255, 240, 230, ${b[p]})`;k(S)}l.push({show:F})};o("big-shadow0","red"),o("big-shadow1","white"),o("big-shadow2","blue")}if(console.log(l),rt(...l),Q.get("thumbnail")=="1"){const r=y.selectorQuery("g#foreground",SVGGElement);j=!0;const o=new Array;Array.from(r.children).forEach(u=>{const w=i.assertClass(u,SVGElement);w.dataset.live===void 0?w.style.display="none":(console.log("live",w.dataset.live),o.push(w))});const a=y.selectorQueryAll("#starfield rect",SVGRectElement);a[0].parentElement.style.transform="scale(3)",a.forEach(u=>{u.style.transformOrigin=`${50/3}% 22%`}),a[1].style.transform="rotate(1.75deg)",a[2].style.transform="rotate(-1.5deg)",A(3e4),y.selectorQueryAll("[data-reference]",SVGPathElement).forEach(u=>u.style.display="none");const h=y.selectorQuery('[data-fourier-top="red"]',SVGGElement),f=getComputedStyle(h).transform;h.style.transform=f+" scale(2) translate(0px, 0.2px)",window.showFrame=u=>{console.info("ignoring showFrame()",u)}}}
