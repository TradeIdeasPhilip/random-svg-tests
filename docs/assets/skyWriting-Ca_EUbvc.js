import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as C}from"./client-misc-leadhGo2.js";import{d as N,T as x,Q as S,P as k,D as R}from"./letters-more-CS7tnLdg.js";import{b as I,a as B}from"./utility-DcEUXXL7.js";import{l as H}from"./math-to-path-CWuJ-zIl.js";const M=C("input",HTMLTextAreaElement),f=C("main",SVGElement);{const t=new x().font,{normal:a}=N(t),e=C("available",HTMLSpanElement);e.innerText=[...a].sort().join(" ")}class w{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,f.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){w.doCleanup(),this.startImpl(),w.#t=this}doCleanup(){}}class j extends w{startImpl(){const t=new x;t.restart();const a=M.value,e=t.addText(a);t.displayText(e,f),f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}const L=C("completionRatio",HTMLInputElement);class O extends w{startImpl(){const t=new x;t.restart();const a=M.value,e=t.addText(a);f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const r=x.join(e),n=document.createElementNS("http://www.w3.org/2000/svg","g");n.classList.add("handwriting"),f.appendChild(n);let s=0;r.splitOnMove().forEach(i=>{const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",i.rawPath),n.appendChild(p);const o=s,c=p.getTotalLength();s=o+c,p.style.setProperty("--offset",o.toString()),p.style.setProperty("--length",c.toString())});const h=new AbortController;this.doCleanup=()=>h.abort();const u=s,y=()=>{const i=L.valueAsNumber*u;I(i),n.style.setProperty("--total-position",i.toString())};y(),L.addEventListener("input",y,{signal:h.signal})}static start(){new this().start()}}class Q extends w{startImpl(){const t=new x;t.restart();const a=M.value,e=t.addText(a);f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const r=x.join(e),n=document.createElementNS("http://www.w3.org/2000/svg","g");n.classList.add("handwriting","skywriting"),f.appendChild(n);let s=0;r.splitOnMove().forEach(p=>{const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",p.rawPath),n.appendChild(o);const c=s,l=o.getTotalLength();s=c+l,o.style.setProperty("--offset",c.toString()),o.style.setProperty("--length",l.toString())});const h=new AbortController;this.doCleanup=()=>h.abort();const y=s+40,i=()=>{const p=L.valueAsNumber*y;I(p),n.style.setProperty("--total-position",p.toString())};i(),L.addEventListener("input",i,{signal:h.signal})}static start(){new this().start()}}function q(d,t){return Math.abs(d-t)<Math.PI/180}class E extends w{static makeRoughShape(t,a){const e=new Array,r=new Array;return t.splitOnMove().forEach(n=>{const s=n.commands,h=s.flatMap((o,c)=>c==0?[]:{x:o.x0,y:o.y0});function u(o,c){const l=a*(c?Math.SQRT1_2:1)*Math.random(),g=Math.random()*Math.PI*2,m=B(l,g),A=o.x+m.x,T=o.y+m.y;return{x:A,y:T,offset:m,initial:o}}const y=s[0],i=[u({x:y.x0,y:y.y0},"½")];h.forEach(o=>{i.push(u(o))});const p=s[s.length-1];if(i.push(u(p)),i.length!=s.length+1||s.length!=h.length+1)throw new Error("wtf");s.forEach((o,c)=>{const l=i[c],g=i[c+1],m=o instanceof S?{x:o.x1,y:o.y1}:H(l,g,Math.random()),A={x:m.x+(l.offset.x+g.offset.x)/2,y:m.y+(l.offset.y+g.offset.y)/2},T=u(A,"½");if(r.push(new S(l.x,l.y,T.x,T.y,g.x,g.y)),e.push(new S(l.initial.x,l.initial.y,m.x,m.y,g.initial.x,g.initial.y)),c>0&&q(e.at(-2).outgoingAngle,e.at(-1).incomingAngle)){const b=r.pop(),v=r.pop(),P=(v.outgoingAngle+b.incomingAngle)/2,G=S.angles(v.x0,v.y0,v.incomingAngle,v.x,v.y,P);r.push(G);const F=S.angles(b.x0,b.y0,P,b.x,b.y,b.outgoingAngle);r.push(F)}})}),{before:new k(e),after:new k(r)}}static makeRoughFont(t){const a=new Map;return t.forEach((e,r)=>{const n=new R(()=>this.makeRoughShape(e.shape,e.fontMetrics.strokeWidth*1.5).after,e.advance,e.fontMetrics);a.set(r,n)}),a}static#t=[];static instantiate(t){const a=[...this.#t];let e=!0;const r=t.map(n=>{if(e){const s=a.at(0);if(s?.char===n.char)return a.shift(),{...n,shape:s.shape};e=!1}return n});for(let n=r.length-1;n>=0;n--){const s=a.pop();if(s===void 0)break;const h=r[n];if(s.char!=h.char)break;const u={...h,shape:s.shape};r[n]=u}return r}startImpl(){const t=new x;t.font=E.makeRoughFont(t.font),t.restart();const a=M.value,e=t.addText(a),r=E.instantiate(e);E.#t=t.displayText(r,f),f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}M.addEventListener("input",()=>{w.restartCurrent()});function V(){const d=document.querySelector('input[name="type"]:checked')?.id;switch(d){case"simpleType":{j.start();break}case"handwritingType":{new O().start();break}case"skywritingType":{new Q().start();break}case"roughType":{new E().start();break}default:throw new Error(`invalid id: ${d}`)}}V();document.querySelectorAll('input[name="type"]').forEach(d=>{d.addEventListener("click",V)});
