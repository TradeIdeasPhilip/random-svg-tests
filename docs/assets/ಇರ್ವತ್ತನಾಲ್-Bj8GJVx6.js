import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as Q,s as z,g as _,t as R,h as A}from"./fourier-shared-BdjzRlL0.js";import{p as H,d as D,b as j,P as I}from"./path-shape-CZZKMsju.js";import{m as a}from"./misc-BHUyxQfl.js";import{g as M,e as K}from"./utility-Dgy6CMn3.js";const X=1024;class Z{constructor(e,s){this.terms=s,e instanceof SVGGElement||(e=y.selectorQuery(e,SVGGElement)),this.#e=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,e).map(n=>({top:n,spinner:y.selectorQuery(".spinner",SVGPolygonElement,n),text:y.selectorQuery("text",SVGTextElement,n)}))}#e;show(e,s,n){this.#e.forEach((t,r)=>{if(r>=e+s)t.top.style.display="none";else{t.top.style.display="";const h=this.terms[r];t.text.innerHTML=h.frequency.toString(),t.spinner.style.transform=`rotate(${n*h.frequency+h.phase+a.FULL_CIRCLE/4}rad)`}})}}function V(c,e){if(c>=e)throw new Error("wtf");const s=a.makeLinear(c,0,e,1);function n(t){if(t<=c)return 0;if(t>=e)return 1;const r=s(t);return K(r)}return n}let $=()=>{};window.showFrame=c=>{$(c)};class U{constructor(e,s){this.getTransform=s,this.#e=y.selectorQuery(e,SVGGElement),this.#s=y.selectorQuery("[data-reference]",SVGPathElement,this.#e),this.#t=y.selectorQuery("[data-live]",SVGPathElement,this.#e)}#e;#s;#t;hide(){this.#e.style.display="none"}show(e,s){this.#e.style.display="",this.#s.style.stroke=e,this.#t.style.stroke=s}setReferencePath(e){this.#s.setAttribute("d",e)}setLivePath(e){this.#t.setAttribute("d",e)}setTransform(e){const s=e.a;this.#e.style.transform=e.toString(),this.#e.style.setProperty("--path-scale",s.toString())}static right=new U("#scaled",e=>H(e,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}class J{static colorSummary(e){if(e instanceof HTMLCanvasElement&&(e=e.getContext("2d")),e instanceof CanvasRenderingContext2D){const{height:t,width:r}=e.canvas;e=e.getImageData(0,0,r,t)}class s{#c=0;#l=0;#o=1/0;#a=-1/0;get min(){return this.#o}get max(){return this.#a}get average(){return this.#l/this.#c}add(r){this.#c++,this.#l+=r,this.#a=Math.max(this.#a,r),this.#o=Math.min(this.#o,r)}get(){return{min:this.min,max:this.max,average:this.average}}}const n=a.initializedArray(4,()=>new s);return e.data.forEach((t,r)=>n[r%4].add(t)),{red:n[0].get(),green:n[1].get(),blue:n[2].get(),alpha:n[3].get()}}#e=y.getById("backgroundCanvas",HTMLCanvasElement);#s;constructor(e){this.#s=this.#r(e)}#t=a.assertNonNullable(this.#e.getContext("2d",{colorSpace:"display-p3"}));#r(e){y.selectorQuery("feTurbulence",SVGFETurbulenceElement).seed.baseVal=e;const s=document.createElement("canvas");s.width=3840,s.height=2160;const n=s.getContext("2d",{colorSpace:"display-p3"}),t=n.createLinearGradient(0,0,3840,2160);return t.addColorStop(0,"hsl(220, 10%, 30%)"),t.addColorStop(1,"hsl(220, 15%, 40%)"),n.fillStyle=t,n.globalCompositeOperation="source-over",n.filter="url(#noiseFilter)",n.fillStyle="rgb(255, 165, 0)",n.fillRect(0,0,3840,2160),n.filter="none",n.globalCompositeOperation="source-over",s}#i=a.makeLinear(-1,.333,1,.5);#n=0;addDebugText(e){const s=this.#n*216+108;this.#n=(this.#n+1)%10,this.#t.font="100px sans-serif",this.#t.fillStyle="white",this.#t.fillText(e,20,s)}draw(e){const s=this.#t;s.drawImage(this.#s,0,0);const n=[0,a.FULL_CIRCLE/3,a.FULL_CIRCLE*(2/3)],t=6e4,r=(e+2e4)%t/t*a.FULL_CIRCLE,[h,g,d]=n.map(f=>this.#i(Math.sin(r+f)));s.globalCompositeOperation="multiply",s.fillStyle=`rgb(${h*255}, ${g*255}, ${d*255})`,s.fillRect(0,0,3840,2160),s.globalCompositeOperation="source-over"}extract(e){e!==void 0&&this.draw(e);const{promise:s,resolve:n,reject:t}=Promise.withResolvers();return this.#e.toBlob(r=>{r?n(r):t("wtf")},"image/png",1),s}}const N=new D;class W{hide(){this.#t.hide()}#e;show(e){this.#t.show(this.#r,this.#i),this.#t.setReferencePath(this.#s),this.#t.setTransform(this.#n),this.#e(e)}endTime;#s;#t;#r;#i;#n;constructor(e,s){this.#s=e.pathString,this.#t=e.destination,this.#r=e.referenceColor,this.#i=e.liveColor,N.d=this.#s,this.#n=this.#t.getTransform(N.getBBox());const n=Q(e.pathString,X),t=z(n),r=_({addTime:5250,pauseTime:750,maxGroupsToDisplay:e.maxGroupsToDisplay,skipCountAtEnd:e.skipCountAtEnd??0,terms:t});this.endTime=r.at(-1).endTime;const h=i=>Math.max(...t.slice(0,i).map(o=>Math.abs(o.frequency))),g=i=>8*h(i)+7,d=r.map(i=>{if(i.addingCircles==0){const l=R(t,i.usingCircles),o=g(i.usingCircles),u=I.glitchFreeParametric(l,o);return()=>u.rawPath}else if(i.usingCircles==0&&i.addingCircles==1&&t[0].frequency==0){let l=function(p){return`${x.x*p},${x.y*p}`};const{startTime:o,endTime:u}=i,m=u-o,C=V(o,o+m/2),S=V(o,u),x=A(t[0]);return p=>{const w=S(p),F=l(w),T=C(p),L=l(T);return`M ${F} L ${L}`}}else{const o=.2/h(i.usingCircles+i.addingCircles),u=a.makeBoundedLinear(i.startTime,-o,i.endTime,1+o),m=R(t,i.usingCircles),C=R(t,i.addingCircles,i.usingCircles);let S=g(i.usingCircles+i.addingCircles);if(i.usingCircles==0||i.usingCircles==1&&A(t[0])){const x=A(t[0])??{x:0,y:0};return p=>{const w=u(p),F=w-o,T=w+o,L=V(F,T),v=Math.min(1,T);if(v<=0)return`M${x.x},${x.y} L${x.x},${x.y}`;{let b=function(P){P=P*v;const q=m(P),G=1-L(P);if(G==0)return q;{const B=C(P);return{x:q.x+G*B.x,y:q.y+G*B.y}}};const E=Math.ceil(Math.max(S,150)*v);return I.glitchFreeParametric(b,E).rawPath}}}else return x=>{const p=u(x),w=V(p-o,p+o);function F(L){const v=m(L),b=1-w(L);if(b==0)return v;{const E=C(L);return{x:v.x+b*E.x,y:v.y+b*E.y}}}return I.glitchFreeParametric(F,S).rawPath}}}),f=new Z(s,t);this.#e=i=>{function l(){const w=r.findIndex(({endTime:F})=>i<F);return w==-1?r.length-1:w}const o=l(),u=d[o](i);this.#t.setLivePath(u);const{usingCircles:m,addingCircles:C,startTime:S,endTime:x}=r[o],p=C>0?(i-S)/(x-S)*a.FULL_CIRCLE:0;f.show(m,C,p)}}}function Y(c){const e=y.selectorQuery("g.frequencies",SVGGElement);e.style.fill=c.referenceColor;const s=new W(c,e),n=new J(c.backgroundSeed);window.customBackground=n,$=t=>{n.draw(t),s.show(t)}}let O;setTimeout(()=>{let c=NaN;O=new y.AnimationLoop(e=>{isNaN(c)&&(c=e);const s=e-c;$(s)}),window.animationLoop=O},1);function ee(c){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(e=>{if(!(e instanceof SVGElement||e instanceof HTMLElement))throw new Error("wtf");e.style.display="none"}),O.cancel(),{source:"fourier-smackdown.ts",script:c,seconds:120,devicePixelRatio}}window.initScreenCapture=ee;class te{constructor(e,s){this.vertex1=e,this.vertex2=s}has(e){return e==this.vertex1||e==this.vertex2}other(e){if(this.vertex1==e)return this.vertex2;if(this.vertex2==e)return this.vertex1}}class k{constructor(e,s){this.pathSoFar=e,this.remainingEdges=s}oneStep(){const e=a.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((s,n)=>{const t=s.other(e);return t===void 0||this.pathSoFar.length==1&&t!=1?[]:new k([...this.pathSoFar,t],this.remainingEdges.toSpliced(n,1))})}*#e(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const e=this.oneStep();for(const s of e)yield*s.#e()}}static*get(e){yield*new this([0],e).#e()}static*getUnique(e){const s=Math.max(...e.map(t=>Math.max(t.vertex1,t.vertex2)))+1,n=new Set;for(const t of this.get(e)){const r=t.slice(0,t.length-1),h=this.#s(r);if(!n.has(h)){yield t,n.add(h);const g=this.#t(r,s).map(d=>this.#s(d));for(const d of g)n.add(d)}}}static#s(e){return String.fromCharCode(...e.map(s=>s+65))}static#t(e,s){const n=new Array;for(let t=1;t<e.length;t++){const r=e[t],h=(r+1)%s,g=M(e,t+1);h==g?n.push(a.initializedArray(e.length,d=>{const f=M(e,d+t);return a.positiveModulo(f-r,s)})):M(e,t-1)==h&&n.push(a.initializedArray(e.length,f=>{const i=M(e,t-f);return a.positiveModulo(i-r,s)}))}return n}static getSamples(){function e(s,...n){return a.initializedArray(s,t=>n.map(r=>new te(t,(t+r)%s))).flat()}return{pentagram:e(5,1,2),dodecahedron:e(6,1,2),square:e(4,1),hex:e(10,1)}}}window.Progress=k;function se(){const c=k.getSamples(),e=k.getUnique(c.pentagram);console.log(e,e.constructor.name);for(const s of e);}se();{a.initializedArray(5,l=>{const o=a.FULL_CIRCLE*l/5+a.FULL_CIRCLE/4,u=Math.cos(o),m=Math.sin(o);return{x:u,y:m}});const c=a.initializedArray(6,l=>{const o=a.FULL_CIRCLE*l/6+a.FULL_CIRCLE/4,u=Math.cos(o),m=Math.sin(o);return{x:u,y:m}}),e=[...k.getUnique(k.getSamples().dodecahedron)],s=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],n=a.Random.fromString("fourier-smackdown.ts"),t=a.initializedArray(e.length,()=>{const l=n()*3|0,o=s[l];return s.splice(l,1),s.push(o),o}),r=a.parseIntX(new URLSearchParams(window.location.search).get("index")),h=r??Math.random()*e.length|0,g=e[h];t[h];const d={light:"var(--pastel-pink)",dark:"var(--darker-pink)"};console.log({requestedIndex:r,index:h,path:g,...d}),console.log(e);{const l=y.getById("chapter",SVGTextElement);l.innerHTML=`#${h} of ${e.length}`,l.style.fill=d.dark}const f=j.M(c[0].x,c[0].y);g.forEach((l,o)=>{if(o==0){if(l!=0)throw new Error("wtf")}else{const{x:u,y:m}=c[l],C=g[o-1];switch(a.positiveModulo(l-C,6)){case 1:{f.arc(0,0,u,m,"cw");break}case 2:case 4:{f.L(u,m);break}case 5:{f.arc(0,0,u,m,"ccw");break}default:throw new Error("wtf")}}});const i=f.pathShape.rawPath;console.log(i),Y({maxGroupsToDisplay:15,skipCountAtEnd:1,pathString:i,destination:U.right,liveColor:d.light,referenceColor:d.dark,backgroundSeed:h})}
