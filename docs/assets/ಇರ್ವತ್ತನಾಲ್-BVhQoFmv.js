import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as p}from"./client-misc-B8CxQsfg.js";import{b as H,s as D,h as B,t as _}from"./fourier-shared-DpvWsPe-.js";import{p as O,d as K,b as Z,P as $}from"./path-shape-CZZKMsju.js";import{m as i}from"./misc-BHUyxQfl.js";import{g as T,e as J}from"./utility-Dgy6CMn3.js";import{a as W}from"./hershey-fonts-Cv6hiE5v.js";import{r as X}from"./letters-base-CTGJGQGt.js";function Y(){document.body.style.backgroundColor="transparent",p.selectorQueryAll("[data-hide-background]",SVGElement).forEach(h=>h.style.display="none")}function tt(){const h=p.selectorQuery("[data-hide-background]",SVGElement);h.parentElement?.append(h)}const I=new URLSearchParams(window.location.search);let j=!1;I.get("hide_background")=="1"?Y():I.get("only_background")=="1"&&tt();{const t=p.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const et=1024;class nt{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=p.selectorQuery(t,SVGGElement)),this.#t=p.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(o=>{const n=p.selectorQuery("text",SVGTextElement,o),u=document.createElementNS("http://www.w3.org/2000/svg","text");return u.classList.add("background"),o.insertBefore(u,n),{top:o,spinner:p.selectorQuery(".spinner",SVGPolygonElement,o),text:n,background:u}})}#t;show(t,e){this.#t.forEach((o,n)=>{if(n>=t)o.top.style.display="none";else{o.top.style.display="";const u=this.terms[n];o.background.innerHTML=o.text.innerHTML=u.frequency.toString(),o.spinner.style.transform=`rotate(${e*u.frequency+u.phase+i.FULL_CIRCLE/4}rad)`}})}}function q(h,t){if(h>=t)throw new Error("wtf");const e=i.makeLinear(h,0,t,1);function o(n){if(n<=h)return 0;if(n>=t)return 1;const u=e(n);return J(u)}return o}let Q=()=>{};window.showFrame=h=>{Q(h)};class U{constructor(t,e){this.getTransform=e,this.#t=p.selectorQuery(t,SVGGElement),this.#n=p.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=p.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new U("#right",t=>O(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const z=new K;class st{constructor(t){this.pathString=t,this.samples=H(t,et),this.terms=D(this.samples),this.keyframes=i.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,o=t-e){const n=this.makeGetPath2(),u=i.makeBoundedLinear(e,0,o,1),k=this.stepCount;function F(d){let c=Math.floor(d/t),a;c<0?(c=0,a=0):c>=k?(c=k-1,a=t):a=d%t;const m=u(a);return{pathString:n(c,m),index:c,t:m}}return F}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],o=this.stepCount,n=d=>Math.max(...t.slice(0,d).map(a=>Math.abs(a.frequency))),u=d=>{const c=n(d);return 8*Math.min(c,50)+7},k=i.initializedArray(o,d=>{const c=e[d],a=e[d+1];if(c==0&&a==1&&t[0].frequency==0){let m=function(f){return`${s.x*f},${s.y*f}`};const s=i.assertNonNullable(B(t[0])),r=q(0,.5),l=q(0,1);return f=>{const y=l(f),g=m(y),E=r(f),S=m(E);return`M ${g} L ${S}`}}else{const s=.2/Math.abs(t[c].frequency),r=i.makeBoundedLinear(0,-s,1,1+s),l=_(t,c),f=_(t,a-c,c),y=u(a);if(c==0||c==1&&B(t[0])){const g=B(t[0])??{x:0,y:0};return E=>{const S=r(E),C=S-s,V=S+s,G=q(C,V),w=Math.min(1,V);if(w<=0)return`M${g.x},${g.y} L${g.x},${g.y}`;{let x=function(L){L=L*w;const A=l(L),M=1-G(L);if(M==0)return A;{const R=f(L);return{x:A.x+M*R.x,y:A.y+M*R.y}}};const b=Math.ceil(Math.max(y,150)*w);return $.glitchFreeParametric(x,b).rawPath}}}else return g=>{const E=r(g),S=q(E-s,E+s);function C(G){const w=l(G),x=1-S(G);if(x==0)return w;{const b=f(G);return{x:w.x+x*b.x,y:w.y+x*b.y}}}return $.glitchFreeParametric(C,y).rawPath}}});function F(d,c){const a=k[d];return a(c)}return F}}class rt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#s;#r;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,z.d=this.#n,this.#o=this.#e.getTransform(z.getBBox());const o=7500,n=750;this.endTime=o*t.base.stepCount;const u=t.base.makeGetPath1(o,0,o-n),k=new nt(e,t.base.terms);this.#t=F=>{const{pathString:d,index:c,t:a}=u(F);this.#e.setLivePath(d),k.show(t.base.keyframes[c+1],a*i.FULL_CIRCLE)}}}function ot(...h){Q=t=>{h.forEach(e=>e.show(t))}}let N;setTimeout(()=>{if(j)return;let h=NaN;N=new p.AnimationLoop(t=>{isNaN(h)&&(h=t);const e=t-h;Q(e)}),window.animationLoop=N},1);function at(h){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),N?.cancel(),{source:"fourier-smackdown.ts",script:h,seconds:120,devicePixelRatio}}window.initScreenCapture=at;class it{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class v{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=i.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,o)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new v([...this.pathSoFar,n],this.remainingEdges.toSpliced(o,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,o=new Set;for(const n of this.get(t)){const u=n.slice(0,n.length-1),k=this.#n(u);if(!o.has(k)){yield n,o.add(k);const F=this.#e(u,e).map(d=>this.#n(d));for(const d of F)o.add(d)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const o=new Array;for(let n=1;n<t.length;n++){const u=t[n],k=(u+1)%e,F=T(t,n+1);k==F?o.push(i.initializedArray(t.length,d=>{const c=T(t,d+n);return i.positiveModulo(c-u,e)})):T(t,n-1)==k&&o.push(i.initializedArray(t.length,c=>{const a=T(t,n-c);return i.positiveModulo(a-u,e)}))}return o}static getSamples(){function t(e,...o){return i.initializedArray(e,n=>o.map(u=>new it(n,(n+u)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=v;function ct(){const h=v.getSamples(),t=v.getUnique(h.pentagram);console.log(t,t.constructor.name);for(const e of t);}ct();{let h=function(a,m=0){const s=[],r=a.terms,l=r.length,f=7,y=10,g=r.splice(1,3),E=g.splice(m,1);for(s.push(g);s.length<y-2;){let C;s.length<6?C=1:(s.length<9,C=2);const V=r.splice(0,C);if(V.length!=C)throw new Error("wtf");s.push(V)}if(s.splice(f,0,[...r]),s.push(E),console.log(s),s.length!=y)throw new Error("wtf");if(r.length=0,r.length!=0)throw new Error("wtf");const S=a.keyframes;if(S.length=0,S.push(0),s.forEach(C=>{r.push(...C),S.push(r.length)}),r.length!=l)throw new Error("wtf")};class t{constructor(m){throw new Error("wtf")}static points=i.initializedArray(5,m=>{const s=i.FULL_CIRCLE*m/5+i.FULL_CIRCLE/4,r=Math.cos(s),l=Math.sin(s);return{x:r,y:l}});static allPaths=[...v.getUnique(v.getSamples().pentagram)]}class e{constructor(m){throw new Error("wtf")}static points=i.initializedArray(6,m=>{const s=i.FULL_CIRCLE*m/6+i.FULL_CIRCLE/4,r=Math.cos(s),l=Math.sin(s);return{x:r,y:l}});static allPaths=[...v.getUnique(v.getSamples().dodecahedron)];static makePathShape(m){const s=this.allPaths[m],r=Z.M(o[0].x,o[0].y);return s.forEach((l,f)=>{if(f==0){if(l!=0)throw new Error("wtf")}else{const{x:y,y:g}=o[l],E=s[f-1];switch(i.positiveModulo(l-E,6)){case 1:{r.arc(0,0,y,g,"cw");break}case 2:case 4:{r.L(y,g);break}case 5:{r.arc(0,0,y,g,"ccw");break}default:throw new Error("wtf")}}}),r.pathShape}}const o=e.points,n=e.allPaths,u=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],k=i.Random.fromString("fourier-smackdown.ts");i.initializedArray(n.length,()=>{const a=k()*3|0,m=u[a];return u.splice(a,1),u.push(m),m});const F=[{color:"#black",destRect:{x:.5,y:.5,width:5,height:5},index:33,colorName:"red"},{color:"black",destRect:{x:5.5,y:3.5,width:5,height:5},index:33,colorName:"white"},{color:"black",destRect:{x:10.5,y:.5,width:5,height:5},index:33,colorName:"blue"}],d=F.map(({index:a})=>{const m=e.makePathShape(a).rawPath;return new st(m)});console.log(d),h(d[0],0),h(d[1],1),h(d[2],2);const c=new Array;for(const[a,m]of i.zip(F,d)){const{color:s,destRect:r}=a,l=a.colorName??a.color,f=p.selectorQuery(`g.frequencies[data-frequencies="${l}"]`,SVGGElement),y=new U(`[data-fourier-top="${l}"]`,S=>O(S,r,"srcRect fits completely into destRect"));f.style.fill=s;const g={base:m,destination:y,liveColor:s,referenceColor:s},E=new rt(g,f);c.push(E),console.log(E)}{let a=function(w,x){const P=[w,w+i.FULL_CIRCLE/3,w-i.FULL_CIRCLE/3].map(R=>V(Math.sin(R)));P.push(0),P.push(G(Math.cos(x)));const L=P.join(" "),M=[L,L,L,"0 0 0 0 1"].join(`
`);r.setAttribute("values",M)},m=function(w){const x=l.map(b=>[]);w.forEach(b=>{if(b.length!=l.length)throw new Error("wtf");b.forEach((P,L)=>{x[L].push(P)})});for(const[b,P]of i.zip(l,x))b.setAttribute("tableValues",P.join(" "))},s=function(w){const x=w/24e4*i.FULL_CIRCLE*2,b=w/24e4*i.FULL_CIRCLE/2;a(x,b)};const r=p.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),l=[p.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),p.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),p.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],S=[[[25,25,112],[70,130,180],[147,112,219],[60,179,113],[199,21,133],[0,206,209],[216,191,216]],[[65,105,225],[204,85,0],[255,160,122],[255,182,193],[255,245,157],[175,238,238]],[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],[[70,100,80],[90,120,100],[110,140,120],[130,160,140],[150,180,160],[170,200,180]]].at(-1),C=i.makeLinear(0,0,255,1);S.forEach(w=>w.forEach((x,b,P)=>P[b]=C(x)));const V=i.makeLinear(-1,-.05,1,.8),G=i.makeLinear(1,0,-1,-.4);window.updateValues=a,m(S),c.push({show:s})}if(console.log(c),ot(...c),I.get("thumbnail")=="1"){const a=p.selectorQuery("g#foreground",SVGGElement);j=!0;const m=new Array;Array.from(a.children).forEach(r=>{const l=i.assertClass(r,SVGElement);l.dataset.live===void 0?l.style.display="none":(console.log("live",l.dataset.live),m.push(l))}),Q(0),p.selectorQueryAll("[data-reference]",SVGPathElement).forEach(r=>r.style.display="none");const s=X(W,.5);[{name:"red",letter:"S"},{name:"white",letter:"V"},{name:"blue",letter:"G"}].forEach(({name:r,letter:l})=>{const f=s.get(l),y=f.shape.translate(f.advance/2,0).rawPath;p.selectorQueryAll(`[data-fourier-top="${r}"] [data-live]`,SVGPathElement,2,2).forEach(E=>{E.setAttribute("d",y)})}),p.selectorQueryAll("[data-fourier-top]",SVGGElement,3,3).forEach((r,l)=>{const f=getComputedStyle(r).transform,y=["-0.5px, -0.13px","-0.43px,-0.35px","-0.5px, -.13px"];r.style.transform=`${f} scale(4) translate(${y[l]})`}),window.showFrame=r=>{console.info("ignoring showFrame()",r)}}}
