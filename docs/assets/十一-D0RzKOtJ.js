import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as h,A as nt}from"./client-misc-1LRynplM.js";import{m as H}from"./misc-CLGTS8fC.js";import{R,m as et,a as k,c as it}from"./utility-CiDAvosU.js";import{m as G,T as W}from"./letters-more-CEUY2q3y.js";import{m as B}from"./rough-lib-HG5NVJFl.js";import{H as ot}from"./handwriting-effect-C7XdtHPU.js";import"./path-shape-Daut0qjt.js";import"./math-to-path-DqQ6Gsvd.js";const D=h("randomSeed",HTMLInputElement),st=h("draw",HTMLButtonElement),at=h("timeInSeconds",HTMLInputElement),N=h("start",HTMLButtonElement),rt=h("time",HTMLInputElement),L=h("handwriting",SVGGElement),b=h("morph",SVGGElement);st.addEventListener("click",()=>{P()});const ct=Intl.NumberFormat(void 0,{useGrouping:!0,maximumFractionDigits:4}),mt=Intl.NumberFormat(void 0,{useGrouping:!0,minimumFractionDigits:2,maximumFractionDigits:2}),ut=Intl.NumberFormat(void 0,{useGrouping:!0,minimumFractionDigits:4,maximumFractionDigits:4});function P(){function s(t){const n=ct.format(t),o=t+1,e=t-1,i=o/e,c=e/o,u=(i+c)/2,r=i-u;return isFinite(u)&&isFinite(r)?{baseValueString:n,finite:!0,meanString:mt.format(u),errorString:ut.format(r)}:{baseValueString:n,finite:!1,errorMessage:"#DIV/0!"}}const p=[{strings:s(10001),finalRough:0},{strings:s(1001),finalRough:0},{strings:s(101),finalRough:.2},{strings:s(11),finalRough:.45},{strings:s(2),finalRough:.7},{strings:s(1.1),finalRough:1},{strings:s(1.01),finalRough:1.2},{strings:s(1.001),finalRough:1.5},{strings:s(1.0001),finalRough:2},{strings:s(1),finalRough:0}];let d=D.value;R.seedIsValid(d)||(d=R.newSeed(),D.value=d);const y=R.create(d);L.innerHTML="",b.innerHTML="";class I{#n=new Array;get letters(){return[...this.#n]}#t=new W;constructor(n){n instanceof Map||(n=G(n)),this.#t.font=n,this.restart()}restart(){this.#t.restart(0,0),this.#n.length=0}addAndTag(n,o){const e=this.#t.addText(n),i=this.#n;e.forEach(c=>i.push({colorName:o,...c}))}get width(){return this.#t.x}extract(){const n={width:this.width,letters:this.letters};return this.restart(),n}single(n,o){return this.restart(),this.addAndTag(n,o),this.extract()}}const g=G(2.7),m=new I(g),w=m.single(" ÷ ","blue"),F=m.single(" → ","blue"),S=p.map(t=>{const n=t.strings;m.addAndTag("("+n.baseValueString,"blue"),m.addAndTag(" ± 1","white"),m.addAndTag(")","blue");const o=m.extract();if(n.finite){const e=m.single(n.meanString,"blue"),i=m.single(" ± "+n.errorString,"white");return{inputLayoutInfo:o,finite:!0,meanLayoutInfo:e,errorLayoutInfo:i}}else{const e=m.single(n.errorMessage,"gold");return{inputLayoutInfo:o,finite:!1,messageLayoutInfo:e}}});let a=7;const x=Math.max(...S.map(t=>t.inputLayoutInfo.width)),M=a+x/2;a+=x;const C=a;a+=w.width;const O=a+x/2;a+=x;const _=a;a+=F.width;const q=Math.max(...S.flatMap(t=>t.finite?[t.meanLayoutInfo.width]:[])),v=a;a+=q;const U=a,X=Math.max(...S.flatMap(t=>t.finite?[t.errorLayoutInfo.width]:[]));a+=X;const j=a,z=a,J=S.map((t,n)=>{const o=[],e=(n+1)*4.8*1.125;function i(r,l,f){l.forEach(E=>{o.push({...E,x:E.x+r,baseline:e,neverLeaveRough:f})})}const c=M-t.inputLayoutInfo.width/2;i(c,t.inputLayoutInfo.letters,!0),i(C,w.letters,!0);const u=c-M+O;if(i(u,t.inputLayoutInfo.letters,!0),i(_,F.letters,!0),t.finite){const r=t.meanLayoutInfo;i(U-r.width,r.letters,!1);const l=t.errorLayoutInfo;i(j-l.width,l.letters,!1)}else{const l=z-v-t.messageLayoutInfo.width,f=v+l/2;i(f,t.messageLayoutInfo.letters,!0)}return o}),T=[];J.map((t,n)=>{const o=p[n].finalRough;t.forEach(e=>{const i=B(e.description.shape,e.description.fontMetrics.strokeWidth,y),c=e.neverLeaveRough?0:o;if(c<=1){const u=i.after,r=i.before,l=1-c,f=e.description.reshape(u);T.push({...e,initialShape:u,finalShape:r,finalAnimation:l,description:f})}else{const u=B(i.after,e.description.fontMetrics.strokeWidth*(c-1)*3,y),r=u.before,l=u.after,f="forever",E=e.description.reshape(r);T.push({...e,initialShape:r,finalShape:l,finalAnimation:f,description:E})}})});const A=W.displayText(T,b).map(t=>{t.element.classList.add(t.colorName);const n=t.finalAnimation,o=[{offset:0,d:t.initialShape.cssPath},{offset:1,d:t.finalShape.cssPath}];if(typeof n=="number"){const e=t.element.animate(o,{duration:1,fill:"both"});e.currentTime=n,e.commitStyles(),e.cancel(),o.pop();const i=t.element.animate(o,{duration:1,fill:"both"});return i.pause(),i}else{const e=t.element.animate(o,{duration:5,fill:"both",direction:"alternate",iterations:1/0});return e.pause(),e}}),K=()=>{b.style.display="none"},Q=t=>{k(t),b.style.display="";const o=t*A.length*(.5+1);A.forEach((e,i)=>{const c=o-i;e.currentTime=c})};{const t=new ot(L);T.forEach(n=>{t.add({baseline:n.baseline,x:n.x,shape:n.description.shape}).forEach(({element:e})=>{e.classList.add(n.colorName)})})}const Y=()=>{L.style.display="none"},Z=t=>{k(t),L.style.display="",L.style.setProperty("--t",t.toString())},$=et(2,1.5),tt=t=>{const n=$(t);switch(n.index){case 0:{K(),Z(n.t);break}case 1:{Y(),Q(n.t);break}default:throw new Error("wtf")}};window.showFrame=tt,N.disabled=!1}let V;N.addEventListener("click",()=>{V?.cancel();const s=H.parseIntX(at.value);if(s===void 0)throw new Error("I don't want to do this better");let p=0,d;const y=it(3),I=new nt(g=>{if(d||(p=g+s*1e3,d=H.makeLinear(g,0,p,1)),g>p)I.cancel(),window.showFrame(1);else{const m=d(g),w=y(m);rt.value=w.toString(),window.showFrame(w)}});V=I});function lt(){return P(),document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(s=>{if(!(s instanceof SVGElement||s instanceof HTMLElement))throw new Error("wtf");s.style.display="none"}),{source:"show-text-1.ts",devicePixelRatio}}window.initScreenCapture=lt;
