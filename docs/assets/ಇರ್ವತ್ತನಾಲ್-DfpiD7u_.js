import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as H,s as W,h as T,t as $}from"./fourier-shared-NjkoHtEt.js";import{p as O,d as D,b as K,P as I}from"./path-shape-CZZKMsju.js";import{m as i}from"./misc-BHUyxQfl.js";import{g as M,e as Z}from"./utility-Dgy6CMn3.js";function J(){document.body.style.backgroundColor="transparent",y.selectorQueryAll("[data-hide-background]",SVGElement).forEach(h=>h.style.display="none")}function X(){const h=y.selectorQuery("[data-hide-background]",SVGElement);h.parentElement?.append(h)}const q=new URLSearchParams(window.location.search);let z=!1;q.get("hide_background")=="1"?J():q.get("only_background")=="1"&&X();{const t=y.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const Y=1024;class tt{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=y.selectorQuery(t,SVGGElement)),this.#t=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(o=>{const s=y.selectorQuery("text",SVGTextElement,o),u=document.createElementNS("http://www.w3.org/2000/svg","text");return u.classList.add("background"),o.insertBefore(u,s),{top:o,spinner:y.selectorQuery(".spinner",SVGPolygonElement,o),text:s,background:u}})}#t;show(t,e){this.#t.forEach((o,s)=>{if(s>=t)o.top.style.display="none";else{o.top.style.display="";const u=this.terms[s];o.background.innerHTML=o.text.innerHTML=u.frequency.toString(),o.spinner.style.transform=`rotate(${e*u.frequency+u.phase+i.FULL_CIRCLE/4}rad)`}})}}function A(h,t){if(h>=t)throw new Error("wtf");const e=i.makeLinear(h,0,t,1);function o(s){if(s<=h)return 0;if(s>=t)return 1;const u=e(s);return Z(u)}return o}let N=()=>{};window.showFrame=h=>{N(h)};class U{constructor(t,e){this.getTransform=e,this.#t=y.selectorQuery(t,SVGGElement),this.#n=y.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=y.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new U("#right",t=>O(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const B=new D;class et{constructor(t){this.pathString=t,this.samples=H(t,Y),this.terms=W(this.samples),this.keyframes=i.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,o=t-e){const s=this.makeGetPath2(),u=i.makeBoundedLinear(e,0,o,1),E=this.stepCount;function x(g){let m=Math.floor(g/t),f;m<0?(m=0,f=0):m>=E?(m=E-1,f=t):f=g%t;const c=u(f);return{pathString:s(m,c),index:m,t:c}}return x}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],o=this.stepCount,s=g=>Math.max(...t.slice(0,g).map(f=>Math.abs(f.frequency))),u=g=>8*s(g)+7,E=i.initializedArray(o,g=>{const m=e[g],f=e[g+1];if(m==0&&f==1&&t[0].frequency==0){let c=function(n){return`${r.x*n},${r.y*n}`};const r=i.assertNonNullable(T(t[0])),a=A(0,.5),l=A(0,1);return n=>{const d=l(n),p=c(d),C=a(n),b=c(C);return`M ${p} L ${b}`}}else{const r=.2/s(f),a=i.makeBoundedLinear(0,-r,1,1+r),l=$(t,m),n=$(t,f-m,m),d=u(f);if(m==0||m==1&&T(t[0])){const p=T(t[0])??{x:0,y:0};return C=>{const b=a(C),P=b-r,k=b+r,F=A(P,k),w=Math.min(1,k);if(w<=0)return`M${p.x},${p.y} L${p.x},${p.y}`;{let S=function(V){V=V*w;const G=l(V),R=1-F(V);if(R==0)return G;{const _=n(V);return{x:G.x+R*_.x,y:G.y+R*_.y}}};const L=Math.ceil(Math.max(d,150)*w);return I.glitchFreeParametric(S,L).rawPath}}}else return p=>{const C=a(p),b=A(C-r,C+r);function P(F){const w=l(F),S=1-b(F);if(S==0)return w;{const L=n(F);return{x:w.x+S*L.x,y:w.y+S*L.y}}}return I.glitchFreeParametric(P,d).rawPath}}});function x(g,m){const f=E[g];return f(m)}return x}}class nt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#s;#r;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,B.d=this.#n,this.#o=this.#e.getTransform(B.getBBox());const o=6e3,s=750;this.endTime=o*t.base.stepCount;const u=t.base.makeGetPath1(o,0,o-s),E=new tt(e,t.base.terms);this.#t=x=>{const{pathString:g,index:m,t:f}=u(x);this.#e.setLivePath(g),E.show(t.base.keyframes[m+1],f*i.FULL_CIRCLE)}}}function st(...h){N=t=>{h.forEach(e=>e.show(t))}}let Q;setTimeout(()=>{if(z)return;let h=NaN;Q=new y.AnimationLoop(t=>{isNaN(h)&&(h=t);const e=t-h;N(e)}),window.animationLoop=Q},1);function rt(h){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),Q?.cancel(),{source:"fourier-smackdown.ts",script:h,seconds:120,devicePixelRatio}}window.initScreenCapture=rt;class ot{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class v{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=i.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,o)=>{const s=e.other(t);return s===void 0||this.pathSoFar.length==1&&s!=1?[]:new v([...this.pathSoFar,s],this.remainingEdges.toSpliced(o,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(s=>Math.max(s.vertex1,s.vertex2)))+1,o=new Set;for(const s of this.get(t)){const u=s.slice(0,s.length-1),E=this.#n(u);if(!o.has(E)){yield s,o.add(E);const x=this.#e(u,e).map(g=>this.#n(g));for(const g of x)o.add(g)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const o=new Array;for(let s=1;s<t.length;s++){const u=t[s],E=(u+1)%e,x=M(t,s+1);E==x?o.push(i.initializedArray(t.length,g=>{const m=M(t,g+s);return i.positiveModulo(m-u,e)})):M(t,s-1)==E&&o.push(i.initializedArray(t.length,m=>{const f=M(t,s-m);return i.positiveModulo(f-u,e)}))}return o}static getSamples(){function t(e,...o){return i.initializedArray(e,s=>o.map(u=>new ot(s,(s+u)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=v;function at(){const h=v.getSamples(),t=v.getUnique(h.pentagram);console.log(t,t.constructor.name);for(const e of t);}at();{let h=function(c,r=".chapter"){typeof r=="string"&&(r=y.selectorQuery(r,SVGTextElement)),r.innerHTML=`#${c} of ${o.allPaths.length}`},t=function(c){const r=[],a=c.terms,l=a.length;r.push(a.splice(0,2));for(let d=0;d<19;d++){const p=i.assertNonNullable(a.shift());r.push([p])}if(r[10].push(...a),a.length=0,a.length!=0)throw new Error("wtf");const n=c.keyframes;if(n.length=0,n.push(0),r.forEach(d=>{a.push(...d),n.push(a.length)}),a.length!=l)throw new Error("wtf")};class e{constructor(r){throw new Error("wtf")}static points=i.initializedArray(5,r=>{const a=i.FULL_CIRCLE*r/5+i.FULL_CIRCLE/4,l=Math.cos(a),n=Math.sin(a);return{x:l,y:n}});static allPaths=[...v.getUnique(v.getSamples().pentagram)]}class o{constructor(r){throw new Error("wtf")}static points=i.initializedArray(6,r=>{const a=i.FULL_CIRCLE*r/6+i.FULL_CIRCLE/4,l=Math.cos(a),n=Math.sin(a);return{x:l,y:n}});static allPaths=[...v.getUnique(v.getSamples().dodecahedron)];static makePathShape(r){const a=this.allPaths[r],l=K.M(s[0].x,s[0].y);return a.forEach((n,d)=>{if(d==0){if(n!=0)throw new Error("wtf")}else{const{x:p,y:C}=s[n],b=a[d-1];switch(i.positiveModulo(n-b,6)){case 1:{l.arc(0,0,p,C,"cw");break}case 2:case 4:{l.L(p,C);break}case 5:{l.arc(0,0,p,C,"ccw");break}default:throw new Error("wtf")}}}),l.pathShape}}const s=o.points,u=o.allPaths,E=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],x=i.Random.fromString("fourier-smackdown.ts");i.initializedArray(u.length,()=>{const c=x()*3|0,r=E[c];return E.splice(c,1),E.push(r),r});const g=[{color:"black",destRect:{x:1,y:.25,width:8.5,height:8.5},index:22,colorName:"blue"}];h(22);const m=g.map(({index:c})=>{const r=o.makePathShape(c).rawPath;return new et(r)});console.log(m),t(m[0]);const f=new Array;for(const[c,r]of i.zip(g,m)){const{color:a,destRect:l}=c,n=c.colorName??c.color,d=y.selectorQuery(`g.frequencies[data-frequencies="${n}"]`,SVGGElement),p=new U(`[data-fourier-top="${n}"]`,P=>O(P,l,"srcRect fits completely into destRect"));d.style.fill=a;const C={base:r,destination:p,liveColor:a,referenceColor:a},b=new nt(C,d);f.push(b),console.log(b)}{let c=function(k,F){const S=[k,k+i.FULL_CIRCLE/3,k-i.FULL_CIRCLE/3].map(G=>b(Math.sin(G)));S.push(0),S.push(P(Math.cos(F)));const L=S.join(" "),V=[L,L,L,"0 0 0 0 1"].join(`
`);l.setAttribute("values",V)},r=function(k){const F=n.map(w=>[]);k.forEach(w=>{if(w.length!=n.length)throw new Error("wtf");w.forEach((S,L)=>{F[L].push(S)})});for(const[w,S]of i.zip(n,F))w.setAttribute("tableValues",S.join(" "))},a=function(k){const F=k/12e4*i.FULL_CIRCLE,w=k/12e4*i.FULL_CIRCLE/2;c(F,w)};const l=y.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),n=[y.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),y.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),y.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],p=[[25,25,112],[70,130,180],[147,112,219],[60,179,113],[199,21,133],[0,206,209],[216,191,216]],C=i.makeLinear(0,0,255,1);p.forEach(k=>k.forEach((F,w,S)=>S[w]=C(F)));const b=i.makeLinear(-1,-.05,1,.8),P=i.makeLinear(1,0,-1,-.4);window.updateValues=c,r(p),f.push({show:a})}{let c=function(n){a.forEach(({element:d,attributeName:p})=>{d.setAttribute(p,n)})},r=function(n){const d=Math.floor(n/1500)%l.length,p=l[d];c(p)};const a=y.selectorQueryAll("[data-fg-color]",SVGElement).map(n=>({element:n,attributeName:i.assertNonNullable(n.dataset.fgColor)}));window.setFgColor=c;const l=["red","yellow","magenta","lime","hwb(204.42deg 0% 0%)","white","cyan","#CC5500","hsl(270, 55%, 55%)"];f.push({show:r})}if(console.log(f),st(...f),q.get("thumbnail")=="1"){const c=y.selectorQuery("g#foreground",SVGGElement);z=!0;const r=new Array;Array.from(c.children).forEach(n=>{const d=i.assertClass(n,SVGElement);d.dataset.live===void 0?d.style.display="none":(console.log("live",d.dataset.live),r.push(d))});const a=y.selectorQueryAll("#starfield rect",SVGRectElement);a[0].parentElement.style.transform="scale(3)",a.forEach(n=>{n.style.transformOrigin=`${50/3}% 22%`}),a[1].style.transform="rotate(1.75deg)",a[2].style.transform="rotate(-1.5deg)",f[0].show(5500),f[1].show(81005),f[2].show(56e3),y.selectorQueryAll("[data-reference]",SVGPathElement).forEach(n=>n.style.display="none");const l=y.selectorQueryAll("[data-live]",SVGPathElement);l.forEach(n=>{n.style.transform="scale(1.15) rotate(22deg)"}),console.log(l[2].style.strokeWidth),l[5].style.strokeWidth="0",console.log(l[5].style.strokeWidth,l[5],l),window.showFrame=n=>{console.info("ignoring showFrame()",n)}}}
