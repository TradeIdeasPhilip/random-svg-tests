import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as X,s as Y,h as _,t as U}from"./fourier-shared-DpvWsPe-.js";import{p as K,d as tt,b as et,P as N}from"./path-shape-CZZKMsju.js";import{m as a}from"./misc-BHUyxQfl.js";import{g as Q,e as nt}from"./utility-Dgy6CMn3.js";function st(){document.body.style.backgroundColor="transparent",y.selectorQueryAll("[data-hide-background]",SVGElement).forEach(i=>i.style.display="none")}function rt(){const i=y.selectorQuery("[data-hide-background]",SVGElement);i.parentElement?.append(i)}{const i=a.Random.fromString("Pastel 41"),t=y.selectorQuery("[data-favorite]",SVGCircleElement),e=a.makeLinear(0,.025,2,.15);for(let r=0;r<150;r++){const n=a.assertClass(t.cloneNode(!0),SVGCircleElement);n.cx.baseVal.value=i()*16,n.cy.baseVal.value=i()*9,n.r.baseVal.value=e(i()+i()),t.parentElement.append(n)}}const $=new URLSearchParams(window.location.search);let Z=!1;$.get("hide_background")=="1"?st():$.get("only_background")=="1"&&rt();{const t=y.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const ot=1024;class at{#t;constructor(t){t instanceof SVGGElement||(t=y.selectorQuery(t,SVGGElement)),this.#t=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(e=>{const r=y.selectorQuery("text",SVGTextElement,e),n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.classList.add("background"),e.insertBefore(n,r),{top:e,spinner:y.selectorQuery(".spinner",SVGPolygonElement,e),text:r,background:n}})}show(t,e){this.#t.forEach((r,n,f)=>{if(n>=t.length)r.top.style.display="none";else{r.top.style.display="";const C=t[n];let v=C.frequency.toString();n==f.length-1&&f.length<t.length&&(v+=", â€¦"),r.background.innerHTML=r.text.innerHTML=v,r.spinner.style.transform=`rotate(${e*C.frequency+C.phase+a.FULL_CIRCLE/4}rad)`}})}}function B(i,t){if(i>=t)throw new Error("wtf");const e=a.makeLinear(i,0,t,1);function r(n){if(n<=i)return 0;if(n>=t)return 1;const f=e(n);return nt(f)}return r}let O=()=>{};window.showFrame=i=>{O(i)};class j{constructor(t,e){this.getTransform=e,this.#t=t,this.#n=y.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=y.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new j(y.getById("right",SVGGElement),t=>K(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const H=new tt;class it{constructor(t,e,r=0,n=e-r){this.stepCount=t,this.period=e,this.#t=a.makeBoundedLinear(r,0,n,1),this.endTime=e*t}#t;endTime;get(t){let e=Math.floor(t/this.period),r;e<0?(e=0,r=0):e>=this.stepCount?(e=this.stepCount-1,r=this.period):r=t%this.period;const n=this.#t(r);return{index:e,t:n}}}class ct{constructor(t){this.pathString=t,this.samples=X(t,ot),this.terms=Y(this.samples),this.keyframes=a.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t){const e=this.makeGetPath2();function r(n){const{index:f,t:C}=t.get(n);return e(f,C)}return r}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],r=this.stepCount,n=d=>Math.max(...t.slice(0,d).map(F=>Math.abs(F.frequency))),f=d=>{if(d==0)return 8;{const g=n(d);return 8*Math.min(g,50)+7}},C=a.initializedArray(r,d=>{const g=e[d],F=e[d+1];if(g==0&&F==1&&t[0].frequency==0){let L=function(V){return`${S.x*V},${S.y*V}`};const S=a.assertNonNullable(_(t[0])),q=B(0,.5),R=B(0,1);return V=>{const u=R(V),s=L(u),l=q(V),h=L(l);return`M ${s} L ${h}`}}else if(g==F){const L=U(t,g),S=f(F),R=N.glitchFreeParametric(L,S).rawPath;return V=>R}else{const S=.2/Math.abs(t[g].frequency),q=a.makeBoundedLinear(0,-S,1,1+S),R=U(t,g),V=U(t,F-g,g),u=f(F);if(g==0||g==1&&_(t[0])){const s=_(t[0])??{x:0,y:0};return l=>{const h=q(l),o=h-S,m=h+S,p=B(o,m),c=Math.min(1,m);if(c<=0)return`M${s.x},${s.y} L${s.x},${s.y}`;{let b=function(P){P=P*c;const k=R(P),E=1-p(P);if(E==0)return k;{const G=V(P);return{x:k.x+E*G.x,y:k.y+E*G.y}}};const w=Math.ceil(Math.max(u,150)*c);return N.glitchFreeParametric(b,w).rawPath}}}else return s=>{const l=q(s),h=B(l-S,l+S);function o(p){const c=R(p),b=1-h(p);if(b==0)return c;{const w=V(p);return{x:c.x+b*w.x,y:c.y+b*w.y}}}return N.glitchFreeParametric(o,u).rawPath}}});function v(d,g){const F=C[d];return F(g)}return v}}class D{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}timer;#n;#e;#s;#r;#o;base;constructor(t){this.base=t.base,this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,H.d=this.#n,this.#o=this.#e.getTransform(H.getBBox());const e=7e3,r=750;this.timer=new it(t.base.stepCount,e,r);const n=t.base.makeGetPath1(this.timer);this.#t=f=>{const C=n(f);this.#e.setLivePath(C)}}}function lt(...i){O=t=>{i.forEach(e=>e.show(t))}}let z;setTimeout(()=>{if(Z)return;let i=NaN;z=new y.AnimationLoop(t=>{isNaN(i)&&(i=t);const e=t-i;O(e)}),window.animationLoop=z},1);function ht(i){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),z?.cancel(),{source:"fourier-smackdown.ts",script:i,seconds:97,devicePixelRatio}}window.initScreenCapture=ht;class ut{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class I{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=a.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,r)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new I([...this.pathSoFar,n],this.remainingEdges.toSpliced(r,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,r=new Set;for(const n of this.get(t)){const f=n.slice(0,n.length-1),C=this.#n(f);if(!r.has(C)){yield n,r.add(C);const v=this.#e(f,e).map(d=>this.#n(d));for(const d of v)r.add(d)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const r=new Array;for(let n=1;n<t.length;n++){const f=t[n],C=(f+1)%e,v=Q(t,n+1);C==v?r.push(a.initializedArray(t.length,d=>{const g=Q(t,d+n);return a.positiveModulo(g-f,e)})):Q(t,n-1)==C&&r.push(a.initializedArray(t.length,g=>{const F=Q(t,n-g);return a.positiveModulo(F-f,e)}))}return r}static getSamples(){function t(e,...r){return a.initializedArray(e,n=>r.map(f=>new ut(n,(n+f)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=I;function dt(){const i=I.getSamples(),t=I.getUnique(i.pentagram);console.log(t,t.constructor.name);for(const e of t);}dt();{let i=function(u,s,l){const h=s-u,o=l-u,m=2*u,p=2*u;return{x:h,y:o,width:m,height:p}};class t{constructor(s){throw new Error("wtf")}static points=a.initializedArray(5,s=>{const l=a.FULL_CIRCLE*s/5+a.FULL_CIRCLE/4,h=Math.cos(l),o=Math.sin(l);return{x:h,y:o}});static allPaths=[...I.getUnique(I.getSamples().pentagram)]}class e{constructor(s){throw new Error("wtf")}static points=a.initializedArray(6,s=>{const l=a.FULL_CIRCLE*s/6+a.FULL_CIRCLE/4,h=Math.cos(l),o=Math.sin(l);return{x:h,y:o}});static allPaths=[...I.getUnique(I.getSamples().dodecahedron)];static makePathShape(s){const l=this.allPaths[s],h=et.M(r[0].x,r[0].y);return l.forEach((o,m)=>{if(m==0){if(o!=0)throw new Error("wtf")}else{const{x:p,y:c}=r[o],b=l[m-1];switch(a.positiveModulo(o-b,6)){case 1:{h.arc(0,0,p,c,"cw");break}case 2:case 4:{h.L(p,c);break}case 5:{h.arc(0,0,p,c,"ccw");break}default:throw new Error("wtf")}}}),h.pathShape}}const r=e.points,n=e.allPaths,f=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],C=a.Random.fromString("fourier-smackdown.ts");a.initializedArray(n.length,()=>{const u=C()*3|0,s=f[u];return f.splice(u,1),f.push(s),s});let v=47;const d=9/4,g=.8,F=[{color:"red",destRect:i(d*g,16-d,d),index:v++},{color:"yellow",destRect:i(d*g,16-3*d,d),index:v++},{color:"lime",destRect:i(7/2*g,7/2,9/2),index:v++},{color:"cyan",destRect:i(d*g,16-3*d,3*d),index:v++},{color:"white",destRect:i(d*g,16-d,3*d),index:v++}],L=F.map(({index:u})=>{const s=e.makePathShape(u).rawPath;return new ct(s)});{const u=new Map;L.forEach(o=>o.terms.forEach(({frequency:m,amplitude:p})=>{let c=u.get(m);c||(c=new Array,u.set(m,c)),c.push(p)}));const s=Array.from(u.entries(),([o,m])=>({frequency:o,amplitude:m.sort((p,c)=>p-c)[2]??0}));s.sort((o,m)=>m.amplitude-o.amplitude);const l=s[0].amplitude*.05,h=s.filter(({amplitude:o})=>o>l).slice(0,6);console.log(h),L.forEach(({terms:o,keyframes:m},p)=>{const c=[];h.forEach(({frequency:x},P)=>{const k=o.findIndex(E=>E.frequency==x);k==-1?c.push([{amplitude:0,phase:0,frequency:x}]):c.push(o.splice(k,1))});const b=11;for(;c.length<b-1;){let x;c.length<6?x=1:c.length<9?x=5:x=10;const P=o.splice(0,x);if(P.length!=x)throw new Error("wtf");c.push(P)}let w;switch(p){case 0:case 4:{w=h.length+1;break}case 1:case 3:{w=h.length+2;break}case 2:{w=h.length+3;break}default:throw new Error("wtf")}if(c.splice(w,0,[...o]),console.log(c),c.length!=b)throw new Error("wtf");o.length=0,m.length=0,m.push(0),c.forEach(x=>{o.push(...x),m.push(o.length)})})}console.log(L);const S=new Array,q=y.selectorQuery("g#foreground",SVGGElement),R=y.getById("chapterList",SVGTextElement),V=F.length-1;for(const[u,s,{light:l,dark:h},o]of a.zip(F,L,f,a.count())){{let k=u.index.toString();o==0&&(k="#"+k,R.innerHTML=""),o==V?k="and "+k+" of 66.":k+=", ";const E=document.createElementNS("http://www.w3.org/2000/svg","tspan");E.style.fill=l,E.textContent=k,R.append(E)}const{destRect:m,search:p}=u,c=p===void 0?document.createElementNS("http://www.w3.org/2000/svg","g"):y.selectorQuery(`g.frequencies[data-frequencies="${p}"]`,SVGGElement),b=p===void 0?q.appendChild(a.assertClass(y.selectorQuery("defs g[data-fourier-top]",SVGGElement).cloneNode(!0),SVGGElement)):y.selectorQuery(`[data-fourier-top="${p}"]`,SVGGElement);b.style.setProperty("--color",l),b.style.setProperty("--blur-color",h);const w=new j(b,k=>K(k,m,"srcRect fits completely into destRect"));c.style.fill=h;const x={base:s,destination:w,liveColor:h,referenceColor:l},P=new D(x);S.push(P),console.log(P)}{let u=function(c){const{index:b,t:w}=h.get(c);w>=1?s.show([],0):s.show(o[b],w*a.FULL_CIRCLE)};const s=new at('[data-frequencies="red"]'),l=a.assertClass(S.at(2),D),h=l.timer,o=new Array,{keyframes:m,terms:p}=l.base;m.forEach((c,b)=>{const w=b-1;if(w>=0){const x=m[w],P=p.slice(x,c);o.push(P)}}),console.log(o),S.push({show:u})}{let u=function(E,G){const A=[E,E+a.FULL_CIRCLE/3,E-a.FULL_CIRCLE/3].map(W=>P(Math.sin(W)));A.push(0),A.push(k(Math.cos(G)));const T=A.join(" "),J=[T,T,T,"0 0 0 0 1"].join(`
`);h.setAttribute("values",J)},s=function(E){const G=o.map(M=>[]);E.forEach(M=>{if(M.length!=o.length)throw new Error("wtf");M.forEach((A,T)=>{G[T].push(A)})});for(const[M,A]of a.zip(o,G))M.setAttribute("tableValues",A.join(" "))},l=function(E){const G=E/24e4*a.FULL_CIRCLE*2,M=E/24e4*a.FULL_CIRCLE/2;u(G,M)};const h=y.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),o=[y.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),y.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),y.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],w=[[[25,25,112],[70,130,180],[147,112,219],[60,179,113],[199,21,133],[0,206,209],[216,191,216]],[[65,105,225],[204,85,0],[255,160,122],[255,182,193],[255,245,157],[175,238,238]],[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],[[70,100,80],[90,120,100],[110,140,120],[130,160,140],[150,180,160],[170,200,180]]].at(-1),x=a.makeLinear(0,0,255,1);w.forEach(E=>E.forEach((G,M,A)=>A[M]=x(G)));const P=a.makeLinear(-1,-.05,1,.8),k=a.makeLinear(1,0,-1,-.4);window.updateValues=u,s(w),S.push({show:l})}if(console.log(S),lt(...S),$.get("thumbnail")=="1"){Z=!0;const u=new Array;Array.from(q.children).forEach(s=>{const l=a.assertClass(s,SVGElement);l.dataset.live===void 0?l.style.display="none":(console.log("live",l.dataset.live),u.push(l))}),S.forEach((s,l)=>{s.show(8500+950*l)}),y.selectorQueryAll("[data-reference]",SVGPathElement).forEach(s=>s.style.display="none"),y.selectorQueryAll("#new-starfield circle",SVGCircleElement).forEach(s=>{s.style.transform="scale(3)",s.style.transformOrigin=`${s.cx.baseVal.value}px ${s.cy.baseVal.value}px`})}}
