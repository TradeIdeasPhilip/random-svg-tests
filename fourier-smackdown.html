<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸ‘‹ fourier-smackdown</title>
    <script type="module" src="/src/fourier-smackdown.ts"></script>
  </head>
  <body>
    <canvas
      id="backgroundCanvas"
      class="backgroundCanvas"
      width="3840"
      height="2160"
    ></canvas>
    <canvas
      id="cache"
      class="backgroundCanvas"
      height="2160"
      width="3840"
    ></canvas>
    <svg
      id="main"
      viewBox="0 0 16 9"
      xmlns="http://www.w3.org/2000/svg"
      preserveAspectRatio="xMaxYMin meet"
    >
      <defs>
        <filter
          id="lava-lamp"
          color-interpolation-filters="sRGB"
          filterUnits="objectBoundingBox"
          x="0"
          y="0"
          width="1"
          height="1"
          primitiveUnits="userSpaceOnUse"
        >
          <!-- Ignore the input image.  Start with pure noise. -->
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.3 0.4"
            numOctaves="1"
            seed="1973"
            stitchTiles="stitch"
            x="0%"
            y="0%"
            width="100%"
            height="100%"
          />
          <!-- Combine three of the channels of noise into a single channel.

               For a static image this didn't make an interesting difference.
               More precisely, the images were different, but I couldn't reliably 
               tell you which image came from from just one chanel and which came
               from a combination of channels.  That's very promising for my
               intended purpose.  I plan to smoothly animate these values over time!
               
               I tweaked these values so I'd get some of the brightest and some of the
               darkest color on the screen.  This seems robust over a number of
               different choices for the random seed.  I did not ignore the alpha
               channel's noise for any good reason; I just forgot it existed.
               
               I pegged the output alpha to 1.

               I'm *currently* ignoring the blue and green output channels.
               All of the interesting data is in the red channel.
               -->
          <feColorMatrix
            type="matrix"
            values="1.2 0.3 -0.3 0 -0.105
0 0 0 0 0
0 0 0 0 0
0 0 0 0 1"
            x="0%"
            y="0%"
            width="100%"
            height="100%"
          />
          <!-- This step could easily be handled by the TypeScript code.
               Adding an extra matrix was helpful when I was creating the SVG by hand.
               Copy the red input channel to be the output of red, of green, and of blue.
               Alpha stays pegged at 1.
               
               The output of this stage is a completely opaque, grayscale noise. -->
          <feColorMatrix
            type="matrix"
            values="1 0 0 0 0
1 0 0 0 0
1 0 0 0 0
0 0 0 0 1"
            x="0%"
            y="0%"
            width="100%"
            height="100%"
          />
          <!-- Remove most of those odd artifacts I get when I zoom in too close to noise.

               I fixed that in the past by using the canvas in display-p3 mode, but I was unable
               to repeat that trick here, and I'm not sure why.

               This works very well.  It was easy to select a value for stdDeviation.
          -->
          <feGaussianBlur stdDeviation="0.05" />
          <!-- 
          // This was my fist attempt at cleaning up the artifacts.  This uses a 2 x 2 kernel
          // because I thought the problem was limited to single pixels.  But as I started
          // tweaking other things, the artifacts grew and this solution was insufficient.
          // The <feGaussianBlur /> solution is much. more robust.
     <feConvolveMatrix
          order="2"
          kernelMatrix="0.25 0.25 0.25 0.25"
          divisor="1"
          bias="0"
          targetX="0"
          targetY="0"
          edgeMode="duplicate"
          preserveAlpha="true"
        />
         -->
          <!-- This is where I convert from a smooth gradient to discrete levels.
               And this is where I set the color for each level.
               
               The number of table values should be the same for each channel.
               I've been focused on groups of 7, but any number could work.

               The first entry in the tableValues is the amount of red, green or
               blue in the first color, the color that will replace the darkest shades
               of gray in the input.  The values range from 0 to 1.

               This hand made example creates red, green, blue, magenta, yellow, 
               cyan and white, in that order.  Replace these with any colors you like.
               -->
          <feComponentTransfer x="0%" y="0%" width="100%" height="100%">
            <feFuncR type="discrete" tableValues="1 0 0 1 1 0 1" />
            <feFuncG type="discrete" tableValues="0 1 0 0 1 1 1" />
            <feFuncB type="discrete" tableValues="0 0 1 1 0 1 1" />
            <feFuncA type="linear" slope="0" intercept="1" />
          </feComponentTransfer>
        </filter>
        <filter
          id="dalmatian"
          color-interpolation-filters="linearRGB"
          filterUnits="objectBoundingBox"
          primitiveUnits="userSpaceOnUse"
        >
          <feTurbulence
            type="turbulence"
            baseFrequency="7 7"
            numOctaves="2"
            seed="13"
            stitchTiles="stitch"
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            result="turbulence"
          />
          <feComponentTransfer
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            in="turbulence"
            result="componentTransfer"
          >
            <feFuncR type="linear" slope="0" intercept="0.1" />
            <feFuncG type="linear" slope="0" intercept="0.1" />
            <feFuncB type="linear" slope="0" intercept="0.1" />
            <feFuncA type="discrete" tableValues="0 0 0 1 1" />
          </feComponentTransfer>
          <feTurbulence
            type="turbulence"
            baseFrequency="6 6"
            numOctaves="2"
            seed="4"
            stitchTiles="stitch"
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            result="turbulence1"
          />
          <feComponentTransfer
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            in="turbulence1"
            result="componentTransfer1"
          >
            <feFuncR type="linear" slope="0" intercept="0.05" />
            <feFuncG type="linear" slope="0" intercept="0.05" />
            <feFuncB type="linear" slope="0" intercept="0.05" />
            <feFuncA type="discrete" tableValues="0 0 0 1 1" />
          </feComponentTransfer>
          <feTurbulence
            type="turbulence"
            baseFrequency="5 5"
            numOctaves="1"
            seed="42"
            stitchTiles="stitch"
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            result="turbulence2"
          />
          <feComponentTransfer
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            in="turbulence2"
            result="componentTransfer2"
          >
            <feFuncR type="linear" slope="0" intercept="0.03" />
            <feFuncG type="linear" slope="0" intercept="0.03" />
            <feFuncB type="linear" slope="0" intercept="0.03" />
            <feFuncA type="discrete" tableValues="0 0 0 1 1" />
          </feComponentTransfer>
          <feTurbulence
            type="turbulence"
            baseFrequency="5 5"
            numOctaves="1"
            seed="44"
            stitchTiles="stitch"
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            result="turbulence3"
          />
          <feComponentTransfer
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            in="turbulence3"
            result="componentTransfer3"
          >
            <feFuncR type="linear" slope="0" intercept="0.04" />
            <feFuncG type="linear" slope="0" intercept="0.04" />
            <feFuncB type="linear" slope="0" intercept="0.04" />
            <feFuncA type="discrete" tableValues="0 0 0 1 1" />
          </feComponentTransfer>
          <feTurbulence
            type="turbulence"
            baseFrequency="5 5"
            numOctaves="1"
            seed="149"
            stitchTiles="stitch"
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            result="turbulence4"
          />
          <feComponentTransfer
            x="0%"
            y="0%"
            width="100%"
            height="100%"
            in="turbulence4"
            result="componentTransfer4"
          >
            <feFuncR type="linear" slope="0" intercept="0.06" />
            <feFuncG type="linear" slope="0" intercept="0.06" />
            <feFuncB type="linear" slope="0" intercept="0.06" />
            <feFuncA type="discrete" tableValues="0 1" />
          </feComponentTransfer>
          <feMerge x="0%" y="0%" width="100%" height="100%" result="merge">
            <feMergeNode in="componentTransfer4" />
            <feMergeNode in="componentTransfer3" />
            <feMergeNode in="componentTransfer2" />
            <feMergeNode in="componentTransfer1" />
            <feMergeNode in="componentTransfer" />
          </feMerge>
        </filter>
        <linearGradient
          id="backgroundGradient"
          x2="0.3"
          y2=".6"
          gradientUnits="userSpaceOnUse"
          spreadMethod="repeat"
        >
          <stop offset="5%" stop-color="#78508C" />
          <stop offset="95%" stop-color="#502864" />
        </linearGradient>
        <!-- source: https://yoksel.github.io/svg-filters/#/presets/paper -->
        <filter
          id="paper-background"
          color-interpolation-filters="sRGB"
          filterUnits="objectBoundingBox"
          primitiveUnits="userSpaceOnUse"
        >
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.05 0.05"
            numOctaves="5"
            seed="1"
            stitchTiles="stitch"
            result="turbulence"
          />
          <feDiffuseLighting
            surfaceScale="0.3"
            diffuseConstant="3.1"
            lighting-color="#ffffff"
            in="turbulence"
            result="diffuseLighting"
          >
            <feDistantLight azimuth="100" elevation="17" />
          </feDiffuseLighting>
          <feComposite
            in="diffuseLighting"
            in2="SourceAlpha"
            operator="in"
            result="composite"
          />
        </filter>
        <!-- source: https://yoksel.github.io/svg-filters/#/presets/watercolor -->
        <filter
          id="watercolor"
          color-interpolation-filters="sRGB"
          filterUnits="objectBoundingBox"
          primitiveUnits="userSpaceOnUse"
        >
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.05 0.05"
            numOctaves="5"
            seed="1"
            stitchTiles="stitch"
            result="turbulence"
          />
          <feDiffuseLighting
            surfaceScale="0.5"
            diffuseConstant="3.2"
            lighting-color="#ffffff"
            in="turbulence"
            result="diffuseLighting"
          >
            <feDistantLight azimuth="150" elevation="16" />
          </feDiffuseLighting>
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.011 0.004"
            numOctaves="2"
            seed="7"
            stitchTiles="noStitch"
            result="turbulence1"
          />
          <feColorMatrix
            type="saturate"
            values="3"
            in="turbulence1"
            result="colormatrix"
          />
          <feColorMatrix
            type="matrix"
            values="2 0 0 0 0
0 1.5 0 0 0
0 0 2 0 0
0 0 0 2 0"
            in="colormatrix"
            result="colormatrix1"
          />
          <feBlend
            mode="multiply"
            in="diffuseLighting"
            in2="colormatrix1"
            result="blend"
          />
          <feComposite
            in="blend"
            in2="SourceAlpha"
            operator="in"
            result="composite1"
          />
        </filter>
        <filter
          id="noiseFilter"
          filterUnits="userSpaceOnUse"
          x="-0.1"
          y="-0.1"
          width="3840.2"
          height="2160.2"
        >
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.015 0.0015"
            numOctaves="2"
            stitchTiles="stitch"
            result="noise"
            seed="4"
          />
          <feComponentTransfer>
            <feFuncA type="linear" slope="0" intercept="1" />
          </feComponentTransfer>
        </filter>
        <radialGradient id="stellarGradient">
          <stop offset="10%" stop-color="white" />
          <stop offset="25%" stop-color="#404040" />
          <stop offset="100%" stop-color="#000000" />
        </radialGradient>
        <mask id="stellarMask" maskUnits="objectBoundingBox">
          <radialGradient id="stellarMaskGradient">
            <stop offset="10%" stop-color="white" stop-opacity="1" />
            <stop offset="25%" stop-color="white" stop-opacity="0.4" />
            <stop offset="100%" stop-color="white" stop-opacity="0" />
          </radialGradient>
          <rect
            x="0"
            y="0"
            width="1"
            height="1"
            fill="url(#stellarMaskGradient)"
          />
        </mask>
      </defs>
      <rect
        data-hide-background
        width="16"
        height="9"
        fill="black"
        filter="none"
      ></rect>
      <g id="new-starfield">
        <circle
          data-favorite
          cx="2"
          cy="7"
          r="0.1"
          fill="url(#stellarGradient)"
        ></circle>
      </g>
      <g id="thumbnail-foreground" style="display: none">
        <text x="1" y="3.75" letter-spacing="0.2">
          <tspan>Abc</tspan>
          <tspan>123</tspan>
          <tspan>:-)</tspan>
        </text>
        <text x="1" y="7.25">
          <tspan>â˜…</tspan>
          <tspan>â§«</tspan>
          <tspan>â™ </tspan>
          <tspan>â™ </tspan>
          <tspan>â§«</tspan>
          <tspan>â˜…</tspan>
        </text>
      </g>
      <g id="foreground">
        <line id="for-scale" x1="1" y1="1" x2="15" y2="8"></line>
        <g id="topText"></g>
        <g id="right">
          <path data-reference></path>
          <path data-live></path>
        </g>
        <g data-fourier-top="red">
          <g data-inner-transform style="/*transform: scaleX(-1)*/">
            <path data-reference></path>
            <path
              data-live
              style="stroke: rgb(255, 162, 0)"
              filter="drop-shadow(0 0 0.1px rgb(255, 162, 0))"
            ></path>
            <path data-live stroke="white"></path>
          </g>
        </g>
        <g data-fourier-top="white">
          <g data-inner-transform style="/*transform: rotate(30deg)*/">
            <path data-reference></path>
            <path
              data-live
              style="stroke: rgb(255, 0, 255)"
              filter="drop-shadow(0 0 0.1px rgb(255, 0, 255))"
            ></path>
            <path data-live stroke="white"></path>
          </g>
        </g>
        <g data-fourier-top="blue">
          <g data-inner-transform>
            <path data-reference></path>
            <path
              data-live
              style="stroke: lime"
              filter="drop-shadow(0 0 0.1px lime)"
            ></path>
            <path data-live stroke="white"></path>
          </g>
        </g>
        <g data-frequencies="red" class="frequencies">
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
        </g>
        <g data-frequencies="white" class="frequencies">
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
        </g>
        <g data-frequencies="blue" class="frequencies">
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
          <g class="frequency">
            <polygon class="spinner" points="2,1 1.5,3 2.5,3"></polygon>
            <text>-3</text>
          </g>
        </g>
        <text
          class="chapter"
          x="0.7"
          y="8.25"
          style="text-anchor: start; fill: orange; fill: none"
        >
          #30
        </text>
        <text
          class="chapter"
          x="8"
          y="1.25"
          style="text-anchor: middle; fill: purple; fill: none"
        >
          #31
        </text>
        <text
          class="chapter"
          x="15.3"
          y="8.25"
          style="text-anchor: end; fill: yellow"
        >
          #34 of 66
        </text>
      </g>
      <text class="thumbnail-bottom" y="8.5" x="8">Animations</text>
    </svg>
  </body>
</html>
