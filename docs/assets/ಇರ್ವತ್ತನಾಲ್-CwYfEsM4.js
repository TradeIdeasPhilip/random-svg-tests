import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as E}from"./client-misc-B8CxQsfg.js";import{b as z,s as H,h as q,t as I}from"./fourier-shared-NjkoHtEt.js";import{p as _,d as D,b as K,P as O}from"./path-shape-CZZKMsju.js";import{m as h}from"./misc-BHUyxQfl.js";import{g as M,e as Z}from"./utility-Dgy6CMn3.js";function j(){document.body.style.backgroundColor="transparent",E.selectorQueryAll("[data-hide-background]",SVGElement).forEach(a=>a.style.display="none")}function J(){const a=E.selectorQuery("[data-hide-background]",SVGElement);a.parentElement?.append(a)}const R=new URLSearchParams(window.location.search);if(R.get("hide_background")=="1")j();else if(R.get("only_background")=="1")J();else if(R.get("thumbnail")=="1"){const a=E.selectorQuery("g#foreground",SVGGElement);a.style.display="none";const t=E.selectorQuery("g#thumbnail-foreground",SVGGElement);t.style.display=""}{const t=E.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const W=1024;class X{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=E.selectorQuery(t,SVGGElement)),this.#t=E.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(s=>{const n=E.selectorQuery("text",SVGTextElement,s),i=document.createElementNS("http://www.w3.org/2000/svg","text");return i.classList.add("background"),s.insertBefore(i,n),{top:s,spinner:E.selectorQuery(".spinner",SVGPolygonElement,s),text:n,background:i}})}#t;show(t,e){this.#t.forEach((s,n)=>{if(n>=t)s.top.style.display="none";else{s.top.style.display="";const i=this.terms[n];s.background.innerHTML=s.text.innerHTML=i.frequency.toString(),s.spinner.style.transform=`rotate(${e*i.frequency+i.phase+h.FULL_CIRCLE/4}rad)`}})}}function V(a,t){if(a>=t)throw new Error("wtf");const e=h.makeLinear(a,0,t,1);function s(n){if(n<=a)return 0;if(n>=t)return 1;const i=e(n);return Z(i)}return s}let N=()=>{};window.showFrame=a=>{N(a)};class Q{constructor(t,e){this.getTransform=e,this.#t=E.selectorQuery(t,SVGGElement),this.#n=E.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=E.selectorQuery("[data-live]",SVGPathElement,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t,this.#e.style.stroke=e}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.setAttribute("d",t)}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new Q("#right",t=>_(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const U=new D;class Y{constructor(t){this.pathString=t,this.samples=z(t,W),this.terms=H(this.samples),this.keyframes=h.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,s=t-e){const n=this.makeGetPath2(),i=h.makeBoundedLinear(e,0,s,1),x=this.stepCount;function P(f){let c=Math.floor(f/t),g;c<0?(c=0,g=0):c>=x?(c=x-1,g=t):g=f%t;const m=i(g);return{pathString:n(c,m),index:c,t:m}}return P}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],s=this.stepCount,n=f=>Math.max(...t.slice(0,f).map(g=>Math.abs(g.frequency))),i=f=>8*n(f)+7,x=h.initializedArray(s,f=>{const c=e[f],g=e[f+1];if(c==0&&g==1&&t[0].frequency==0){let m=function(l){return`${r.x*l},${r.y*l}`};const r=h.assertNonNullable(q(t[0])),p=V(0,.5),S=V(0,1);return l=>{const u=S(l),o=m(u),d=p(l),y=m(d);return`M ${o} L ${y}`}}else{const r=.2/n(g),p=h.makeBoundedLinear(0,-r,1,1+r),S=I(t,c),l=I(t,g-c,c),u=i(g);if(c==0||c==1&&q(t[0])){const o=q(t[0])??{x:0,y:0};return d=>{const y=p(d),w=y-r,k=y+r,b=V(w,k),C=Math.min(1,k);if(C<=0)return`M${o.x},${o.y} L${o.x},${o.y}`;{let L=function(G){G=G*C;const T=S(G),A=1-b(G);if(A==0)return T;{const B=l(G);return{x:T.x+A*B.x,y:T.y+A*B.y}}};const v=Math.ceil(Math.max(u,150)*C);return O.glitchFreeParametric(L,v).rawPath}}}else return o=>{const d=p(o),y=V(d-r,d+r);function w(b){const C=S(b),L=1-y(b);if(L==0)return C;{const v=l(b);return{x:C.x+L*v.x,y:C.y+L*v.y}}}return O.glitchFreeParametric(w,u).rawPath}}});function P(f,c){const g=x[f];return g(c)}return P}}class tt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#s;#r;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,U.d=this.#n,this.#o=this.#e.getTransform(U.getBBox());const s=6e3,n=750;this.endTime=s*t.base.stepCount;const i=t.base.makeGetPath1(s,0,s-n),x=new X(e,t.base.terms);this.#t=P=>{const{pathString:f,index:c,t:g}=i(P);this.#e.setLivePath(f),x.show(t.base.keyframes[c+1],g*h.FULL_CIRCLE)}}}function et(...a){N=t=>{a.forEach(e=>e.show(t))}}let $;setTimeout(()=>{let a=NaN;$=new E.AnimationLoop(t=>{isNaN(a)&&(a=t);const e=t-a;N(e)}),window.animationLoop=$},1);function nt(a){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),$.cancel(),{source:"fourier-smackdown.ts",script:a,seconds:120,devicePixelRatio}}window.initScreenCapture=nt;class st{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class F{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=h.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,s)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new F([...this.pathSoFar,n],this.remainingEdges.toSpliced(s,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,s=new Set;for(const n of this.get(t)){const i=n.slice(0,n.length-1),x=this.#n(i);if(!s.has(x)){yield n,s.add(x);const P=this.#e(i,e).map(f=>this.#n(f));for(const f of P)s.add(f)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const s=new Array;for(let n=1;n<t.length;n++){const i=t[n],x=(i+1)%e,P=M(t,n+1);x==P?s.push(h.initializedArray(t.length,f=>{const c=M(t,f+n);return h.positiveModulo(c-i,e)})):M(t,n-1)==x&&s.push(h.initializedArray(t.length,c=>{const g=M(t,n-c);return h.positiveModulo(g-i,e)}))}return s}static getSamples(){function t(e,...s){return h.initializedArray(e,n=>s.map(i=>new st(n,(n+i)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=F;function rt(){const a=F.getSamples(),t=F.getUnique(a.pentagram);console.log(t,t.constructor.name);for(const e of t);}rt();{class a{constructor(r){throw new Error("wtf")}static points=h.initializedArray(5,r=>{const p=h.FULL_CIRCLE*r/5+h.FULL_CIRCLE/4,S=Math.cos(p),l=Math.sin(p);return{x:S,y:l}});static allPaths=[...F.getUnique(F.getSamples().pentagram)]}class t{constructor(r){throw new Error("wtf")}static points=h.initializedArray(6,r=>{const p=h.FULL_CIRCLE*r/6+h.FULL_CIRCLE/4,S=Math.cos(p),l=Math.sin(p);return{x:S,y:l}});static allPaths=[...F.getUnique(F.getSamples().dodecahedron)];static makePathShape(r){const p=this.allPaths[r],S=K.M(e[0].x,e[0].y);return p.forEach((l,u)=>{if(u==0){if(l!=0)throw new Error("wtf")}else{const{x:o,y:d}=e[l],y=p[u-1];switch(h.positiveModulo(l-y,6)){case 1:{S.arc(0,0,o,d,"cw");break}case 2:case 4:{S.L(o,d);break}case 5:{S.arc(0,0,o,d,"ccw");break}default:throw new Error("wtf")}}}),S.pathShape}}const e=t.points,s=t.allPaths,n=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],i=h.Random.fromString("fourier-smackdown.ts"),x=h.initializedArray(s.length,()=>{const m=i()*3|0,r=n[m];return n.splice(m,1),n.push(r),r});let P=7;const f=[{color:x[P++].light,destRect:{x:.5,y:.5,width:5,height:5},index:18,colorName:"red"},{color:x[P++].light,destRect:{x:5.5,y:3.5,width:5,height:5},index:19,colorName:"white"},{color:x[P++].light,destRect:{x:10.5,y:.5,width:5,height:5},index:20,colorName:"blue"}],c=f.map(({index:m})=>{const r=t.makePathShape(m).rawPath;return new Y(r)});{const m=new Map;c.forEach(u=>u.terms.forEach(({frequency:o,amplitude:d})=>{const w=(m.get(o)??0)+d;m.set(o,w)}));const r=Array.from(m.entries(),([u,o])=>({frequency:u,amplitude:o}));r.sort((u,o)=>o.amplitude-u.amplitude);const p=r[0].amplitude*.05,S=3,l=r.filter(({amplitude:u,frequency:o})=>u>p&&(o+1)%S==0);console.log(l),c.forEach(({terms:u})=>{l.forEach(({frequency:o},d)=>{const y=u.findIndex(k=>k.frequency==o);let w;y==-1?w={amplitude:0,phase:0,frequency:o}:[w]=u.splice(y,1),u.splice(d,0,w)})})}const g=new Array;for(const[m,r]of h.zip(f,c)){const{color:p,destRect:S,index:l}=m,u=m.colorName??m.color,o=E.selectorQuery(`g.frequencies[data-frequencies="${u}"]`,SVGGElement),d=new Q(`[data-fourier-top="${u}"]`,b=>_(b,S,"srcRect fits completely into destRect"));o.style.fill=p;const y={base:r,destination:d,liveColor:p,referenceColor:p},w=new tt(y,o);g.push(w);const k=E.selectorQuery(`text.chapter[data-chapter="${u}"]`,SVGTextElement);k.innerHTML=`#${l}`,k.style.fill=p}{let m=function(d){const y=d*50,w=d*60,k=`${y}% ${w}%`;l.forEach(b=>b.style.transformOrigin=k)},r=function(d,y,w){const k=(d+y)/2,b=d-k,C=h.FULL_CIRCLE/w;function L(v){return Math.sin(v*C)*b+k}return L},p=function(d){const y=u(d);m(y),o.forEach(({element:w,oscillator:k})=>{const b=k(d);w.style.transform=`rotate(${b}deg)`})};const[S,...l]=E.selectorQueryAll("#starfield rect",SVGRectElement),u=h.makeBoundedLinear(0,0,6e4,1),o=[{element:l[0],oscillator:r(.5,1.5,15e3)},{element:l[1],oscillator:r(-.5,-1.5,13081)}];if(o.length!=l.length)throw new Error("wtf");g.push({show:p})}et(...g)}
