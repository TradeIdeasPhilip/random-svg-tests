import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as X,s as Y,h as I,t as Q}from"./fourier-shared-BneanVCb.js";import{p as D,d as K,b as Z,P as B}from"./path-shape-DN4hoPl6.js";import{m as i}from"./misc-BHUyxQfl.js";import{g as A,e as j}from"./utility-Dgy6CMn3.js";function J(){document.body.style.backgroundColor="transparent",y.selectorQueryAll("[data-hide-background]",SVGElement).forEach(o=>o.style.display="none")}function W(){const o=y.selectorQuery("[data-hide-background]",SVGElement);o.parentElement?.append(o)}{const o=i.Random.fromString("Pastel 41"),t=y.selectorQuery("[data-favorite]",SVGCircleElement),e=i.makeLinear(0,.025,2,.15);for(let n=0;n<150;n++){const s=i.assertClass(t.cloneNode(!0),SVGCircleElement);s.cx.baseVal.value=o()*16,s.cy.baseVal.value=o()*9,s.r.baseVal.value=e(o()+o()),t.parentElement.append(s)}}const $=new URLSearchParams(window.location.search);let H=!1;$.get("hide_background")=="1"?J():$.get("only_background")=="1"&&W();{const t=y.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const tt=1024;class et{constructor(t,e={radius:1,centerX:2,centerY:2}){this.element=t;const n=t.style;n.setProperty("--radius",e.radius.toString()),n.setProperty("--center-x",e.centerX.toString()),n.setProperty("--center-y",e.centerY.toString()),e.color&&n.setProperty("--color",e.color),this.hide()}#t;showRadians(t){const e=this.#t??t;this.#t=t;const n=this.element.style;n.display="",n.setProperty("--main-angle",`${t}rad`),n.setProperty("--blur-angle",`${e}rad`)}hide(){this.#t=void 0,this.element.style.display="none"}static available=y.selectorQueryAll(".motion-blur-spinner",HTMLDivElement).map(t=>new this(t))}class nt{#t;constructor(t){t instanceof SVGGElement||(t=y.selectorQuery(t,SVGGElement)),this.#t=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(e=>{const n=y.selectorQuery("text",SVGTextElement,e);return{top:e,oldSpinner:y.selectorQuery(".spinner",SVGPolygonElement,e),newSpinner:i.assertNonNullable(et.available.shift()),text:n}})}show(t,e){this.#t.forEach((n,s,f)=>{if(s>=t.length)n.top.style.display="none",n.newSpinner.hide();else{n.top.style.display="";const P=t[s];P.frequency.toString(),s==f.length-1&&f.length<t.length;const v=e*P.frequency+P.phase;n.oldSpinner.style.transform=`rotate(${v+i.FULL_CIRCLE/4}rad)`,n.newSpinner.showRadians(v)}})}}function R(o,t){if(o>=t)throw new Error("wtf");const e=i.makeLinear(o,0,t,1);function n(s){if(s<=o)return 0;if(s>=t)return 1;const f=e(s);return j(f)}return n}let O=()=>{};window.showFrame=o=>{O(o)};class U{constructor(t,e){this.getTransform=e,this.#t=t,this.#n=y.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=y.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new U(y.getById("right",SVGGElement),t=>D(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const z=new K;class st{constructor(t,e,n=0,s=e-n){this.stepCount=t,this.period=e,this.#t=i.makeBoundedLinear(n,0,s,1),this.endTime=e*t}#t;endTime;get(t){let e=Math.floor(t/this.period),n;e<0?(e=0,n=0):e>=this.stepCount?(e=this.stepCount-1,n=this.period):n=t%this.period;const s=this.#t(n);return{index:e,t:s}}}class rt{constructor(t){this.pathString=t,this.samples=X(t,tt),this.terms=Y(this.samples),this.keyframes=i.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t){const e=this.makeGetPath2();function n(s){const{index:f,t:P}=t.get(s);return e(f,P)}return n}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],n=this.stepCount,s=u=>Math.max(...t.slice(0,u).map(b=>Math.abs(b.frequency))),f=u=>{if(u==0)return 8;{const g=s(u);return 8*Math.min(g,50)+7}},P=i.initializedArray(n,u=>{const g=e[u],b=e[u+1];if(g==0&&b==1&&t[0].frequency==0){let k=function(a){return`${p.x*a},${p.y*a}`};const p=i.assertNonNullable(I(t[0])),F=R(0,.5),V=R(0,1);return a=>{const r=V(a),c=k(r),h=F(a),l=k(h);return`M ${c} L ${l}`}}else if(g==b){const k=Q(t,g),p=f(b),V=B.glitchFreeParametric(k,p).rawPath;return a=>V}else{const p=.2/Math.abs(t[g].frequency),F=i.makeBoundedLinear(0,-p,1,1+p),V=Q(t,g),a=Q(t,b-g,g),r=f(b);if(g==0||g==1&&I(t[0])){const c=I(t[0])??{x:0,y:0};return h=>{const l=F(h),E=l-p,w=l+p,S=R(E,w),m=Math.min(1,w);if(m<=0)return`M${c.x},${c.y} L${c.x},${c.y}`;{let d=function(G){G=G*m;const q=V(G),T=1-S(G);if(T==0)return q;{const _=a(G);return{x:q.x+T*_.x,y:q.y+T*_.y}}};const x=Math.ceil(Math.max(r,150)*m);return B.glitchFreeParametric(d,x).rawPath}}}else return c=>{const h=F(c),l=R(h-p,h+p);function E(S){const m=V(S),d=1-l(S);if(d==0)return m;{const x=a(S);return{x:m.x+d*x.x,y:m.y+d*x.y}}}return B.glitchFreeParametric(E,r).rawPath}}});function v(u,g){const b=P[u];return b(g)}return v}}class M{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}timer;#n;#e;#s;#r;#o;base;static PERIOD=7e3;static PAUSE=1e3;constructor(t){this.base=t.base,this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,z.d=this.#n,this.#o=this.#e.getTransform(z.getBBox()),this.timer=new st(t.base.stepCount,M.PERIOD,M.PAUSE);const e=t.base.makeGetPath1(this.timer);this.#t=n=>{const s=e(n);this.#e.setLivePath(s)}}}function ot(...o){O=t=>{o.forEach(e=>e.show(t))}}let N;setTimeout(()=>{if(H)return;let o=NaN;N=new y.AnimationLoop(t=>{isNaN(o)&&(o=t);const e=t-o;O(e)}),window.animationLoop=N},1);function at(o){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),N?.cancel(),{source:"fourier-smackdown.ts",script:o,seconds:90,devicePixelRatio}}window.initScreenCapture=at;class it{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class C{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=i.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,n)=>{const s=e.other(t);return s===void 0||this.pathSoFar.length==1&&s!=1?[]:new C([...this.pathSoFar,s],this.remainingEdges.toSpliced(n,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(s=>Math.max(s.vertex1,s.vertex2)))+1,n=new Set;for(const s of this.get(t)){const f=s.slice(0,s.length-1),P=this.#n(f);if(!n.has(P)){yield s,n.add(P);const v=this.#e(f,e).map(u=>this.#n(u));for(const u of v)n.add(u)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const n=new Array;for(let s=1;s<t.length;s++){const f=t[s],P=(f+1)%e,v=A(t,s+1);P==v?n.push(i.initializedArray(t.length,u=>{const g=A(t,u+s);return i.positiveModulo(g-f,e)})):A(t,s-1)==P&&n.push(i.initializedArray(t.length,g=>{const b=A(t,s-g);return i.positiveModulo(b-f,e)}))}return n}static getSamples(){function t(e,...n){return i.initializedArray(e,s=>n.map(f=>new it(s,(s+f)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=C;function ct(){const o=C.getSamples(),t=C.getUnique(o.pentagram);console.log(t,t.constructor.name);for(const e of t);}ct();{let o=function(a,r,c){const h=r-a,l=c-a,E=2*a,w=2*a;return{x:h,y:l,width:E,height:w}};class t{constructor(r){throw new Error("wtf")}static points=i.initializedArray(5,r=>{const c=i.FULL_CIRCLE*r/5+i.FULL_CIRCLE/4,h=Math.cos(c),l=Math.sin(c);return{x:h,y:l}});static allPaths=[...C.getUnique(C.getSamples().pentagram)]}class e{constructor(r){throw new Error("wtf")}static points=i.initializedArray(6,r=>{const c=i.FULL_CIRCLE*r/6+i.FULL_CIRCLE/4,h=Math.cos(c),l=Math.sin(c);return{x:h,y:l}});static allPaths=[...C.getUnique(C.getSamples().dodecahedron)];static makePathShape(r){const c=this.allPaths[r],h=Z.M(n[0].x,n[0].y);return c.forEach((l,E)=>{if(E==0){if(l!=0)throw new Error("wtf")}else{const{x:w,y:S}=n[l],m=c[E-1];switch(i.positiveModulo(l-m,6)){case 1:{h.arc(0,0,w,S,"cw");break}case 2:case 4:{h.L(w,S);break}case 5:{h.arc(0,0,w,S,"ccw");break}default:throw new Error("wtf")}}}),h.pathShape}}const n=e.points,s=e.allPaths,f=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],P=i.Random.fromString("fourier-smackdown.ts");i.initializedArray(s.length,()=>{const a=P()*3|0,r=f[a];return f.splice(a,1),f.push(r),r});let v=59;const u=9/4,g=.8,b=[{color:"n/a",destRect:o(u*g,u,2.75*u),index:v},{color:"n/a",destRect:o(u*g,16/2,9/2),index:v},{color:"n/a",destRect:o(u*g,16-u,1.25*u),index:v}],k=b.map(({index:a})=>{const r=e.makePathShape(a).rawPath;return new rt(r)});k.forEach(({terms:a,keyframes:r},c)=>{const h=a.length,l=[],E=10;for(;l.length<E-1;){let d;l.length<6?d=1:d=2;const x=a.splice(0,d);if(x.length!=d)throw new Error("wtf");l.push(x)}const w=[],S=[];l.forEach((d,x)=>{x%3<2?w.push(d):S.unshift(d)});const m=[...w,[...a],...S];if(m.length!=E)throw new Error("wtf");if(console.log(m),a.length=0,r.length=0,r.push(0),m.forEach((d,x,L)=>{a.push(...d),r.push(a.length)}),a.length!=h)throw new Error("wtf")}),console.log(k);const p=new Array,F=y.selectorQuery("g#foreground",SVGGElement);y.getById("chapterList",SVGTextElement),b.length-1;const V=[{light:"red",dark:"darkRed"},{light:"white",dark:"black"},{light:"var(--blue)",dark:"darkblue"},{light:"orange",dark:"darkOrange"},{light:"Fuchsia ",dark:"purple"}];for(const[a,r,{light:c,dark:h},l]of i.zip(b,k,V,i.count())){const{destRect:E,search:w}=a,S=w===void 0?document.createElementNS("http://www.w3.org/2000/svg","g"):y.selectorQuery(`g.frequencies[data-frequencies="${w}"]`,SVGGElement),m=w===void 0?F.appendChild(i.assertClass(y.selectorQuery("defs g[data-fourier-top]",SVGGElement).cloneNode(!0),SVGGElement)):y.selectorQuery(`[data-fourier-top="${w}"]`,SVGGElement);m.style.setProperty("--color",c),m.style.setProperty("--blur-color",h);const d=new U(m,G=>D(G,E,"srcRect fits completely into destRect"));m.dataset.liveIndex=l.toString(),S.style.fill=h;const x={base:r,destination:d,liveColor:h,referenceColor:c},L=new M(x);p.push(L),console.log(L)}{let a=function(S){const{index:m,t:d}=h.get(S);d>=1?r.show([],0):r.show(l[m],d*i.FULL_CIRCLE)};const r=new nt('[data-frequencies="red"]'),c=i.assertClass(p.at(2),M),h=c.timer,l=new Array,{keyframes:E,terms:w}=c.base;E.forEach((S,m)=>{const d=m-1;if(d>=0){const x=E[d],L=w.slice(x,S);l.push(L)}}),console.log(l),p.push({show:a})}if(console.log(p),ot(...p),$.get("thumbnail")=="1"){H=!0;const a=new Array;Array.from(F.children).forEach(r=>{const c=i.assertClass(r,SVGElement);c.dataset.live===void 0?c.style.display="none":(console.log("live",c.dataset.live),a.push(c))}),p[0].show(14e3),p[1].show(28e3),p[2].show(42e3),window.showFrame=r=>{console.info(`ignoring showFrame(${r})`)},y.selectorQueryAll("[data-reference]",SVGPathElement).forEach(r=>r.style.display="none"),y.selectorQueryAll("#new-starfield circle",SVGCircleElement).forEach(r=>{r.style.transform="scale(3)",r.style.transformOrigin=`${r.cx.baseVal.value}px ${r.cy.baseVal.value}px`})}}
