import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as N}from"./client-misc-DWuUZUgy.js";import{d as U,D as X,m as Y,T as S}from"./letters-more-Cm2hH_PT.js";import{c as W,R as O,b as F,r as Z,a as _}from"./utility-BHSQpXni.js";import{Q as E,P as k}from"./path-shape-T33T0rPM.js";import{l as tt}from"./math-to-path-BWrqRrmX.js";import{c as J}from"./path-debugger-widget-Rds6Yxwh.js";const C=N("input",HTMLTextAreaElement),x=N("main",SVGElement),A=N("completionRatio",HTMLInputElement);{const t=new S().font,{normal:a}=U(t),r=N("available",HTMLSpanElement);r.innerText=[...a].sort().join(" ")}const $=J();$.insertBefore("debuggerBefore");const z=J();z.insertBefore("debuggerAfter");class v{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,x.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){v.doCleanup(),this.startImpl(),v.#t=this}doCleanup(){}}class et extends v{startImpl(){const t=new S;t.restart();const a=C.value,r=t.addText(a);t.displayText(r,x),x.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}class nt extends v{startImpl(){const t=new S;t.restart();const a=C.value,r=t.addText(a);x.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const h=S.join(r),n=document.createElementNS("http://www.w3.org/2000/svg","g");n.classList.add("handwriting"),x.appendChild(n);let o=.01;h.splitOnMove().forEach(i=>{const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",i.rawPath),n.appendChild(l);const p=o,s=l.getTotalLength();o=p+s,l.style.setProperty("--offset",p.toString()),l.style.setProperty("--length",s.toString())});const c=new AbortController;this.doCleanup=()=>c.abort();const u=o,e=()=>{const i=A.valueAsNumber*u;F(i),n.style.setProperty("--total-position",i.toString())};e(),A.addEventListener("input",e,{signal:c.signal})}static start(){new this().start()}}class ot extends v{startImpl(){const t=new S;t.restart();const a=C.value,r=t.addText(a);x.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const h=S.join(r),n=document.createElementNS("http://www.w3.org/2000/svg","g");n.classList.add("handwriting","skywriting"),x.appendChild(n);let o=.01;h.splitOnMove().forEach(l=>{const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",l.rawPath),n.appendChild(p);const s=o,g=p.getTotalLength();o=s+g,p.style.setProperty("--offset",s.toString()),p.style.setProperty("--length",g.toString())});const c=new AbortController;this.doCleanup=()=>c.abort();const e=o+40,i=()=>{const l=A.valueAsNumber*e;F(l),n.style.setProperty("--total-position",l.toString())};i(),A.addEventListener("input",i,{signal:c.signal})}static start(){new this().start()}}function st(y,t){const a=W(y,t),r=1*Z;return Math.abs(a)<r}class P extends v{static makeRoughShape(t,a,r){const h=t.commands.map(o=>o instanceof E?o:E.line2({x:o.x0,y:o.y0},o)),n=new Array;return new k(h).splitOnMove().forEach(o=>{const c=o.commands.map(s=>{if(!(s instanceof E))throw new Error("wtf");const g=document.createElementNS("http://www.w3.org/2000/svg","path"),m=new k([s]).rawPath;g.setAttribute("d",m);const b=g.getTotalLength();return{command:s,length:b}}),u=c.flatMap(({command:s},g)=>g==0?[]:{x:s.x0,y:s.y0});function e(s,g){const m=Math.min(a,g)*r(),b=r()*Math.PI*2,f=_(m,b),M=s.x+f.x,L=s.y+f.y;return{x:M,y:L,offset:f,initial:s}}const i=c[0],l=[e({x:i.command.x0,y:i.command.y0},i.length)];u.forEach((s,g)=>{const m=c[g],b=c[g+1],f=Math.min(m.length,b.length)/2;l.push(e(s,f))});const p=c[c.length-1];if(l.push(e(p.command,p.length)),l.length!=c.length+1||c.length!=u.length+1)throw new Error("wtf");c.forEach((s,g)=>{const m=l[g],b=l[g+1];let f={x:s.command.x1,y:s.command.y1};if(f={x:f.x+(m.offset.x+b.offset.x)/2,y:f.y+(m.offset.y+b.offset.y)/2},f=e(f,s.length),n.push(E.controlPoints(m.x,m.y,f.x,f.y,b.x,b.y)),g>0&&st(h.at(n.length-2).requestedOutgoingAngle,h.at(n.length-1).requestedIncomingAngle)){let M=function(){return[d,w].some(T=>T.creationInfo.source=="angles"&&!T.creationInfo.success)};const L=n.pop(),I=n.pop(),G=I.requestedOutgoingAngle+W(I.requestedOutgoingAngle,L.requestedIncomingAngle)/2;let d=I.newAngles(void 0,G),w=L.newAngles(G,void 0);if(M()){const T=E.angles(d.x0,d.y0,d.incomingAngle,w.x,w.y,w.outgoingAngle);if(T.creationInfo.success){const q=document.createElementNS("http://www.w3.org/2000/svg","path");q.setAttribute("d",new k([T]).rawPath);const H=q.getTotalLength(),j=H/5,D=H/200,V=q.getPointAtLength(j-D),R=q.getPointAtLength(j+D),B=tt(V,R,.5),Q=Math.atan2(R.y-V.y,R.x-V.x);d=E.angles(d.x0,d.y0,d.incomingAngle,B.x,B.y,Q),w=E.angles(B.x,B.y,Q,w.x,w.y,w.outgoingAngle),console.log("merged",d,w)}}M()&&(d=I,w=L),n.push(d),n.push(w)}})}),{before:new k(h),after:new k(n)}}static makeRoughFont(t,a){const r=new Map;(a==""||a===void 0)&&(a=O.newSeed());const h=O.create(a);t.forEach((o,c)=>{const u=new X(()=>this.makeRoughShape(o.shape,o.fontMetrics.strokeWidth*1.5,h).after,o.advance,o.fontMetrics);r.set(c,u)});const n=r;return n.seed=a,n}static#t=O.create("[1729402151840,42,2115899219,1537839617]");static#e=[];static makeRough(t){function a({shape0:e,shape1:i},l){const p=[{offset:0,d:e.cssPath},{offset:1,d:i.cssPath}],s=l.animate(p,{duration:1,fill:"both"});return s.pause(),s}const r=[...this.#e],h=[...t],n=[];for(;!(r.length==0||h.length==0||r[0].char!=h[0].char);){const e=r.shift(),i=h.shift();n.push({...i,shape0:e.shape0,shape1:e.shape1,animation:a(e,i.element)})}const o=[];for(;!(r.length==0||h.length==0||r.at(-1).char!=h.at(-1).char);){const e=r.pop(),i=h.pop();n.push({...i,shape0:e.shape0,shape1:e.shape1,animation:a(e,i.element)})}const c=h.map(e=>{const i=P.makeRoughShape(e.shape,e.description.fontMetrics.strokeWidth*1.5,P.#t),l=i.before,p=i.after;return{...e,shape0:l,shape1:p,animation:a({shape0:l,shape1:p},e.element)}}),u=[...n,...c,...o];return this.#e=u,u}startImpl(){const t=new S;t.font=Y(7);const a=t.font.get("0").fontMetrics;t.lineHeight=a.bottom-a.capitalTop,t.restart();const r=C.value,h=t.addText(r),n=t.displayText(h,x),o=P.makeRough(n);o.forEach(e=>{e.element.addEventListener("click",()=>{console.log(e),$.pathShape=e.shape0,z.pathShape=e.shape1,navigator.clipboard.writeText(JSON.stringify(e.shape1))}),e.element.style.cursor="grab"}),x.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const c=new AbortController;this.doCleanup=()=>c.abort();const u=()=>{const e=A.valueAsNumber;F(e),o.forEach(({animation:i})=>{i.currentTime=e})};u(),A.addEventListener("input",u,{signal:c.signal})}static start(){new this().start()}}C.addEventListener("input",()=>{v.restartCurrent()});function K(){const y=document.querySelector('input[name="type"]:checked')?.id;switch(y){case"simpleType":{et.start();break}case"handwritingType":{new nt().start();break}case"skywritingType":{new ot().start();break}case"roughType":{new P().start();break}default:throw new Error(`invalid id: ${y}`)}}K();document.querySelectorAll('input[name="type"]').forEach(y=>{y.addEventListener("click",K)});
