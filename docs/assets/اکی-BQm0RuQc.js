import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as E}from"./client-misc-B8CxQsfg.js";import{P as R}from"./path-shape-DN4hoPl6.js";import{m as I}from"./misc-BHUyxQfl.js";const O=1e-4;class A{compute(t,e,n){let s=0;for(let r=0;r<n;r++){const o=this.constant(e,r);s+=o*(t-e)**r}return s}invalid(t){return this.badPoints.some(({real:e,imaginary:n})=>t==e&&n==0)}validRanges(){const t=this.badPoints.flatMap(({real:n,imaginary:s})=>s==0?[n]:[]).sort((n,s)=>n-s);return t.push(1/0),t.map((n,s,r)=>({from:(r[s-1]??-1/0)+O,to:n-O}))}radiusOfConvergence(t){return Math.min(...this.badPoints.map(e=>Math.hypot(t-e.real,e.imaginary)))}partialSum(t,e){const n=I.initializedArray(e,r=>this.constant(t,r));function s(r){const o=r-t;let i=0;return n.forEach((a,d)=>i+=a*o**d),i}return s}}class y extends A{numberOfTerms=1/0;constant(t,e){if(t===0)throw new Error("Reciprocal is undefined at x0 = 0");return(-1)**e/t**(e+1)}f(t){if(t===0)throw new Error("Reciprocal is undefined at x = 0");return 1/t}static instance=new this;badPoints=[{real:0,imaginary:0}]}class N extends A{numberOfTerms=1/0;constant(t,e){const n=t+e*Math.PI/2;let s=1;for(let r=1;r<=e;r++)s*=r;return Math.sin(n)/s}f(t){return Math.sin(t)}static instance=new this;badPoints=[]}class g extends A{numberOfTerms=12;constant(t,e){const n=1+t*t;switch(e){case 0:return 1/n;case 1:return-2*t/n**2;case 2:return(3*t*t-1)/n**3;case 3:return 2*t*(3-5*t*t)/n**4;case 4:return(25*t**4-38*t*t+3)/(2*n**5);case 5:return t*(2842*t*t-1450*t**4-636)/(5*n**6);case 6:return(-7700*t**6+20316*t**4-9120*t*t+216)/(12*n**7);case 7:return t*(29718*t**4-46410*t*t+10869)/(3*n**8);case 8:return(159600*t**8-498960*t**6+424116*t**4-90456*t*t+2268)/(48*n**9);case 9:return t*(-672452*t**6+1660530*t**4-987318*t*t+117693)/(30*n**10);case 10:return(8044400*t**10-30524376*t**8+35128260*t**6-13524948*t**4+1475730*t*t-18360)/(720*n**11);case 11:return t*(29887350*t**8-96204090*t**6+87415950*t**4-22994430*t*t+1596795)/(180*n**12);default:throw new Error(`Term ${e} not implemented.`)}}f(t){return 1/(1+t*t)}static instance=new this;badPoints=[{real:0,imaginary:1},{real:0,imaginary:-1}]}const M=document.documentElement.style;class m{constructor(t){this.which=t,this.#e=E.selectorQuery(`[data-center="${t}"]`,SVGCircleElement),this.#t=E.selectorQuery(`[data-circle-info="${t}"] [data-bottom-center]`,SVGCircleElement),this.#n=E.selectorQuery(`[data-reconstruction="${t}"]`,SVGPathElement)}#e;#t;#n;hide(){M.setProperty(`--example${this.which}-open-end-display`,"none"),this.#e.style.display="none",this.#t.style.display="none",this.#n.style.d=""}draw2(t,e,n,s,r,o){function i(a){const d=t(a),l=e(a);return d*(1-n)+l*n}this.draw(i,s,r,o)}draw(t,e,n,s){if(n-=O,n<=0)throw new Error("wtf");const r=-9,o=9,i=e-n,a=e+n,d=Math.max(r,i),l=Math.min(o,a),f=h=>{const p=I.lerp(d,l,h),T=t(p);return{x:p,y:T}},c=R.parametric(f,50);this.#n.style.d=c.cssPath,this.#e.style.display="",this.#t.style.display="",M.setProperty(`--example${this.which}-center-x`,e+"px"),M.setProperty(`--example${this.which}-center-y`,t(e)+"px"),isFinite(n)?(M.setProperty(`--example${this.which}-from-x`,i+"px"),M.setProperty(`--example${this.which}-from-y`,t(i)+"px"),M.setProperty(`--example${this.which}-from-y-ideal`,s(i)+"px"),M.setProperty(`--example${this.which}-to-x`,a+"px"),M.setProperty(`--example${this.which}-to-y`,t(a)+"px"),M.setProperty(`--example${this.which}-to-y-ideal`,s(a)+"px"),M.setProperty(`--example${this.which}-open-end-display`,"")):M.setProperty(`--example${this.which}-open-end-display`,"none")}precompute(t,e,n){const s=t.radiusOfConvergence(e),r=I.initializedArray(n,i=>t.partialSum(e,i));return i=>{if(i>r.length-1)throw new Error(`Requested: ${i}, Available [0 - ${r.length-1}]`);if(Number.isInteger(i))this.draw(r[i],e,s,t.f);else{let a=function(c){const h=d(c),p=l(c);return h*(1-f)+p*f};const d=r[Math.floor(i)],l=r[Math.ceil(i)],f=i%1;this.draw(a,e,s,t.f)}}}drawAll(t,e,n){if(t.invalid(e))this.hide();else{const s=t.radiusOfConvergence(e);if(Number.isInteger(n))this.draw(t.partialSum(e,n),e,s,t.f);else{const r=t.partialSum(e,Math.floor(n)),o=t.partialSum(e,Math.ceil(n)),i=n%1;this.draw2(r,o,i,e,s,t.f)}}}static instances=[new this("1"),new this("2"),new this("3")]}class _{#e=E.getById("original-function",SVGPathElement);#t=E.getById("bad-points",SVGGElement);#n=E.getById("circles-all",SVGGElement);hide(){this.#e.style.d="",this.#n.style.display="none"}draw(t,e){e?(this.#n.style.display="",this.#t.innerHTML="",t.badPoints.forEach(i=>{const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.innerHTML="⚠️",a.setAttribute("x",i.real.toString()),a.setAttribute("y",i.imaginary.toString()),this.#t.appendChild(a)})):this.#n.style.display="none";const n=-9,s=9,r=t.validRanges().flatMap(i=>{const a=Math.max(n,i.from),d=Math.min(s,i.to);if(a>=d)return[];{const l=c=>{const h=I.lerp(a,d,c),p=t.f(h);return{x:h,y:p}};return R.parametric(l,Math.ceil((d-a)*5)).commands}}),o=new R(r);this.#e.style.d=o.cssPath}static instance=new this}class S{#e=new Map;addScript(t,e){if(this.#s||(this.#s=e),this.#e.has(t))throw new Error("wtf");this.#e.set(t,e)}#t={paused:!0,timePassed:0};get timePassed(){return this.#t.paused?this.#t.timePassed:performance.now()-this.#t.timeOffset}get paused(){return this.#t.paused}pause(){this.#t.paused||(this.#t={paused:!0,timePassed:this.timePassed})}play(){this.#t.paused&&(this.#t={paused:!1,timeOffset:performance.now()-this.timePassed})}set paused(t){t?this.pause():this.play()}restart(t){if(typeof t=="string"){const n=this.#e.get(t);if(n===void 0)throw new Error(`Unknown script: ${t}`);this.#s=n}else if(typeof t=="number"){const n=[...this.#e.values()],s=n[t%n.length];if(s===void 0)throw new Error(`Unknown script: ${t}`);this.#s=s}else if(t!==void 0)throw new Error("unknown script type");const e=this.paused;this.#t={timePassed:0,paused:!0},this.paused=e}#n(t){this.#t.paused||this.show(t-this.#t.timeOffset)}#s;show(t){M.setProperty("--ms-since-start",t.toString()),this.#s.show(t)}constructor(){new E.AnimationLoop(this.#n.bind(this)),window.initScreenCapture=this.initScreenCapture.bind(this),window.showFrame=t=>{this.show(t/60*1e3)}}static instance=new this;initScreenCapture(t){if(document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(e=>{if(!(e instanceof SVGElement||e instanceof HTMLElement))throw new Error("wtf");e.style.display="none"}),typeof t=="string"){const e=this.#e.get(t);if(e){this.#s=e;const n=e.initScreenCapture();return{source:"some4.ts",script:t,devicePixelRatio,...n}}}throw new Error(`Unknown script: ${JSON.stringify(t)}`)}}{let u=function(i){if(i<0||i>=o)return;const a=Math.floor(i/(s+r)),d=i-a*(s+r),f=Math.max(0,d-s)/r,c=a+f,h=N.instance;_.instance.draw(h,!1),m.instances[0].drawAll(h,-Math.PI*7/4,c),m.instances[1].drawAll(h,0,c),m.instances[2].drawAll(h,Math.PI*3/2,c)},t=function(){return{firstFrame:0,lastFrame:Math.floor(o/1e3*60)}};const e="part 1",s=1e3,r=800,o=69400;console.log(`${e} length: ${69400/1e3} seconds.`),S.instance.addScript(e,{show:u,initScreenCapture:t})}{let u=function(l){if(l<0||l>=o)return;const f=Math.floor(l/(s+r)),c=l-f*(s+r),p=Math.max(0,c-s)/r,T=f+p,w=y.instance;_.instance.draw(w,!1),m.instances[0].drawAll(w,-2,T),m.instances[1].drawAll(w,1,T),l<i||l>a?m.instances[2].hide():m.instances[2].drawAll(w,d(l),T)},t=function(){return{firstFrame:0,lastFrame:Math.floor(o/1e3*60)}};const e="part 2",s=1100,r=900,o=41100,i=13e3,a=22e3,d=I.makeLinear(13e3,-9,22e3,9);console.log(`${e} length: ${41100/1e3} seconds.`),S.instance.addScript(e,{show:u,initScreenCapture:t})}{let u=function(i){if(i<0||i>=o)return;const a=Math.floor(i/(s+r)),d=i-a*(s+r),f=Math.max(0,d-s)/r,c=a+f,h=g.instance;_.instance.draw(h,!1),m.instances[0].drawAll(h,-1,c),m.instances[1].drawAll(h,0,c),m.instances[2].drawAll(h,2,c)},t=function(){return{firstFrame:0,lastFrame:Math.floor(o/1e3*60)}};const e="part 3",s=920,r=666,o=19952;console.log(`${e} length: ${19952/1e3} seconds.`),S.instance.addScript(e,{show:u,initScreenCapture:t})}{let u=function(i){if(i<0||i>=o)return;const a=Math.floor(i/(s+r)),d=i-a*(s+r),f=Math.max(0,d-s)/r,c=a+f,h=N.instance;_.instance.draw(h,!0),m.instances[0].drawAll(h,-Math.PI*7/4,c),m.instances[1].drawAll(h,0,c),m.instances[2].drawAll(h,Math.PI*3/2,c)},t=function(){return{firstFrame:0,lastFrame:Math.floor(o/1e3*60)}};const e="part 4",s=500,r=478.5,o=23005.5;console.log(`${e} length: ${23005.5/1e3} seconds.`),S.instance.addScript(e,{show:u,initScreenCapture:t})}{let u=function(l){if(l<0||l>=o)return;const f=Math.floor(l/(s+r)),c=l-f*(s+r),p=Math.max(0,c-s)/r,T=f+p,w=y.instance;_.instance.draw(w,!0),m.instances[0].drawAll(w,-2,T),m.instances[1].drawAll(w,1,T),l<i||l>a?m.instances[2].hide():m.instances[2].drawAll(w,d(l),T)},t=function(){return{firstFrame:0,lastFrame:Math.floor(o/1e3*60)}};const e="part 5",s=820,r=640,o=30020,i=22e3,a=27e3,d=I.makeLinear(22e3,-9,27e3,9);console.log(`${e} length: ${30020/1e3} seconds.`),S.instance.addScript(e,{show:u,initScreenCapture:t})}{let u=function(d){if(d<0||d>=r)return;const l=d/s|0,f=d%s,c=f<o?i(f):a(f),h=g.instance;_.instance.draw(h,!0),m.instances[0].hide(),m.instances[1].hide(),m.instances[2].drawAll(h,c,l)},t=function(){return{firstFrame:0,lastFrame:Math.floor(r/1e3*60)}};const e="part 6",s=1e4,r=8e4;console.log(`${e} length: ${8e4/1e3} seconds.`);const o=1e4/2,i=I.makeLinear(0,-7,o,7),a=I.makeLinear(o,7,1e4,-7);S.instance.addScript(e,{show:u,initScreenCapture:t})}window.debugStuff={HiddenPoles:g,Sine:N,Reciprocal:y,TaylorElements:m,ScriptDispatcher:S};console.log("debugStuff",window.debugStuff);{let u=function(){t()},t=function(){const c=a.map(({use:h,value:p})=>{if(h.checked)return p.valueAsNumber});L(I.parseIntX(n.value),d.checked,s.valueAsNumber,...c)},e=function(){const c=s.valueAsNumber;Number.isInteger(c)?(l=Math.max(0,c-1),f=Math.min(12,c+1)):(l=Math.floor(c),f=Math.ceil(c)),i.innerText=c.toFixed(3),r.innerText=l.toString(),o.innerText=f.toString()};const n=E.selectorQuery("#manual-controls select",HTMLSelectElement),s=E.selectorQuery("#manual-controls > input",HTMLInputElement),[r,o]=E.selectorQueryAll("[data-term-stepper] button",HTMLButtonElement,2,2),i=E.selectorQuery("[data-term-stepper] span",HTMLSpanElement),a=E.selectorQueryAll("#manual-controls > div[data-x0]",HTMLDivElement,3,3).map(c=>{const[h,p]=E.selectorQueryAll("input",HTMLInputElement,2,2,c);return h.addEventListener("input",u),p.addEventListener("input",()=>{h.checked=!0,u()}),{use:h,value:p}}),d=E.getById("show-bad-points",HTMLInputElement);n.addEventListener("input",u);let l=NaN,f=NaN;s.addEventListener("input",()=>{e(),u()}),r.addEventListener("click",()=>{s.value=l.toString(),e(),u()}),o.addEventListener("click",()=>{s.value=f.toString(),e(),u()}),d.addEventListener("input",u),e(),u()}function L(u,t,e,...n){const s=[N.instance,y.instance,g.instance],r=s[u%s.length];_.instance.draw(r,t),m.instances.forEach((o,i)=>{const a=n[i];a===void 0?o.hide():o.drawAll(r,a,e)})}window.debugDraw=L;
