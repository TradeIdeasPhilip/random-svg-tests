import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as v}from"./client-misc-ZHNZ3-cL.js";import{T as m,m as k}from"./letters-more-DuHTG-yD.js";import{d as A,D as P}from"./letters-base-Dg5OErWY.js";import{c as L}from"./path-debugger-widget-DUmCXWYU.js";import{m as f}from"./misc-wGF4FraP.js";import{m as S}from"./rough-lib-C0xFdSSB.js";import"./path-shape-n6EbRjvk.js";import"./utility-DqApwI2-.js";import"./math-to-path-BjxPr1Cw.js";const y=v.getById("input",HTMLTextAreaElement),g=v.getById("main",SVGElement),b=v.getById("completionRatio",HTMLInputElement);{const t=new m().font,{normal:n}=A(t),o=v.getById("available",HTMLSpanElement);o.innerText=[...n].sort().join(" ")}const T=L();T.insertBefore("debuggerBefore");const C=L();C.insertBefore("debuggerAfter");class w{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,g.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){w.doCleanup(),this.startImpl(),w.#t=this}doCleanup(){}}class B extends w{startImpl(){const t=new m;t.restart();const n=y.value,o=t.addText(n);m.displayText(o,g),g.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}class I extends w{startImpl(){const t=new m;t.restart();const n=y.value,o=t.addText(n);g.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const i=m.join(o),a=document.createElementNS("http://www.w3.org/2000/svg","g");a.classList.add("handwriting"),g.appendChild(a);let r=.01;i.splitOnMove().forEach(s=>{const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",s.rawPath),a.appendChild(c);const l=r,u=c.getTotalLength();r=l+u,c.style.setProperty("--offset",l.toString()),c.style.setProperty("--length",u.toString())});const p=new AbortController;this.doCleanup=()=>p.abort();const d=r,e=()=>{const s=b.valueAsNumber*d;f.assertFinite(s),a.style.setProperty("--total-position",s.toString())};e(),b.addEventListener("input",e,{signal:p.signal})}static start(){new this().start()}}class R extends w{startImpl(){const t=new m;t.restart();const n=y.value,o=t.addText(n);g.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const i=m.join(o),a=document.createElementNS("http://www.w3.org/2000/svg","g");a.classList.add("handwriting","skywriting"),g.appendChild(a);let r=.01;i.splitOnMove().forEach(c=>{const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",c.rawPath),a.appendChild(l);const u=r,E=l.getTotalLength();r=u+E,l.style.setProperty("--offset",u.toString()),l.style.setProperty("--length",E.toString())});const p=new AbortController;this.doCleanup=()=>p.abort();const e=r+40,s=()=>{const c=b.valueAsNumber*e;f.assertFinite(c),a.style.setProperty("--total-position",c.toString())};s(),b.addEventListener("input",s,{signal:p.signal})}static start(){new this().start()}}class x extends w{static makeRoughFont(t,n){const o=new Map;(n==""||n===void 0)&&(n=f.Random.newSeed());const i=f.Random.create(n);t.forEach((r,p)=>{const d=new P(()=>S(r.shape,r.fontMetrics.strokeWidth*1.5,i).after,r.advance,r.fontMetrics);o.set(p,d)});const a=o;return a.seed=n,a}static#t=f.Random.create("[1729402151840,42,2115899219,1537839617]");static#e=[];static makeRough(t){function n({shape0:e,shape1:s},c){const l=[{offset:0,d:e.cssPath},{offset:1,d:s.cssPath}],u=c.animate(l,{duration:1,fill:"both"});return u.pause(),u}const o=[...this.#e],i=[...t],a=[];for(;!(o.length==0||i.length==0||o[0].char!=i[0].char);){const e=o.shift(),s=i.shift();a.push({...s,shape0:e.shape0,shape1:e.shape1,animation:n(e,s.element)})}const r=[];for(;!(o.length==0||i.length==0||o.at(-1).char!=i.at(-1).char);){const e=o.pop(),s=i.pop();a.push({...s,shape0:e.shape0,shape1:e.shape1,animation:n(e,s.element)})}const p=i.map(e=>{const s=S(e.shape,e.description.fontMetrics.strokeWidth*1.5,x.#t),c=s.before,l=s.after;return{...e,shape0:c,shape1:l,animation:n({shape0:c,shape1:l},e.element)}}),d=[...a,...p,...r];return this.#e=d,d}startImpl(){const t=new m;t.font=k(7);const n=t.font.get("0").fontMetrics;t.lineHeight=n.bottom-n.capitalTop,t.restart();const o=y.value,i=t.addText(o),a=m.displayText(i,g),r=x.makeRough(a);r.forEach(e=>{e.element.addEventListener("click",()=>{console.log(e),T.pathShape=e.shape0,C.pathShape=e.shape1,navigator.clipboard.writeText(JSON.stringify(e.shape1))}),e.element.style.cursor="grab"}),g.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const p=new AbortController;this.doCleanup=()=>p.abort();const d=()=>{const e=b.valueAsNumber;f.assertFinite(e),r.forEach(({animation:s})=>{s.currentTime=e})};d(),b.addEventListener("input",d,{signal:p.signal})}static start(){new this().start()}}y.addEventListener("input",()=>{w.restartCurrent()});function M(){const h=document.querySelector('input[name="type"]:checked')?.id;switch(h){case"simpleType":{B.start();break}case"handwritingType":{new I().start();break}case"skywritingType":{new R().start();break}case"roughType":{new x().start();break}default:throw new Error(`invalid id: ${h}`)}}M();document.querySelectorAll('input[name="type"]').forEach(h=>{h.addEventListener("click",M)});function V(){const h=[..."♡◯◡"],t=k(42);h.forEach(n=>{console.log(n),console.table(t.get(n).shape.commands.map(o=>({incoming:o.incomingAngle*f.degreesPerRadian,outgoing:o.outgoingAngle*f.degreesPerRadian})))})}V();
