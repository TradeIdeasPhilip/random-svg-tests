import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as R,m as x}from"./client-misc-CqK8Npau.js";import{d as z,D as K,m as U,T as A}from"./letters-more-CCFt004V.js";import{Q as S,P}from"./path-shape-CZ8Qd9-L.js";import{l as X}from"./math-to-path-D11qeOG5.js";import{c as Q}from"./path-debugger-widget-CdymCBk5.js";const M=R("input",HTMLTextAreaElement),v=R("main",SVGElement),L=R("completionRatio",HTMLInputElement);{const t=new A().font,{normal:a}=z(t),r=R("available",HTMLSpanElement);r.innerText=[...a].sort().join(" ")}const W=Q();W.insertBefore("debuggerBefore");const J=Q();J.insertBefore("debuggerAfter");class E{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,v.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){E.doCleanup(),this.startImpl(),E.#t=this}doCleanup(){}}class Y extends E{startImpl(){const t=new A;t.restart();const a=M.value,r=t.addText(a);t.displayText(r,v),v.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}class Z extends E{startImpl(){const t=new A;t.restart();const a=M.value,r=t.addText(a);v.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const h=A.join(r),n=document.createElementNS("http://www.w3.org/2000/svg","g");n.classList.add("handwriting"),v.appendChild(n);let o=.01;h.splitOnMove().forEach(i=>{const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",i.rawPath),n.appendChild(l);const p=o,s=l.getTotalLength();o=p+s,l.style.setProperty("--offset",p.toString()),l.style.setProperty("--length",s.toString())});const c=new AbortController;this.doCleanup=()=>c.abort();const u=o,e=()=>{const i=L.valueAsNumber*u;x.assertFinite(i),n.style.setProperty("--total-position",i.toString())};e(),L.addEventListener("input",e,{signal:c.signal})}static start(){new this().start()}}class _ extends E{startImpl(){const t=new A;t.restart();const a=M.value,r=t.addText(a);v.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const h=A.join(r),n=document.createElementNS("http://www.w3.org/2000/svg","g");n.classList.add("handwriting","skywriting"),v.appendChild(n);let o=.01;h.splitOnMove().forEach(l=>{const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",l.rawPath),n.appendChild(p);const s=o,g=p.getTotalLength();o=s+g,p.style.setProperty("--offset",s.toString()),p.style.setProperty("--length",g.toString())});const c=new AbortController;this.doCleanup=()=>c.abort();const e=o+40,i=()=>{const l=L.valueAsNumber*e;x.assertFinite(l),n.style.setProperty("--total-position",l.toString())};i(),L.addEventListener("input",i,{signal:c.signal})}static start(){new this().start()}}function tt(y,t){const a=x.angleBetween(y,t),r=1*x.radiansPerDegree;return Math.abs(a)<r}class C extends E{static makeRoughShape(t,a,r){const h=t.commands.map(o=>o instanceof S?o:S.line2({x:o.x0,y:o.y0},o)),n=new Array;return new P(h).splitOnMove().forEach(o=>{const c=o.commands.map(s=>{if(!(s instanceof S))throw new Error("wtf");const g=document.createElementNS("http://www.w3.org/2000/svg","path"),m=new P([s]).rawPath;g.setAttribute("d",m);const b=g.getTotalLength();return{command:s,length:b}}),u=c.flatMap(({command:s},g)=>g==0?[]:{x:s.x0,y:s.y0});function e(s,g){const m=Math.min(a,g)*r(),b=r()*Math.PI*2,f=x.polarToRectangular(m,b),I=s.x+f.x,T=s.y+f.y;return{x:I,y:T,offset:f,initial:s}}const i=c[0],l=[e({x:i.command.x0,y:i.command.y0},i.length)];u.forEach((s,g)=>{const m=c[g],b=c[g+1],f=Math.min(m.length,b.length)/2;l.push(e(s,f))});const p=c[c.length-1];if(l.push(e(p.command,p.length)),l.length!=c.length+1||c.length!=u.length+1)throw new Error("wtf");c.forEach((s,g)=>{const m=l[g],b=l[g+1];let f={x:s.command.x1,y:s.command.y1};if(f={x:f.x+(m.offset.x+b.offset.x)/2,y:f.y+(m.offset.y+b.offset.y)/2},f=e(f,s.length),n.push(S.controlPoints(m.x,m.y,f.x,f.y,b.x,b.y)),g>0&&tt(h.at(n.length-2).requestedOutgoingAngle,h.at(n.length-1).requestedIncomingAngle)){let I=function(){return[d,w].some(k=>k.creationInfo.source=="angles"&&!k.creationInfo.success)};const T=n.pop(),B=n.pop(),O=B.requestedOutgoingAngle+x.angleBetween(B.requestedOutgoingAngle,T.requestedIncomingAngle)/2;let d=B.newAngles(void 0,O),w=T.newAngles(O,void 0);if(I()){const k=S.angles(d.x0,d.y0,d.incomingAngle,w.x,w.y,w.outgoingAngle);if(k.creationInfo.success){const q=document.createElementNS("http://www.w3.org/2000/svg","path");q.setAttribute("d",new P([k]).rawPath);const G=q.getTotalLength(),H=G/5,j=G/200,V=q.getPointAtLength(H-j),F=q.getPointAtLength(H+j),N=X(V,F,.5),D=Math.atan2(F.y-V.y,F.x-V.x);d=S.angles(d.x0,d.y0,d.incomingAngle,N.x,N.y,D),w=S.angles(N.x,N.y,D,w.x,w.y,w.outgoingAngle),console.log("merged",d,w)}}I()&&(d=B,w=T),n.push(d),n.push(w)}})}),{before:new P(h),after:new P(n)}}static makeRoughFont(t,a){const r=new Map;(a==""||a===void 0)&&(a=x.Random.newSeed());const h=x.Random.create(a);t.forEach((o,c)=>{const u=new K(()=>this.makeRoughShape(o.shape,o.fontMetrics.strokeWidth*1.5,h).after,o.advance,o.fontMetrics);r.set(c,u)});const n=r;return n.seed=a,n}static#t=x.Random.create("[1729402151840,42,2115899219,1537839617]");static#e=[];static makeRough(t){function a({shape0:e,shape1:i},l){const p=[{offset:0,d:e.cssPath},{offset:1,d:i.cssPath}],s=l.animate(p,{duration:1,fill:"both"});return s.pause(),s}const r=[...this.#e],h=[...t],n=[];for(;!(r.length==0||h.length==0||r[0].char!=h[0].char);){const e=r.shift(),i=h.shift();n.push({...i,shape0:e.shape0,shape1:e.shape1,animation:a(e,i.element)})}const o=[];for(;!(r.length==0||h.length==0||r.at(-1).char!=h.at(-1).char);){const e=r.pop(),i=h.pop();n.push({...i,shape0:e.shape0,shape1:e.shape1,animation:a(e,i.element)})}const c=h.map(e=>{const i=C.makeRoughShape(e.shape,e.description.fontMetrics.strokeWidth*1.5,C.#t),l=i.before,p=i.after;return{...e,shape0:l,shape1:p,animation:a({shape0:l,shape1:p},e.element)}}),u=[...n,...c,...o];return this.#e=u,u}startImpl(){const t=new A;t.font=U(7);const a=t.font.get("0").fontMetrics;t.lineHeight=a.bottom-a.capitalTop,t.restart();const r=M.value,h=t.addText(r),n=t.displayText(h,v),o=C.makeRough(n);o.forEach(e=>{e.element.addEventListener("click",()=>{console.log(e),W.pathShape=e.shape0,J.pathShape=e.shape1,navigator.clipboard.writeText(JSON.stringify(e.shape1))}),e.element.style.cursor="grab"}),v.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const c=new AbortController;this.doCleanup=()=>c.abort();const u=()=>{const e=L.valueAsNumber;x.assertFinite(e),o.forEach(({animation:i})=>{i.currentTime=e})};u(),L.addEventListener("input",u,{signal:c.signal})}static start(){new this().start()}}M.addEventListener("input",()=>{E.restartCurrent()});function $(){const y=document.querySelector('input[name="type"]:checked')?.id;switch(y){case"simpleType":{Y.start();break}case"handwritingType":{new Z().start();break}case"skywritingType":{new _().start();break}case"roughType":{new C().start();break}default:throw new Error(`invalid id: ${y}`)}}$();document.querySelectorAll('input[name="type"]').forEach(y=>{y.addEventListener("click",$)});
