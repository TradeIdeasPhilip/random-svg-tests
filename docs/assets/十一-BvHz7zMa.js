import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as f}from"./client-misc-ZHNZ3-cL.js";import{m as B}from"./misc-wGF4FraP.js";import{R as M,m as nt,c as et,b as H}from"./utility-D-kBkb6L.js";import{m as k,T as G}from"./letters-more-DkNc7UGy.js";import{m as W}from"./rough-lib-PI00gaPW.js";import{H as it}from"./handwriting-effect-2FjZRqWW.js";import"./letters-base-DU8plAKw.js";import"./path-shape-ZNbOYjhy.js";import"./math-to-path-BjxPr1Cw.js";const D=f.getById("randomSeed",HTMLInputElement),ot=f.getById("draw",HTMLButtonElement),st=f.getById("timeInSeconds",HTMLInputElement),N=f.getById("start",HTMLButtonElement),at=f.getById("time",HTMLInputElement),y=f.getById("handwriting",SVGGElement),b=f.getById("morph",SVGGElement);ot.addEventListener("click",()=>{P()});const rt=Intl.NumberFormat(void 0,{useGrouping:!0,maximumFractionDigits:4}),ct=Intl.NumberFormat(void 0,{useGrouping:!0,minimumFractionDigits:2,maximumFractionDigits:2}),mt=Intl.NumberFormat(void 0,{useGrouping:!0,minimumFractionDigits:4,maximumFractionDigits:4});function P(){function s(t){const n=rt.format(t),o=t+1,e=t-1,i=o/e,c=e/o,u=(i+c)/2,r=i-u;return isFinite(u)&&isFinite(r)?{baseValueString:n,finite:!0,meanString:ct.format(u),errorString:mt.format(r)}:{baseValueString:n,finite:!1,errorMessage:"#DIV/0!"}}const p=[{strings:s(10001),finalRough:0},{strings:s(1001),finalRough:0},{strings:s(101),finalRough:.2},{strings:s(11),finalRough:.45},{strings:s(2),finalRough:.7},{strings:s(1.1),finalRough:1},{strings:s(1.01),finalRough:1.2},{strings:s(1.001),finalRough:1.5},{strings:s(1.0001),finalRough:2},{strings:s(1),finalRough:0}];let l=D.value;M.seedIsValid(l)||(l=M.newSeed(),D.value=l);const I=M.create(l);y.innerHTML="",b.innerHTML="";class L{#n=new Array;get letters(){return[...this.#n]}#t=new G;constructor(n){n instanceof Map||(n=k(n)),this.#t.font=n,this.restart()}restart(){this.#t.restart(0,0),this.#n.length=0}addAndTag(n,o){const e=this.#t.addText(n),i=this.#n;e.forEach(c=>i.push({colorName:o,...c}))}get width(){return this.#t.x}extract(){const n={width:this.width,letters:this.letters};return this.restart(),n}single(n,o){return this.restart(),this.addAndTag(n,o),this.extract()}}const g=k(2.7),m=new L(g),w=m.single(" ÷ ","blue"),R=m.single(" → ","blue"),x=p.map(t=>{const n=t.strings;m.addAndTag("("+n.baseValueString,"blue"),m.addAndTag(" ± 1","white"),m.addAndTag(")","blue");const o=m.extract();if(n.finite){const e=m.single(n.meanString,"blue"),i=m.single(" ± "+n.errorString,"white");return{inputLayoutInfo:o,finite:!0,meanLayoutInfo:e,errorLayoutInfo:i}}else{const e=m.single(n.errorMessage,"gold");return{inputLayoutInfo:o,finite:!1,messageLayoutInfo:e}}});let a=7;const S=Math.max(...x.map(t=>t.inputLayoutInfo.width)),F=a+S/2;a+=S;const C=a;a+=w.width;const O=a+S/2;a+=S;const q=a;a+=R.width;const U=Math.max(...x.flatMap(t=>t.finite?[t.meanLayoutInfo.width]:[])),v=a;a+=U;const X=a,j=Math.max(...x.flatMap(t=>t.finite?[t.errorLayoutInfo.width]:[]));a+=j;const z=a,J=a,K=x.map((t,n)=>{const o=[],e=(n+1)*4.8*1.125;function i(r,d,h){d.forEach(T=>{o.push({...T,x:T.x+r,baseline:e,neverLeaveRough:h})})}const c=F-t.inputLayoutInfo.width/2;i(c,t.inputLayoutInfo.letters,!0),i(C,w.letters,!0);const u=c-F+O;if(i(u,t.inputLayoutInfo.letters,!0),i(q,R.letters,!0),t.finite){const r=t.meanLayoutInfo;i(X-r.width,r.letters,!1);const d=t.errorLayoutInfo;i(z-d.width,d.letters,!1)}else{const d=J-v-t.messageLayoutInfo.width,h=v+d/2;i(h,t.messageLayoutInfo.letters,!0)}return o}),E=[];K.map((t,n)=>{const o=p[n].finalRough;t.forEach(e=>{const i=W(e.description.shape,e.description.fontMetrics.strokeWidth,I),c=e.neverLeaveRough?0:o;if(c<=1){const u=i.after,r=i.before,d=1-c,h=e.description.reshape(u);E.push({...e,initialShape:u,finalShape:r,finalAnimation:d,description:h})}else{const u=W(i.after,e.description.fontMetrics.strokeWidth*(c-1)*3,I),r=u.before,d=u.after,h="forever",T=e.description.reshape(r);E.push({...e,initialShape:r,finalShape:d,finalAnimation:h,description:T})}})});const A=G.displayText(E,b).map(t=>{t.element.classList.add(t.colorName);const n=t.finalAnimation,o=[{offset:0,d:t.initialShape.cssPath},{offset:1,d:t.finalShape.cssPath}];if(typeof n=="number"){const e=t.element.animate(o,{duration:1,fill:"both"});e.currentTime=n,e.commitStyles(),e.cancel(),o.pop();const i=t.element.animate(o,{duration:1,fill:"both"});return i.pause(),i}else{const e=t.element.animate(o,{duration:5,fill:"both",direction:"alternate",iterations:1/0});return e.pause(),e}}),Q=()=>{b.style.display="none"},Y=t=>{H(t),b.style.display="";const o=t*A.length*(.5+1);A.forEach((e,i)=>{const c=o-i;e.currentTime=c})};{const t=new it(y);E.forEach(n=>{t.add({baseline:n.baseline,x:n.x,shape:n.description.shape}).forEach(({element:e})=>{e.classList.add(n.colorName)})})}const Z=()=>{y.style.display="none"},_=t=>{H(t),y.style.display="",y.style.setProperty("--t",t.toString())},$=nt(2,1.5),tt=t=>{const n=$(t);switch(n.index){case 0:{Q(),_(n.t);break}case 1:{Z(),Y(n.t);break}default:throw new Error("wtf")}};window.showFrame=tt,N.disabled=!1}let V;N.addEventListener("click",()=>{V?.cancel();const s=B.parseIntX(st.value);if(s===void 0)throw new Error("I don't want to do this better");let p=0,l;const I=et(3),L=new f.AnimationLoop(g=>{if(l||(p=g+s*1e3,l=B.makeLinear(g,0,p,1)),g>p)L.cancel(),window.showFrame(1);else{const m=l(g),w=I(m);at.value=w.toString(),window.showFrame(w)}});V=L});function ut(){return P(),document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(s=>{if(!(s instanceof SVGElement||s instanceof HTMLElement))throw new Error("wtf");s.style.display="none"}),{source:"show-text-1.ts",devicePixelRatio}}window.initScreenCapture=ut;
