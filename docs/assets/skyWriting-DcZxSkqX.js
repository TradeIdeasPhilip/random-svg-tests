import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as L}from"./client-misc-leadhGo2.js";import{d as N,T as x,Q as S,P as I,D as q}from"./letters-more-CS7tnLdg.js";import{b as A,a as B}from"./utility-DcEUXXL7.js";import{l as F}from"./math-to-path-CWuJ-zIl.js";const k=L("input",HTMLTextAreaElement),f=L("main",SVGElement),E=L("completionRatio",HTMLInputElement);{const t=new x().font,{normal:i}=N(t),e=L("available",HTMLSpanElement);e.innerText=[...i].sort().join(" ")}class y{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,f.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){y.doCleanup(),this.startImpl(),y.#t=this}doCleanup(){}}class H extends y{startImpl(){const t=new x;t.restart();const i=k.value,e=t.addText(i);t.displayText(e,f),f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}class j extends y{startImpl(){const t=new x;t.restart();const i=k.value,e=t.addText(i);f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const a=x.join(e),c=document.createElementNS("http://www.w3.org/2000/svg","g");c.classList.add("handwriting"),f.appendChild(c);let r=0;a.splitOnMove().forEach(o=>{const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",o.rawPath),c.appendChild(l);const n=r,h=l.getTotalLength();r=n+h,l.style.setProperty("--offset",n.toString()),l.style.setProperty("--length",h.toString())});const p=new AbortController;this.doCleanup=()=>p.abort();const u=r,s=()=>{const o=E.valueAsNumber*u;A(o),c.style.setProperty("--total-position",o.toString())};s(),E.addEventListener("input",s,{signal:p.signal})}static start(){new this().start()}}class O extends y{startImpl(){const t=new x;t.restart();const i=k.value,e=t.addText(i);f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const a=x.join(e),c=document.createElementNS("http://www.w3.org/2000/svg","g");c.classList.add("handwriting","skywriting"),f.appendChild(c);let r=0;a.splitOnMove().forEach(l=>{const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",l.rawPath),c.appendChild(n);const h=r,d=n.getTotalLength();r=h+d,n.style.setProperty("--offset",h.toString()),n.style.setProperty("--length",d.toString())});const p=new AbortController;this.doCleanup=()=>p.abort();const s=r+40,o=()=>{const l=E.valueAsNumber*s;A(l),c.style.setProperty("--total-position",l.toString())};o(),E.addEventListener("input",o,{signal:p.signal})}static start(){new this().start()}}function Q(g,t){return Math.abs(g-t)<Math.PI/180}class C extends y{static makeRoughShape(t,i){const e=new Array,a=new Array;return t.splitOnMove().forEach(c=>{const r=c.commands,p=r.flatMap((n,h)=>h==0?[]:{x:n.x0,y:n.y0});function u(n,h){const d=i*(h?Math.SQRT1_2:1)*Math.random(),m=Math.random()*Math.PI*2,w=B(d,m),M=n.x+w.x,T=n.y+w.y;return{x:M,y:T,offset:w,initial:n}}const s=r[0],o=[u({x:s.x0,y:s.y0},"½")];p.forEach(n=>{o.push(u(n))});const l=r[r.length-1];if(o.push(u(l)),o.length!=r.length+1||r.length!=p.length+1)throw new Error("wtf");r.forEach((n,h)=>{const d=o[h],m=o[h+1],w=n instanceof S?{x:n.x1,y:n.y1}:F(d,m,Math.random()),M={x:w.x+(d.offset.x+m.offset.x)/2,y:w.y+(d.offset.y+m.offset.y)/2},T=u(M,"½");if(a.push(new S(d.x,d.y,T.x,T.y,m.x,m.y)),e.push(new S(d.initial.x,d.initial.y,w.x,w.y,m.initial.x,m.initial.y)),h>0&&Q(e.at(-2).outgoingAngle,e.at(-1).incomingAngle)){const b=a.pop(),v=a.pop(),P=(v.outgoingAngle+b.incomingAngle)/2,R=S.angles(v.x0,v.y0,v.incomingAngle,v.x,v.y,P);a.push(R);const G=S.angles(b.x0,b.y0,P,b.x,b.y,b.outgoingAngle);a.push(G)}})}),{before:new I(e),after:new I(a)}}static makeRoughFont(t){const i=new Map;return t.forEach((e,a)=>{const c=new q(()=>this.makeRoughShape(e.shape,e.fontMetrics.strokeWidth*1.5).after,e.advance,e.fontMetrics);i.set(a,c)}),i}static#t=[];static makeRough(t){function i({shape0:s,shape1:o},l){const n=[{offset:0,d:s.cssPath},{offset:1,d:o.cssPath}],h=l.animate(n,{duration:1,fill:"both"});return h.pause(),h}const e=[...this.#t],a=[...t],c=[];for(;!(e.length==0||a.length==0||e[0].char!=a[0].char);){const s=e.shift(),o=a.shift();c.push({...o,shape0:s.shape0,shape1:s.shape1,animation:i(s,o.element)})}const r=[];for(;!(e.length==0||a.length==0||e.at(-1).char!=a.at(-1).char);){const s=e.pop(),o=a.pop();c.push({...o,shape0:s.shape0,shape1:s.shape1,animation:i(s,o.element)})}const p=a.map(s=>{const o=C.makeRoughShape(s.shape,s.description.fontMetrics.strokeWidth*1.5),l=o.before,n=o.after;return{...s,shape0:l,shape1:n,animation:i({shape0:l,shape1:n},s.element)}}),u=[...c,...p,...r];return this.#t=u,u}startImpl(){const t=new x;t.restart();const i=k.value,e=t.addText(i),a=t.displayText(e,f),c=C.makeRough(a);f.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const r=new AbortController;this.doCleanup=()=>r.abort();const p=()=>{const u=E.valueAsNumber;A(u),c.forEach(({animation:s})=>{s.currentTime=u})};p(),E.addEventListener("input",p,{signal:r.signal})}static start(){new this().start()}}k.addEventListener("input",()=>{y.restartCurrent()});function V(){const g=document.querySelector('input[name="type"]:checked')?.id;switch(g){case"simpleType":{H.start();break}case"handwritingType":{new j().start();break}case"skywritingType":{new O().start();break}case"roughType":{new C().start();break}default:throw new Error(`invalid id: ${g}`)}}V();document.querySelectorAll('input[name="type"]').forEach(g=>{g.addEventListener("click",V)});
