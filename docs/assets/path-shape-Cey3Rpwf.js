import{m as g}from"./misc-BHUyxQfl.js";function I(h,t,n){return new DOMPoint(h,t).matrixTransform(n)}function O(h,t,n,s=.5,e=.5){return new DOMMatrix(V(h,t,n,s,e))}function V(h,t,n,s=.5,e=.5){const i=h.width/h.height,o=t.width/t.height;let r;switch(n){case"meet":case"srcRect fits completely into destRect":{i>o?r=t.width/h.width:r=t.height/h.height;break}case"slice":case"srcRect completely covers destRect":{i>o?r=t.height/h.height:r=t.width/h.width;break}default:throw new Error("wtf")}const c=-h.x*r+s*(t.width-h.width*r)+t.x,u=-h.y*r+e*(t.height-h.height*r)+t.y;return`translate(${c}px, ${u}px) scale(${r})`}function j(){{const h={x:-1,y:-1,width:2,height:2},t={x:0,y:0,height:244,width:325},n=O(h,t,"meet");[{x:h.x,y:h.y},{x:h.x+h.width,y:h.y},{x:h.x+h.width,y:h.y+h.height},{x:h.x,y:h.y+h.height}].forEach(({x:e,y:i})=>{const o=I(e,i,n);if(o.x<t.x||o.x>t.x+t.width||o.y<t.y||o.y>t.y+t.height)throw new Error(`Test 1 failed: Point (${o.x}, ${o.y}) is outside destination (${t.x}, ${t.y}, ${t.width}, ${t.height})`)})}{const h={x:-1,y:-1,width:2,height:2},t={x:0,y:0,height:325,width:244},n=O(h,t,"meet");[{x:h.x,y:h.y},{x:h.x+h.width,y:h.y},{x:h.x+h.width,y:h.y+h.height},{x:h.x,y:h.y+h.height}].forEach(({x:e,y:i})=>{const o=I(e,i,n);if(o.x<t.x||o.x>t.x+t.width||o.y<t.y||o.y>t.y+t.height)throw new Error(`Test 2 failed: Point (${o.x}, ${o.y}) is outside destination (${t.x}, ${t.y}, ${t.width}, ${t.height})`)})}}j();class D{#n=document.createElementNS("http://www.w3.org/2000/svg","svg");#t=document.createElementNS("http://www.w3.org/2000/svg","path");constructor(){this.#n.style.width="0",this.#n.style.height="0",this.#n.style.position="absolute",this.#n.appendChild(this.#t),document.body.appendChild(this.#n)}getBBox(){return this.#t.getBBox()}get d(){return this.#t.getAttribute("d")??""}set d(t){this.#t.style.d="",this.#t.style.d=w.cssifyPath(t);const n=this.#t.style.d!="";if(this.#t.style.d="",n)this.#t.setAttribute("d",t);else throw new Error("Invalid path")}get empty(){return this.d==""}clear(){this.d=""}get length(){return this.#t.getTotalLength()}getPoint(t){return this.#t.getPointAtLength(t)}load(t){typeof t!="string"&&(t instanceof w||(t=new w([t])),t=t.rawPath),this.d=t}measure(t){return this.load(t),this.length}}const A=new Intl.NumberFormat("en-US",{maximumSignificantDigits:8,useGrouping:!1}).format;class E{constructor(t,n,s,e){this.x0=t,this.y0=n,this.x=s,this.y=e,g.assertFinite(t,n,s,e),this.asString=`L ${A(s)},${A(e)}`,this.outgoingAngle=this.incomingAngle=Math.atan2(e-n,s-t)}reverse(){return new E(this.x,this.y,this.x0,this.y0)}toJSON(){return{command:"L",x0:this.x0,y0:this.y0,x:this.x,y:this.y}}static relative(t,n,s,e){return new this(t,n,s+t,e+n)}incomingAngle;outgoingAngle;command="L";asString;get length(){return Math.hypot(this.x0-this.x,this.y0-this.y)}translate(t,n){return new E(this.x0+t,this.y0+n,this.x+t,this.y+n)}toCubic(){return new F(this.x0,this.y0,g.lerp(this.x0,this.x,1/3),g.lerp(this.y0,this.y,1/3),g.lerp(this.x0,this.x,2/3),g.lerp(this.y0,this.y,2/3),this.x,this.y)}transform(t){const n=I(this.x,this.y,t),s=I(this.x0,this.y0,t);return new E(s.x,s.y,n.x,n.y)}}class M{constructor(t,n,s,e,i,o,r){this.x0=t,this.y0=n,this.x1=s,this.y1=e,this.x=i,this.y=o,this.creationInfo=r,g.assertFinite(t,n,s,e,i,o),this.asString=`Q ${A(s)},${A(e)} ${A(i)},${A(o)}`}reverse(){return M.controlPoints(this.x,this.y,this.x1,this.y1,this.x0,this.y0)}static line(t,n,s,e,i){return new this(t,n,(t+s)/2,(n+e)/2,s,e,i)}static line4(t,n,s,e){return this.line(t,n,s,e,{source:"line"})}static line2(t,n){return this.line4(t.x,t.y,n.x,n.y)}static angles(t,n,s,e,i,o){g.assertFinite(t,n,s,e,i,o);const r=rt({x0:t,y0:n,angle:s},{x0:e,y0:i,angle:o+Math.PI});return r?new this(t,n,r.x,r.y,e,i,{source:"angles",success:!0,angle:o,angle0:s}):this.line(t,n,e,i,{source:"angles",success:!1,angle:o,angle0:s})}newAngles(t,n){return t??=this.requestedIncomingAngle,n??=this.requestedOutgoingAngle,M.angles(this.x0,this.y0,t,this.x,this.y,n)}toJSON(){return{command:"Q",x0:this.x0,y0:this.y0,x1:this.x1,y1:this.y1,x:this.x,y:this.y,creationInfo:this.creationInfo}}static controlPoints(t,n,s,e,i,o){return new this(t,n,s,e,i,o,{source:"controlPoints"})}static relative(t,n,s,e,i,o){return this.controlPoints(t,n,s+t,e+n,i+t,o+n)}get incomingAngle(){return Math.atan2(this.y1-this.y0,this.x1-this.x0)}get outgoingAngle(){return Math.atan2(this.y-this.y1,this.x-this.x1)}get requestedIncomingAngle(){return this.creationInfo.source=="angles"?this.creationInfo.angle0:this.incomingAngle}get requestedOutgoingAngle(){return this.creationInfo.source=="angles"?this.creationInfo.angle:this.outgoingAngle}command="Q";asString;translate(t,n){return M.controlPoints(this.x0+t,this.y0+n,this.x1+t,this.y1+n,this.x+t,this.y+n)}transform(t){const n=I(this.x0,this.y0,t),s=I(this.x1,this.y1,t),e=I(this.x,this.y,t);return M.controlPoints(n.x,n.y,s.x,s.y,e.x,e.y)}toCubic(){return new F(this.x0,this.y0,g.lerp(this.x0,this.x1,2/3),g.lerp(this.y0,this.y1,2/3),g.lerp(this.x,this.x1,2/3),g.lerp(this.y,this.y1,2/3),this.x,this.y)}split(t){const{x:n,x0:s,x1:e,y:i,y0:o,y1:r}=this,c=s,u=o,l=(1-t)*s+t*e,d=(1-t)*o+t*r,a=(1-t)**2*s+2*(1-t)*t*e+t**2*n,x=(1-t)**2*o+2*(1-t)*t*r+t**2*i,p=M.controlPoints(c,u,l,d,a,x),y=a,$=x,C=(1-t)*e+t*n,v=(1-t)*r+t*i,T=n,b=i,L=M.controlPoints(y,$,C,v,T,b);return[p,L]}multiSplit(t){if(g.assertFinite(t),t<1||(t|0)!=t)throw new Error("wtf");const n=[];let s=this;for(;t>1;){const e=1/t;let i;[i,s]=s.split(e),n.push(i),t--}return n.push(s),n}}class F{constructor(t,n,s,e,i,o,r,c){this.x0=t,this.y0=n,this.x1=s,this.y1=e,this.x2=i,this.y2=o,this.x=r,this.y=c,g.assertFinite(t,n,s,e,i,o,r,c),this.asString=`C ${A(s)},${A(e)} ${A(i)},${A(o)} ${A(r)},${A(c)}`}reverse(){return new F(this.x,this.y,this.x2,this.y2,this.x1,this.y1,this.x0,this.y0)}static relative(t,n,s,e,i,o,r,c){return new this(t,n,s+t,e+n,i+t,o+n,r+t,c+n)}get incomingAngle(){return Math.atan2(this.y1-this.y0,this.x1-this.x0)}get outgoingAngle(){return Math.atan2(this.y-this.y2,this.x-this.x2)}command="C";asString;translate(t,n){return new F(this.x0+t,this.y0+n,this.x1+t,this.y1+n,this.x2+t,this.y2+n,this.x+t,this.y+n)}transform(t){const n=I(this.x0,this.y0,t),s=I(this.x1,this.y1,t),e=I(this.x2,this.y2,t),i=I(this.x,this.y,t);return new F(n.x,n.y,s.x,s.y,e.x,e.y,i.x,i.y)}toCubic(){return this}}class X{get commands(){return this.#n}addCommand(t){this.#n.push(t),this.#t=void 0}addCommands(t){return t.forEach(n=>this.addCommand(n)),this}static fromStrings(t){let n=t.join(" ");const s=[];let e;for(;n=n.replace(/^ */,""),n!="";){let i=B.exec(n);if(i){const o=g.parseFloatX(i[1]),r=g.parseFloatX(i[2]);if(o===void 0||r===void 0)throw console.error(i,o,r,this),new Error("wtf");e&&s.push(e),e=this.M(o,r),n=i[3];continue}if(e){if(i=z.exec(n),i){const o=g.parseFloatX(i[1]),r=g.parseFloatX(i[2]);if(o===void 0||r===void 0)throw console.error(i,o,r,this),new Error("wtf");e=e.L(o,r),n=i[3];continue}if(i=U.exec(n),i){const o=g.parseFloatX(i[1]),r=g.parseFloatX(i[2]),c=g.parseFloatX(i[3]),u=g.parseFloatX(i[4]);if(o===void 0||r===void 0||c===void 0||u===void 0)throw console.error(i,o,r,c,u,this),new Error("wtf");e=e.Q(o,r,c,u),n=i[5];continue}if(i=Y.exec(n),i){const o=g.parseFloatX(i[1]),r=g.parseFloatX(i[2]),c=g.parseFloatX(i[3]),u=g.parseFloatX(i[4]),l=g.parseFloatX(i[5]),d=g.parseFloatX(i[6]);if(o===void 0||r===void 0||c===void 0||u===void 0||l===void 0||d===void 0)throw console.error(i,o,r,c,u,l,d,this),new Error("wtf");e=e.C(o,r,c,u,l,d),n=i[7];continue}}throw console.error(n),new Error("wtf")}return e&&s.push(e),s}static M(t,n){const s=new X;return s.M(t,n),s}#n=[];get pathShape(){return new w(this.#n)}#t;M(t,n,s=NaN){return g.assertFinite(t,n),this.#t={x:t,y:n,outgoingAngle:s},this}previous(){return this.#t??this.#n.at(-1)}H(t){const n=this.previous();return this.addCommand(new E(n.x,n.y,t,n.y)),this}V(t){const n=this.previous();return this.addCommand(new E(n.x,n.y,n.x,t)),this}L(t,n){const s=this.previous();return this.addCommand(new E(s.x,s.y,t,n)),this}Q(t,n,s,e){const i=this.previous();return this.addCommand(M.controlPoints(i.x,i.y,t,n,s,e)),this}Q_HV(t,n){const s=this.previous();return this.Q(t,s.y,t,n)}Q_VH(t,n){const s=this.previous();return this.Q(s.x,n,t,n)}Q_angles(t,n,s,e){const i=this.previous();if(e??=i.outgoingAngle,e===void 0)throw new Error("wtf");return this.addCommand(M.angles(i.x,i.y,e,t,n,s)),this}C(t,n,s,e,i,o){const r=this.previous();return this.addCommand(new F(r.x,r.y,t,n,s,e,i,o)),this}circle(t,n,s="cw"){const e=this.previous(),i=e.x,o=e.y,r=Math.atan2(o-n,i-t),c=Math.hypot(o-n,i-t),u=s=="cw"?1:-1,l=r+Math.PI*2*u,d=g.makeLinear(0,r,1,l);function a(y){switch(y){case 0:case 1:return e;default:{const $=d(y),C=g.polarToRectangular(c,$);return{x:t+C.x,y:n+C.y}}}}function x(y){return a(y)}return this.addParametricPath(x,8),this}arc(t,n,s,e,i){const o=this.previous(),r=o.x,c=o.y;let u=g.positiveModulo(Math.atan2(c-n,r-t),Math.PI*2);const l=Math.hypot(c-n,r-t);let d=g.positiveModulo(Math.atan2(e-n,s-t),Math.PI*2);const a=Math.hypot(e-n,s-t);i=="cw"?u>d&&(d+=Math.PI*2):u<d&&(u+=Math.PI*2);const x=Math.abs(u-d),p=Math.ceil(x*1.17+1e-4),y=g.makeLinear(0,l,1,a),$=g.makeLinear(0,u,1,d);function C(v){switch(v){case 0:return o;case 1:return{x:s,y:e};default:{const T=g.polarToRectangular(y(v),$(v));return{x:t+T.x,y:n+T.y}}}}return this.addParametricPath(C,p)}addParametricPath(t,n){if(n<=0)throw new Error("wtf");const s=1e-4/n,e=g.initializedArray(n+1,i=>{const o=i/n,r=t(o),c=Q(t,o,s);return{t:o,point:r,direction:c}});if(e.some(i=>!isFinite(i.direction))){const{x:i,y:o}=e[0].point;if(g.assertFinite(i,o),e.some(r=>r.point.x!=i||r.point.y!=o))throw new Error("Unable to create a path from this function.  Unable to compute the derivative.");for(let r=0;r<n;r++)this.Q(i,o,i,o)}else g.initializedArray(n,o=>({from:e[o],to:e[o+1]})).forEach(o=>{this.Q_angles(o.to.point.x,o.to.point.y,o.to.direction,o.from.direction)});return this}}function S(h,t,n){if(!(t>=0&&t<=1))throw new Error("Expected 0 ≤ t ≤ 1");const s=Math.max(0,t-n),e=h(s),i=Math.min(1,t+n),o=h(i),r=o.x-e.x,c=o.y-e.y;return r==0&&c==0?NaN:Math.atan2(c,r)}function Q(h,t,n){const s=S(h,t,n*2),e=S(h,t,n*1),i=s-e;return e-i}const P=" *",m="(-?[0-9]+\\.?[0-9]*(?:[eE][-+]?[0-9]+)?)",f="(?: *[, ] *|(?=-))",B=new RegExp(`^M${P}${m}${f}${m}(.*)$`),G=new RegExp(`^m${P}${m}${f}${m}(.*)$`),z=new RegExp(`^L${P}${m}${f}${m}(.*)$`),k=new RegExp(`^${f}${m}${f}${m}(.*)$`),H=new RegExp(`^l${P}${m}${f}${m}(.*)$`),Z=new RegExp(`^H${P}${m}(.*)$`),K=new RegExp(`^h${P}${m}(.*)$`),W=new RegExp(`^V${P}${m}(.*)$`),_=new RegExp(`^v${P}${m}(.*)$`),J=new RegExp(`^${f}${m}(.*)$`),tt=J,U=new RegExp(`^Q${P}${m}${f}${m}${f}${m}${f}${m}(.*)$`),nt=new RegExp(`^${f}${m}${f}${m}${f}${m}${f}${m}(.*)$`),et=new RegExp(`^q${P}${m}${f}${m}${f}${m}${f}${m}(.*)$`),Y=new RegExp(`^C${P}${m}${f}${m}${f}${m}${f}${m}${f}${m}${f}${m}(.*)$`),q=new RegExp(`^${f}${m}${f}${m}${f}${m}${f}${m}${f}${m}${f}${m}(.*)$`),st=new RegExp(`^c${P}${m}${f}${m}${f}${m}${f}${m}${f}${m}${f}${m}(.*)$`),ot=new RegExp("^[zZ](.*)$");class it extends Error{constructor(t,n){super(t),this.where=n}}class w{reverse(){return new w(this.commands.toReversed().map(t=>t.reverse()))}static fromString(t){const n=this.fromJson(t);if(n)return n;let s=t,e=null;const i=a=>new it(a,s),o=a=>{const x=g.parseFloatX(a);if(x===void 0)throw i(`Invalid number: "${a}"`);return x};let r=0,c=0;const u=[],l=a=>{u.push(a),r=a.x,c=a.y};let d;for(;s=s.replace(/^ */,""),s!="";){if(e=B.exec(s)){r=o(e[1]),c=o(e[2]),d={x0:r,y0:c},s=e[3];continue}if(e=G.exec(s)){for(r+=o(e[1]),c+=o(e[2]),d={x0:r,y0:c},s=e[3];e=k.exec(s);){const a=E.relative(r,c,o(e[1]),o(e[2]));l(a),s=e[3]}continue}if(!d)throw i("Must start with an M command.");if(e=ot.exec(s)){if(r!=d.x0||c!=d.y0){const a=new E(r,c,d.x0,d.y0);l(a)}s=e[1];continue}if(e=z.exec(s)){const a=o(e[1]),x=o(e[2]),p=new E(r,c,a,x);l(p),s=e[3];continue}if(e=H.exec(s)){for(;e;){const a=o(e[1]),x=o(e[2]),p=E.relative(r,c,a,x);l(p),s=e[3],e=k.exec(s)}continue}if(e=Z.exec(s)){const a=o(e[1]),x=new E(r,c,a,c);l(x),s=e[2];continue}if(e=K.exec(s)){for(;e;){const a=o(e[1]),x=new E(r,c,r+a,c);l(x),s=e[2],e=tt.exec(s)}continue}if(e=W.exec(s)){const a=o(e[1]),x=new E(r,c,r,a);l(x),s=e[2];continue}if(e=_.exec(s)){for(;e;){const a=o(e[1]),x=new E(r,c,r,c+a);l(x),s=e[2],e=J.exec(s)}continue}if(e=U.exec(s)){const a=o(e[1]),x=o(e[2]),p=o(e[3]),y=o(e[4]),$=M.controlPoints(r,c,a,x,p,y);l($),s=e[5];continue}if(e=et.exec(s)){for(;e;){const a=o(e[1]),x=o(e[2]),p=o(e[3]),y=o(e[4]),$=M.relative(r,c,a,x,p,y);l($),s=e[5],e=nt.exec(s)}continue}if(e=Y.exec(s)){for(;e;){const a=o(e[1]),x=o(e[2]),p=o(e[3]),y=o(e[4]),$=o(e[5]),C=o(e[6]),v=new F(r,c,a,x,p,y,$,C);l(v),s=e[7],e=q.exec(s)}continue}if(e=st.exec(s)){for(;e;){const a=o(e[1]),x=o(e[2]),p=o(e[3]),y=o(e[4]),$=o(e[5]),C=o(e[6]),v=F.relative(r,c,a,x,p,y,$,C);l(v),s=e[7],e=q.exec(s)}continue}throw i("Confused.")}return new this(u)}static fromJson(t){try{const s=JSON.parse(t).commands.map(e=>{switch(e.command){case"C":{const{x0:i,y0:o,x1:r,y1:c,x2:u,y2:l,x:d,y:a}=e;return new F(i,o,r,c,u,l,d,a)}case"L":{const{x0:i,y0:o,x:r,y:c}=e;return new E(i,o,r,c)}case"Q":{const{x0:i,y0:o,x:r,y:c,creationInfo:u}=e;switch(u.source){case"angles":{const{angle0:l,angle:d}=u,a=M.angles(i,o,l,r,c,d);return(a.creationInfo.source!="angles"||a.creationInfo.success!=u.success)&&console.warn("different",e,a),a}case"controlPoints":{const{x1:l,y1:d}=e;return M.controlPoints(i,o,l,d,r,c)}case"line":return M.line4(i,o,r,c);default:throw new Error(`Unknown source: "${u.source}"`)}}default:throw new Error(`Unknown command: "${e.command}"`)}});return new w(s)}catch{return}}matchForMorph(t){const n=this.commands.map(r=>r.toCubic()),s=t.commands.map(r=>r.toCubic());if(n.length!=s.length){const{shorter:r,longer:c}=n.length<s.length?{shorter:n,longer:s}:{shorter:s,longer:n};if(r.length==0)throw new Error("can't morph something into nothing");const u=c.length/r.length,l=[];r.forEach((d,a)=>{const x=Math.round((a+1)*u);for(;l.length<x;)l.push(d)}),r.length=0,r.push(...l)}if(n.length!=s.length)throw new Error("wtf");function e(r){return w.cssifyPath(r.map(c=>new w([c]).rawPath).join())}const i=e(n),o=e(s);return[i,o]}commands;get endX(){return this.commands.at(-1)?.x}get endY(){return this.commands.at(-1)?.y}get startX(){return this.commands.at(0)?.x0}get startY(){return this.commands.at(0)?.y0}constructor(t){this.commands=[...t]}static cssifyPath(t){return`path('${t}')`}get cssPath(){return w.cssifyPath(this.rawPath)}makeElement(){const t=document.createElementNS("http://www.w3.org/2000/svg","path"),n=this.cssPath;if(t.style.d=n,t.style.d=="")throw console.error(n,t),new Error("wtf");return t}static needAnM(t,n){return n?!t||t.x!=n.x0||t.y!=n.y0:!1}get rawPath(){return this.splitOnMove().flatMap(t=>{const n=[`M ${A(t.startX)},${A(t.startY)}`];return t.commands.forEach(s=>n.push(s.asString)),t.startX==t.endX&&t.startY==t.endY&&n.push("Z"),n}).join(" ")}splitOnMove(){const t=[];let n=[];return this.commands.forEach(s=>{w.needAnM(n.at(-1),s)&&(n=[],t.push(n)),n.push(s)}),t.map(s=>new w(s))}static join(t){return new w(t.flatMap(({Δx:n,Δy:s,shape:e})=>e.translate(n,s).commands))}convertToCubics(){return new w(this.commands.map(t=>t.toCubic()))}translate(t,n){return new w(this.commands.map(s=>s.translate(t,n)))}transform(t){return new w(this.commands.map(n=>n.transform(t)))}static parametric(t,n){const s=t(0);return X.M(s.x,s.y).addParametricPath(t,n).pathShape}static glitchFreeParametric(t,n){const s=this.#t(t,n,0);return g.assertNonNullable(s)}static#n=new D;static#t(t,n,s){if(s>=4){console.log("⚝");return}const i=this.parametric(t,n).commands.map((c,u,l)=>{const d=u/l.length,a=(u+1)/l.length;return{command:c,initialT:d,finalT:a}});let o=0;const r=c=>{const u=new this([c]);this.#n.d=u.rawPath;const l=this.#n.length,d=Math.hypot(c.x0-c.x,c.y0-c.y),a=l/d;return a<2||!isFinite(a)};for(;o<i.length;){const c=i[o].command;if(r(c))o++;else{const u=Math.max(0,o-1);let l=o+1;for(;l<i.length;){const v=i[l].command;if(l++,r(v))break}const d=i[u].initialT,a=i[l-1].finalT,x=g.makeLinear(0,d,1,a),p=v=>t(x(v)),y=l-u,$=y+1,C=this.#t(p,$,s+1);if(C===void 0){if(s>0)return;const v=i[o],{x0:T,y0:b,x:L,y:R}=v.command;v.command=M.line4(T,b,L,R),o++}else i.splice(u,y,...C.commands.map((v,T,b)=>{const L=x(T/b.length),R=x((T+1)/b.length);return{command:v,initialT:L,finalT:R}})),o+=$}}return new w(i.map(c=>c.command))}static fixAngleRounding(t){return t+400-400}static toDegrees(t){return Math.round(t*g.degreesPerRadian*100)/100}dump(){const t=this.commands.map((n,s)=>{const{x0:e,y0:i,x:o,y:r,incomingAngle:c,outgoingAngle:u,command:l}=n,d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",new w([n]).rawPath);const a=d.getTotalLength(),x=this.commands[s-1],y=w.needAnM(x,n)?{}:{difference:w.toDegrees(g.angleBetween(x.outgoingAngle,c))};return{x0:e,y0:i,x:o,y:r,incomingAngle:w.toDegrees(c),outgoingAngle:w.toDegrees(u),length:a,c:l,...y}});console.table(t),console.log(this.rawPath),console.log(JSON.stringify(this))}}function rt(h,t){if(g.assertFinite(h.x0,h.y0,h.angle,t.x0,t.y0,t.angle),isNaN(h.angle)||isNaN(t.angle)||h.angle==t.angle)return;const n=Math.tan(h.angle),s=Math.tan(t.angle),e=Math.abs(n)*100>Number.MAX_SAFE_INTEGER,i=Math.abs(s)*100>Number.MAX_SAFE_INTEGER;if(e&&i)return;const o=Math.atan2(t.y0-h.y0,t.x0-h.x0),r=g.angleBetween(h.angle,o),c=g.angleBetween(t.angle,o);if(r==0||Math.abs(c)==Math.PI){if(Math.abs(r)==Math.PI||c==0)return;const d=(h.x0+t.x0)/2,a=(h.y0+t.y0)/2;return{x:d,y:a}}const u=Math.sign(r),l=Math.sign(c);if(!(u!=l||u==0)&&!(Math.abs(c)<=Math.abs(r)+g.radiansPerDegree))if(e||i){const d=e?h.x0:t.x0,a=e?{...t,slope:s}:{...h,slope:n},x=a.slope*(d-a.x0)+a.y0;return{x:d,y:x}}else{const d=(t.y0-s*t.x0-h.y0+n*h.x0)/(n-s),a=n*(d-h.x0)+h.y0;return{x:d,y:a}}}function ct(h){if(!(h instanceof M))throw new Error("wtf");if(h.creationInfo.source!="angles")throw new Error("wtf");return h}class N{constructor(t,n=16,s){this.f=t;const e=w.parametric(t,n);this.#t=e.commands.map((i,o,r)=>{const c=o/r.length,u=(o+1)/r.length;return this.#e(c,u,ct(i))}).sort((i,o)=>i.metric-o.metric),s===void 0&&(N.#n.load(e),s=N.#n.getBBox()),typeof s!="number"&&(s=Math.hypot(s.height,s.width)),this.#s=.001*s}static#n=new D;#t;#s;get commands(){return this.#t}#o(t){this.#t.splice(this.#t.findLastIndex(n=>n.metric<=t.metric)+1,0,t)}#e(t,n,s){let i=0;{const c=[{x:s.x0,y:s.y0}];for(let u=1;u<4;u++){const l=u/4,d=g.lerp(t,n,l);c.push(this.f(d))}c.push({x:s.x,y:s.y}),c.forEach((u,l)=>{const d=c[l+1];d&&(i+=Math.hypot(u.x-d.x,u.y-d.y))})}const o=N.#n.measure(s),r=Math.abs(i-o);return s.creationInfo.success,{startT:t,endT:n,command:s,polyLineLength:i,curveLength:o,metric:r}}add(t){for(let n=0;n<t;n++)this.addOne()}addOne(){const t=this.#t.pop(),{startT:n,endT:s}=t,e=(n+s)/2,i=this.f(e),o=1e-4*(e-n),r=Q(this.f,e,o),c=M.angles(t.command.x0,t.command.y0,t.command.requestedIncomingAngle,i.x,i.y,r),u=this.#e(n,e,c);this.#o(u);const l=M.angles(i.x,i.y,r,t.command.x,t.command.y,t.command.requestedOutgoingAngle),d=this.#e(e,s,l);return this.#o(d),{toSplit:t,firstCommandInfo:u,secondCommandInfo:d}}done(){return this.commands.at(-1).metric<this.#s}go(t=50){for(let n=0;n<t&&!this.done();n++)this.addOne()}get pathShape(){return new w(this.#t.toSorted((t,n)=>t.startT-n.startT).map(({command:t})=>t))}summarize(){function t(n){n.sort((l,d)=>l-d);const s=n.length;function e(l){const a=(n.length-1)*l;if(Number.isInteger(a))return n[a];{const x=Math.floor(a),p=x+1,y=a-x;return g.lerp(n[x],n[p],y)}}if(n.length<2)throw new Error("wtf");const i=g.initializedArray(5,l=>e(l/4));let o=0,r=0;n.forEach(l=>{o+=l,r+=l*l});const c=o/s,u=Math.sqrt((r-s*c*c)/(s-1));return{quartiles:i,mean:c,standardDeviation:u}}return{polyLineLength:t(this.#t.map(({polyLineLength:n})=>n)),curveLength:t(this.#t.map(({curveLength:n})=>n)),metric:t(this.#t.map(({metric:n})=>n)),tCoverage:t(this.#t.map(({startT:n,endT:s})=>s-n)),generation:t(this.#t.map(({startT:n,endT:s})=>-Math.log2(s-n))),count:this.#t.length}}dump(){console.table(this.commands.map(({startT:t,endT:n,metric:s,curveLength:e})=>({startT:t,tCoverage:n-t,generation:-Math.log2(n-t),metric:s,curveLength:e})))}static chordRatio(t){const n=g.FULL_CIRCLE/t,s=2*1*Math.sin(n/(2*1));return n/s}}window.ParametricToPath=N;export{E as L,w as P,M as Q,it as a,X as b,N as c,D as d,V as e,O as p};
