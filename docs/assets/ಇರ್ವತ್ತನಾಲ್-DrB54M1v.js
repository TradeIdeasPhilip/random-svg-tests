import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as H,s as D,h as T,t as $}from"./fourier-shared-NjkoHtEt.js";import{p as O,d as K,b as Z,P as I}from"./path-shape-CZZKMsju.js";import{m as i}from"./misc-BHUyxQfl.js";import{g as M,e as J}from"./utility-Dgy6CMn3.js";function W(){document.body.style.backgroundColor="transparent",y.selectorQueryAll("[data-hide-background]",SVGElement).forEach(u=>u.style.display="none")}function X(){const u=y.selectorQuery("[data-hide-background]",SVGElement);u.parentElement?.append(u)}const q=new URLSearchParams(window.location.search);let z=!1;q.get("hide_background")=="1"?W():q.get("only_background")=="1"&&X();{const t=y.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const Y=1024;class tt{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=y.selectorQuery(t,SVGGElement)),this.#t=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(r=>{const n=y.selectorQuery("text",SVGTextElement,r),m=document.createElementNS("http://www.w3.org/2000/svg","text");return m.classList.add("background"),r.insertBefore(m,n),{top:r,spinner:y.selectorQuery(".spinner",SVGPolygonElement,r),text:n,background:m}})}#t;show(t,e){this.#t.forEach((r,n)=>{if(n>=t)r.top.style.display="none";else{r.top.style.display="";const m=this.terms[n];r.background.innerHTML=r.text.innerHTML=m.frequency.toString(),r.spinner.style.transform=`rotate(${e*m.frequency+m.phase+i.FULL_CIRCLE/4}rad)`}})}}function A(u,t){if(u>=t)throw new Error("wtf");const e=i.makeLinear(u,0,t,1);function r(n){if(n<=u)return 0;if(n>=t)return 1;const m=e(n);return J(m)}return r}let N=()=>{};window.showFrame=u=>{N(u)};class U{constructor(t,e){this.getTransform=e,this.#t=y.selectorQuery(t,SVGGElement),this.#n=y.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=y.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new U("#right",t=>O(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const B=new K;class et{constructor(t){this.pathString=t,this.samples=H(t,Y),this.terms=D(this.samples),this.keyframes=i.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,r=t-e){const n=this.makeGetPath2(),m=i.makeBoundedLinear(e,0,r,1),E=this.stepCount;function x(p){let f=Math.floor(p/t),d;f<0?(f=0,d=0):f>=E?(f=E-1,d=t):d=p%t;const c=m(d);return{pathString:n(f,c),index:f,t:c}}return x}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],r=this.stepCount,n=p=>Math.max(...t.slice(0,p).map(d=>Math.abs(d.frequency))),m=p=>8*n(p)+7,E=i.initializedArray(r,p=>{const f=e[p],d=e[p+1];if(f==0&&d==1&&t[0].frequency==0){let c=function(a){return`${s.x*a},${s.y*a}`};const s=i.assertNonNullable(T(t[0])),o=A(0,.5),g=A(0,1);return a=>{const l=g(a),h=c(l),C=o(a),k=c(C);return`M ${h} L ${k}`}}else{const s=.2/n(d),o=i.makeBoundedLinear(0,-s,1,1+s),g=$(t,f),a=$(t,d-f,f),l=m(d);if(f==0||f==1&&T(t[0])){const h=T(t[0])??{x:0,y:0};return C=>{const k=o(C),L=k-s,F=k+s,b=A(L,F),w=Math.min(1,F);if(w<=0)return`M${h.x},${h.y} L${h.x},${h.y}`;{let S=function(V){V=V*w;const G=g(V),R=1-b(V);if(R==0)return G;{const _=a(V);return{x:G.x+R*_.x,y:G.y+R*_.y}}};const P=Math.ceil(Math.max(l,150)*w);return I.glitchFreeParametric(S,P).rawPath}}}else return h=>{const C=o(h),k=A(C-s,C+s);function L(b){const w=g(b),S=1-k(b);if(S==0)return w;{const P=a(b);return{x:w.x+S*P.x,y:w.y+S*P.y}}}return I.glitchFreeParametric(L,l).rawPath}}});function x(p,f){const d=E[p];return d(f)}return x}}class nt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#s;#r;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,B.d=this.#n,this.#o=this.#e.getTransform(B.getBBox());const r=6e3,n=750;this.endTime=r*t.base.stepCount;const m=t.base.makeGetPath1(r,0,r-n),E=new tt(e,t.base.terms);this.#t=x=>{const{pathString:p,index:f,t:d}=m(x);this.#e.setLivePath(p),E.show(t.base.keyframes[f+1],d*i.FULL_CIRCLE)}}}function st(...u){N=t=>{u.forEach(e=>e.show(t))}}let Q;setTimeout(()=>{if(z)return;let u=NaN;Q=new y.AnimationLoop(t=>{isNaN(u)&&(u=t);const e=t-u;N(e)}),window.animationLoop=Q},1);function rt(u){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),Q?.cancel(),{source:"fourier-smackdown.ts",script:u,seconds:120,devicePixelRatio}}window.initScreenCapture=rt;class ot{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class v{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=i.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,r)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new v([...this.pathSoFar,n],this.remainingEdges.toSpliced(r,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,r=new Set;for(const n of this.get(t)){const m=n.slice(0,n.length-1),E=this.#n(m);if(!r.has(E)){yield n,r.add(E);const x=this.#e(m,e).map(p=>this.#n(p));for(const p of x)r.add(p)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const r=new Array;for(let n=1;n<t.length;n++){const m=t[n],E=(m+1)%e,x=M(t,n+1);E==x?r.push(i.initializedArray(t.length,p=>{const f=M(t,p+n);return i.positiveModulo(f-m,e)})):M(t,n-1)==E&&r.push(i.initializedArray(t.length,f=>{const d=M(t,n-f);return i.positiveModulo(d-m,e)}))}return r}static getSamples(){function t(e,...r){return i.initializedArray(e,n=>r.map(m=>new ot(n,(n+m)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=v;function at(){const u=v.getSamples(),t=v.getUnique(u.pentagram);console.log(t,t.constructor.name);for(const e of t);}at();{let u=function(c,s=".chapter"){typeof s=="string"&&(s=y.selectorQuery(s,SVGTextElement)),s.innerHTML=`#${c} of ${r.allPaths.length}`},t=function(c){const s=[],o=c.terms,g=o.length;s.push(o.splice(0,2));for(let l=0;l<19;l++){const h=i.assertNonNullable(o.shift());s.push([h])}if(s[10].push(...o),o.length=0,o.length!=0)throw new Error("wtf");const a=c.keyframes;if(a.length=0,a.push(0),s.forEach(l=>{o.push(...l),a.push(o.length)}),o.length!=g)throw new Error("wtf")};class e{constructor(s){throw new Error("wtf")}static points=i.initializedArray(5,s=>{const o=i.FULL_CIRCLE*s/5+i.FULL_CIRCLE/4,g=Math.cos(o),a=Math.sin(o);return{x:g,y:a}});static allPaths=[...v.getUnique(v.getSamples().pentagram)]}class r{constructor(s){throw new Error("wtf")}static points=i.initializedArray(6,s=>{const o=i.FULL_CIRCLE*s/6+i.FULL_CIRCLE/4,g=Math.cos(o),a=Math.sin(o);return{x:g,y:a}});static allPaths=[...v.getUnique(v.getSamples().dodecahedron)];static makePathShape(s){const o=this.allPaths[s],g=Z.M(n[0].x,n[0].y);return o.forEach((a,l)=>{if(l==0){if(a!=0)throw new Error("wtf")}else{const{x:h,y:C}=n[a],k=o[l-1];switch(i.positiveModulo(a-k,6)){case 1:{g.arc(0,0,h,C,"cw");break}case 2:case 4:{g.L(h,C);break}case 5:{g.arc(0,0,h,C,"ccw");break}default:throw new Error("wtf")}}}),g.pathShape}}const n=r.points,m=r.allPaths,E=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],x=i.Random.fromString("fourier-smackdown.ts");i.initializedArray(m.length,()=>{const c=x()*3|0,s=E[c];return E.splice(c,1),E.push(s),s});const p=[{color:"black",destRect:{x:1,y:.25,width:8.5,height:8.5},index:22,colorName:"blue"}];u(22);const f=p.map(({index:c})=>{const s=r.makePathShape(c).rawPath;return new et(s)});console.log(f),t(f[0]);const d=new Array;for(const[c,s]of i.zip(p,f)){const{color:o,destRect:g}=c,a=c.colorName??c.color,l=y.selectorQuery(`g.frequencies[data-frequencies="${a}"]`,SVGGElement),h=new U(`[data-fourier-top="${a}"]`,L=>O(L,g,"srcRect fits completely into destRect"));l.style.fill=o;const C={base:s,destination:h,liveColor:o,referenceColor:o},k=new nt(C,l);d.push(k),console.log(k)}{let c=function(F,b){const S=[F,F+i.FULL_CIRCLE/3,F-i.FULL_CIRCLE/3].map(G=>k(Math.sin(G)));S.push(0),S.push(L(Math.cos(b)));const P=S.join(" "),V=[P,P,P,"0 0 0 0 1"].join(`
`);g.setAttribute("values",V)},s=function(F){const b=a.map(w=>[]);F.forEach(w=>{if(w.length!=a.length)throw new Error("wtf");w.forEach((S,P)=>{b[P].push(S)})});for(const[w,S]of i.zip(a,b))w.setAttribute("tableValues",S.join(" "))},o=function(F){const b=F/12e4*i.FULL_CIRCLE,w=F/12e4*i.FULL_CIRCLE/2;c(b,w)};const g=y.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),a=[y.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),y.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),y.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],h=[[25,25,112],[70,130,180],[147,112,219],[60,179,113],[199,21,133],[0,206,209],[216,191,216]],C=i.makeLinear(0,0,255,1);h.forEach(F=>F.forEach((b,w,S)=>S[w]=C(b)));const k=i.makeLinear(-1,-.05,1,.8),L=i.makeLinear(1,0,-1,-.4);window.updateValues=c,s(h),d.push({show:o})}{let c=function(a){o.forEach(({element:l,attributeName:h})=>{l.setAttribute(h,a)})},s=function(a){const l=Math.floor(a/1500)%g.length,h=g[l];c(h)};const o=y.selectorQueryAll("[data-fg-color]",SVGElement).map(a=>({element:a,attributeName:i.assertNonNullable(a.dataset.fgColor)}));window.setFgColor=c;const g=["red","yellow","magenta","lime","hwb(204.42deg 0% 0%)","white","cyan","#CC5500","hsl(270, 55%, 55%)"];d.push({show:s})}if(st(...d),q.get("thumbnail")=="1"){const c=y.selectorQuery("g#foreground",SVGGElement);z=!0;const s=new Array;Array.from(c.children).forEach(l=>{const h=i.assertClass(l,SVGElement);h.dataset.live===void 0?h.style.display="none":(console.log("live",h.dataset.live),s.push(h))});const o=y.selectorQueryAll("#starfield rect",SVGRectElement);o[0].parentElement.style.transform="scale(3)",o.forEach(l=>{l.style.transformOrigin=`${50/3}% 22%`}),o[1].style.transform="rotate(1.75deg)",o[2].style.transform="rotate(-1.5deg)";const g=6e3;d[0].show(g*5-20),d[1].show(g*7-20),d[2].show(g*4-20),y.selectorQueryAll("[data-reference]",SVGPathElement).forEach(l=>l.style.display="none"),y.selectorQueryAll("[data-live]",SVGPathElement).forEach(l=>{l.style.transform="scale(1.5)"}),window.showFrame=l=>{console.info("ignoring showFrame()",l)}}}
