import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as E}from"./client-misc-B8CxQsfg.js";import{b as H,s as W,h as q,t as _}from"./fourier-shared-DpvWsPe-.js";import{p as z,d as D,b as K,P as B}from"./path-shape-CZZKMsju.js";import{m as c}from"./misc-BHUyxQfl.js";import{g as M,e as Z}from"./utility-Dgy6CMn3.js";function J(){document.body.style.backgroundColor="transparent",E.selectorQueryAll("[data-hide-background]",SVGElement).forEach(f=>f.style.display="none")}function X(){const f=E.selectorQuery("[data-hide-background]",SVGElement);f.parentElement?.append(f)}const Q=new URLSearchParams(window.location.search);let j=!1;Q.get("hide_background")=="1"?J():Q.get("only_background")=="1"&&X();{const t=E.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const Y=1024;class tt{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=E.selectorQuery(t,SVGGElement)),this.#t=E.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(o=>{const r=E.selectorQuery("text",SVGTextElement,o),m=document.createElementNS("http://www.w3.org/2000/svg","text");return m.classList.add("background"),o.insertBefore(m,r),{top:o,spinner:E.selectorQuery(".spinner",SVGPolygonElement,o),text:r,background:m}})}#t;show(t,e){this.#t.forEach((o,r)=>{if(r>=t)o.top.style.display="none";else{o.top.style.display="";const m=this.terms[r];o.background.innerHTML=o.text.innerHTML=m.frequency.toString(),o.spinner.style.transform=`rotate(${e*m.frequency+m.phase+c.FULL_CIRCLE/4}rad)`}})}}function R(f,t){if(f>=t)throw new Error("wtf");const e=c.makeLinear(f,0,t,1);function o(r){if(r<=f)return 0;if(r>=t)return 1;const m=e(r);return Z(m)}return o}let $=()=>{};window.showFrame=f=>{$(f)};class I{constructor(t,e){this.getTransform=e,this.#t=E.selectorQuery(t,SVGGElement),this.#n=E.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=E.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new I("#right",t=>z(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const O=new D;class et{constructor(t){this.pathString=t,this.samples=H(t,Y),this.terms=W(this.samples),this.keyframes=c.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,o=t-e){const r=this.makeGetPath2(),m=c.makeBoundedLinear(e,0,o,1),b=this.stepCount;function P(y){let d=Math.floor(y/t),g;d<0?(d=0,g=0):d>=b?(d=b-1,g=t):g=y%t;const l=m(g);return{pathString:r(d,l),index:d,t:l}}return P}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],o=this.stepCount,r=y=>Math.max(...t.slice(0,y).map(g=>Math.abs(g.frequency))),m=y=>8*r(y)+7,b=c.initializedArray(o,y=>{const d=e[y],g=e[y+1];if(d==0&&g==1&&t[0].frequency==0){let l=function(s){return`${n.x*s},${n.y*s}`};const n=c.assertNonNullable(q(t[0])),a=R(0,.5),u=R(0,1);return s=>{const h=u(s),p=l(h),C=a(s),F=l(C);return`M ${p} L ${F}`}}else{const n=.2/r(g),a=c.makeBoundedLinear(0,-n,1,1+n),u=_(t,d),s=_(t,g-d,d),h=m(g);if(d==0||d==1&&q(t[0])){const p=q(t[0])??{x:0,y:0};return C=>{const F=a(C),L=F-n,S=F+n,k=R(L,S),i=Math.min(1,S);if(i<=0)return`M${p.x},${p.y} L${p.x},${p.y}`;{let w=function(v){v=v*i;const A=u(v),T=1-k(v);if(T==0)return A;{const U=s(v);return{x:A.x+T*U.x,y:A.y+T*U.y}}};const x=Math.ceil(Math.max(h,150)*i);return B.glitchFreeParametric(w,x).rawPath}}}else return p=>{const C=a(p),F=R(C-n,C+n);function L(k){const i=u(k),w=1-F(k);if(w==0)return i;{const x=s(k);return{x:i.x+w*x.x,y:i.y+w*x.y}}}return B.glitchFreeParametric(L,h).rawPath}}});function P(y,d){const g=b[y];return g(d)}return P}}class nt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#r,this.#s),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#r;#s;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#r=t.referenceColor,this.#s=t.liveColor,O.d=this.#n,this.#o=this.#e.getTransform(O.getBBox());const o=7e3,r=750;this.endTime=o*t.base.stepCount;const m=t.base.makeGetPath1(o,0,o-r),b=new tt(e,t.base.terms);this.#t=P=>{const{pathString:y,index:d,t:g}=m(P);this.#e.setLivePath(y),b.show(t.base.keyframes[d+1],g*c.FULL_CIRCLE)}}}function rt(...f){$=t=>{f.forEach(e=>e.show(t))}}let N;setTimeout(()=>{if(j)return;let f=NaN;N=new E.AnimationLoop(t=>{isNaN(f)&&(f=t);const e=t-f;$(e)}),window.animationLoop=N},1);function st(f){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),N?.cancel(),{source:"fourier-smackdown.ts",script:f,seconds:120,devicePixelRatio}}window.initScreenCapture=st;class ot{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class V{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=c.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,o)=>{const r=e.other(t);return r===void 0||this.pathSoFar.length==1&&r!=1?[]:new V([...this.pathSoFar,r],this.remainingEdges.toSpliced(o,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(r=>Math.max(r.vertex1,r.vertex2)))+1,o=new Set;for(const r of this.get(t)){const m=r.slice(0,r.length-1),b=this.#n(m);if(!o.has(b)){yield r,o.add(b);const P=this.#e(m,e).map(y=>this.#n(y));for(const y of P)o.add(y)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const o=new Array;for(let r=1;r<t.length;r++){const m=t[r],b=(m+1)%e,P=M(t,r+1);b==P?o.push(c.initializedArray(t.length,y=>{const d=M(t,y+r);return c.positiveModulo(d-m,e)})):M(t,r-1)==b&&o.push(c.initializedArray(t.length,d=>{const g=M(t,r-d);return c.positiveModulo(g-m,e)}))}return o}static getSamples(){function t(e,...o){return c.initializedArray(e,r=>o.map(m=>new ot(r,(r+m)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=V;function at(){const f=V.getSamples(),t=V.getUnique(f.pentagram);console.log(t,t.constructor.name);for(const e of t);}at();{let f=function(l,n=".chapter"){typeof n=="string"&&(n=E.selectorQuery(n,SVGTextElement)),n.innerHTML=`#${l} of ${o.allPaths.length}`},t=function(l){const n=[],a=l.terms,u=a.length;n.push();for(let h=0;h<5;h++){const p=c.assertNonNullable(a.shift());n.push([p])}for(let h=0;h<10;h++){const p=a.splice(0,2);if(p.length!=2)throw new Error("wtf");n.push(p)}if(console.log({bins:n,terms:a}),n.splice(1,0,[...a]),console.log(n),a.length=0,a.length!=0)throw new Error("wtf");const s=l.keyframes;if(s.length=0,s.push(0),n.forEach(h=>{a.push(...h),s.push(a.length)}),a.length!=u)throw new Error("wtf")};class e{constructor(n){throw new Error("wtf")}static points=c.initializedArray(5,n=>{const a=c.FULL_CIRCLE*n/5+c.FULL_CIRCLE/4,u=Math.cos(a),s=Math.sin(a);return{x:u,y:s}});static allPaths=[...V.getUnique(V.getSamples().pentagram)]}class o{constructor(n){throw new Error("wtf")}static points=c.initializedArray(6,n=>{const a=c.FULL_CIRCLE*n/6+c.FULL_CIRCLE/4,u=Math.cos(a),s=Math.sin(a);return{x:u,y:s}});static allPaths=[...V.getUnique(V.getSamples().dodecahedron)];static makePathShape(n){const a=this.allPaths[n],u=K.M(r[0].x,r[0].y);return a.forEach((s,h)=>{if(h==0){if(s!=0)throw new Error("wtf")}else{const{x:p,y:C}=r[s],F=a[h-1];switch(c.positiveModulo(s-F,6)){case 1:{u.arc(0,0,p,C,"cw");break}case 2:case 4:{u.L(p,C);break}case 5:{u.arc(0,0,p,C,"ccw");break}default:throw new Error("wtf")}}}),u.pathShape}}const r=o.points,m=o.allPaths,b=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],P=c.Random.fromString("fourier-smackdown.ts");c.initializedArray(m.length,()=>{const l=P()*3|0,n=b[l];return b.splice(l,1),b.push(n),n});const y=[{color:"black",destRect:{x:2,y:.5,width:8,height:8},index:23,colorName:"blue"}];f(23);const d=y.map(({index:l})=>{const n=o.makePathShape(l).rawPath;return new et(n)});console.log(d),t(d[0]);const g=new Array;for(const[l,n]of c.zip(y,d)){const{color:a,destRect:u}=l,s=l.colorName??l.color,h=E.selectorQuery(`g.frequencies[data-frequencies="${s}"]`,SVGGElement),p=new I(`[data-fourier-top="${s}"]`,L=>z(L,u,"srcRect fits completely into destRect"));h.style.fill=a;const C={base:n,destination:p,liveColor:a,referenceColor:a},F=new nt(C,h);g.push(F),console.log(F)}{let l=function(S,k){const w=[S,S+c.FULL_CIRCLE/3,S-c.FULL_CIRCLE/3].map(A=>F(Math.sin(A)));w.push(0),w.push(L(Math.cos(k)));const x=w.join(" "),v=[x,x,x,"0 0 0 0 1"].join(`
`);u.setAttribute("values",v)},n=function(S){const k=s.map(i=>[]);S.forEach(i=>{if(i.length!=s.length)throw new Error("wtf");i.forEach((w,x)=>{k[x].push(w)})});for(const[i,w]of c.zip(s,k))i.setAttribute("tableValues",w.join(" "))},a=function(S){const k=S/18e4*c.FULL_CIRCLE,i=S/24e4*c.FULL_CIRCLE/2;l(k,i)};const u=E.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),s=[E.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),E.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),E.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],p=[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],C=c.makeLinear(0,0,255,1);p.forEach(S=>S.forEach((k,i,w)=>w[i]=C(k)));const F=c.makeLinear(-1,-.05,1,.8),L=c.makeLinear(1,0,-1,-.4);window.updateValues=l,n(p),g.push({show:a})}{let l=function(i){F.forEach(({element:w,attributeName:x})=>{w.setAttribute(x,i)})},n=function(){return .65+S()*.15},a=function(){return .8+S()*.1},u=function(){return .2+S()*.3},s=function(i,w){return i+Math.floor(S()*(w-i+1))},h=function(i,w,x){const G=s(w,x);for(let v=0;v<G;v++)k.push(i())},p=function(){for(;k.length<L;)if(h(n,60,90),S()<.15){let i=s(2,3);for(;h(u,2,3),i--,!(i<=0);)h(n,3,5)}else{let i=s(3,5);for(;h(a,2,5),i--,!(i<=0);)h(n,3,5)}},C=function(i){const w=Math.floor(i/1e3*30)%k.length,G=`rgba(255, 240, 230, ${k[w]})`;l(G)};const F=E.selectorQueryAll("[data-fg-color]",SVGElement).map(i=>({element:i,attributeName:c.assertNonNullable(i.dataset.fgColor)}));window.setFgColor=l;const L=120*60,S=c.Random.fromString("Flicker"),k=new Array;p(),g.push({show:C})}if(console.log(g),rt(...g),Q.get("thumbnail")=="1"){const l=E.selectorQuery("g#foreground",SVGGElement);j=!0;const n=new Array;Array.from(l.children).forEach(s=>{const h=c.assertClass(s,SVGElement);h.dataset.live===void 0?h.style.display="none":(console.log("live",h.dataset.live),n.push(h))});const a=E.selectorQueryAll("#starfield rect",SVGRectElement);a[0].parentElement.style.transform="scale(3)",a.forEach(s=>{s.style.transformOrigin=`${50/3}% 22%`}),a[1].style.transform="rotate(1.75deg)",a[2].style.transform="rotate(-1.5deg)",g[0].show(5500),g[1].show(81005),g[2].show(56e3),E.selectorQueryAll("[data-reference]",SVGPathElement).forEach(s=>s.style.display="none");const u=E.selectorQueryAll("[data-live]",SVGPathElement);u.forEach(s=>{s.style.transform="scale(1.15) rotate(22deg)"}),console.log(u[2].style.strokeWidth),u[5].style.strokeWidth="0",console.log(u[5].style.strokeWidth,u[5],u),window.showFrame=s=>{console.info("ignoring showFrame()",s)}}}
