import{m as l}from"./misc-wGF4FraP.js";function F(c,t,n){return new DOMPoint(c,t).matrixTransform(n)}function O(c,t,n,e=.5,s=.5){const o=c.width/c.height,r=t.width/t.height;let i,a;switch(n){case"meet":case"srcRect fits completely into destRect":{o>r?(i=t.width/c.width,a=i):(a=t.height/c.height,i=a);break}case"slice":case"srcRect completely covers destRect":{o>r?(a=t.height/c.height,i=a):(i=t.width/c.width,a=i);break}default:throw new Error("wtf")}const u=-c.x*i+e*(t.width-c.width*i)+t.x,d=-c.y*a+s*(t.height-c.height*a)+t.y;return new DOMMatrix().translate(u,d).scale(i,a)}function B(){{const c={x:-1,y:-1,width:2,height:2},t={x:0,y:0,height:244,width:325},n=O(c,t,"meet");[{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}].forEach(({x:s,y:o})=>{const r=F(s,o,n);if(r.x<t.x||r.x>t.x+t.width||r.y<t.y||r.y>t.y+t.height)throw new Error(`Test 1 failed: Point (${r.x}, ${r.y}) is outside destination (${t.x}, ${t.y}, ${t.width}, ${t.height})`)})}{const c={x:-1,y:-1,width:2,height:2},t={x:0,y:0,height:325,width:244},n=O(c,t,"meet");[{x:c.x,y:c.y},{x:c.x+c.width,y:c.y},{x:c.x+c.width,y:c.y+c.height},{x:c.x,y:c.y+c.height}].forEach(({x:s,y:o})=>{const r=F(s,o,n);if(r.x<t.x||r.x>t.x+t.width||r.y<t.y||r.y>t.y+t.height)throw new Error(`Test 2 failed: Point (${r.x}, ${r.y}) is outside destination (${t.x}, ${t.y}, ${t.width}, ${t.height})`)})}}B();class V{#t=document.createElementNS("http://www.w3.org/2000/svg","svg");#n=document.createElementNS("http://www.w3.org/2000/svg","path");constructor(){this.#t.style.width="0",this.#t.style.height="0",this.#t.style.position="absolute",this.#t.appendChild(this.#n),document.body.appendChild(this.#t)}get d(){return this.#n.getAttribute("d")??""}set d(t){this.#n.style.d="",this.#n.style.d=p.cssifyPath(t);const n=this.#n.style.d!="";if(this.#n.style.d="",n)this.#n.setAttribute("d",t);else throw new Error("Invalid path")}get empty(){return this.d==""}clear(){this.d=""}get length(){return this.#n.getTotalLength()}getPoint(t){return this.#n.getPointAtLength(t)}}function at(c,t){const n=l.angleBetween(c,t);return c+n/2}function z(c,t,n=1,e=1/0,s=document){const o=[];if(s.querySelectorAll(c).forEach(r=>{o.push(l.assertClass(r,t))}),o.length<n||o.length>e)throw new Error(`Expecting "${c}" to return [${n} - ${e}] instances of ${t.name}, found ${o.length}.`);return o}function ht(c,t,n=document){return z(c,t,1,1,n)[0]}class U{constructor(){throw new Error("wtf")}static sfc32(t,n,e,s){function o(){t|=0,n|=0,e|=0,s|=0;let i=(t+n|0)+s|0;return s=s+1|0,t=n^n>>>9,n=e+(e<<3)|0,e=e<<21|e>>>11,e=e+i|0,(i>>>0)/4294967296}const r=o;return Object.defineProperty(r,"currentSeed",{get(){return JSON.stringify([t,n,e,s])}}),r}static#t=42;static seedIsValid(t){try{return this.create(t),!0}catch{return!1}}static create(t=this.newSeed()){console.info(t);const n=JSON.parse(t);if(!(n instanceof Array))throw new Error("invalid input");if(n.length!=4)throw new Error("invalid input");const[e,s,o,r]=n;if(!(typeof e=="number"&&typeof s=="number"&&typeof o=="number"&&typeof r=="number"))throw new Error("invalid input");return this.sfc32(e,s,o,r)}static newSeed(){const t=[];return t.push(Date.now()|0),t.push(this.#t++|0),t.push(Math.random()*2**31|0),t.push(performance.now()*1e4|0),JSON.stringify(t)}static fromString(t){try{return this.create(t)}catch{return this.create(this.anyStringToSeed(t))}}static anyStringToSeed(t){function n(o,r){return(o<<r|o>>>32-r)>>>0}const e=[2654435769,608135816,2242054355,320440878];return new TextEncoder().encode(t).forEach(o=>{e[0]^=o,e[0]=n(e[0],3),e[1]^=o,e[1]=n(e[1],5),e[2]^=o,e[2]=n(e[2],7),e[3]^=o,e[3]=n(e[3],11)}),e[0]^=n(e[1],7),e[1]^=n(e[2],11),e[2]^=n(e[3],13),e[3]^=n(e[0],17),JSON.stringify(e)}static test(){const e=[this.create()];for(;e.length<=10;){for(let o=0;o<20;o++){const r=e.map(i=>i());for(let i=1;i<r.length;i++)if(r[i]!==r[0]){debugger;throw new Error("wtf")}}const s=l.pick(e).currentSeed;e.forEach(o=>{if(o.currentSeed!=s){debugger;throw new Error("wtf")}}),e.push(this.create(s))}}}window.Random=U;function N(c){if(!(Number.isFinite(c)&&c>=0&&c<=1))throw new Error(`t should be between 0 and 1, inclusive. t == ${c}`)}function lt(...c){c.forEach(e=>{if(!(e>=0&&e<Number.MAX_SAFE_INTEGER))throw new Error("wtf")});const t=l.sum(c);if(t==0)throw new Error("wtf");return e=>{N(e),e*=t;for(let s=0;s<c.length;s++){const o=c[s];if(e<=o)return e/=o,{t:e,index:s};e-=o}throw new Error("wtf")}}function ut(c,t,n){const e=c+t+n,s=l.makeBoundedLinear(c/e,0,(c+t)/e,1);return r=>{N(r);const i=s(r)*t,a=Math.min(i|0,t-1),u=i-a;return N(u),{t:u,index:a}}}function dt(c){if(c==null)throw new Error("wtf");return c}function ft(c){const t=2/(c+1),n=1-t;return s=>n*s*s+t*s}function Q(c,t){return t?Q(t,c%t):c}function gt(c,t){return c*t/Q(c,t)}class mt{#t;constructor(t=60){if(l.assertFinite(t),t<1||t!=(t|0))throw new Error("wtf");this.#t=t,this.fromMSF=this.fromMSF.bind(this),this.fromString=this.fromString.bind(this),Object.freeze(this)}get framesPerSecond(){return this.#t}fromMSF(t,n,e){return(t*60+n)*this.#t+e}fromString(t){const n=/^([0-9]+):([0-9]+):([0-9]+)$/.exec(t);if(!n)throw new Error("wtf");const e=l.parseIntX(n[1]),s=l.parseIntX(n[2]),o=l.parseIntX(n[3]);if(e===void 0||s===void 0||o===void 0)throw new Error("wtf");return this.fromMSF(e,s,o)}}function wt(c){const t=c*Math.PI;return(1-Math.cos(t))/2}const M=new Intl.NumberFormat("en-US",{maximumSignificantDigits:8,useGrouping:!1}).format;class E{constructor(t,n,e,s){this.x0=t,this.y0=n,this.x=e,this.y=s,l.assertFinite(t,n,e,s),this.asString=`L ${M(e)},${M(s)}`,this.outgoingAngle=this.incomingAngle=Math.atan2(s-n,e-t)}reverse(){return new E(this.x,this.y,this.x0,this.y0)}toJSON(){return{command:"L",x0:this.x0,y0:this.y0,x:this.x,y:this.y}}static relative(t,n,e,s){return new this(t,n,e+t,s+n)}incomingAngle;outgoingAngle;command="L";asString;get length(){return Math.hypot(this.x0-this.x,this.y0-this.y)}translate(t,n){return new E(this.x0+t,this.y0+n,this.x+t,this.y+n)}toCubic(){return new T(this.x0,this.y0,l.lerp(this.x0,this.x,1/3),l.lerp(this.y0,this.y,1/3),l.lerp(this.x0,this.x,2/3),l.lerp(this.y0,this.y,2/3),this.x,this.y)}transform(t){const n=F(this.x,this.y,t),e=F(this.x0,this.y0,t);return new E(e.x,e.y,n.x,n.y)}}class A{constructor(t,n,e,s,o,r,i){this.x0=t,this.y0=n,this.x1=e,this.y1=s,this.x=o,this.y=r,this.creationInfo=i,l.assertFinite(t,n,e,s,o,r),this.asString=`Q ${M(e)},${M(s)} ${M(o)},${M(r)}`}reverse(){return A.controlPoints(this.x,this.y,this.x1,this.y1,this.x0,this.y0)}static line(t,n,e,s,o){return new this(t,n,(t+e)/2,(n+s)/2,e,s,o)}static line4(t,n,e,s){return this.line(t,n,e,s,{source:"line"})}static line2(t,n){return this.line4(t.x,t.y,n.x,n.y)}static angles(t,n,e,s,o,r){l.assertFinite(t,n,e,s,o,r);const i=it({x0:t,y0:n,angle:e},{x0:s,y0:o,angle:r+Math.PI});return i?new this(t,n,i.x,i.y,s,o,{source:"angles",success:!0,angle:r,angle0:e}):this.line(t,n,s,o,{source:"angles",success:!1,angle:r,angle0:e})}newAngles(t,n){return t??=this.requestedIncomingAngle,n??=this.requestedOutgoingAngle,A.angles(this.x0,this.y0,t,this.x,this.y,n)}toJSON(){return{command:"Q",x0:this.x0,y0:this.y0,x1:this.x1,y1:this.y1,x:this.x,y:this.y,creationInfo:this.creationInfo}}static controlPoints(t,n,e,s,o,r){return new this(t,n,e,s,o,r,{source:"controlPoints"})}static relative(t,n,e,s,o,r){return this.controlPoints(t,n,e+t,s+n,o+t,r+n)}get incomingAngle(){return Math.atan2(this.y1-this.y0,this.x1-this.x0)}get outgoingAngle(){return Math.atan2(this.y-this.y1,this.x-this.x1)}get requestedIncomingAngle(){return this.creationInfo.source=="angles"?this.creationInfo.angle0:this.incomingAngle}get requestedOutgoingAngle(){return this.creationInfo.source=="angles"?this.creationInfo.angle:this.outgoingAngle}command="Q";asString;translate(t,n){return A.controlPoints(this.x0+t,this.y0+n,this.x1+t,this.y1+n,this.x+t,this.y+n)}transform(t){const n=F(this.x0,this.y0,t),e=F(this.x1,this.y1,t),s=F(this.x,this.y,t);return A.controlPoints(n.x,n.y,e.x,e.y,s.x,s.y)}toCubic(){return new T(this.x0,this.y0,l.lerp(this.x0,this.x1,2/3),l.lerp(this.y0,this.y1,2/3),l.lerp(this.x,this.x1,2/3),l.lerp(this.y,this.y1,2/3),this.x,this.y)}split(t){const{x:n,x0:e,x1:s,y:o,y0:r,y1:i}=this,a=e,u=r,d=(1-t)*e+t*s,f=(1-t)*r+t*i,h=(1-t)**2*e+2*(1-t)*t*s+t**2*n,m=(1-t)**2*r+2*(1-t)*t*i+t**2*o,y=A.controlPoints(a,u,d,f,h,m),x=h,$=m,P=(1-t)*s+t*n,v=(1-t)*i+t*o,I=n,S=o,C=A.controlPoints(x,$,P,v,I,S);return[y,C]}multiSplit(t){if(l.assertFinite(t),t<1||(t|0)!=t)throw new Error("wtf");const n=[];let e=this;for(;t>1;){const s=1/t;let o;[o,e]=e.split(s),n.push(o),t--}return n.push(e),n}}class T{constructor(t,n,e,s,o,r,i,a){this.x0=t,this.y0=n,this.x1=e,this.y1=s,this.x2=o,this.y2=r,this.x=i,this.y=a,l.assertFinite(t,n,e,s,o,r,i,a),this.asString=`C ${M(e)},${M(s)} ${M(o)},${M(r)} ${M(i)},${M(a)}`}reverse(){return new T(this.x,this.y,this.x2,this.y2,this.x1,this.y1,this.x0,this.y0)}static relative(t,n,e,s,o,r,i,a){return new this(t,n,e+t,s+n,o+t,r+n,i+t,a+n)}get incomingAngle(){return Math.atan2(this.y1-this.y0,this.x1-this.x0)}get outgoingAngle(){return Math.atan2(this.y-this.y2,this.x-this.x2)}command="C";asString;translate(t,n){return new T(this.x0+t,this.y0+n,this.x1+t,this.y1+n,this.x2+t,this.y2+n,this.x+t,this.y+n)}transform(t){const n=F(this.x0,this.y0,t),e=F(this.x1,this.y1,t),s=F(this.x2,this.y2,t),o=F(this.x,this.y,t);return new T(n.x,n.y,e.x,e.y,s.x,s.y,o.x,o.y)}toCubic(){return this}}class X{get commands(){return this.#t}addCommand(t){this.#t.push(t),this.#n=void 0}addCommands(t){return t.forEach(n=>this.addCommand(n)),this}static fromStrings(t){let n=t.join(" ");const e=[];let s;for(;n=n.replace(/^ */,""),n!="";){let o=D.exec(n);if(o){const r=l.parseFloatX(o[1]),i=l.parseFloatX(o[2]);if(r===void 0||i===void 0)throw console.error(o,r,i,this),new Error("wtf");s&&e.push(s),s=this.M(r,i),n=o[3];continue}if(s){if(o=J.exec(n),o){const r=l.parseFloatX(o[1]),i=l.parseFloatX(o[2]);if(r===void 0||i===void 0)throw console.error(o,r,i,this),new Error("wtf");s=s.L(r,i),n=o[3];continue}if(o=G.exec(n),o){const r=l.parseFloatX(o[1]),i=l.parseFloatX(o[2]),a=l.parseFloatX(o[3]),u=l.parseFloatX(o[4]);if(r===void 0||i===void 0||a===void 0||u===void 0)throw console.error(o,r,i,a,u,this),new Error("wtf");s=s.Q(r,i,a,u),n=o[5];continue}if(o=j.exec(n),o){const r=l.parseFloatX(o[1]),i=l.parseFloatX(o[2]),a=l.parseFloatX(o[3]),u=l.parseFloatX(o[4]),d=l.parseFloatX(o[5]),f=l.parseFloatX(o[6]);if(r===void 0||i===void 0||a===void 0||u===void 0||d===void 0||f===void 0)throw console.error(o,r,i,a,u,d,f,this),new Error("wtf");s=s.C(r,i,a,u,d,f),n=o[7];continue}}throw console.error(n),new Error("wtf")}return s&&e.push(s),e}static M(t,n){const e=new X;return e.M(t,n),e}#t=[];get pathShape(){return new p(this.#t)}#n;M(t,n,e=NaN){return l.assertFinite(t,n),this.#n={x:t,y:n,outgoingAngle:e},this}previous(){return this.#n??this.#t.at(-1)}H(t){const n=this.previous();return this.addCommand(new E(n.x,n.y,t,n.y)),this}V(t){const n=this.previous();return this.addCommand(new E(n.x,n.y,n.x,t)),this}L(t,n){const e=this.previous();return this.addCommand(new E(e.x,e.y,t,n)),this}Q(t,n,e,s){const o=this.previous();return this.addCommand(A.controlPoints(o.x,o.y,t,n,e,s)),this}Q_HV(t,n){const e=this.previous();return this.Q(t,e.y,t,n)}Q_VH(t,n){const e=this.previous();return this.Q(e.x,n,t,n)}Q_angles(t,n,e,s){const o=this.previous();if(s??=o.outgoingAngle,s===void 0)throw new Error("wtf");return this.addCommand(A.angles(o.x,o.y,s,t,n,e)),this}C(t,n,e,s,o,r){const i=this.previous();return this.addCommand(new T(i.x,i.y,t,n,e,s,o,r)),this}circle(t,n,e="cw"){const s=this.previous(),o=s.x,r=s.y,i=Math.atan2(r-n,o-t),a=Math.hypot(r-n,o-t),u=e=="cw"?1:-1,d=i+Math.PI*2*u,f=l.makeLinear(0,i,1,d);function h(x){switch(x){case 0:case 1:return s;default:{const $=f(x),P=l.polarToRectangular(a,$);return{x:t+P.x,y:n+P.y}}}}function m(x){return h(x)}return this.addParametricPath(m,8),this}arc(t,n,e,s,o){const r=this.previous(),i=r.x,a=r.y;let u=l.positiveModulo(Math.atan2(a-n,i-t),Math.PI*2);const d=Math.hypot(a-n,i-t);let f=l.positiveModulo(Math.atan2(s-n,e-t),Math.PI*2);const h=Math.hypot(s-n,e-t);o=="cw"?u>f&&(f+=Math.PI*2):u<f&&(u+=Math.PI*2);const m=Math.abs(u-f),y=Math.ceil(m*1.17+1e-4),x=l.makeLinear(0,d,1,h),$=l.makeLinear(0,u,1,f);function P(v){switch(v){case 0:return r;case 1:return{x:e,y:s};default:{const I=l.polarToRectangular(x(v),$(v));return{x:t+I.x,y:n+I.y}}}}return this.addParametricPath(P,y)}addParametricPath(t,n){if(n<=0)throw new Error("wtf");const e=.01/n,s=l.initializedArray(n+1,o=>{const r=o/n,i=t(r),a=H(t,r,e);return{t:r,point:i,direction:a}});if(s.some(o=>!isFinite(o.direction))){const{x:o,y:r}=s[0].point;if(l.assertFinite(o,r),s.some(i=>i.point.x!=o||i.point.y!=r))throw new Error("Unable to create a path from this function.  Unable to compute the derivative.");for(let i=0;i<n;i++)this.Q(o,r,o,r)}else l.initializedArray(n,r=>({from:s[r],to:s[r+1]})).forEach(r=>{this.Q_angles(r.to.point.x,r.to.point.y,r.to.direction,r.from.direction)});return this}}function R(c,t,n){if(!(t>=0&&t<=1))throw new Error("Expected 0 ≤ t ≤ 1");const e=Math.max(0,t-n),s=c(e),o=Math.min(1,t+n),r=c(o),i=r.x-s.x,a=r.y-s.y;return i==0&&a==0?NaN:Math.atan2(a,i)}function H(c,t,n){const e=R(c,t,n*2),s=R(c,t,n*1),o=e-s;return s-o}const b=" *",g="(-?[0-9]+\\.?[0-9]*(?:[eE][-+]?[0-9]+)?)",w="(?: *[, ] *|(?=-))",D=new RegExp(`^M${b}${g}${w}${g}(.*)$`),Z=new RegExp(`^m${b}${g}${w}${g}(.*)$`),J=new RegExp(`^L${b}${g}${w}${g}(.*)$`),L=new RegExp(`^${w}${g}${w}${g}(.*)$`),W=new RegExp(`^l${b}${g}${w}${g}(.*)$`),K=new RegExp(`^h${b}${g}(.*)$`),_=new RegExp(`^v${b}${g}(.*)$`),q=new RegExp(`^${w}${g}(.*)$`),tt=q,G=new RegExp(`^Q${b}${g}${w}${g}${w}${g}${w}${g}(.*)$`),nt=new RegExp(`^${w}${g}${w}${g}${w}${g}${w}${g}(.*)$`),et=new RegExp(`^q${b}${g}${w}${g}${w}${g}${w}${g}(.*)$`),j=new RegExp(`^C${b}${g}${w}${g}${w}${g}${w}${g}${w}${g}${w}${g}(.*)$`),k=new RegExp(`^${w}${g}${w}${g}${w}${g}${w}${g}${w}${g}${w}${g}(.*)$`),st=new RegExp(`^c${b}${g}${w}${g}${w}${g}${w}${g}${w}${g}${w}${g}(.*)$`),rt=new RegExp("^[zZ](.*)$");class ot extends Error{constructor(t,n){super(t),this.where=n}}class p{reverse(){return new p(this.commands.toReversed().map(t=>t.reverse()))}static fromString(t){const n=this.fromJson(t);if(n)return n;let e=t,s=null;const o=h=>new ot(h,e),r=h=>{const m=l.parseFloatX(h);if(m===void 0)throw o(`Invalid number: "${h}"`);return m};let i=0,a=0;const u=[],d=h=>{u.push(h),i=h.x,a=h.y};let f;for(;e=e.replace(/^ */,""),e!="";){if(s=D.exec(e)){i=r(s[1]),a=r(s[2]),f={x0:i,y0:a},e=s[3];continue}if(s=Z.exec(e)){for(i+=r(s[1]),a+=r(s[2]),f={x0:i,y0:a},e=s[3];s=L.exec(e);){const h=E.relative(i,a,r(s[1]),r(s[2]));d(h),e=s[3]}continue}if(!f)throw o("Must start with an M command.");if(s=rt.exec(e)){if(i!=f.x0||a!=f.y0){const h=new E(i,a,f.x0,f.y0);d(h)}e=s[1];continue}if(s=J.exec(e)){const h=r(s[1]),m=r(s[2]),y=new E(i,a,h,m);d(y),e=s[3];continue}if(s=W.exec(e)){for(;s;){const h=r(s[1]),m=r(s[2]),y=E.relative(i,a,h,m);d(y),e=s[3],s=L.exec(e)}continue}if(s=K.exec(e)){for(;s;){const h=r(s[1]),m=new E(i,a,i+h,a);d(m),e=s[2],s=tt.exec(e)}continue}if(s=_.exec(e)){for(;s;){const h=r(s[1]),m=new E(i,a,i,a+h);d(m),e=s[2],s=q.exec(e)}continue}if(s=G.exec(e)){const h=r(s[1]),m=r(s[2]),y=r(s[3]),x=r(s[4]),$=A.controlPoints(i,a,h,m,y,x);d($),e=s[5];continue}if(s=et.exec(e)){for(;s;){const h=r(s[1]),m=r(s[2]),y=r(s[3]),x=r(s[4]),$=A.relative(i,a,h,m,y,x);d($),e=s[5],s=nt.exec(e)}continue}if(s=j.exec(e)){for(;s;){const h=r(s[1]),m=r(s[2]),y=r(s[3]),x=r(s[4]),$=r(s[5]),P=r(s[6]),v=new T(i,a,h,m,y,x,$,P);d(v),e=s[7],s=k.exec(e)}continue}if(s=st.exec(e)){for(;s;){const h=r(s[1]),m=r(s[2]),y=r(s[3]),x=r(s[4]),$=r(s[5]),P=r(s[6]),v=T.relative(i,a,h,m,y,x,$,P);d(v),e=s[7],s=k.exec(e)}continue}throw o("Confused.")}return new this(u)}static fromJson(t){try{const e=JSON.parse(t).commands.map(s=>{switch(s.command){case"C":{const{x0:o,y0:r,x1:i,y1:a,x2:u,y2:d,x:f,y:h}=s;return new T(o,r,i,a,u,d,f,h)}case"L":{const{x0:o,y0:r,x:i,y:a}=s;return new E(o,r,i,a)}case"Q":{const{x0:o,y0:r,x:i,y:a,creationInfo:u}=s;switch(u.source){case"angles":{const{angle0:d,angle:f}=u,h=A.angles(o,r,d,i,a,f);return(h.creationInfo.source!="angles"||h.creationInfo.success!=u.success)&&console.warn("different",s,h),h}case"controlPoints":{const{x1:d,y1:f}=s;return A.controlPoints(o,r,d,f,i,a)}case"line":return A.line4(o,r,i,a);default:throw new Error(`Unknown source: "${u.source}"`)}}default:throw new Error(`Unknown command: "${s.command}"`)}});return new p(e)}catch{return}}matchForMorph(t){const n=this.commands.map(i=>i.toCubic()),e=t.commands.map(i=>i.toCubic());if(n.length!=e.length){const{shorter:i,longer:a}=n.length<e.length?{shorter:n,longer:e}:{shorter:e,longer:n};if(i.length==0)throw new Error("can't morph something into nothing");const u=a.length/i.length,d=[];i.forEach((f,h)=>{const m=Math.round((h+1)*u);for(;d.length<m;)d.push(f)}),i.length=0,i.push(...d)}if(n.length!=e.length)throw new Error("wtf");function s(i){return p.cssifyPath(i.map(a=>new p([a]).rawPath).join())}const o=s(n),r=s(e);return[o,r]}commands;get endX(){return this.commands.at(-1)?.x}get endY(){return this.commands.at(-1)?.y}get startX(){return this.commands.at(0)?.x0}get startY(){return this.commands.at(0)?.y0}constructor(t){this.commands=[...t]}static cssifyPath(t){return`path('${t}')`}get cssPath(){return p.cssifyPath(this.rawPath)}makeElement(){const t=document.createElementNS("http://www.w3.org/2000/svg","path"),n=this.cssPath;if(t.style.d=n,t.style.d=="")throw console.error(n,t),new Error("wtf");return t}static needAnM(t,n){return n?!t||t.x!=n.x0||t.y!=n.y0:!1}get rawPath(){return this.splitOnMove().flatMap(t=>{const n=[`M ${M(t.startX)},${M(t.startY)}`];return t.commands.forEach(e=>n.push(e.asString)),t.startX==t.endX&&t.startY==t.endY&&n.push("Z"),n}).join(" ")}get cssPaths(){return this.splitOnMove().map(t=>t.cssPath)}get rawPaths(){return this.splitOnMove().map(t=>t.rawPath)}splitOnMove(){const t=[];let n=[];return this.commands.forEach(e=>{p.needAnM(n.at(-1),e)&&(n=[],t.push(n)),n.push(e)}),t.map(e=>new p(e))}static join(t){return new p(t.flatMap(({Δx:n,Δy:e,shape:s})=>s.translate(n,e).commands))}convertToCubics(){return new p(this.commands.map(t=>t.toCubic()))}translate(t,n){return new p(this.commands.map(e=>e.translate(t,n)))}transform(t){return new p(this.commands.map(n=>n.transform(t)))}static parametric(t,n){const e=t(0);return X.M(e.x,e.y).addParametricPath(t,n).pathShape}static#t=new V;static parametric1(t,n,e=0){e>0&&console.log(e);const o=this.parametric(t,n).commands.map((a,u,d)=>{const f=u/d.length,h=(u+1)/d.length;return{command:a,initialT:f,finalT:h}});let r=0;const i=a=>{const u=new this([a]);this.#t.d=u.rawPath;const d=this.#t.length,f=Math.hypot(a.x0-a.x,a.y0-a.y),h=d/f;return h<2||!isFinite(h)};for(;r<o.length;){const a=o[r].command;if(i(a))r++;else{const u=Math.max(0,r-1);let d=r+1;for(;d<o.length;){const v=o[d].command;if(d++,i(v))break}const f=o[u].initialT,h=o[d-1].finalT,m=l.makeLinear(0,f,1,h),y=v=>t(m(v)),x=d-u,$=x+1,P=this.parametric1(y,$,e+1);o.splice(u,x,...P.commands.map((v,I,S)=>{const C=m(I/S.length),Y=m((I+1)/S.length);return{command:v,initialT:C,finalT:Y}})),r+=$}}return new p(o.map(a=>a.command))}static fixAngleRounding(t){return t+400-400}static toDegrees(t){return Math.round(t*l.degreesPerRadian*100)/100}dump(){const t=this.commands.map((n,e)=>{const{x0:s,y0:o,x:r,y:i,incomingAngle:a,outgoingAngle:u,command:d}=n,f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d",new p([n]).rawPath);const h=f.getTotalLength(),m=this.commands[e-1],x=p.needAnM(m,n)?{}:{difference:p.toDegrees(l.angleBetween(m.outgoingAngle,a))};return{x0:s,y0:o,x:r,y:i,incomingAngle:p.toDegrees(a),outgoingAngle:p.toDegrees(u),length:h,c:d,...x}});console.table(t),console.log(this.rawPath),console.log(JSON.stringify(this))}}function it(c,t){if(l.assertFinite(c.x0,c.y0,c.angle,t.x0,t.y0,t.angle),isNaN(c.angle)||isNaN(t.angle)||c.angle==t.angle)return;const n=Math.tan(c.angle),e=Math.tan(t.angle),s=Math.abs(n)*100>Number.MAX_SAFE_INTEGER,o=Math.abs(e)*100>Number.MAX_SAFE_INTEGER;if(s&&o)return;const r=Math.atan2(t.y0-c.y0,t.x0-c.x0),i=l.angleBetween(c.angle,r),a=l.angleBetween(t.angle,r);if(i==0||Math.abs(a)==Math.PI){if(Math.abs(i)==Math.PI||a==0)return;const f=(c.x0+t.x0)/2,h=(c.y0+t.y0)/2;return{x:f,y:h}}const u=Math.sign(i),d=Math.sign(a);if(!(u!=d||u==0)&&!(Math.abs(a)<=Math.abs(i)+l.radiansPerDegree))if(s||o){const f=s?c.x0:t.x0,h=s?{...t,slope:e}:{...c,slope:n},m=h.slope*(f-h.x0)+h.y0;return{x:f,y:m}}else{const f=(t.y0-e*t.x0-c.y0+n*c.x0)/(n-e),h=n*(f-c.x0)+c.y0;return{x:f,y:h}}}export{mt as G,E as L,p as P,A as Q,U as R,at as a,ot as b,N as c,ft as d,ht as e,X as f,ut as g,V as h,dt as i,wt as j,gt as l,lt as m,O as p,z as s};
