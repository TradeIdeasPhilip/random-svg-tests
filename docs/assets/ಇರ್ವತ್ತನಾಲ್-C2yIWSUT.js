import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as f}from"./client-misc-B8CxQsfg.js";import{b as H,s as D,t as M,g as j,h as q}from"./fourier-shared-BdjzRlL0.js";import{p as Q,d as K,b as X,c as Z,P as O}from"./path-shape-CZZKMsju.js";import{m as c}from"./misc-BHUyxQfl.js";import{g as V,e as J}from"./utility-Dgy6CMn3.js";const W=1024,N=f.getById("scaled",SVGGElement),A=f.selectorQuery("[data-reference]",SVGPathElement),z=f.selectorQuery("[data-live]",SVGPathElement),Y=f.selectorQueryAll("g.frequency",SVGGElement).map(i=>({top:i,spinner:f.selectorQuery(".spinner",SVGPolygonElement,i),text:f.selectorQuery("text",SVGTextElement,i)}));function R(i,e){if(i>=e)throw new Error("wtf");const t=c.makeLinear(i,0,e,1);function s(n){if(n<=i)return 0;if(n>=e)return 1;const a=t(n);return J(a)}return s}let U=()=>{};window.showFrame=i=>{U(i)};class _{constructor(e,t){this.getTransform=t,this.#e=f.selectorQuery(e,SVGGElement),this.#n=f.selectorQuery("[data-reference]",SVGPathElement,this.#e),this.#t=f.selectorQuery("[data-live]",SVGPathElement,this.#e)}#e;#n;#t;hide(){this.#e.style.display="none"}show(e,t){this.#e.style.display="",this.#n.style.stroke=e,this.#t.style.stroke=t}setReferencePath(e){this.#n.setAttribute("d",e)}setLivePath(e){this.#t.setAttribute("d",e)}setTransform(e){const t=e.a;this.#e.style.transform=e.toString(),this.#e.style.setProperty("--path-scale",t.toString())}static right=new _("#scaled",e=>Q(e,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}class ee{static colorSummary(e){if(e instanceof HTMLCanvasElement&&(e=e.getContext("2d")),e instanceof CanvasRenderingContext2D){const{height:n,width:a}=e.canvas;e=e.getImageData(0,0,a,n)}class t{#a=0;#i=0;#r=1/0;#o=-1/0;get min(){return this.#r}get max(){return this.#o}get average(){return this.#i/this.#a}add(a){this.#a++,this.#i+=a,this.#o=Math.max(this.#o,a),this.#r=Math.min(this.#r,a)}get(){return{min:this.min,max:this.max,average:this.average}}}const s=c.initializedArray(4,()=>new t);return e.data.forEach((n,a)=>s[a%4].add(n)),{red:s[0].get(),green:s[1].get(),blue:s[2].get(),alpha:s[3].get()}}#e=f.getById("backgroundCanvas",HTMLCanvasElement);#n;constructor(e){this.#n=this.#c(e)}#t=c.assertNonNullable(this.#e.getContext("2d",{colorSpace:"display-p3"}));#c(e){f.selectorQuery("feTurbulence",SVGFETurbulenceElement).seed.baseVal=e;const t=document.createElement("canvas");t.width=3840,t.height=2160;const s=t.getContext("2d",{colorSpace:"display-p3"}),n=s.createLinearGradient(0,0,3840,2160);return n.addColorStop(0,"hsl(220, 10%, 30%)"),n.addColorStop(1,"hsl(220, 15%, 40%)"),s.fillStyle=n,s.globalCompositeOperation="source-over",s.filter="url(#noiseFilter)",s.fillStyle="rgb(255, 165, 0)",s.fillRect(0,0,3840,2160),s.filter="none",s.globalCompositeOperation="source-over",t}#l=c.makeLinear(-1,.333,1,.555);#s=0;addDebugText(e){const t=this.#s*216+108;this.#s=(this.#s+1)%10,this.#t.font="100px sans-serif",this.#t.fillStyle="white",this.#t.fillText(e,20,t)}draw(e){const t=this.#t;t.drawImage(this.#n,0,0);const s=[0,c.FULL_CIRCLE/3,c.FULL_CIRCLE*(2/3)],n=6e4,a=(e+2e4)%n/n*c.FULL_CIRCLE,[h,y,d]=s.map(p=>this.#l(Math.sin(a+p)));t.globalCompositeOperation="multiply",t.fillStyle=`rgb(${h*255}, ${y*255}, ${d*255})`,t.fillRect(0,0,3840,2160),t.globalCompositeOperation="source-over"}extract(e){e!==void 0&&this.draw(e);const{promise:t,resolve:s,reject:n}=Promise.withResolvers();return this.#e.toBlob(a=>{a?s(a):n("wtf")},"image/png",1),t}}new K;function te(i){A.setAttribute("d",i.pathString);const e=Q(A.getBBox(),{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1),t=e.a;N.style.transform=e.toString(),N.style.setProperty("--path-scale",t.toString());const s=H(i.pathString,W),n=D(s);window.debugPath=o=>{const l=M(n,o),r=new Z(l);r.go(5e3),r.dump(),console.log(r),A.setAttribute("d",r.pathShape.rawPath)};const a=j({addTime:6250,pauseTime:750,maxGroupsToDisplay:i.maxGroupsToDisplay,skipCountAtEnd:i.skipCountAtEnd,terms:n}),h=o=>Math.max(...n.slice(0,o).map(r=>Math.abs(r.frequency))),y=o=>8*h(o)+7,d=a.map(o=>{if(o.addingCircles==0){const l=M(n,o.usingCircles),r=y(o.usingCircles),u=O.glitchFreeParametric(l,r);return()=>u.rawPath}else if(o.usingCircles==0&&o.addingCircles==1&&n[0].frequency==0){let l=function(x){return`${w.x*x},${w.y*x}`};const{startTime:r,endTime:u}=o,g=u-r,S=R(r,r+g/2),F=R(r,u),w=q(n[0]);return x=>{const m=F(x),C=l(m),v=S(x),P=l(v);return`M ${C} L ${P}`}}else{const r=.2/h(o.usingCircles+o.addingCircles),u=c.makeBoundedLinear(o.startTime,-r,o.endTime,1+r),g=M(n,o.usingCircles),S=M(n,o.addingCircles,o.usingCircles);let F=y(o.usingCircles+o.addingCircles);if(o.usingCircles==0||o.usingCircles==1&&q(n[0])){const w=q(n[0])??{x:0,y:0};return x=>{const m=u(x),C=m-r,v=m+r,P=R(C,v),L=Math.min(1,v);if(L<=0)return`M${w.x},${w.y} L${w.x},${w.y}`;{let k=function(T){T=T*L;const G=g(T),I=1-P(T);if(I==0)return G;{const B=S(T);return{x:G.x+I*B.x,y:G.y+I*B.y}}};const E=Math.ceil(Math.max(F,150)*L);return O.glitchFreeParametric(k,E).rawPath}}}else return w=>{const x=u(w),m=R(x-r,x+r);function C(P){const L=g(P),k=1-m(P);if(k==0)return L;{const E=S(P);return{x:L.x+k*E.x,y:L.y+k*E.y}}}return O.glitchFreeParametric(C,F).rawPath}}}),p=new ee(i.backgroundSeed);window.customBackground=p,U=o=>{p.draw(o);function l(){const m=a.findIndex(({endTime:C})=>o<C);return m==-1?a.length-1:m}const r=l(),u=d[r](o);z.setAttribute("d",u);const{usingCircles:g,addingCircles:S,startTime:F,endTime:w}=a[r],x=S>0?(o-F)/(w-F)*c.FULL_CIRCLE:0;Y.forEach((m,C)=>{if(C>=g+S)m.top.style.display="none";else{m.top.style.display="";const v=n[C];m.text.innerHTML=v.frequency.toString(),m.spinner.style.transform=`rotate(${x*v.frequency+v.phase+c.FULL_CIRCLE/4}rad)`}})}}let $;setTimeout(()=>{let i=NaN;$=new f.AnimationLoop(e=>{isNaN(i)&&(i=e);const t=e-i;U(t)}),window.animationLoop=$},1);function ne(i){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(e=>{if(!(e instanceof SVGElement||e instanceof HTMLElement))throw new Error("wtf");e.style.display="none"}),$.cancel(),{source:"fourier-smackdown.ts",script:i,seconds:120,devicePixelRatio}}window.initScreenCapture=ne;class se{constructor(e,t){this.vertex1=e,this.vertex2=t}has(e){return e==this.vertex1||e==this.vertex2}other(e){if(this.vertex1==e)return this.vertex2;if(this.vertex2==e)return this.vertex1}}class b{constructor(e,t){this.pathSoFar=e,this.remainingEdges=t}oneStep(){const e=c.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((t,s)=>{const n=t.other(e);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new b([...this.pathSoFar,n],this.remainingEdges.toSpliced(s,1))})}*#e(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const e=this.oneStep();for(const t of e)yield*t.#e()}}static*get(e){yield*new this([0],e).#e()}static*getUnique(e){const t=Math.max(...e.map(n=>Math.max(n.vertex1,n.vertex2)))+1,s=new Set;for(const n of this.get(e)){const a=n.slice(0,n.length-1),h=this.#n(a);if(!s.has(h)){yield n,s.add(h);const y=this.#t(a,t).map(d=>this.#n(d));for(const d of y)s.add(d)}}}static#n(e){return String.fromCharCode(...e.map(t=>t+65))}static#t(e,t){const s=new Array;for(let n=1;n<e.length;n++){const a=e[n],h=(a+1)%t,y=V(e,n+1);h==y?s.push(c.initializedArray(e.length,d=>{const p=V(e,d+n);return c.positiveModulo(p-a,t)})):V(e,n-1)==h&&s.push(c.initializedArray(e.length,p=>{const o=V(e,n-p);return c.positiveModulo(o-a,t)}))}return s}static getSamples(){function e(t,...s){return c.initializedArray(t,n=>s.map(a=>new se(n,(n+a)%t))).flat()}return{pentagram:e(5,1,2),dodecahedron:e(6,1,2),square:e(4,1),hex:e(10,1)}}}window.Progress=b;function re(){const i=b.getSamples(),e=b.getUnique(i.pentagram);console.log(e,e.constructor.name);for(const t of e);}re();{c.initializedArray(5,l=>{const r=c.FULL_CIRCLE*l/5+c.FULL_CIRCLE/4,u=Math.cos(r),g=Math.sin(r);return{x:u,y:g}});const i=c.initializedArray(6,l=>{const r=c.FULL_CIRCLE*l/6+c.FULL_CIRCLE/4,u=Math.cos(r),g=Math.sin(r);return{x:u,y:g}}),e=[...b.getUnique(b.getSamples().dodecahedron)],t=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],s=c.Random.fromString("fourier-smackdown.ts"),n=c.initializedArray(e.length,()=>{const l=s()*3|0,r=t[l];return t.splice(l,1),t.push(r),r}),a=c.parseIntX(new URLSearchParams(window.location.search).get("index")),h=a??Math.random()*e.length|0;{const l=f.getById("chapter",SVGTextElement);l.innerHTML=`#${h} of ${e.length}`}const y=e[h],d=n[h];console.log({requestedIndex:a,index:h,path:y,...d}),console.log(e),z.style.stroke=d.light,A.style.stroke=d.dark;const p=X.M(i[0].x,i[0].y);y.forEach((l,r)=>{if(r==0){if(l!=0)throw new Error("wtf")}else{const{x:u,y:g}=i[l],S=y[r-1];switch(c.positiveModulo(l-S,6)){case 1:{p.arc(0,0,u,g,"cw");break}case 2:case 4:{p.L(u,g);break}case 5:{p.arc(0,0,u,g,"ccw");break}default:throw new Error("wtf")}}});const o=p.pathShape.rawPath;console.log(o),te({maxGroupsToDisplay:15,skipCountAtEnd:1,pathString:o,liveColor:d.light,referenceColor:d.dark,backgroundSeed:h})}
