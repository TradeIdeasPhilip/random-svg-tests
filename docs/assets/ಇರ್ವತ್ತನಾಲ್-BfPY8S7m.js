import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as S}from"./client-misc-B8CxQsfg.js";import{b as _,s as H,h as T,t as B}from"./fourier-shared-NjkoHtEt.js";import{p as O,d as D,b as K,P as U}from"./path-shape-CZZKMsju.js";import{m as l}from"./misc-BHUyxQfl.js";import{g as G,e as Z}from"./utility-Dgy6CMn3.js";function j(){document.body.style.backgroundColor="transparent",S.selectorQueryAll("[data-hide-background]",SVGElement).forEach(o=>o.style.display="none")}function J(){const o=S.selectorQuery("[data-hide-background]",SVGElement);o.parentElement?.append(o)}const R=new URLSearchParams(window.location.search);if(R.get("hide_background")=="1")j();else if(R.get("only_background")=="1")J();else if(R.get("thumbnail")=="1"){const o=S.selectorQuery("g#foreground",SVGGElement);o.style.display="none";const t=S.selectorQuery("g#thumbnail-foreground",SVGGElement);t.style.display=""}{const t=S.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const W=1024;class X{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=S.selectorQuery(t,SVGGElement)),this.#t=S.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(s=>{const n=S.selectorQuery("text",SVGTextElement,s),a=document.createElementNS("http://www.w3.org/2000/svg","text");return a.classList.add("background"),s.insertBefore(a,n),{top:s,spinner:S.selectorQuery(".spinner",SVGPolygonElement,s),text:n,background:a}})}#t;show(t,e){this.#t.forEach((s,n)=>{if(n>=t)s.top.style.display="none";else{s.top.style.display="";const a=this.terms[n];s.background.innerHTML=s.text.innerHTML=a.frequency.toString(),s.spinner.style.transform=`rotate(${e*a.frequency+a.phase+l.FULL_CIRCLE/4}rad)`}})}}function V(o,t){if(o>=t)throw new Error("wtf");const e=l.makeLinear(o,0,t,1);function s(n){if(n<=o)return 0;if(n>=t)return 1;const a=e(n);return Z(a)}return s}let Q=()=>{};window.showFrame=o=>{Q(o)};class I{constructor(t,e){this.getTransform=e,this.#t=S.selectorQuery(t,SVGGElement),this.#n=S.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=S.selectorQuery("[data-live]",SVGPathElement,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t,this.#e.style.stroke=e}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.setAttribute("d",t)}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new I("#right",t=>O(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const z=new D;class Y{constructor(t){this.pathString=t,this.samples=_(t,W),this.terms=H(this.samples),this.keyframes=l.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,s=t-e){const n=this.makeGetPath2(),a=l.makeBoundedLinear(e,0,s,1),g=this.stepCount;function E(h){let i=Math.floor(h/t),m;i<0?(i=0,m=0):i>=g?(i=g-1,m=t):m=h%t;const d=a(m);return{pathString:n(i,d),index:i,t:d}}return E}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],s=this.stepCount,n=h=>Math.max(...t.slice(0,h).map(m=>Math.abs(m.frequency))),a=h=>8*n(h)+7,g=l.initializedArray(s,h=>{const i=e[h],m=e[h+1];if(i==0&&m==1&&t[0].frequency==0){let d=function(f){return`${r.x*f},${r.y*f}`};const r=l.assertNonNullable(T(t[0])),p=V(0,.5),y=V(0,1);return f=>{const u=y(f),c=d(u),w=p(f),x=d(w);return`M ${c} L ${x}`}}else{const r=.2/n(m),p=l.makeBoundedLinear(0,-r,1,1+r),y=B(t,i),f=B(t,m-i,i),u=a(m);if(i==0||i==1&&T(t[0])){const c=T(t[0])??{x:0,y:0};return w=>{const x=p(w),k=x-r,b=x+r,F=V(k,b),C=Math.min(1,b);if(C<=0)return`M${c.x},${c.y} L${c.x},${c.y}`;{let v=function(L){L=L*C;const q=y(L),A=1-F(L);if(A==0)return q;{const $=f(L);return{x:q.x+A*$.x,y:q.y+A*$.y}}};const M=Math.ceil(Math.max(u,150)*C);return U.glitchFreeParametric(v,M).rawPath}}}else return c=>{const w=p(c),x=V(w-r,w+r);function k(F){const C=y(F),v=1-x(F);if(v==0)return C;{const M=f(F);return{x:C.x+v*M.x,y:C.y+v*M.y}}}return U.glitchFreeParametric(k,u).rawPath}}});function E(h,i){const m=g[h];return m(i)}return E}}class tt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#s;#r;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,z.d=this.#n,this.#o=this.#e.getTransform(z.getBBox());const s=6e3,n=750;this.endTime=s*t.base.stepCount;const a=t.base.makeGetPath1(s,0,s-n),g=new X(e,t.base.terms);this.#t=E=>{const{pathString:h,index:i,t:m}=a(E);this.#e.setLivePath(h),g.show(t.base.keyframes[i+1],m*l.FULL_CIRCLE)}}}function et(...o){Q=t=>{o.forEach(e=>e.show(t))}}let N;setTimeout(()=>{let o=NaN;N=new S.AnimationLoop(t=>{isNaN(o)&&(o=t);const e=t-o;Q(e)}),window.animationLoop=N},1);function nt(o){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),N.cancel(),{source:"fourier-smackdown.ts",script:o,seconds:120,devicePixelRatio}}window.initScreenCapture=nt;class st{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class P{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=l.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,s)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new P([...this.pathSoFar,n],this.remainingEdges.toSpliced(s,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,s=new Set;for(const n of this.get(t)){const a=n.slice(0,n.length-1),g=this.#n(a);if(!s.has(g)){yield n,s.add(g);const E=this.#e(a,e).map(h=>this.#n(h));for(const h of E)s.add(h)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const s=new Array;for(let n=1;n<t.length;n++){const a=t[n],g=(a+1)%e,E=G(t,n+1);g==E?s.push(l.initializedArray(t.length,h=>{const i=G(t,h+n);return l.positiveModulo(i-a,e)})):G(t,n-1)==g&&s.push(l.initializedArray(t.length,i=>{const m=G(t,n-i);return l.positiveModulo(m-a,e)}))}return s}static getSamples(){function t(e,...s){return l.initializedArray(e,n=>s.map(a=>new st(n,(n+a)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=P;function rt(){const o=P.getSamples(),t=P.getUnique(o.pentagram);console.log(t,t.constructor.name);for(const e of t);}rt();{class o{constructor(r){throw new Error("wtf")}static points=l.initializedArray(5,r=>{const p=l.FULL_CIRCLE*r/5+l.FULL_CIRCLE/4,y=Math.cos(p),f=Math.sin(p);return{x:y,y:f}});static allPaths=[...P.getUnique(P.getSamples().pentagram)]}class t{constructor(r){throw new Error("wtf")}static points=l.initializedArray(6,r=>{const p=l.FULL_CIRCLE*r/6+l.FULL_CIRCLE/4,y=Math.cos(p),f=Math.sin(p);return{x:y,y:f}});static allPaths=[...P.getUnique(P.getSamples().dodecahedron)];static makePathShape(r){const p=this.allPaths[r],y=K.M(e[0].x,e[0].y);return p.forEach((f,u)=>{if(u==0){if(f!=0)throw new Error("wtf")}else{const{x:c,y:w}=e[f],x=p[u-1];switch(l.positiveModulo(f-x,6)){case 1:{y.arc(0,0,c,w,"cw");break}case 2:case 4:{y.L(c,w);break}case 5:{y.arc(0,0,c,w,"ccw");break}default:throw new Error("wtf")}}}),y.pathShape}}const e=t.points,s=t.allPaths,n=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],a=l.Random.fromString("fourier-smackdown.ts"),g=l.initializedArray(s.length,()=>{const d=a()*3|0,r=n[d];return n.splice(d,1),n.push(r),r});let E=4;const h=[{color:g[E++].light,destRect:{x:.5,y:.5,width:5,height:5},index:15,colorName:"red"},{color:g[E++].light,destRect:{x:5.5,y:3.5,width:5,height:5},index:16,colorName:"white"},{color:g[E++].light,destRect:{x:10.5,y:.5,width:5,height:5},index:17,colorName:"blue"}],i=h.map(({index:d})=>{const r=t.makePathShape(d).rawPath;return new Y(r)});{const d=new Map;i.forEach(u=>u.terms.forEach(({frequency:c,amplitude:w})=>{const k=(d.get(c)??0)+w;d.set(c,k)}));const r=Array.from(d.entries(),([u,c])=>({frequency:u,amplitude:c}));r.sort((u,c)=>c.amplitude-u.amplitude);const p=r[0].amplitude*.05,y=4,f=r.filter(({amplitude:u,frequency:c})=>u>p&&(c+1)%y==0);console.log(f),i.forEach(({terms:u})=>{f.forEach(({frequency:c},w)=>{const x=u.findIndex(b=>b.frequency==c);let k;x==-1?k={amplitude:0,phase:0,frequency:c}:[k]=u.splice(x,1),u.splice(w,0,k)})})}const m=new Array;for(const[d,r]of l.zip(h,i)){const{color:p,destRect:y,index:f}=d,u=d.colorName??d.color,c=S.selectorQuery(`g.frequencies[data-frequencies="${u}"]`,SVGGElement),w=new I(`[data-fourier-top="${u}"]`,F=>O(F,y,"srcRect fits completely into destRect"));c.style.fill=p;const x={base:r,destination:w,liveColor:p,referenceColor:p},k=new tt(x,c);m.push(k);const b=S.selectorQuery(`text.chapter[data-chapter="${u}"]`,SVGTextElement);b.innerHTML=`#${f}`,b.style.fill=p}et(...m)}
