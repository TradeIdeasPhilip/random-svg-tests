import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as M}from"./client-misc-leadhGo2.js";import{d as A,T as y,Q as T,P as C,D as V}from"./letters-more-DrO7i2-O.js";import{b as k,a as I}from"./utility-DcEUXXL7.js";import{l as G}from"./math-to-path-CWuJ-zIl.js";const E=M("input",HTMLTextAreaElement),u=M("main",SVGElement);{const t=new y().font,{normal:a}=A(t),n=M("available",HTMLSpanElement);n.innerText=[...a].sort().join(" ")}class f{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,u.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){f.doCleanup(),this.startImpl(),f.#t=this}doCleanup(){}}class F extends f{startImpl(){const t=new y;t.restart();const a=E.value,n=t.addText(a);t.displayText(n,u),u.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}const L=M("completionRatio",HTMLInputElement);class N extends f{startImpl(){const t=new y;t.restart();const a=E.value,n=t.addText(a);u.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const r=y.join(n),e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("handwriting"),u.appendChild(e);let o=0;r.splitOnMove().forEach(c=>{const h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",c.rawPath),e.appendChild(h);const s=o,p=h.getTotalLength();o=s+p,h.style.setProperty("--offset",s.toString()),h.style.setProperty("--length",p.toString())});const i=new AbortController;this.doCleanup=()=>i.abort();const g=o,w=()=>{const c=L.valueAsNumber*g;k(c),e.style.setProperty("--total-position",c.toString())};w(),L.addEventListener("input",w,{signal:i.signal})}static start(){new this().start()}}class R extends f{startImpl(){const t=new y;t.restart();const a=E.value,n=t.addText(a);u.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const r=y.join(n),e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("handwriting","skywriting"),u.appendChild(e);let o=0;r.splitOnMove().forEach(h=>{const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",h.rawPath),e.appendChild(s);const p=o,l=s.getTotalLength();o=p+l,s.style.setProperty("--offset",p.toString()),s.style.setProperty("--length",l.toString())});const i=new AbortController;this.doCleanup=()=>i.abort();const w=o+40,c=()=>{const h=L.valueAsNumber*w;k(h),e.style.setProperty("--total-position",h.toString())};c(),L.addEventListener("input",c,{signal:i.signal})}static start(){new this().start()}}function B(d){return!d.commands.some(t=>t.command!="L")}class v extends f{static makeRoughShape(t,a){const n=new Array,r=new Array;return t.splitOnMove().forEach(e=>{if(B(e)){let o=function(s,p){const l=a*(p?Math.SQRT1_2:1)*Math.random(),m=Math.random()*Math.PI*2,x=I(l,m),b=s.x+x.x,S=s.y+x.y;return{x:b,y:S,offset:x,initial:s}};const i=e.commands,g=i.flatMap((s,p)=>p==0?[]:{x:s.x0,y:s.y0}),w=i[0],c=[o({x:w.x0,y:w.y0},"½")];g.forEach(s=>{c.push(o(s))});const h=i[i.length-1];if(c.push(o(h)),c.length!=i.length+1||i.length!=g.length+1)throw new Error("wtf");i.forEach((s,p)=>{const l=c[p],m=c[p+1],x=s instanceof T?{x:s.x1,y:s.y1}:G(l,m,Math.random()),b={x:x.x+(l.offset.x+m.offset.x)/2,y:x.y+(l.offset.y+m.offset.y)/2},S=o(b,"½");n.push(new T(l.initial.x,l.initial.y,b.x,b.y,m.initial.x,m.initial.y)),r.push(new T(l.x,l.y,S.x,S.y,m.x,m.y))})}else n.push(...e.commands),r.push(...e.commands)}),{before:new C(n),after:new C(r)}}static makeRoughFont(t){const a=new Map;return t.forEach((n,r)=>{const e=new V(()=>this.makeRoughShape(n.shape,n.fontMetrics.strokeWidth*1.5).before,n.advance,n.fontMetrics);a.set(r,e)}),a}static#t=[];static instantiate(t){const a=[...this.#t];let n=!0;const r=t.map(e=>{if(n){const o=a.at(0);if(o?.char===e.char)return a.shift(),{...e,shape:o.shape};n=!1}return e});for(let e=r.length-1;e>=0;e--){const o=a.pop();if(o===void 0)break;const i=r[e];if(o.char!=i.char)break;const g={...i,shape:o.shape};r[e]=g}return r}startImpl(){const t=new y;t.font=v.makeRoughFont(t.font),t.restart();const a=E.value,n=t.addText(a),r=v.instantiate(n);v.#t=t.displayText(r,u),u.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}E.addEventListener("input",()=>{f.restartCurrent()});function P(){const d=document.querySelector('input[name="type"]:checked')?.id;switch(d){case"simpleType":{F.start();break}case"handwritingType":{new N().start();break}case"skywritingType":{new R().start();break}case"roughType":{new v().start();break}default:throw new Error(`invalid id: ${d}`)}}P();document.querySelectorAll('input[name="type"]').forEach(d=>{d.addEventListener("click",P)});
