import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as H,s as D,h as q,t as $}from"./fourier-shared-NjkoHtEt.js";import{p as O,d as K,b as Z,P as B}from"./path-shape-CZZKMsju.js";import{m as c}from"./misc-BHUyxQfl.js";import{g as G,e as J}from"./utility-Dgy6CMn3.js";function W(){document.body.style.backgroundColor="transparent",y.selectorQueryAll("[data-hide-background]",SVGElement).forEach(d=>d.style.display="none")}function X(){const d=y.selectorQuery("[data-hide-background]",SVGElement);d.parentElement?.append(d)}const T=new URLSearchParams(window.location.search);let j=!1;T.get("hide_background")=="1"?W():T.get("only_background")=="1"&&X();{const t=y.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const Y=1024;class tt{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=y.selectorQuery(t,SVGGElement)),this.#t=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(a=>{const r=y.selectorQuery("text",SVGTextElement,a),m=document.createElementNS("http://www.w3.org/2000/svg","text");return m.classList.add("background"),a.insertBefore(m,r),{top:a,spinner:y.selectorQuery(".spinner",SVGPolygonElement,a),text:r,background:m}})}#t;show(t,e){this.#t.forEach((a,r)=>{if(r>=t)a.top.style.display="none";else{a.top.style.display="";const m=this.terms[r];a.background.innerHTML=a.text.innerHTML=m.frequency.toString(),a.spinner.style.transform=`rotate(${e*m.frequency+m.phase+c.FULL_CIRCLE/4}rad)`}})}}function A(d,t){if(d>=t)throw new Error("wtf");const e=c.makeLinear(d,0,t,1);function a(r){if(r<=d)return 0;if(r>=t)return 1;const m=e(r);return J(m)}return a}let I=()=>{};window.showFrame=d=>{I(d)};class N{constructor(t,e){this.getTransform=e,this.#t=y.selectorQuery(t,SVGGElement),this.#n=y.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=y.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new N("#right",t=>O(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const z=new K;class et{constructor(t){this.pathString=t,this.samples=H(t,Y),this.terms=D(this.samples),this.keyframes=c.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,a=t-e){const r=this.makeGetPath2(),m=c.makeBoundedLinear(e,0,a,1),S=this.stepCount;function P(g){let h=Math.floor(g/t),n;h<0?(h=0,n=0):h>=S?(h=S-1,n=t):n=g%t;const o=m(n);return{pathString:r(h,o),index:h,t:o}}return P}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],a=this.stepCount,r=g=>Math.max(...t.slice(0,g).map(n=>Math.abs(n.frequency))),m=g=>8*r(g)+7,S=c.initializedArray(a,g=>{const h=e[g],n=e[g+1];if(h==0&&n==1&&t[0].frequency==0){let o=function(s){return`${i.x*s},${i.y*s}`};const i=c.assertNonNullable(q(t[0])),f=A(0,.5),u=A(0,1);return s=>{const l=u(s),w=o(l),E=f(s),p=o(E);return`M ${w} L ${p}`}}else{const i=.2/r(n),f=c.makeBoundedLinear(0,-i,1,1+i),u=$(t,h),s=$(t,n-h,h),l=m(n);if(h==0||h==1&&q(t[0])){const w=q(t[0])??{x:0,y:0};return E=>{const p=f(E),C=p-i,x=p+i,F=A(C,x),k=Math.min(1,x);if(k<=0)return`M${w.x},${w.y} L${w.x},${w.y}`;{let b=function(V){V=V*k;const M=u(V),R=1-F(V);if(R==0)return M;{const _=s(V);return{x:M.x+R*_.x,y:M.y+R*_.y}}};const v=Math.ceil(Math.max(l,150)*k);return B.glitchFreeParametric(b,v).rawPath}}}else return w=>{const E=f(w),p=A(E-i,E+i);function C(F){const k=u(F),b=1-p(F);if(b==0)return k;{const v=s(F);return{x:k.x+b*v.x,y:k.y+b*v.y}}}return B.glitchFreeParametric(C,l).rawPath}}});function P(g,h){const n=S[g];return n(h)}return P}}class nt{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#s;#r;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,z.d=this.#n,this.#o=this.#e.getTransform(z.getBBox());const a=6e3,r=750;this.endTime=a*t.base.stepCount;const m=t.base.makeGetPath1(a,0,a-r),S=new tt(e,t.base.terms);this.#t=P=>{const{pathString:g,index:h,t:n}=m(P);this.#e.setLivePath(g),S.show(t.base.keyframes[h+1],n*c.FULL_CIRCLE)}}}function st(...d){I=t=>{d.forEach(e=>e.show(t))}}let Q;setTimeout(()=>{if(j)return;let d=NaN;Q=new y.AnimationLoop(t=>{isNaN(d)&&(d=t);const e=t-d;I(e)}),window.animationLoop=Q},1);function rt(d){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),Q?.cancel(),{source:"fourier-smackdown.ts",script:d,seconds:120,devicePixelRatio}}window.initScreenCapture=rt;class ot{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class L{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=c.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,a)=>{const r=e.other(t);return r===void 0||this.pathSoFar.length==1&&r!=1?[]:new L([...this.pathSoFar,r],this.remainingEdges.toSpliced(a,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(r=>Math.max(r.vertex1,r.vertex2)))+1,a=new Set;for(const r of this.get(t)){const m=r.slice(0,r.length-1),S=this.#n(m);if(!a.has(S)){yield r,a.add(S);const P=this.#e(m,e).map(g=>this.#n(g));for(const g of P)a.add(g)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const a=new Array;for(let r=1;r<t.length;r++){const m=t[r],S=(m+1)%e,P=G(t,r+1);S==P?a.push(c.initializedArray(t.length,g=>{const h=G(t,g+r);return c.positiveModulo(h-m,e)})):G(t,r-1)==S&&a.push(c.initializedArray(t.length,h=>{const n=G(t,r-h);return c.positiveModulo(n-m,e)}))}return a}static getSamples(){function t(e,...a){return c.initializedArray(e,r=>a.map(m=>new ot(r,(r+m)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=L;function at(){const d=L.getSamples(),t=L.getUnique(d.pentagram);console.log(t,t.constructor.name);for(const e of t);}at();{let d=function(n,o=".chapter"){typeof o=="string"&&(o=y.selectorQuery(o,SVGTextElement)),o.innerHTML=`#${n} of ${e.allPaths.length}`};class t{constructor(o){throw new Error("wtf")}static points=c.initializedArray(5,o=>{const i=c.FULL_CIRCLE*o/5+c.FULL_CIRCLE/4,f=Math.cos(i),u=Math.sin(i);return{x:f,y:u}});static allPaths=[...L.getUnique(L.getSamples().pentagram)]}class e{constructor(o){throw new Error("wtf")}static points=c.initializedArray(6,o=>{const i=c.FULL_CIRCLE*o/6+c.FULL_CIRCLE/4,f=Math.cos(i),u=Math.sin(i);return{x:f,y:u}});static allPaths=[...L.getUnique(L.getSamples().dodecahedron)];static makePathShape(o){const i=this.allPaths[o],f=Z.M(a[0].x,a[0].y);return i.forEach((u,s)=>{if(s==0){if(u!=0)throw new Error("wtf")}else{const{x:l,y:w}=a[u],E=i[s-1];switch(c.positiveModulo(u-E,6)){case 1:{f.arc(0,0,l,w,"cw");break}case 2:case 4:{f.L(l,w);break}case 5:{f.arc(0,0,l,w,"ccw");break}default:throw new Error("wtf")}}}),f.pathShape}}const a=e.points,r=e.allPaths,m=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],S=c.Random.fromString("fourier-smackdown.ts");c.initializedArray(r.length,()=>{const n=S()*3|0,o=m[n];return m.splice(n,1),m.push(o),o});const P=[{color:"black",destRect:{x:1,y:.25,width:8.5,height:8.5},index:21,colorName:"blue"}];d(21);const g=P.map(({index:n})=>{const o=e.makePathShape(n).rawPath;return new et(o)});{const n=new Map;g.forEach(s=>s.terms.forEach(({frequency:l,amplitude:w})=>{const p=(n.get(l)??0)+w;n.set(l,p)}));const o=Array.from(n.entries(),([s,l])=>({frequency:s,amplitude:l}));o.sort((s,l)=>l.amplitude-s.amplitude);const i=o[0].amplitude*.05,f=3,u=o.filter(({amplitude:s,frequency:l})=>s>i&&(l-1)%f==0);console.log(u),g.forEach(({terms:s})=>{u.forEach(({frequency:l},w)=>{const E=s.findIndex(C=>C.frequency==l);let p;E==-1?p={amplitude:0,phase:0,frequency:l}:[p]=s.splice(E,1),s.splice(w,0,p)})})}const h=new Array;for(const[n,o]of c.zip(P,g)){const{color:i,destRect:f}=n,u=n.colorName??n.color,s=y.selectorQuery(`g.frequencies[data-frequencies="${u}"]`,SVGGElement),l=new N(`[data-fourier-top="${u}"]`,p=>O(p,f,"srcRect fits completely into destRect"));s.style.fill=i;const w={base:o,destination:l,liveColor:i,referenceColor:i},E=new nt(w,s);h.push(E),console.log(E)}{let n=function(p,C){const F=[p,p+c.FULL_CIRCLE/3,p-c.FULL_CIRCLE/3].map(U=>w(Math.sin(U)));F.push(0),F.push(E(Math.cos(C)));const k=F.join(" "),v=[k,k,k,"0 0 0 0 1"].join(`
`);f.setAttribute("values",v)},o=function(p){const C=u.map(x=>[]);p.forEach(x=>{if(x.length!=u.length)throw new Error("wtf");x.forEach((F,k)=>{C[k].push(F)})});for(const[x,F]of c.zip(u,C))x.setAttribute("tableValues",F.join(" "))},i=function(p){const C=p/12e4*c.FULL_CIRCLE,x=p/12e4*c.FULL_CIRCLE/2;n(C,x)};const f=y.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),u=[y.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),y.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),y.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],s=[[65,105,225],[204,85,0],[255,160,122],[255,182,193],[255,245,157],[175,238,238]],l=c.makeLinear(0,.25,255,1);s.forEach(p=>p.forEach((C,x,F)=>F[x]=l(C)));const w=c.makeLinear(-1,-.05,1,.8),E=c.makeLinear(1,0,-1,-.4);window.updateValues=n,o(s),h.push({show:i})}{let n=function(u){i.forEach(({element:s,attributeName:l})=>{s.setAttribute(l,u)})},o=function(u){const s=Math.floor(u/1500)%f.length,l=f[s];n(l)};const i=y.selectorQueryAll("[data-fg-color]",SVGElement).map(u=>({element:u,attributeName:c.assertNonNullable(u.dataset.fgColor)}));window.setFgColor=n;const f=["red","yellow","magenta","lime","hwb(204.42deg 0% 0%)","white","cyan","#CC5500","hsl(270, 55%, 55%)"];h.push({show:o})}if(st(...h),T.get("thumbnail")=="1"){const n=y.selectorQuery("g#foreground",SVGGElement);j=!0;const o=new Array;Array.from(n.children).forEach(s=>{const l=c.assertClass(s,SVGElement);l.dataset.live===void 0?l.style.display="none":(console.log("live",l.dataset.live),o.push(l))});const i=y.selectorQueryAll("#starfield rect",SVGRectElement);i[0].parentElement.style.transform="scale(3)",i.forEach(s=>{s.style.transformOrigin=`${50/3}% 22%`}),i[1].style.transform="rotate(1.75deg)",i[2].style.transform="rotate(-1.5deg)";const f=6e3;h[0].show(f*5-20),h[1].show(f*7-20),h[2].show(f*4-20),y.selectorQueryAll("[data-reference]",SVGPathElement).forEach(s=>s.style.display="none"),y.selectorQueryAll("[data-live]",SVGPathElement).forEach(s=>{s.style.transform="scale(1.5)"}),window.showFrame=s=>{console.info("ignoring showFrame()",s)}}}
