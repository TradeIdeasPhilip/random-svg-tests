import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as K,s as Z,h as I,t as B}from"./fourier-shared-BneanVCb.js";import{p as D,d as j,b as J,P as Q}from"./path-shape-DN4hoPl6.js";import{m as c}from"./misc-BHUyxQfl.js";import{g as A,e as W}from"./utility-Dgy6CMn3.js";function X(){document.body.style.backgroundColor="transparent",y.selectorQueryAll("[data-hide-background]",SVGElement).forEach(a=>a.style.display="none")}function Y(){const a=y.selectorQuery("[data-hide-background]",SVGElement);a.parentElement?.append(a)}{const a=c.Random.fromString("Pastel 41"),t=y.selectorQuery("[data-favorite]",SVGCircleElement),e=c.makeLinear(0,.025,2,.15);for(let s=0;s<150;s++){const n=c.assertClass(t.cloneNode(!0),SVGCircleElement);n.cx.baseVal.value=a()*16,n.cy.baseVal.value=a()*9,n.r.baseVal.value=e(a()+a()),t.parentElement.append(n)}}const N=new URLSearchParams(window.location.search);let H=!1;N.get("hide_background")=="1"?X():N.get("only_background")=="1"&&Y();{const t=y.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const tt=1024;class et{#t;constructor(t){t instanceof SVGGElement||(t=y.selectorQuery(t,SVGGElement)),this.#t=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(e=>{const s=y.selectorQuery("text",SVGTextElement,e),n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.classList.add("background"),e.insertBefore(n,s),{top:e,spinner:y.selectorQuery(".spinner",SVGPolygonElement,e),text:s,background:n}})}show(t,e){this.#t.forEach((s,n,f)=>{if(n>=t.length)s.top.style.display="none";else{s.top.style.display="";const x=t[n];let k=x.frequency.toString();n==f.length-1&&f.length<t.length&&(k+=", â€¦"),s.background.innerHTML=s.text.innerHTML=k,s.spinner.style.transform=`rotate(${e*x.frequency+x.phase+c.FULL_CIRCLE/4}rad)`}})}}function q(a,t){if(a>=t)throw new Error("wtf");const e=c.makeLinear(a,0,t,1);function s(n){if(n<=a)return 0;if(n>=t)return 1;const f=e(n);return W(f)}return s}let U=()=>{};window.showFrame=a=>{U(a)};class ${constructor(t,e){this.getTransform=e,this.#t=t,this.#n=y.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=y.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new $(y.getById("right",SVGGElement),t=>D(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const z=new j;class nt{constructor(t,e,s=0,n=e-s){this.stepCount=t,this.period=e,this.#t=c.makeBoundedLinear(s,0,n,1),this.endTime=e*t}#t;endTime;get(t){let e=Math.floor(t/this.period),s;e<0?(e=0,s=0):e>=this.stepCount?(e=this.stepCount-1,s=this.period):s=t%this.period;const n=this.#t(s);return{index:e,t:n}}}class st{constructor(t){this.pathString=t,this.samples=K(t,tt),this.terms=Z(this.samples),this.keyframes=c.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t){const e=this.makeGetPath2();function s(n){const{index:f,t:x}=t.get(n);return e(f,x)}return s}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],s=this.stepCount,n=u=>Math.max(...t.slice(0,u).map(P=>Math.abs(P.frequency))),f=u=>{if(u==0)return 8;{const g=n(u);return 8*Math.min(g,50)+7}},x=c.initializedArray(s,u=>{const g=e[u],P=e[u+1];if(g==0&&P==1&&t[0].frequency==0){let v=function(o){return`${w.x*o},${w.y*o}`};const w=c.assertNonNullable(I(t[0])),F=q(0,.5),V=q(0,1);return o=>{const r=V(o),i=v(r),h=F(o),l=v(h);return`M ${i} L ${l}`}}else if(g==P){const v=B(t,g),w=f(P),V=Q.glitchFreeParametric(v,w).rawPath;return o=>V}else{const w=.2/Math.abs(t[g].frequency),F=c.makeBoundedLinear(0,-w,1,1+w),V=B(t,g),o=B(t,P-g,g),r=f(P);if(g==0||g==1&&I(t[0])){const i=I(t[0])??{x:0,y:0};return h=>{const l=F(h),E=l-w,p=l+w,S=q(E,p),m=Math.min(1,p);if(m<=0)return`M${i.x},${i.y} L${i.x},${i.y}`;{let d=function(L){L=L*m;const R=V(L),T=1-S(L);if(T==0)return R;{const _=o(L);return{x:R.x+T*_.x,y:R.y+T*_.y}}};const b=Math.ceil(Math.max(r,150)*m);return Q.glitchFreeParametric(d,b).rawPath}}}else return i=>{const h=F(i),l=q(h-w,h+w);function E(S){const m=V(S),d=1-l(S);if(d==0)return m;{const b=o(S);return{x:m.x+d*b.x,y:m.y+d*b.y}}}return Q.glitchFreeParametric(E,r).rawPath}}});function k(u,g){const P=x[u];return P(g)}return k}}class M{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}timer;#n;#e;#s;#r;#o;base;static PERIOD=7e3;static PAUSE=1e3;constructor(t){this.base=t.base,this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,z.d=this.#n,this.#o=this.#e.getTransform(z.getBBox()),this.timer=new nt(t.base.stepCount,M.PERIOD,M.PAUSE);const e=t.base.makeGetPath1(this.timer);this.#t=s=>{const n=e(s);this.#e.setLivePath(n)}}}function rt(...a){U=t=>{a.forEach(e=>e.show(t))}}let O;setTimeout(()=>{if(H)return;let a=NaN;O=new y.AnimationLoop(t=>{isNaN(a)&&(a=t);const e=t-a;U(e)}),window.animationLoop=O},1);function ot(a){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),O?.cancel(),{source:"fourier-smackdown.ts",script:a,seconds:90,devicePixelRatio}}window.initScreenCapture=ot;class at{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class C{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=c.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,s)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new C([...this.pathSoFar,n],this.remainingEdges.toSpliced(s,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,s=new Set;for(const n of this.get(t)){const f=n.slice(0,n.length-1),x=this.#n(f);if(!s.has(x)){yield n,s.add(x);const k=this.#e(f,e).map(u=>this.#n(u));for(const u of k)s.add(u)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const s=new Array;for(let n=1;n<t.length;n++){const f=t[n],x=(f+1)%e,k=A(t,n+1);x==k?s.push(c.initializedArray(t.length,u=>{const g=A(t,u+n);return c.positiveModulo(g-f,e)})):A(t,n-1)==x&&s.push(c.initializedArray(t.length,g=>{const P=A(t,n-g);return c.positiveModulo(P-f,e)}))}return s}static getSamples(){function t(e,...s){return c.initializedArray(e,n=>s.map(f=>new at(n,(n+f)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=C;function it(){const a=C.getSamples(),t=C.getUnique(a.pentagram);console.log(t,t.constructor.name);for(const e of t);}it();{let a=function(o,r,i){const h=r-o,l=i-o,E=2*o,p=2*o;return{x:h,y:l,width:E,height:p}};class t{constructor(r){throw new Error("wtf")}static points=c.initializedArray(5,r=>{const i=c.FULL_CIRCLE*r/5+c.FULL_CIRCLE/4,h=Math.cos(i),l=Math.sin(i);return{x:h,y:l}});static allPaths=[...C.getUnique(C.getSamples().pentagram)]}class e{constructor(r){throw new Error("wtf")}static points=c.initializedArray(6,r=>{const i=c.FULL_CIRCLE*r/6+c.FULL_CIRCLE/4,h=Math.cos(i),l=Math.sin(i);return{x:h,y:l}});static allPaths=[...C.getUnique(C.getSamples().dodecahedron)];static makePathShape(r){const i=this.allPaths[r],h=J.M(s[0].x,s[0].y);return i.forEach((l,E)=>{if(E==0){if(l!=0)throw new Error("wtf")}else{const{x:p,y:S}=s[l],m=i[E-1];switch(c.positiveModulo(l-m,6)){case 1:{h.arc(0,0,p,S,"cw");break}case 2:case 4:{h.L(p,S);break}case 5:{h.arc(0,0,p,S,"ccw");break}default:throw new Error("wtf")}}}),h.pathShape}}const s=e.points,n=e.allPaths,f=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],x=c.Random.fromString("fourier-smackdown.ts");c.initializedArray(n.length,()=>{const o=x()*3|0,r=f[o];return f.splice(o,1),f.push(r),r});let k=58;const u=9/4,g=.8,P=[{color:"n/a",destRect:a(u*g,u,2.75*u),index:k},{color:"n/a",destRect:a(u*g,16/2,9/2),index:k},{color:"n/a",destRect:a(u*g,16-u,1.25*u),index:k}],v=P.map(({index:o})=>{const r=e.makePathShape(o).rawPath;return new st(r)});v.forEach(({terms:o,keyframes:r},i)=>{const h=o.length,l=[],E=10;for(;l.length<E-1;){let d;l.length<6?d=1:d=2;const b=o.splice(0,d);if(b.length!=d)throw new Error("wtf");l.push(b)}const p=[],S=[];l.forEach((d,b)=>{b%3<2?p.push(d):S.unshift(d)});const m=[...p,[...o],...S];if(m.length!=E)throw new Error("wtf");if(console.log(m),o.length=0,r.length=0,r.push(0),m.forEach((d,b,G)=>{o.push(...d),r.push(o.length)}),o.length!=h)throw new Error("wtf")}),console.log(v);const w=new Array,F=y.selectorQuery("g#foreground",SVGGElement);y.getById("chapterList",SVGTextElement),P.length-1;const V=[{light:"red",dark:"darkRed"},{light:"white",dark:"black"},{light:"var(--blue)",dark:"darkblue"},{light:"orange",dark:"darkOrange"},{light:"Fuchsia ",dark:"purple"}];for(const[o,r,{light:i,dark:h},l]of c.zip(P,v,V,c.count())){const{destRect:E,search:p}=o,S=p===void 0?document.createElementNS("http://www.w3.org/2000/svg","g"):y.selectorQuery(`g.frequencies[data-frequencies="${p}"]`,SVGGElement),m=p===void 0?F.appendChild(c.assertClass(y.selectorQuery("defs g[data-fourier-top]",SVGGElement).cloneNode(!0),SVGGElement)):y.selectorQuery(`[data-fourier-top="${p}"]`,SVGGElement);m.style.setProperty("--color",i),m.style.setProperty("--blur-color",h);const d=new $(m,L=>D(L,E,"srcRect fits completely into destRect"));m.dataset.liveIndex=l.toString(),S.style.fill=h;const b={base:r,destination:d,liveColor:h,referenceColor:i},G=new M(b);w.push(G),console.log(G)}{let o=function(S){const{index:m,t:d}=h.get(S);d>=1?r.show([],0):r.show(l[m],d*c.FULL_CIRCLE)};const r=new et('[data-frequencies="red"]'),i=c.assertClass(w.at(2),M),h=i.timer,l=new Array,{keyframes:E,terms:p}=i.base;E.forEach((S,m)=>{const d=m-1;if(d>=0){const b=E[d],G=p.slice(b,S);l.push(G)}}),console.log(l),w.push({show:o})}if(console.log(w),rt(...w),N.get("thumbnail")=="1"){H=!0;const o=new Array;Array.from(F.children).forEach(r=>{const i=c.assertClass(r,SVGElement);i.dataset.live===void 0?i.style.display="none":(console.log("live",i.dataset.live),o.push(i))}),w.forEach((r,i)=>{r.show(8500+950*i)}),y.selectorQueryAll("[data-reference]",SVGPathElement).forEach(r=>r.style.display="none"),y.selectorQueryAll("#new-starfield circle",SVGCircleElement).forEach(r=>{r.style.transform="scale(3)",r.style.transformOrigin=`${r.cx.baseVal.value}px ${r.cy.baseVal.value}px`})}}
