import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as E}from"./client-misc-B8CxQsfg.js";import{b as H,s as D,h as q,t as B}from"./fourier-shared-NjkoHtEt.js";import{p as _,d as K,b as Z,P as I}from"./path-shape-CZZKMsju.js";import{m as u}from"./misc-BHUyxQfl.js";import{g as G,e as j}from"./utility-Dgy6CMn3.js";function J(){document.body.style.backgroundColor="transparent",E.selectorQueryAll("[data-hide-background]",SVGElement).forEach(d=>d.style.display="none")}function W(){const d=E.selectorQuery("[data-hide-background]",SVGElement);d.parentElement?.append(d)}const R=new URLSearchParams(window.location.search);let z=!1;R.get("hide_background")=="1"?J():R.get("only_background")=="1"&&W();{const t=E.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const X=1024;class Y{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=E.selectorQuery(t,SVGGElement)),this.#t=E.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(o=>{const s=E.selectorQuery("text",SVGTextElement,o),i=document.createElementNS("http://www.w3.org/2000/svg","text");return i.classList.add("background"),o.insertBefore(i,s),{top:o,spinner:E.selectorQuery(".spinner",SVGPolygonElement,o),text:s,background:i}})}#t;show(t,e){this.#t.forEach((o,s)=>{if(s>=t)o.top.style.display="none";else{o.top.style.display="";const i=this.terms[s];o.background.innerHTML=o.text.innerHTML=i.frequency.toString(),o.spinner.style.transform=`rotate(${e*i.frequency+i.phase+u.FULL_CIRCLE/4}rad)`}})}}function A(d,t){if(d>=t)throw new Error("wtf");const e=u.makeLinear(d,0,t,1);function o(s){if(s<=d)return 0;if(s>=t)return 1;const i=e(s);return j(i)}return o}let Q=()=>{};window.showFrame=d=>{Q(d)};class N{constructor(t,e){this.getTransform=e,this.#t=E.selectorQuery(t,SVGGElement),this.#s=E.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=E.selectorQuery("[data-live]",SVGPathElement,this.#t)}#t;#s;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#s.style.stroke=t,this.#e.style.stroke=e}setReferencePath(t){this.#s.setAttribute("d",t)}setLivePath(t){this.#e.setAttribute("d",t)}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new N("#right",t=>_(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const U=new K;class tt{constructor(t){this.pathString=t,this.samples=H(t,X),this.terms=D(this.samples),this.keyframes=u.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,o=t-e){const s=this.makeGetPath2(),i=u.makeBoundedLinear(e,0,o,1),x=this.stepCount;function P(p){let c=Math.floor(p/t),f;c<0?(c=0,f=0):c>=x?(c=x-1,f=t):f=p%t;const m=i(f);return{pathString:s(c,m),index:c,t:m}}return P}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],o=this.stepCount,s=p=>Math.max(...t.slice(0,p).map(f=>Math.abs(f.frequency))),i=p=>8*s(p)+7,x=u.initializedArray(o,p=>{const c=e[p],f=e[p+1];if(c==0&&f==1&&t[0].frequency==0){let m=function(h){return`${a.x*h},${a.y*h}`};const a=u.assertNonNullable(q(t[0])),l=A(0,.5),y=A(0,1);return h=>{const n=y(h),r=m(n),g=l(h),w=m(g);return`M ${r} L ${w}`}}else{const a=.2/s(f),l=u.makeBoundedLinear(0,-a,1,1+a),y=B(t,c),h=B(t,f-c,c),n=i(f);if(c==0||c==1&&q(t[0])){const r=q(t[0])??{x:0,y:0};return g=>{const w=l(g),S=w-a,k=w+a,v=A(S,k),F=Math.min(1,k);if(F<=0)return`M${r.x},${r.y} L${r.x},${r.y}`;{let b=function(V){V=V*F;const M=y(V),T=1-v(V);if(T==0)return M;{const O=h(V);return{x:M.x+T*O.x,y:M.y+T*O.y}}};const L=Math.ceil(Math.max(n,150)*F);return I.glitchFreeParametric(b,L).rawPath}}}else return r=>{const g=l(r),w=A(g-a,g+a);function S(v){const F=y(v),b=1-w(v);if(b==0)return F;{const L=h(v);return{x:F.x+b*L.x,y:F.y+b*L.y}}}return I.glitchFreeParametric(S,n).rawPath}}});function P(p,c){const f=x[p];return f(c)}return P}}class et{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#n,this.#r),this.#e.setReferencePath(this.#s),this.#e.setTransform(this.#o),this.#t(t)}endTime;#s;#e;#n;#r;#o;constructor(t,e){this.#s=t.base.pathString,this.#e=t.destination,this.#n=t.referenceColor,this.#r=t.liveColor,U.d=this.#s,this.#o=this.#e.getTransform(U.getBBox());const o=6e3,s=750;this.endTime=o*t.base.stepCount;const i=t.base.makeGetPath1(o,0,o-s),x=new Y(e,t.base.terms);this.#t=P=>{const{pathString:p,index:c,t:f}=i(P);this.#e.setLivePath(p),x.show(t.base.keyframes[c+1],f*u.FULL_CIRCLE)}}}function st(...d){Q=t=>{d.forEach(e=>e.show(t))}}let $;setTimeout(()=>{if(z)return;let d=NaN;$=new E.AnimationLoop(t=>{isNaN(d)&&(d=t);const e=t-d;Q(e)}),window.animationLoop=$},1);function nt(d){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),$?.cancel(),{source:"fourier-smackdown.ts",script:d,seconds:120,devicePixelRatio}}window.initScreenCapture=nt;class rt{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class C{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=u.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,o)=>{const s=e.other(t);return s===void 0||this.pathSoFar.length==1&&s!=1?[]:new C([...this.pathSoFar,s],this.remainingEdges.toSpliced(o,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(s=>Math.max(s.vertex1,s.vertex2)))+1,o=new Set;for(const s of this.get(t)){const i=s.slice(0,s.length-1),x=this.#s(i);if(!o.has(x)){yield s,o.add(x);const P=this.#e(i,e).map(p=>this.#s(p));for(const p of P)o.add(p)}}}static#s(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const o=new Array;for(let s=1;s<t.length;s++){const i=t[s],x=(i+1)%e,P=G(t,s+1);x==P?o.push(u.initializedArray(t.length,p=>{const c=G(t,p+s);return u.positiveModulo(c-i,e)})):G(t,s-1)==x&&o.push(u.initializedArray(t.length,c=>{const f=G(t,s-c);return u.positiveModulo(f-i,e)}))}return o}static getSamples(){function t(e,...o){return u.initializedArray(e,s=>o.map(i=>new rt(s,(s+i)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=C;function ot(){const d=C.getSamples(),t=C.getUnique(d.pentagram);console.log(t,t.constructor.name);for(const e of t);}ot();{class d{constructor(a){throw new Error("wtf")}static points=u.initializedArray(5,a=>{const l=u.FULL_CIRCLE*a/5+u.FULL_CIRCLE/4,y=Math.cos(l),h=Math.sin(l);return{x:y,y:h}});static allPaths=[...C.getUnique(C.getSamples().pentagram)]}class t{constructor(a){throw new Error("wtf")}static points=u.initializedArray(6,a=>{const l=u.FULL_CIRCLE*a/6+u.FULL_CIRCLE/4,y=Math.cos(l),h=Math.sin(l);return{x:y,y:h}});static allPaths=[...C.getUnique(C.getSamples().dodecahedron)];static makePathShape(a){const l=this.allPaths[a],y=Z.M(e[0].x,e[0].y);return l.forEach((h,n)=>{if(n==0){if(h!=0)throw new Error("wtf")}else{const{x:r,y:g}=e[h],w=l[n-1];switch(u.positiveModulo(h-w,6)){case 1:{y.arc(0,0,r,g,"cw");break}case 2:case 4:{y.L(r,g);break}case 5:{y.arc(0,0,r,g,"ccw");break}default:throw new Error("wtf")}}}),y.pathShape}}const e=t.points,o=t.allPaths,s=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],i=u.Random.fromString("fourier-smackdown.ts"),x=u.initializedArray(o.length,()=>{const m=i()*3|0,a=s[m];return s.splice(m,1),s.push(a),a});let P=7;const p=[{color:x[P++].light,destRect:{x:.5,y:.5,width:5,height:5},index:18,colorName:"red"},{color:x[P++].light,destRect:{x:5.5,y:3.5,width:5,height:5},index:19,colorName:"white"},{color:x[P++].light,destRect:{x:10.5,y:.5,width:5,height:5},index:20,colorName:"blue"}],c=p.map(({index:m})=>{const a=t.makePathShape(m).rawPath;return new tt(a)});{const m=new Map;c.forEach(n=>n.terms.forEach(({frequency:r,amplitude:g})=>{const S=(m.get(r)??0)+g;m.set(r,S)}));const a=Array.from(m.entries(),([n,r])=>({frequency:n,amplitude:r}));a.sort((n,r)=>r.amplitude-n.amplitude);const l=a[0].amplitude*.05,y=3,h=a.filter(({amplitude:n,frequency:r})=>n>l&&(r+1)%y==0);console.log(h),c.forEach(({terms:n})=>{h.forEach(({frequency:r},g)=>{const w=n.findIndex(k=>k.frequency==r);let S;w==-1?S={amplitude:0,phase:0,frequency:r}:[S]=n.splice(w,1),n.splice(g,0,S)})})}const f=new Array;for(const[m,a]of u.zip(p,c)){const{color:l,destRect:y,index:h}=m,n=m.colorName??m.color,r=E.selectorQuery(`g.frequencies[data-frequencies="${n}"]`,SVGGElement),g=new N(`[data-fourier-top="${n}"]`,v=>_(v,y,"srcRect fits completely into destRect"));r.style.fill=l;const w={base:a,destination:g,liveColor:l,referenceColor:l},S=new et(w,r);f.push(S);const k=E.selectorQuery(`text.chapter[data-chapter="${n}"]`,SVGTextElement);k.innerHTML=`#${h}`,k.style.fill=l}{let m=function(g){const w=g*50,S=g*60,k=`${w}% ${S}%`;h.forEach(v=>v.style.transformOrigin=k)},a=function(g,w,S){const k=(g+w)/2,v=g-k,F=u.FULL_CIRCLE/S;function b(L){return Math.sin(L*F)*v+k}return b},l=function(g){const w=n(g);m(w),r.forEach(({element:S,oscillator:k})=>{const v=k(g);S.style.transform=`rotate(${v}deg)`})};const[y,...h]=E.selectorQueryAll("#starfield rect",SVGRectElement),n=u.makeBoundedLinear(0,0,6e4,1),r=[{element:h[0],oscillator:a(.5,1.5,15e3)},{element:h[1],oscillator:a(-.5,-1.5,13081)}];if(r.length!=h.length)throw new Error("wtf");f.push({show:l})}if(st(...f),R.get("thumbnail")=="1"){const m=E.selectorQuery("g#foreground",SVGGElement);z=!0;const a=new Array;Array.from(m.children).forEach(n=>{const r=u.assertClass(n,SVGElement);r.dataset.live===void 0?r.style.display="none":(console.log("live",r.dataset.live),a.push(r))});const l=E.selectorQueryAll("#starfield rect",SVGRectElement);l[0].parentElement.style.transform="scale(3)",l.forEach(n=>{n.style.transformOrigin=`${50/3}% 22%`}),l[1].style.transform="rotate(1.75deg)",l[2].style.transform="rotate(-1.5deg)";const y=6e3;f[0].show(y*5-20),f[1].show(y*7-20),f[2].show(y*4-20),E.selectorQueryAll("[data-reference]",SVGPathElement).forEach(n=>n.style.display="none"),E.selectorQueryAll("[data-live]",SVGPathElement).forEach(n=>{n.style.transform="scale(1.5)"}),window.showFrame=n=>{console.info("ignoring showFrame()",n)}}}
