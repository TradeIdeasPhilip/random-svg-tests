import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as A}from"./client-misc-leadhGo2.js";import{d as H,Q as S,P as M,D as q,m as j,T as v}from"./letters-more-AoRLkaKh.js";import{c as B,R,b as V,r as O,a as D}from"./utility-B4gEaDDG.js";import{l as Q}from"./math-to-path-CuCBKs9Y.js";const C=A("input",HTMLTextAreaElement),d=A("main",SVGElement),k=A("completionRatio",HTMLInputElement);{const t=new v().font,{normal:o}=H(t),s=A("available",HTMLSpanElement);s.innerText=[...o].sort().join(" ")}class y{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,d.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){y.doCleanup(),this.startImpl(),y.#t=this}doCleanup(){}}class W extends y{startImpl(){const t=new v;t.restart();const o=C.value,s=t.addText(o);t.displayText(s,d),d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}class $ extends y{startImpl(){const t=new v;t.restart();const o=C.value,s=t.addText(o);d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const p=v.join(s),e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("handwriting"),d.appendChild(e);let a=.01;p.splitOnMove().forEach(r=>{const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",r.rawPath),e.appendChild(i);const h=a,c=i.getTotalLength();a=h+c,i.style.setProperty("--offset",h.toString()),i.style.setProperty("--length",c.toString())});const l=new AbortController;this.doCleanup=()=>l.abort();const u=a,n=()=>{const r=k.valueAsNumber*u;V(r),e.style.setProperty("--total-position",r.toString())};n(),k.addEventListener("input",n,{signal:l.signal})}static start(){new this().start()}}class z extends y{startImpl(){const t=new v;t.restart();const o=C.value,s=t.addText(o);d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const p=v.join(s),e=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("handwriting","skywriting"),d.appendChild(e);let a=.01;p.splitOnMove().forEach(i=>{const h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",i.rawPath),e.appendChild(h);const c=a,g=h.getTotalLength();a=c+g,h.style.setProperty("--offset",c.toString()),h.style.setProperty("--length",g.toString())});const l=new AbortController;this.doCleanup=()=>l.abort();const n=a+40,r=()=>{const i=k.valueAsNumber*n;V(i),e.style.setProperty("--total-position",i.toString())};r(),k.addEventListener("input",r,{signal:l.signal})}static start(){new this().start()}}function J(f,t){const o=B(f,t),s=1*O;return Math.abs(o)<s}class T extends y{static makeRoughShape(t,o,s){const p=t.commands.map(a=>a instanceof S?a:S.line({x:a.x0,y:a.y0},a)),e=new Array;return t.splitOnMove().forEach(a=>{const l=a.commands,u=l.flatMap((c,g)=>g==0?[]:{x:c.x0,y:c.y0});function n(c,g){const m=o*(g?Math.SQRT1_2:1)*s(),x=s()*Math.PI*2,E=D(m,x),P=c.x+E.x,L=c.y+E.y;return{x:P,y:L,offset:E,initial:c}}const r=l[0],i=[n({x:r.x0,y:r.y0},"½")];u.forEach(c=>{i.push(n(c))});const h=l[l.length-1];if(i.push(n(h)),i.length!=l.length+1||l.length!=u.length+1)throw new Error("wtf");l.forEach((c,g)=>{const m=i[g],x=i[g+1],E=c instanceof S?{x:c.x1,y:c.y1}:Q(m,x,Math.random()),P={x:E.x+(m.offset.x+x.offset.x)/2,y:E.y+(m.offset.y+x.offset.y)/2},L=n(P,"½");if(e.push(new S(m.x,m.y,L.x,L.y,x.x,x.y)),g>0&&J(p.at(e.length-2).outgoingAngle,p.at(e.length-1).incomingAngle)){new M(e).dump();const b=e.pop(),w=e.pop();console.log({previous:w,last:b});const I=w.outgoingAngle+B(w.outgoingAngle,b.incomingAngle)/2,G=S.angles(w.x0,w.y0,w.incomingAngle,w.x,w.y,I);e.push(G);const N=S.angles(b.x0,b.y0,I,b.x,b.y,b.outgoingAngle);e.push(N),console.log({previous1:G,last1:N}),new M(e).dump()}})}),{before:new M(p),after:new M(e)}}static makeRoughFont(t,o){const s=new Map;(o==""||o===void 0)&&(o=R.newSeed());const p=R.create(o);t.forEach((a,l)=>{const u=new q(()=>this.makeRoughShape(a.shape,a.fontMetrics.strokeWidth*1.5,p).after,a.advance,a.fontMetrics);s.set(l,u)});const e=s;return e.seed=o,e}static#t=R.create("[1729402151840,42,2115899219,1537839617]");static#e=[];static makeRough(t){function o({shape0:n,shape1:r},i){const h=[{offset:0,d:n.cssPath},{offset:1,d:r.cssPath}],c=i.animate(h,{duration:1,fill:"both"});return c.pause(),c}const s=[...this.#e],p=[...t],e=[];for(;!(s.length==0||p.length==0||s[0].char!=p[0].char);){const n=s.shift(),r=p.shift();e.push({...r,shape0:n.shape0,shape1:n.shape1,animation:o(n,r.element)})}const a=[];for(;!(s.length==0||p.length==0||s.at(-1).char!=p.at(-1).char);){const n=s.pop(),r=p.pop();e.push({...r,shape0:n.shape0,shape1:n.shape1,animation:o(n,r.element)})}const l=p.map(n=>{const r=T.makeRoughShape(n.shape,n.description.fontMetrics.strokeWidth*1.5,T.#t),i=r.before,h=r.after;return{...n,shape0:i,shape1:h,animation:o({shape0:i,shape1:h},n.element)}}),u=[...e,...l,...a];return this.#e=u,u}startImpl(){const t=new v;t.font=j(15);const o=t.font.get("0").fontMetrics;t.lineHeight=o.bottom-o.capitalTop,t.restart();const s=C.value,p=t.addText(s),e=t.displayText(p,d),a=T.makeRough(e);d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const l=new AbortController;this.doCleanup=()=>l.abort();const u=()=>{const n=k.valueAsNumber;V(n),a.forEach(({animation:r})=>{r.currentTime=n})};u(),k.addEventListener("input",u,{signal:l.signal})}static start(){new this().start()}}C.addEventListener("input",()=>{y.restartCurrent()});function F(){const f=document.querySelector('input[name="type"]:checked')?.id;switch(f){case"simpleType":{W.start();break}case"handwritingType":{new $().start();break}case"skywritingType":{new z().start();break}case"roughType":{new T().start();break}default:throw new Error(`invalid id: ${f}`)}}F();document.querySelectorAll('input[name="type"]').forEach(f=>{f.addEventListener("click",F)});
