import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as w}from"./client-misc-B8CxQsfg.js";import{b as X,s as Y,h as Q,t as O}from"./fourier-shared-DpvWsPe-.js";import{p as j,d as D,b as K,P as U}from"./path-shape-CZZKMsju.js";import{m as s}from"./misc-BHUyxQfl.js";import{g as T,e as Z}from"./utility-Dgy6CMn3.js";function J(){document.body.style.backgroundColor="transparent",w.selectorQueryAll("[data-hide-background]",SVGElement).forEach(c=>c.style.display="none")}function W(){const c=w.selectorQuery("[data-hide-background]",SVGElement);c.parentElement?.append(c)}const N=new URLSearchParams(window.location.search);let H=!1;N.get("hide_background")=="1"?J():N.get("only_background")=="1"&&W();{const t=w.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const tt=1024;class et{constructor(t,e){this.terms=e,t instanceof SVGGElement||(t=w.selectorQuery(t,SVGGElement)),this.#t=w.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(o=>{const n=w.selectorQuery("text",SVGTextElement,o),d=document.createElementNS("http://www.w3.org/2000/svg","text");return d.classList.add("background"),o.insertBefore(d,n),{top:o,spinner:w.selectorQuery(".spinner",SVGPolygonElement,o),text:n,background:d}})}#t;show(t,e){this.#t.forEach((o,n)=>{if(n>=t)o.top.style.display="none";else{o.top.style.display="";const d=this.terms[n];o.background.innerHTML=o.text.innerHTML=d.frequency.toString(),o.spinner.style.transform=`rotate(${e*d.frequency+d.phase+s.FULL_CIRCLE/4}rad)`}})}}function q(c,t){if(c>=t)throw new Error("wtf");const e=s.makeLinear(c,0,t,1);function o(n){if(n<=c)return 0;if(n>=t)return 1;const d=e(n);return Z(d)}return o}let B=()=>{};window.showFrame=c=>{B(c)};class I{constructor(t,e){this.getTransform=e,this.#t=w.selectorQuery(t,SVGGElement),this.#n=w.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=w.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new I("#right",t=>j(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const $=new D;class nt{constructor(t){this.pathString=t,this.samples=X(t,tt),this.terms=Y(this.samples),this.keyframes=s.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t,e=0,o=t-e){const n=this.makeGetPath2(),d=s.makeBoundedLinear(e,0,o,1),x=this.stepCount;function v(f){let l=Math.floor(f/t),a;l<0?(l=0,a=0):l>=x?(l=x-1,a=t):a=f%t;const h=d(a);return{pathString:n(l,h),index:l,t:h}}return v}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],o=this.stepCount,n=f=>Math.max(...t.slice(0,f).map(a=>Math.abs(a.frequency))),d=f=>{const l=n(f);return 8*Math.min(l,50)+7},x=s.initializedArray(o,f=>{const l=e[f],a=e[f+1];if(l==0&&a==1&&t[0].frequency==0){let h=function(g){return`${r.x*g},${r.y*g}`};const r=s.assertNonNullable(Q(t[0])),i=q(0,.5),u=q(0,1);return g=>{const b=u(g),E=h(b),L=i(g),S=h(L);return`M ${E} L ${S}`}}else{const r=.2/Math.abs(t[l].frequency),i=s.makeBoundedLinear(0,-r,1,1+r),u=O(t,l),g=O(t,a-l,l),b=d(a);if(l==0||l==1&&Q(t[0])){const E=Q(t[0])??{x:0,y:0};return L=>{const S=i(L),F=S-r,P=S+r,V=q(F,P),m=Math.min(1,P);if(m<=0)return`M${E.x},${E.y} L${E.x},${E.y}`;{let y=function(C){C=C*m;const M=u(C),R=1-V(C);if(R==0)return M;{const A=g(C);return{x:M.x+R*A.x,y:M.y+R*A.y}}};const p=Math.ceil(Math.max(b,150)*m);return U.glitchFreeParametric(y,p).rawPath}}}else return E=>{const L=i(E),S=q(L-r,L+r);function F(V){const m=u(V),y=1-S(V);if(y==0)return m;{const p=g(V);return{x:m.x+y*p.x,y:m.y+y*p.y}}}return U.glitchFreeParametric(F,b).rawPath}}});function v(f,l){const a=x[f];return a(l)}return v}}class z{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#r,this.#s),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}endTime;#n;#e;#r;#s;#o;constructor(t,e){this.#n=t.base.pathString,this.#e=t.destination,this.#r=t.referenceColor,this.#s=t.liveColor,$.d=this.#n,this.#o=this.#e.getTransform($.getBBox());const o=7500,n=750;this.endTime=o*t.base.stepCount;const d=t.base.makeGetPath1(o,0,o-n),x=new et(e,t.base.terms);this.#t=v=>{const{pathString:f,index:l,t:a}=d(v);this.#e.setLivePath(f),x.show(t.base.keyframes[l+1],a*s.FULL_CIRCLE)}}}function rt(...c){B=t=>{c.forEach(e=>e.show(t))}}let _;setTimeout(()=>{if(H)return;let c=NaN;_=new w.AnimationLoop(t=>{isNaN(c)&&(c=t);const e=t-c;B(e)}),window.animationLoop=_},1);function st(c){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),_?.cancel(),{source:"fourier-smackdown.ts",script:c,seconds:95,devicePixelRatio}}window.initScreenCapture=st;class ot{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class G{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=s.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,o)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new G([...this.pathSoFar,n],this.remainingEdges.toSpliced(o,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,o=new Set;for(const n of this.get(t)){const d=n.slice(0,n.length-1),x=this.#n(d);if(!o.has(x)){yield n,o.add(x);const v=this.#e(d,e).map(f=>this.#n(f));for(const f of v)o.add(f)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const o=new Array;for(let n=1;n<t.length;n++){const d=t[n],x=(d+1)%e,v=T(t,n+1);x==v?o.push(s.initializedArray(t.length,f=>{const l=T(t,f+n);return s.positiveModulo(l-d,e)})):T(t,n-1)==x&&o.push(s.initializedArray(t.length,l=>{const a=T(t,n-l);return s.positiveModulo(a-d,e)}))}return o}static getSamples(){function t(e,...o){return s.initializedArray(e,n=>o.map(d=>new ot(n,(n+d)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=G;function at(){const c=G.getSamples(),t=G.getUnique(c.pentagram);console.log(t,t.constructor.name);for(const e of t);}at();{let c=function(a,h=0){const r=[],i=a.terms,u=i.length,g=7,b=10,E=i.splice(5,3),L=E.splice(h,1);for(r.push(E);r.length<b-2;){let F;r.length<6?F=1:(r.length<9,F=2);const P=i.splice(0,F);if(P.length!=F)throw new Error("wtf");r.push(P)}if(r.splice(g,0,[...i]),r.push(L),console.log(r),r.length!=b)throw new Error("wtf");if(i.length=0,i.length!=0)throw new Error("wtf");const S=a.keyframes;if(S.length=0,S.push(0),r.forEach(F=>{i.push(...F),S.push(i.length)}),i.length!=u)throw new Error("wtf")};class t{constructor(h){throw new Error("wtf")}static points=s.initializedArray(5,h=>{const r=s.FULL_CIRCLE*h/5+s.FULL_CIRCLE/4,i=Math.cos(r),u=Math.sin(r);return{x:i,y:u}});static allPaths=[...G.getUnique(G.getSamples().pentagram)]}class e{constructor(h){throw new Error("wtf")}static points=s.initializedArray(6,h=>{const r=s.FULL_CIRCLE*h/6+s.FULL_CIRCLE/4,i=Math.cos(r),u=Math.sin(r);return{x:i,y:u}});static allPaths=[...G.getUnique(G.getSamples().dodecahedron)];static makePathShape(h){const r=this.allPaths[h],i=K.M(o[0].x,o[0].y);return r.forEach((u,g)=>{if(g==0){if(u!=0)throw new Error("wtf")}else{const{x:b,y:E}=o[u],L=r[g-1];switch(s.positiveModulo(u-L,6)){case 1:{i.arc(0,0,b,E,"cw");break}case 2:case 4:{i.L(b,E);break}case 5:{i.arc(0,0,b,E,"ccw");break}default:throw new Error("wtf")}}}),i.pathShape}}const o=e.points,n=e.allPaths,d=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],x=s.Random.fromString("fourier-smackdown.ts");s.initializedArray(n.length,()=>{const a=x()*3|0,h=d[a];return d.splice(a,1),d.push(h),h});const v=[{color:"#black",destRect:{x:.5,y:.5,width:5,height:5},index:36,colorName:"red"},{color:"black",destRect:{x:5.5,y:3.5,width:5,height:5},index:36,colorName:"white"},{color:"black",destRect:{x:10.5,y:.5,width:5,height:5},index:36,colorName:"blue"}],f=v.map(({index:a})=>{const h=e.makePathShape(a).rawPath;return new nt(h)});console.log(f),c(f[0],0),c(f[1],1),c(f[2],2);const l=new Array;for(const[a,h]of s.zip(v,f)){const{color:r,destRect:i}=a,u=a.colorName??a.color,g=w.selectorQuery(`g.frequencies[data-frequencies="${u}"]`,SVGGElement),b=new I(`[data-fourier-top="${u}"]`,S=>j(S,i,"srcRect fits completely into destRect"));g.style.fill=r;const E={base:h,destination:b,liveColor:r,referenceColor:r},L=new z(E,g);l.push(L),console.log(L)}{let a=function(m,y){const k=[m,m+s.FULL_CIRCLE/3,m-s.FULL_CIRCLE/3].map(A=>P(Math.sin(A)));k.push(0),k.push(V(Math.cos(y)));const C=k.join(" "),R=[C,C,C,"0 0 0 0 1"].join(`
`);i.setAttribute("values",R)},h=function(m){const y=u.map(p=>[]);m.forEach(p=>{if(p.length!=u.length)throw new Error("wtf");p.forEach((k,C)=>{y[C].push(k)})});for(const[p,k]of s.zip(u,y))p.setAttribute("tableValues",k.join(" "))},r=function(m){const y=m/24e4*s.FULL_CIRCLE*2,p=m/24e4*s.FULL_CIRCLE/2;a(y,p)};const i=w.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),u=[w.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),w.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),w.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],S=[[[25,25,112],[70,130,180],[147,112,219],[60,179,113],[199,21,133],[0,206,209],[216,191,216]],[[65,105,225],[204,85,0],[255,160,122],[255,182,193],[255,245,157],[175,238,238]],[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],[[70,100,80],[90,120,100],[110,140,120],[130,160,140],[150,180,160],[170,200,180]]].at(-1),F=s.makeLinear(0,0,255,1);S.forEach(m=>m.forEach((y,p,k)=>k[p]=F(y)));const P=s.makeLinear(-1,-.05,1,.8),V=s.makeLinear(1,0,-1,-.4);window.updateValues=a,h(S),l.push({show:r})}{let a=function(m){let y,p;m<g?(y=b(m),p=E(m)):(y=L(m),p=S(m));const k=`${y}% ${p}%`;u.forEach(C=>C.style.transformOrigin=k)},h=function(m,y,p){const k=(m+y)/2,C=m-k,M=s.FULL_CIRCLE/p;function R(A){return Math.sin(A*M)*C+k}return R},r=function(m){const y=P(m);a(y),V.forEach(({element:p,oscillator:k})=>{const C=k(m);p.style.transform=`rotate(${C}deg)`})};const[i,...u]=w.selectorQueryAll("#starfield rect",SVGRectElement),g=.5,b=s.makeLinear(0,0,g,13/16*100),E=s.makeLinear(0,0,g,3/9*100),L=s.makeBoundedLinear(g,13/16*100,1,8),S=s.makeBoundedLinear(g,3/9*100,1,61),F=s.assertClass(l[0],z).endTime,P=s.makeBoundedLinear(0,0,F,1),V=[{element:u[0],oscillator:h(.5,1.5,15e3)},{element:u[1],oscillator:h(-.5,-1.5,13081)}];if(V.length!=u.length)throw new Error("wtf");l.push({show:r})}if(console.log(l),rt(...l),N.get("thumbnail")=="1"){const a=w.selectorQuery("g#foreground",SVGGElement);H=!0;const h=new Array;Array.from(a.children).forEach(i=>{const u=s.assertClass(i,SVGElement);u.dataset.live===void 0?u.style.display="none":(console.log("live",u.dataset.live),h.push(u))}),B(2e4),w.selectorQueryAll("[data-reference]",SVGPathElement).forEach(i=>i.style.display="none");const r=w.selectorQueryAll("#starfield rect",SVGRectElement);r[0].parentElement.style.transform="scale(3)",r.forEach(i=>{i.style.transformOrigin=`${50/3}% 9%`}),r[1].style.transform="rotate(1.75deg)",r[2].style.transform="rotate(-2deg)",window.showFrame=i=>{console.info("ignoring showFrame()",i)}}}{const c=s.Random.fromString("Starry, Starry Night ðŸŒŒ"),t=w.selectorQuery("[data-favorite]",SVGCircleElement),e=s.makeLinear(0,.025,2,.1);for(let o=0;o<100;o++){const n=s.assertClass(t.cloneNode(!0),SVGCircleElement);n.cx.baseVal.value=c()*16,n.cy.baseVal.value=c()*9,n.r.baseVal.value=e(c()+c()),t.parentElement.append(n)}}
