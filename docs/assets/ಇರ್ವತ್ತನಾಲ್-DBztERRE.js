import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as y}from"./client-misc-B8CxQsfg.js";import{b as K,s as X,h as I,t as B}from"./fourier-shared-BneanVCb.js";import{p as D,d as Z,b as j,P as N}from"./path-shape-DN4hoPl6.js";import{m as c}from"./misc-BHUyxQfl.js";import{g as A,e as J}from"./utility-Dgy6CMn3.js";function W(){document.body.style.backgroundColor="transparent",y.selectorQueryAll("[data-hide-background]",SVGElement).forEach(o=>o.style.display="none")}function Y(){const o=y.selectorQuery("[data-hide-background]",SVGElement);o.parentElement?.append(o)}{const o=c.Random.fromString("Pastel 41"),t=y.selectorQuery("[data-favorite]",SVGCircleElement),e=c.makeLinear(0,.025,2,.15);for(let s=0;s<150;s++){const n=c.assertClass(t.cloneNode(!0),SVGCircleElement);n.cx.baseVal.value=o()*16,n.cy.baseVal.value=o()*9,n.r.baseVal.value=e(o()+o()),t.parentElement.append(n)}}const Q=new URLSearchParams(window.location.search);let H=!1;Q.get("hide_background")=="1"?W():Q.get("only_background")=="1"&&Y();{const t=y.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const tt=1024;class et{#t;constructor(t){t instanceof SVGGElement||(t=y.selectorQuery(t,SVGGElement)),this.#t=y.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(e=>{const s=y.selectorQuery("text",SVGTextElement,e),n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.classList.add("background"),e.insertBefore(n,s),{top:e,spinner:y.selectorQuery(".spinner",SVGPolygonElement,e),text:s,background:n}})}show(t,e){this.#t.forEach((s,n,m)=>{if(n>=t.length)s.top.style.display="none";else{s.top.style.display="";const x=t[n];let b=x.frequency.toString();n==m.length-1&&m.length<t.length&&(b+=", â€¦"),s.background.innerHTML=s.text.innerHTML=b,s.spinner.style.transform=`rotate(${e*x.frequency+x.phase+c.FULL_CIRCLE/4}rad)`}})}}function R(o,t){if(o>=t)throw new Error("wtf");const e=c.makeLinear(o,0,t,1);function s(n){if(n<=o)return 0;if(n>=t)return 1;const m=e(n);return J(m)}return s}let z=()=>{};window.showFrame=o=>{z(o)};class U{constructor(t,e){this.getTransform=e,this.#t=t,this.#n=y.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=y.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new U(y.getById("right",SVGGElement),t=>D(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const $=new Z;class nt{constructor(t,e,s=0,n=e-s){this.stepCount=t,this.period=e,this.#t=c.makeBoundedLinear(s,0,n,1),this.endTime=e*t}#t;endTime;get(t){let e=Math.floor(t/this.period),s;e<0?(e=0,s=0):e>=this.stepCount?(e=this.stepCount-1,s=this.period):s=t%this.period;const n=this.#t(s);return{index:e,t:n}}}class st{constructor(t){this.pathString=t,this.samples=K(t,tt),this.terms=X(this.samples),this.keyframes=c.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t){const e=this.makeGetPath2();function s(n){const{index:m,t:x}=t.get(n);return e(m,x)}return s}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],s=this.stepCount,n=l=>Math.max(...t.slice(0,l).map(P=>Math.abs(P.frequency))),m=l=>{if(l==0)return 8;{const d=n(l);return 8*Math.min(d,50)+7}},x=c.initializedArray(s,l=>{const d=e[l],P=e[l+1];if(d==0&&P==1&&t[0].frequency==0){let v=function(a){return`${w.x*a},${w.y*a}`};const w=c.assertNonNullable(I(t[0])),F=R(0,.5),V=R(0,1);return a=>{const r=V(a),i=v(r),u=F(a),h=v(u);return`M ${i} L ${h}`}}else if(d==P){const v=B(t,d),w=m(P),V=N.glitchFreeParametric(v,w).rawPath;return a=>V}else{const w=.2/Math.abs(t[d].frequency),F=c.makeBoundedLinear(0,-w,1,1+w),V=B(t,d),a=B(t,P-d,d),r=m(P);if(d==0||d==1&&I(t[0])){const i=I(t[0])??{x:0,y:0};return u=>{const h=F(u),E=h-w,p=h+w,S=R(E,p),f=Math.min(1,p);if(f<=0)return`M${i.x},${i.y} L${i.x},${i.y}`;{let g=function(L){L=L*f;const q=V(L),T=1-S(L);if(T==0)return q;{const _=a(L);return{x:q.x+T*_.x,y:q.y+T*_.y}}};const k=Math.ceil(Math.max(r,150)*f);return N.glitchFreeParametric(g,k).rawPath}}}else return i=>{const u=F(i),h=R(u-w,u+w);function E(S){const f=V(S),g=1-h(S);if(g==0)return f;{const k=a(S);return{x:f.x+g*k.x,y:f.y+g*k.y}}}return N.glitchFreeParametric(E,r).rawPath}}});function b(l,d){const P=x[l];return P(d)}return b}}class M{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}timer;#n;#e;#s;#r;#o;base;static PERIOD=7e3;static PAUSE=1e3;constructor(t){this.base=t.base,this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,$.d=this.#n,this.#o=this.#e.getTransform($.getBBox()),this.timer=new nt(t.base.stepCount,M.PERIOD,M.PAUSE);const e=t.base.makeGetPath1(this.timer);this.#t=s=>{const n=e(s);this.#e.setLivePath(n)}}}function rt(...o){z=t=>{o.forEach(e=>e.show(t))}}let O;setTimeout(()=>{if(H)return;let o=NaN;O=new y.AnimationLoop(t=>{isNaN(o)&&(o=t);const e=t-o;z(e)}),window.animationLoop=O},1);function ot(o){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),O?.cancel(),{source:"fourier-smackdown.ts",script:o,seconds:118,devicePixelRatio}}window.initScreenCapture=ot;class at{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class C{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=c.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,s)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new C([...this.pathSoFar,n],this.remainingEdges.toSpliced(s,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,s=new Set;for(const n of this.get(t)){const m=n.slice(0,n.length-1),x=this.#n(m);if(!s.has(x)){yield n,s.add(x);const b=this.#e(m,e).map(l=>this.#n(l));for(const l of b)s.add(l)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const s=new Array;for(let n=1;n<t.length;n++){const m=t[n],x=(m+1)%e,b=A(t,n+1);x==b?s.push(c.initializedArray(t.length,l=>{const d=A(t,l+n);return c.positiveModulo(d-m,e)})):A(t,n-1)==x&&s.push(c.initializedArray(t.length,d=>{const P=A(t,n-d);return c.positiveModulo(P-m,e)}))}return s}static getSamples(){function t(e,...s){return c.initializedArray(e,n=>s.map(m=>new at(n,(n+m)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=C;function it(){const o=C.getSamples(),t=C.getUnique(o.pentagram);console.log(t,t.constructor.name);for(const e of t);}it();{let o=function(a,r,i){const u=r-a,h=i-a,E=2*a,p=2*a;return{x:u,y:h,width:E,height:p}};class t{constructor(r){throw new Error("wtf")}static points=c.initializedArray(5,r=>{const i=c.FULL_CIRCLE*r/5+c.FULL_CIRCLE/4,u=Math.cos(i),h=Math.sin(i);return{x:u,y:h}});static allPaths=[...C.getUnique(C.getSamples().pentagram)]}class e{constructor(r){throw new Error("wtf")}static points=c.initializedArray(6,r=>{const i=c.FULL_CIRCLE*r/6+c.FULL_CIRCLE/4,u=Math.cos(i),h=Math.sin(i);return{x:u,y:h}});static allPaths=[...C.getUnique(C.getSamples().dodecahedron)];static makePathShape(r){const i=this.allPaths[r],u=j.M(s[0].x,s[0].y);return i.forEach((h,E)=>{if(E==0){if(h!=0)throw new Error("wtf")}else{const{x:p,y:S}=s[h],f=i[E-1];switch(c.positiveModulo(h-f,6)){case 1:{u.arc(0,0,p,S,"cw");break}case 2:case 4:{u.L(p,S);break}case 5:{u.arc(0,0,p,S,"ccw");break}default:throw new Error("wtf")}}}),u.pathShape}}const s=e.points,n=e.allPaths,m=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],x=c.Random.fromString("fourier-smackdown.ts");c.initializedArray(n.length,()=>{const a=x()*3|0,r=m[a];return m.splice(a,1),m.push(r),r});let b=56;const l=9/4,d=.8,P=[{color:"n/a",destRect:o(l*d,l,l),index:b},{color:"n/a",destRect:o(l*d,3*l,l),index:b},{color:"n/a",destRect:o(7/2*d,16-7/2,9/2),index:b},{color:"n/a",destRect:o(l*d,3*l,3*l),index:b},{color:"n/a",destRect:o(l*d,l,3*l),index:b}],v=P.map(({index:a})=>{const r=e.makePathShape(a).rawPath;return new st(r)});v.forEach(({terms:a,keyframes:r},i)=>{const u=a.length,h=[],E=10;for(;h.length<E-1;){let g;h.length<6?g=1:g=2;const k=a.splice(0,g);if(k.length!=g)throw new Error("wtf");h.push(k)}const p=[],S=[];h.forEach((g,k)=>{k%3<2?p.push(g):S.unshift(g)});const f=[...p,[...a],...S];if(f.length!=E)throw new Error("wtf");if(f.splice(0,0,...c.initializedArray(i,()=>[])),f.splice(Number.MAX_SAFE_INTEGER,0,...c.initializedArray(4-i,()=>[])),console.log(f),a.length=0,r.length=0,r.push(0),f.forEach((g,k,G)=>{a.push(...g),r.push(a.length)}),a.length!=u)throw new Error("wtf")}),console.log(v);const w=new Array,F=y.selectorQuery("g#foreground",SVGGElement);y.getById("chapterList",SVGTextElement),P.length-1;const V=[{light:"red",dark:"darkRed"},{light:"orange",dark:"darkOrange"},{light:"lime",dark:"green"},{light:"var(--blue)",dark:"darkblue"},{light:"Fuchsia ",dark:"purple"}];for(const[a,r,{light:i,dark:u},h]of c.zip(P,v,V,c.count())){const{destRect:E,search:p}=a,S=p===void 0?document.createElementNS("http://www.w3.org/2000/svg","g"):y.selectorQuery(`g.frequencies[data-frequencies="${p}"]`,SVGGElement),f=p===void 0?F.appendChild(c.assertClass(y.selectorQuery("defs g[data-fourier-top]",SVGGElement).cloneNode(!0),SVGGElement)):y.selectorQuery(`[data-fourier-top="${p}"]`,SVGGElement);f.style.setProperty("--color",i),f.style.setProperty("--blur-color",u);const g=new U(f,L=>D(L,E,"srcRect fits completely into destRect"));f.dataset.liveIndex=h.toString(),S.style.fill=u;const k={base:r,destination:g,liveColor:u,referenceColor:i},G=new M(k);w.push(G),console.log(G)}{let a=function(S){const{index:f,t:g}=u.get(S);g>=1?r.show([],0):r.show(h[f],g*c.FULL_CIRCLE)};const r=new et('[data-frequencies="red"]'),i=c.assertClass(w.at(2),M),u=i.timer,h=new Array,{keyframes:E,terms:p}=i.base;E.forEach((S,f)=>{const g=f-1;if(g>=0){const k=E[g],G=p.slice(k,S);h.push(G)}}),console.log(h),w.push({show:a})}if(console.log(w),rt(...w),Q.get("thumbnail")=="1"){H=!0;const a=new Array;Array.from(F.children).forEach(r=>{const i=c.assertClass(r,SVGElement);i.dataset.live===void 0?i.style.display="none":(console.log("live",i.dataset.live),a.push(i))}),w.forEach((r,i)=>{r.show(8500+950*i)}),y.selectorQueryAll("[data-reference]",SVGPathElement).forEach(r=>r.style.display="none"),y.selectorQueryAll("#new-starfield circle",SVGCircleElement).forEach(r=>{r.style.transform="scale(3)",r.style.transformOrigin=`${r.cx.baseVal.value}px ${r.cy.baseVal.value}px`})}}
