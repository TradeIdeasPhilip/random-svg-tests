import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as w}from"./client-misc-B8CxQsfg.js";import{b as Z,s as J,h as Q,t as _}from"./fourier-shared-DpvWsPe-.js";import{p as H,d as W,b as Y,P as B}from"./path-shape-CZZKMsju.js";import{m as a}from"./misc-BHUyxQfl.js";import{g as q,e as tt}from"./utility-Dgy6CMn3.js";function et(){document.body.style.backgroundColor="transparent",w.selectorQueryAll("[data-hide-background]",SVGElement).forEach(i=>i.style.display="none")}function nt(){const i=w.selectorQuery("[data-hide-background]",SVGElement);i.parentElement?.append(i)}{const i=a.Random.fromString("Pastel 41"),t=w.selectorQuery("[data-favorite]",SVGCircleElement),e=a.makeLinear(0,.025,2,.15);for(let r=0;r<150;r++){const n=a.assertClass(t.cloneNode(!0),SVGCircleElement);n.cx.baseVal.value=i()*16,n.cy.baseVal.value=i()*9,n.r.baseVal.value=e(i()+i()),t.parentElement.append(n)}}const N=new URLSearchParams(window.location.search);let D=!1;N.get("hide_background")=="1"?et():N.get("only_background")=="1"&&nt();{const t=w.selectorQuery("canvas#cache",HTMLCanvasElement).getContext("2d");t.filter="url(#watercolor)";const e=1;t.scale(e,e)}const st=1024;class rt{#t;constructor(t){t instanceof SVGGElement||(t=w.selectorQuery(t,SVGGElement)),this.#t=w.selectorQueryAll("g.frequency",SVGGElement,0,1/0,t).map(e=>{const r=w.selectorQuery("text",SVGTextElement,e),n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.classList.add("background"),e.insertBefore(n,r),{top:e,spinner:w.selectorQuery(".spinner",SVGPolygonElement,e),text:r,background:n}})}show(t,e){this.#t.forEach((r,n,m)=>{if(n>=t.length)r.top.style.display="none";else{r.top.style.display="";const C=t[n];let F=C.frequency.toString();n==m.length-1&&m.length<t.length&&(F+=", â€¦"),r.background.innerHTML=r.text.innerHTML=F,r.spinner.style.transform=`rotate(${e*C.frequency+C.phase+a.FULL_CIRCLE/4}rad)`}})}}function T(i,t){if(i>=t)throw new Error("wtf");const e=a.makeLinear(i,0,t,1);function r(n){if(n<=i)return 0;if(n>=t)return 1;const m=e(n);return tt(m)}return r}let z=()=>{};window.showFrame=i=>{z(i)};class ${constructor(t,e){this.getTransform=e,this.#t=t,this.#n=w.selectorQuery("[data-reference]",SVGPathElement,this.#t),this.#e=w.selectorQueryAll("[data-live]",SVGPathElement,1,1/0,this.#t)}#t;#n;#e;hide(){this.#t.style.display="none"}show(t,e){this.#t.style.display="",this.#n.style.stroke=t}setReferencePath(t){this.#n.setAttribute("d",t)}setLivePath(t){this.#e.forEach(e=>e.setAttribute("d",t))}setTransform(t){const e=t.a;this.#t.style.transform=t.toString(),this.#t.style.setProperty("--path-scale",e.toString())}static right=new $(w.getById("right",SVGGElement),t=>H(t,{x:1,y:1,width:14,height:7},"srcRect fits completely into destRect",1))}const O=new W;class ot{constructor(t,e,r=0,n=e-r){this.stepCount=t,this.period=e,this.#t=a.makeBoundedLinear(r,0,n,1),this.endTime=e*t}#t;endTime;get(t){let e=Math.floor(t/this.period),r;e<0?(e=0,r=0):e>=this.stepCount?(e=this.stepCount-1,r=this.period):r=t%this.period;const n=this.#t(r);return{index:e,t:n}}}class at{constructor(t){this.pathString=t,this.samples=Z(t,st),this.terms=J(this.samples),this.keyframes=a.initializedArray(21,e=>e)}samples;terms;keyframes;get stepCount(){return this.keyframes.length-1}makeGetPath1(t){const e=this.makeGetPath2();function r(n){const{index:m,t:C}=t.get(n);return e(m,C)}return r}makeGetPath2(){const t=[...this.terms],e=[...this.keyframes],r=this.stepCount,n=d=>Math.max(...t.slice(0,d).map(k=>Math.abs(k.frequency))),m=d=>{if(d==0)return 8;{const y=n(d);return 8*Math.min(y,50)+7}},C=a.initializedArray(r,d=>{const y=e[d],k=e[d+1];if(y==0&&k==1&&t[0].frequency==0){let G=function(s){return`${b.x*s},${b.y*s}`};const b=a.assertNonNullable(Q(t[0])),A=T(0,.5),u=T(0,1);return s=>{const h=u(s),c=G(h),o=A(s),f=G(o);return`M ${c} L ${f}`}}else if(y==k){const G=_(t,y),b=m(k),u=B.glitchFreeParametric(G,b).rawPath;return s=>u}else{const b=.2/Math.abs(t[y].frequency),A=a.makeBoundedLinear(0,-b,1,1+b),u=_(t,y),s=_(t,k-y,y),h=m(k);if(y==0||y==1&&Q(t[0])){const c=Q(t[0])??{x:0,y:0};return o=>{const f=A(o),p=f-b,l=f+b,S=T(p,l),g=Math.min(1,l);if(g<=0)return`M${c.x},${c.y} L${c.x},${c.y}`;{let E=function(x){x=x*g;const L=u(x),v=1-S(x);if(v==0)return L;{const V=s(x);return{x:L.x+v*V.x,y:L.y+v*V.y}}};const P=Math.ceil(Math.max(h,150)*g);return B.glitchFreeParametric(E,P).rawPath}}}else return c=>{const o=A(c),f=T(o-b,o+b);function p(S){const g=u(S),E=1-f(S);if(E==0)return g;{const P=s(S);return{x:g.x+E*P.x,y:g.y+E*P.y}}}return B.glitchFreeParametric(p,h).rawPath}}});function F(d,y){const k=C[d];return k(y)}return F}}class j{hide(){this.#e.hide()}#t;show(t){this.#e.show(this.#s,this.#r),this.#e.setReferencePath(this.#n),this.#e.setTransform(this.#o),this.#t(t)}timer;#n;#e;#s;#r;#o;base;constructor(t){this.base=t.base,this.#n=t.base.pathString,this.#e=t.destination,this.#s=t.referenceColor,this.#r=t.liveColor,O.d=this.#n,this.#o=this.#e.getTransform(O.getBBox());const e=6e3,r=750;this.timer=new ot(t.base.stepCount,e,r);const n=t.base.makeGetPath1(this.timer);this.#t=m=>{const C=n(m);this.#e.setLivePath(C)}}}function it(...i){z=t=>{i.forEach(e=>e.show(t))}}let U;setTimeout(()=>{if(D)return;let i=NaN;U=new w.AnimationLoop(t=>{isNaN(i)&&(i=t);const e=t-i;z(e)}),window.animationLoop=U},1);function ct(i){return document.querySelectorAll("[data-hideBeforeScreenshot]").forEach(t=>{if(!(t instanceof SVGElement||t instanceof HTMLElement))throw new Error("wtf");t.style.display="none"}),U?.cancel(),{source:"fourier-smackdown.ts",script:i,seconds:110,devicePixelRatio}}window.initScreenCapture=ct;class lt{constructor(t,e){this.vertex1=t,this.vertex2=e}has(t){return t==this.vertex1||t==this.vertex2}other(t){if(this.vertex1==t)return this.vertex2;if(this.vertex2==t)return this.vertex1}}class M{constructor(t,e){this.pathSoFar=t,this.remainingEdges=e}oneStep(){const t=a.assertNonNullable(this.pathSoFar.at(-1));return this.remainingEdges.flatMap((e,r)=>{const n=e.other(t);return n===void 0||this.pathSoFar.length==1&&n!=1?[]:new M([...this.pathSoFar,n],this.remainingEdges.toSpliced(r,1))})}*#t(){if(this.remainingEdges.length==0)yield this.pathSoFar;else{const t=this.oneStep();for(const e of t)yield*e.#t()}}static*get(t){yield*new this([0],t).#t()}static*getUnique(t){const e=Math.max(...t.map(n=>Math.max(n.vertex1,n.vertex2)))+1,r=new Set;for(const n of this.get(t)){const m=n.slice(0,n.length-1),C=this.#n(m);if(!r.has(C)){yield n,r.add(C);const F=this.#e(m,e).map(d=>this.#n(d));for(const d of F)r.add(d)}}}static#n(t){return String.fromCharCode(...t.map(e=>e+65))}static#e(t,e){const r=new Array;for(let n=1;n<t.length;n++){const m=t[n],C=(m+1)%e,F=q(t,n+1);C==F?r.push(a.initializedArray(t.length,d=>{const y=q(t,d+n);return a.positiveModulo(y-m,e)})):q(t,n-1)==C&&r.push(a.initializedArray(t.length,y=>{const k=q(t,n-y);return a.positiveModulo(k-m,e)}))}return r}static getSamples(){function t(e,...r){return a.initializedArray(e,n=>r.map(m=>new lt(n,(n+m)%e))).flat()}return{pentagram:t(5,1,2),dodecahedron:t(6,1,2),square:t(4,1),hex:t(10,1)}}}window.Progress=M;function ht(){const i=M.getSamples(),t=M.getUnique(i.pentagram);console.log(t,t.constructor.name);for(const e of t);}ht();{let i=function(u,s,h){const c=s-u,o=h-u,f=2*u,p=2*u;return{x:c,y:o,width:f,height:p}};class t{constructor(s){throw new Error("wtf")}static points=a.initializedArray(5,s=>{const h=a.FULL_CIRCLE*s/5+a.FULL_CIRCLE/4,c=Math.cos(h),o=Math.sin(h);return{x:c,y:o}});static allPaths=[...M.getUnique(M.getSamples().pentagram)]}class e{constructor(s){throw new Error("wtf")}static points=a.initializedArray(6,s=>{const h=a.FULL_CIRCLE*s/6+a.FULL_CIRCLE/4,c=Math.cos(h),o=Math.sin(h);return{x:c,y:o}});static allPaths=[...M.getUnique(M.getSamples().dodecahedron)];static makePathShape(s){const h=this.allPaths[s],c=Y.M(r[0].x,r[0].y);return h.forEach((o,f)=>{if(f==0){if(o!=0)throw new Error("wtf")}else{const{x:p,y:l}=r[o],S=h[f-1];switch(a.positiveModulo(o-S,6)){case 1:{c.arc(0,0,p,l,"cw");break}case 2:case 4:{c.L(p,l);break}case 5:{c.arc(0,0,p,l,"ccw");break}default:throw new Error("wtf")}}}),c.pathShape}}const r=e.points,n=e.allPaths,m=[{light:"var(--pastel-blue)",dark:"var(--darker-blue)"},{light:"var(--pastel-lavender)",dark:"var(--darker-purple)"},{light:"var(--pastel-pink)",dark:"var(--darker-pink)"},{light:"var(--pastel-mint)",dark:"var(--darker-teal)"},{light:"var(--pastel-coral)",dark:"var(--darker-coral)"}],C=a.Random.fromString("fourier-smackdown.ts");a.initializedArray(n.length,()=>{const u=C()*3|0,s=m[u];return m.splice(u,1),m.push(s),s});let F=53;const d=9/4,y=.8,k=[{color:"n/a",destRect:i(d*y,d,d),index:F},{color:"n/a",destRect:i(d*y,3*d,d),index:F},{color:"n/a",destRect:i(7/2*y,16-7/2,9/2),index:F},{color:"n/a",destRect:i(d*y,3*d,3*d),index:F},{color:"n/a",destRect:i(d*y,d,3*d),index:F}],G=k.map(({index:u})=>{const s=e.makePathShape(u).rawPath;return new at(s)});{const u=new Map;G.forEach(o=>o.terms.forEach(({frequency:f,amplitude:p})=>{let l=u.get(f);l||(l=new Array,u.set(f,l)),l.push(p)}));const s=Array.from(u.entries(),([o,f])=>({frequency:o,amplitude:f.sort((p,l)=>p-l)[2]??0}));s.sort((o,f)=>f.amplitude-o.amplitude);const h=s[0].amplitude*.05,c=s.filter(({amplitude:o})=>o>h).slice(0,6);console.log(c),G.forEach(({terms:o,keyframes:f},p)=>{const l=[];c.forEach(({frequency:E},P)=>{const R=o.findIndex(x=>x.frequency==E);R==-1?l.push([{amplitude:0,phase:0,frequency:E}]):l.push(o.splice(R,1))});const S=11;for(;l.length<S-1;){let E;l.length<6?E=1:l.length<9?E=3:E=10;const P=o.splice(0,E);if(P.length!=E)throw new Error("wtf");l.push(P)}let g;switch(p){case 0:case 4:{g=c.length+1;break}case 1:case 3:{g=c.length+2;break}case 2:{g=c.length+3;break}default:throw new Error("wtf")}if(g=c.length+2,l.splice(g,0,[...o]),l.length!=S)throw new Error("wtf");l.splice(0,0,...a.initializedArray(p,()=>[])),l.splice(Number.MAX_SAFE_INTEGER,0,...a.initializedArray(4-p,()=>[])),console.log(l),o.length=0,f.length=0,f.push(0),l.forEach(E=>{o.push(...E),f.push(o.length)})})}console.log(G);const b=new Array,A=w.selectorQuery("g#foreground",SVGGElement);w.getById("chapterList",SVGTextElement),k.length-1;for(const[u,s,{light:h,dark:c},o]of a.zip(k,G,m,a.count())){const{destRect:f,search:p}=u,l=p===void 0?document.createElementNS("http://www.w3.org/2000/svg","g"):w.selectorQuery(`g.frequencies[data-frequencies="${p}"]`,SVGGElement),S=p===void 0?A.appendChild(a.assertClass(w.selectorQuery("defs g[data-fourier-top]",SVGGElement).cloneNode(!0),SVGGElement)):w.selectorQuery(`[data-fourier-top="${p}"]`,SVGGElement);S.style.setProperty("--color",h),S.style.setProperty("--blur-color",c);const g=new $(S,R=>H(R,f,"srcRect fits completely into destRect"));S.dataset.liveIndex=o.toString(),l.style.fill=c;const E={base:s,destination:g,liveColor:c,referenceColor:h},P=new j(E);b.push(P),console.log(P)}{let u=function(l){const{index:S,t:g}=c.get(l);g>=1?s.show([],0):s.show(o[S],g*a.FULL_CIRCLE)};const s=new rt('[data-frequencies="red"]'),h=a.assertClass(b.at(2),j),c=h.timer,o=new Array,{keyframes:f,terms:p}=h.base;f.forEach((l,S)=>{const g=S-1;if(g>=0){const E=f[g],P=p.slice(E,l);o.push(P)}}),console.log(o),b.push({show:u})}{let u=function(x,L){const V=[x,x+a.FULL_CIRCLE/3,x-a.FULL_CIRCLE/3].map(X=>P(Math.sin(X)));V.push(0),V.push(R(Math.cos(L)));const I=V.join(" "),K=[I,I,I,"0 0 0 0 1"].join(`
`);c.setAttribute("values",K)},s=function(x){const L=o.map(v=>[]);x.forEach(v=>{if(v.length!=o.length)throw new Error("wtf");v.forEach((V,I)=>{L[I].push(V)})});for(const[v,V]of a.zip(o,L))v.setAttribute("tableValues",V.join(" "))},h=function(x){const L=x/24e4*a.FULL_CIRCLE*2,v=x/24e4*a.FULL_CIRCLE/2;u(L,v)};const c=w.selectorQuery("#lava-lamp feColorMatrix:first-of-type",SVGFEColorMatrixElement),o=[w.selectorQuery('#lava-lamp feFuncR[type="discrete"]',SVGFEFuncRElement),w.selectorQuery('#lava-lamp feFuncG[type="discrete"]',SVGFEFuncGElement),w.selectorQuery('#lava-lamp feFuncB[type="discrete"]',SVGFEFuncBElement)],g=[[[25,25,112],[70,130,180],[147,112,219],[60,179,113],[199,21,133],[0,206,209],[216,191,216]],[[65,105,225],[204,85,0],[255,160,122],[255,182,193],[255,245,157],[175,238,238]],[[80,40,100],[100,60,120],[120,80,140],[140,100,160],[160,120,180],[180,140,200]],[[70,100,80],[90,120,100],[110,140,120],[130,160,140],[150,180,160],[170,200,180]]].at(-1),E=a.makeLinear(0,0,255,1);g.forEach(x=>x.forEach((L,v,V)=>V[v]=E(L)));const P=a.makeLinear(-1,-.05,1,.8),R=a.makeLinear(1,0,-1,-.4);window.updateValues=u,s(g),b.push({show:h})}if(console.log(b),it(...b),N.get("thumbnail")=="1"){D=!0;const u=new Array;Array.from(A.children).forEach(s=>{const h=a.assertClass(s,SVGElement);h.dataset.live===void 0?h.style.display="none":(console.log("live",h.dataset.live),u.push(h))}),b.forEach((s,h)=>{s.show(8500+950*h)}),w.selectorQueryAll("[data-reference]",SVGPathElement).forEach(s=>s.style.display="none"),w.selectorQueryAll("#new-starfield circle",SVGCircleElement).forEach(s=>{s.style.transform="scale(3)",s.style.transformOrigin=`${s.cx.baseVal.value}px ${s.cy.baseVal.value}px`})}}
