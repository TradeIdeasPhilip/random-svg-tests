import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as A}from"./client-misc-leadhGo2.js";import{d as j,Q as k,P as G,D,T as b}from"./letters-more-oRcWgNdf.js";import{R,b as V,f as C,r as O,a as Q,c as N}from"./utility-LPFHNjBe.js";import{l as W}from"./math-to-path-DkA6OA2_.js";const L=A("input",HTMLTextAreaElement),g=A("main",SVGElement),S=A("completionRatio",HTMLInputElement);{const t=new b().font,{normal:e}=j(t),n=A("available",HTMLSpanElement);n.innerText=[...e].sort().join(" ")}class y{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,g.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){y.doCleanup(),this.startImpl(),y.#t=this}doCleanup(){}}class $ extends y{startImpl(){const t=new b;t.restart();const e=L.value,n=t.addText(e);t.displayText(n,g),g.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}class z extends y{startImpl(){const t=new b;t.restart();const e=L.value,n=t.addText(e);g.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const c=b.join(n),o=document.createElementNS("http://www.w3.org/2000/svg","g");o.classList.add("handwriting"),g.appendChild(o);let h=.01;c.splitOnMove().forEach(a=>{const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d",a.rawPath),o.appendChild(r);const u=h,i=r.getTotalLength();h=u+i,r.style.setProperty("--offset",u.toString()),r.style.setProperty("--length",i.toString())});const l=new AbortController;this.doCleanup=()=>l.abort();const f=h,s=()=>{const a=S.valueAsNumber*f;V(a),o.style.setProperty("--total-position",a.toString())};s(),S.addEventListener("input",s,{signal:l.signal})}static start(){new this().start()}}class J extends y{startImpl(){const t=new b;t.restart();const e=L.value,n=t.addText(e);g.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const c=b.join(n),o=document.createElementNS("http://www.w3.org/2000/svg","g");o.classList.add("handwriting","skywriting"),g.appendChild(o);let h=.01;c.splitOnMove().forEach(r=>{const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",r.rawPath),o.appendChild(u);const i=h,d=u.getTotalLength();h=i+d,u.style.setProperty("--offset",i.toString()),u.style.setProperty("--length",d.toString())});const l=new AbortController;this.doCleanup=()=>l.abort();const s=h+40,a=()=>{const r=S.valueAsNumber*s;V(r),o.style.setProperty("--total-position",r.toString())};a(),S.addEventListener("input",a,{signal:l.signal})}static start(){new this().start()}}function B(p,t){p=N(p,C),t=N(p,C);let e=t-p;const n=C/2;if(e>n?e-=C:e<-n&&(e+=C),Math.abs(e)>n)throw new Error("wtf");return e}function K(p,t){const e=B(p,t),n=1*O;return Math.abs(e)<n}class T extends y{static makeRoughShape(t,e,n){const c=new Array,o=new Array;return t.splitOnMove().forEach(h=>{const l=h.commands,f=l.flatMap((i,d)=>d==0?[]:{x:i.x0,y:i.y0});function s(i,d){const m=e*(d?Math.SQRT1_2:1)*n(),w=n()*Math.PI*2,v=Q(m,w),P=i.x+v.x,M=i.y+v.y;return{x:P,y:M,offset:v,initial:i}}const a=l[0],r=[s({x:a.x0,y:a.y0},"½")];f.forEach(i=>{r.push(s(i))});const u=l[l.length-1];if(r.push(s(u)),r.length!=l.length+1||l.length!=f.length+1)throw new Error("wtf");l.forEach((i,d)=>{const m=r[d],w=r[d+1],v=i instanceof k?{x:i.x1,y:i.y1}:W(m,w,Math.random()),P={x:v.x+(m.offset.x+w.offset.x)/2,y:v.y+(m.offset.y+w.offset.y)/2},M=s(P,"½");if(o.push(new k(m.x,m.y,M.x,M.y,w.x,w.y)),c.push(k.line(m.initial,w.initial)),d>0&&K(c.at(-2).outgoingAngle,c.at(-1).incomingAngle)){const E=o.pop(),x=o.pop(),I=x.outgoingAngle+B(x.outgoingAngle,E.incomingAngle)/2,F=k.angles(x.x0,x.y0,x.incomingAngle,x.x,x.y,I);o.push(F);const H=k.angles(E.x0,E.y0,I,E.x,E.y,E.outgoingAngle);o.push(H)}})}),{before:new G(c),after:new G(o)}}static makeRoughFont(t,e){const n=new Map;(e==""||e===void 0)&&(e=R.newSeed());const c=R.create(e);t.forEach((h,l)=>{const f=new D(()=>this.makeRoughShape(h.shape,h.fontMetrics.strokeWidth*1.5,c).after,h.advance,h.fontMetrics);n.set(l,f)});const o=n;return o.seed=e,o}static#t=R.create("[1729026770590,42,394283687,1185765695]");static#e=[];static makeRough(t){function e({shape0:s,shape1:a},r){const u=[{offset:0,d:s.cssPath},{offset:1,d:a.cssPath}],i=r.animate(u,{duration:1,fill:"both"});return i.pause(),i}const n=[...this.#e],c=[...t],o=[];for(;!(n.length==0||c.length==0||n[0].char!=c[0].char);){const s=n.shift(),a=c.shift();o.push({...a,shape0:s.shape0,shape1:s.shape1,animation:e(s,a.element)})}const h=[];for(;!(n.length==0||c.length==0||n.at(-1).char!=c.at(-1).char);){const s=n.pop(),a=c.pop();o.push({...a,shape0:s.shape0,shape1:s.shape1,animation:e(s,a.element)})}const l=c.map(s=>{const a=T.makeRoughShape(s.shape,s.description.fontMetrics.strokeWidth*1.5,T.#t),r=a.before,u=a.after;return{...s,shape0:r,shape1:u,animation:e({shape0:r,shape1:u},s.element)}}),f=[...o,...l,...h];return this.#e=f,f}startImpl(){const t=new b;t.restart();const e=L.value,n=t.addText(e),c=t.displayText(n,g),o=T.makeRough(c);g.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const h=new AbortController;this.doCleanup=()=>h.abort();const l=()=>{const f=S.valueAsNumber;V(f),o.forEach(({animation:s})=>{s.currentTime=f})};l(),S.addEventListener("input",l,{signal:h.signal})}static start(){new this().start()}}L.addEventListener("input",()=>{y.restartCurrent()});function q(){const p=document.querySelector('input[name="type"]:checked')?.id;switch(p){case"simpleType":{$.start();break}case"handwritingType":{new z().start();break}case"skywritingType":{new J().start();break}case"roughType":{new T().start();break}default:throw new Error(`invalid id: ${p}`)}}q();document.querySelectorAll('input[name="type"]').forEach(p=>{p.addEventListener("click",q)});
