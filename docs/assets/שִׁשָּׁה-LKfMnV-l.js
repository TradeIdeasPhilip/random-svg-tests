import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as x,m as w}from"./client-misc-CqK8Npau.js";import{d as M,D as A,m as P,T as f}from"./letters-more-DvklmhjG.js";import{c as k}from"./path-debugger-widget-BBVk7XcM.js";import{m as E}from"./rough-lib-DZc4J2vG.js";import"./path-shape-BXOkZTxi.js";import"./math-to-path-D11qeOG5.js";const y=x("input",HTMLTextAreaElement),d=x("main",SVGElement),b=x("completionRatio",HTMLInputElement);{const t=new f().font,{normal:n}=M(t),o=x("available",HTMLSpanElement);o.innerText=[...n].sort().join(" ")}const L=k();L.insertBefore("debuggerBefore");const T=k();T.insertBefore("debuggerAfter");class g{static#t;static doCleanup(){this.#t?.doCleanup(),this.#t=void 0,d.innerHTML=""}static restartCurrent(){const t=this.#t;t&&(this.doCleanup(),t.start())}start(){g.doCleanup(),this.startImpl(),g.#t=this}doCleanup(){}}class V extends g{startImpl(){const t=new f;t.restart();const n=y.value,o=t.addText(n);t.displayText(o,d),d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom}static start(){new this().start()}}class B extends g{startImpl(){const t=new f;t.restart();const n=y.value,o=t.addText(n);d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const i=f.join(o),a=document.createElementNS("http://www.w3.org/2000/svg","g");a.classList.add("handwriting"),d.appendChild(a);let r=.01;i.splitOnMove().forEach(s=>{const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",s.rawPath),a.appendChild(c);const l=r,u=c.getTotalLength();r=l+u,c.style.setProperty("--offset",l.toString()),c.style.setProperty("--length",u.toString())});const p=new AbortController;this.doCleanup=()=>p.abort();const h=r,e=()=>{const s=b.valueAsNumber*h;w.assertFinite(s),a.style.setProperty("--total-position",s.toString())};e(),b.addEventListener("input",e,{signal:p.signal})}static start(){new this().start()}}class F extends g{startImpl(){const t=new f;t.restart();const n=y.value,o=t.addText(n);d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const i=f.join(o),a=document.createElementNS("http://www.w3.org/2000/svg","g");a.classList.add("handwriting","skywriting"),d.appendChild(a);let r=.01;i.splitOnMove().forEach(c=>{const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",c.rawPath),a.appendChild(l);const u=r,S=l.getTotalLength();r=u+S,l.style.setProperty("--offset",u.toString()),l.style.setProperty("--length",S.toString())});const p=new AbortController;this.doCleanup=()=>p.abort();const e=r+40,s=()=>{const c=b.valueAsNumber*e;w.assertFinite(c),a.style.setProperty("--total-position",c.toString())};s(),b.addEventListener("input",s,{signal:p.signal})}static start(){new this().start()}}class v extends g{static makeRoughFont(t,n){const o=new Map;(n==""||n===void 0)&&(n=w.Random.newSeed());const i=w.Random.create(n);t.forEach((r,p)=>{const h=new A(()=>E(r.shape,r.fontMetrics.strokeWidth*1.5,i).after,r.advance,r.fontMetrics);o.set(p,h)});const a=o;return a.seed=n,a}static#t=w.Random.create("[1729402151840,42,2115899219,1537839617]");static#e=[];static makeRough(t){function n({shape0:e,shape1:s},c){const l=[{offset:0,d:e.cssPath},{offset:1,d:s.cssPath}],u=c.animate(l,{duration:1,fill:"both"});return u.pause(),u}const o=[...this.#e],i=[...t],a=[];for(;!(o.length==0||i.length==0||o[0].char!=i[0].char);){const e=o.shift(),s=i.shift();a.push({...s,shape0:e.shape0,shape1:e.shape1,animation:n(e,s.element)})}const r=[];for(;!(o.length==0||i.length==0||o.at(-1).char!=i.at(-1).char);){const e=o.pop(),s=i.pop();a.push({...s,shape0:e.shape0,shape1:e.shape1,animation:n(e,s.element)})}const p=i.map(e=>{const s=E(e.shape,e.description.fontMetrics.strokeWidth*1.5,v.#t),c=s.before,l=s.after;return{...e,shape0:c,shape1:l,animation:n({shape0:c,shape1:l},e.element)}}),h=[...a,...p,...r];return this.#e=h,h}startImpl(){const t=new f;t.font=P(7);const n=t.font.get("0").fontMetrics;t.lineHeight=n.bottom-n.capitalTop,t.restart();const o=y.value,i=t.addText(o),a=t.displayText(i,d),r=v.makeRough(a);r.forEach(e=>{e.element.addEventListener("click",()=>{console.log(e),L.pathShape=e.shape0,T.pathShape=e.shape1,navigator.clipboard.writeText(JSON.stringify(e.shape1))}),e.element.style.cursor="grab"}),d.ownerSVGElement.viewBox.baseVal.height=t.baseline+t.font.get("0").fontMetrics.bottom;const p=new AbortController;this.doCleanup=()=>p.abort();const h=()=>{const e=b.valueAsNumber;w.assertFinite(e),r.forEach(({animation:s})=>{s.currentTime=e})};h(),b.addEventListener("input",h,{signal:p.signal})}static start(){new this().start()}}y.addEventListener("input",()=>{g.restartCurrent()});function C(){const m=document.querySelector('input[name="type"]:checked')?.id;switch(m){case"simpleType":{V.start();break}case"handwritingType":{new B().start();break}case"skywritingType":{new F().start();break}case"roughType":{new v().start();break}default:throw new Error(`invalid id: ${m}`)}}C();document.querySelectorAll('input[name="type"]').forEach(m=>{m.addEventListener("click",C)});
