import{m as c}from"./client-misc-CqK8Npau.js";class F{constructor(t,s,e,n){this.x0=t,this.y0=s,this.x=e,this.y=n,c.assertFinite(t,s,e,n),this.asString=`L ${e},${n}`,this.outgoingAngle=this.incomingAngle=Math.atan2(n-s,e-t)}toJSON(){return{command:"L",x0:this.x0,y0:this.y0,x:this.x,y:this.y}}incomingAngle;outgoingAngle;command="L";asString;translate(t,s){return new F(this.x0+t,this.y0+s,this.x+t,this.y+s)}toCubic(){return new M(this.x0,this.y0,c.lerp(this.x0,this.x,1/3),c.lerp(this.y0,this.y,1/3),c.lerp(this.x0,this.x,2/3),c.lerp(this.y0,this.y,2/3),this.x,this.y)}}class v{constructor(t,s,e,n,r,o,i){this.x0=t,this.y0=s,this.x1=e,this.y1=n,this.x=r,this.y=o,this.creationInfo=i,c.assertFinite(t,s,e,n,r,o),this.asString=`Q ${e},${n} ${r},${o}`}static line(t,s,e,n,r){return new this(t,s,(t+e)/2,(s+n)/2,e,n,r)}static line4(t,s,e,n){return this.line(t,s,e,n,{source:"line"})}static line2(t,s){return this.line4(t.x,t.y,s.x,s.y)}static angles(t,s,e,n,r,o){c.assertFinite(t,s,e,n,r,o);const i=k({x0:t,y0:s,angle:e},{x0:n,y0:r,angle:o+Math.PI});return i?new this(t,s,i.x,i.y,n,r,{source:"angles",success:!0,angle:o,angle0:e}):this.line(t,s,n,r,{source:"angles",success:!1,angle:o,angle0:e})}newAngles(t,s){return t??=this.requestedIncomingAngle,s??=this.requestedOutgoingAngle,v.angles(this.x0,this.y0,t,this.x,this.y,s)}toJSON(){return{command:"Q",x0:this.x0,y0:this.y0,x1:this.x1,y1:this.y1,x:this.x,y:this.y,creationInfo:this.creationInfo}}static controlPoints(t,s,e,n,r,o){return new this(t,s,e,n,r,o,{source:"controlPoints"})}get incomingAngle(){return Math.atan2(this.y1-this.y0,this.x1-this.x0)}get outgoingAngle(){return Math.atan2(this.y-this.y1,this.x-this.x1)}get requestedIncomingAngle(){return this.creationInfo.source=="angles"?this.creationInfo.angle0:this.incomingAngle}get requestedOutgoingAngle(){return this.creationInfo.source=="angles"?this.creationInfo.angle:this.outgoingAngle}command="Q";asString;translate(t,s){return v.controlPoints(this.x0+t,this.y0+s,this.x1+t,this.y1+s,this.x+t,this.y+s)}toCubic(){return new M(this.x0,this.y0,c.lerp(this.x0,this.x1,2/3),c.lerp(this.y0,this.y1,2/3),c.lerp(this.x,this.x1,2/3),c.lerp(this.y,this.y1,2/3),this.x,this.y)}}class M{constructor(t,s,e,n,r,o,i,a){this.x0=t,this.y0=s,this.x1=e,this.y1=n,this.x2=r,this.y2=o,this.x=i,this.y=a,c.assertFinite(t,s,e,n,r,o,i,a),this.asString=`C ${e},${n} ${r},${o} ${i},${a}`}reverse(){return new M(this.x,this.y,this.x2,this.y2,this.x1,this.y1,this.x0,this.y0)}static relative(t,s,e,n,r,o,i,a){return new this(t,s,e+t,n+s,r+t,o+s,i+t,a+s)}get incomingAngle(){return Math.atan2(this.y1-this.y0,this.x1-this.x0)}get outgoingAngle(){return Math.atan2(this.y-this.y2,this.x-this.x2)}command="C";asString;translate(t,s){return new M(this.x0+t,this.y0+s,this.x1+t,this.y1+s,this.x2+t,this.y2+s,this.x+t,this.y+s)}toCubic(){return this}}class N{get commands(){return this.#t}addCommand(t){this.#t.push(t),this.#s=void 0}addCommands(t){return t.forEach(s=>this.addCommand(s)),this}static fromStrings(t){let s=t.join(" ");const e=[];let n;for(;s=s.replace(/^ */,""),s!="";){let r=b.exec(s);if(r){const o=c.parseFloatX(r[1]),i=c.parseFloatX(r[2]);if(o===void 0||i===void 0)throw console.error(r,o,i,this),new Error("wtf");n&&e.push(n),n=this.M(o,i),s=r[3];continue}if(n){if(r=X.exec(s),r){const o=c.parseFloatX(r[1]),i=c.parseFloatX(r[2]);if(o===void 0||i===void 0)throw console.error(r,o,i,this),new Error("wtf");n=n.L(o,i),s=r[3];continue}if(r=R.exec(s),r){const o=c.parseFloatX(r[1]),i=c.parseFloatX(r[2]),a=c.parseFloatX(r[3]),u=c.parseFloatX(r[4]);if(o===void 0||i===void 0||a===void 0||u===void 0)throw console.error(r,o,i,a,u,this),new Error("wtf");n=n.Q(o,i,a,u),s=r[5];continue}if(r=L.exec(s),r){const o=c.parseFloatX(r[1]),i=c.parseFloatX(r[2]),a=c.parseFloatX(r[3]),u=c.parseFloatX(r[4]),g=c.parseFloatX(r[5]),l=c.parseFloatX(r[6]);if(o===void 0||i===void 0||a===void 0||u===void 0||g===void 0||l===void 0)throw console.error(r,o,i,a,u,g,l,this),new Error("wtf");n=n.C(o,i,a,u,g,l),s=r[7];continue}}throw console.error(s),new Error("wtf")}return n&&e.push(n),e}static M(t,s){const e=new N;return e.M(t,s),e}#t=[];get pathShape(){return new p(this.#t)}#s;M(t,s,e=NaN){return c.assertFinite(t,s),this.#s={x:t,y:s,outgoingAngle:e},this}previous(){return this.#s??this.#t.at(-1)}H(t){const s=this.previous();return this.addCommand(new F(s.x,s.y,t,s.y)),this}V(t){const s=this.previous();return this.addCommand(new F(s.x,s.y,s.x,t)),this}L(t,s){const e=this.previous();return this.addCommand(new F(e.x,e.y,t,s)),this}Q(t,s,e,n){const r=this.previous();return this.addCommand(v.controlPoints(r.x,r.y,t,s,e,n)),this}Q_HV(t,s){const e=this.previous();return this.Q(t,e.y,t,s)}Q_VH(t,s){const e=this.previous();return this.Q(e.x,s,t,s)}Q_angles(t,s,e,n){const r=this.previous();if(n??=r.outgoingAngle,n===void 0)throw new Error("wtf");return this.addCommand(v.angles(r.x,r.y,n,t,s,e)),this}C(t,s,e,n,r,o){const i=this.previous();return this.addCommand(new M(i.x,i.y,t,s,e,n,r,o)),this}circle(t,s,e="cw"){const n=this.previous(),r=n.x,o=n.y,i=Math.atan2(o-s,r-t),a=Math.hypot(o-s,r-t),u=e=="cw"?1:-1,g=i+Math.PI*2*u,l=c.makeLinear(0,i,1,g);function h(x){switch(x){case 0:case 1:return n;default:{const $=l(x),A=c.polarToRectangular(a,$);return{x:t+A.x,y:s+A.y}}}}function f(x){return h(x)}return this.addParametricPath(f,8),this}arc(t,s,e,n,r){const o=this.previous(),i=o.x,a=o.y;let u=c.positiveModulo(Math.atan2(a-s,i-t),Math.PI*2);const g=Math.hypot(a-s,i-t);let l=c.positiveModulo(Math.atan2(n-s,e-t),Math.PI*2);const h=Math.hypot(n-s,e-t);r=="cw"?u>l&&(l+=Math.PI*2):u<l&&(u+=Math.PI*2);const f=Math.abs(u-l),y=Math.ceil(f*1.17+1e-4),x=c.makeLinear(0,g,1,h),$=c.makeLinear(0,u,1,l);function A(E){switch(E){case 0:return o;case 1:return{x:e,y:n};default:{const C=c.polarToRectangular(x(E),$(E));return{x:t+C.x,y:s+C.y}}}}return this.addParametricPath(A,y)}addParametricPath(t,s){if(s<=0)throw new Error("wtf");const e=.01/s,n=c.initializedArray(s+1,o=>{const i=o/s,a=t(i),u=O(t,i,e);return{t:i,point:a,direction:u}});return c.initializedArray(s,o=>({from:n[o],to:n[o+1]})).forEach(o=>{this.Q_angles(o.to.point.x,o.to.point.y,o.to.direction,o.from.direction)}),this}}function O(m,t,s){if(!(t>=0&&t<=1))throw new Error("Expected 0 ≤ t ≤ 1");const e=Math.max(0,t-s),n=m(e),r=Math.min(1,t+s),o=m(r),i=o.x-n.x,a=o.y-n.y;return i==0&&a==0?NaN:Math.atan2(a,i)}const P=" *",d="(-?[0-9]+\\.?[0-9]*)",w=" *[, ] *",b=new RegExp(`^M${P}${d}${w}${d}(.*)$`),X=new RegExp(`^L${P}${d}${w}${d}(.*)$`),R=new RegExp(`^Q${P}${d}${w}${d}${w}${d}${w}${d}(.*)$`),L=new RegExp(`^C${P}${d}${w}${d}${w}${d}${w}${d}${w}${d}${w}${d}(.*)$`),I=new RegExp(`^${P}${d}${w}${d}${w}${d}${w}${d}${w}${d}${w}${d}(.*)$`),Q=new RegExp(`^c${P}${d}${w}${d}${w}${d}${w}${d}${w}${d}${w}${d}(.*)$`);class T extends Error{constructor(t,s){super(t),this.where=s}}class p{static fromString(t){const s=this.fromJson(t);if(s)return s;let e=t,n=null;const r=h=>new T(h,e),o=h=>{const f=c.parseFloatX(h);if(f===void 0)throw r(`Invalid number: "${h}"`);return f};let i=NaN,a=NaN;const u=[],g=h=>{u.push(h),i=h.x,a=h.y};let l=!1;for(;e=e.replace(/^ */,""),e!="";){if(n=b.exec(e),n){i=o(n[1]),a=o(n[2]),l=!0,e=n[3];continue}if(!l)throw r("Must start with an M command.");if(n=X.exec(e),n){const h=o(n[1]),f=o(n[2]),y=new F(i,a,h,f);g(y),e=n[3];continue}if(n=R.exec(e),n){const h=o(n[1]),f=o(n[2]),y=o(n[3]),x=o(n[4]),$=v.controlPoints(i,a,h,f,y,x);g($),e=n[5];continue}if(n=L.exec(e),n){for(;n;){const h=o(n[1]),f=o(n[2]),y=o(n[3]),x=o(n[4]),$=o(n[5]),A=o(n[6]),E=new M(i,a,h,f,y,x,$,A);g(E),e=n[7],n=I.exec(e)}continue}if(n=Q.exec(e),n){for(;n;){const h=o(n[1]),f=o(n[2]),y=o(n[3]),x=o(n[4]),$=o(n[5]),A=o(n[6]),E=M.relative(i,a,h,f,y,x,$,A);g(E),e=n[7],n=I.exec(e)}continue}throw r("Confused.")}return new this(u)}static fromJson(t){try{const e=JSON.parse(t).commands.map(n=>{switch(n.command){case"C":{const{x0:r,y0:o,x1:i,y1:a,x2:u,y2:g,x:l,y:h}=n;return new M(r,o,i,a,u,g,l,h)}case"L":{const{x0:r,y0:o,x:i,y:a}=n;return new F(r,o,i,a)}case"Q":{const{x0:r,y0:o,x:i,y:a,creationInfo:u}=n;switch(u.source){case"angles":{const{angle0:g,angle:l}=u,h=v.angles(r,o,g,i,a,l);return(h.creationInfo.source!="angles"||h.creationInfo.success!=u.success)&&console.warn("different",n,h),h}case"controlPoints":{const{x1:g,y1:l}=n;return v.controlPoints(r,o,g,l,i,a)}case"line":return v.line4(r,o,i,a);default:throw new Error(`Unknown source: "${u.source}"`)}}default:throw new Error(`Unknown command: "${n.command}"`)}});return new p(e)}catch{return}}matchForMorph(t){const s=this.commands.map(i=>i.toCubic()),e=t.commands.map(i=>i.toCubic());if(s.length!=e.length){const{shorter:i,longer:a}=s.length<e.length?{shorter:s,longer:e}:{shorter:e,longer:s};if(i.length==0)throw new Error("can't morph something into nothing");const u=a.length/i.length,g=[];i.forEach((l,h)=>{const f=Math.round((h+1)*u);for(;g.length<f;)g.push(l)}),i.length=0,i.push(...g)}if(s.length!=e.length)throw new Error("wtf");function n(i){return p.cssifyPath(i.map(a=>new p([a]).rawPath).join())}const r=n(s),o=n(e);return[r,o]}commands;get endX(){return this.commands.at(-1)?.x}get endY(){return this.commands.at(-1)?.y}get startX(){return this.commands.at(0)?.x0}get startY(){return this.commands.at(0)?.y0}constructor(t){this.commands=[...t]}static cssifyPath(t){return`path('${t}')`}get cssPath(){return p.cssifyPath(this.rawPath)}makeElement(){const t=document.createElementNS("http://www.w3.org/2000/svg","path"),s=this.cssPath;if(t.style.d=s,t.style.d=="")throw console.error(s,t),new Error("wtf");return t}static needAnM(t,s){return s?!t||t.x!=s.x0||t.y!=s.y0:!1}get rawPath(){return this.commands.flatMap((t,s)=>{const e=[],n=this.commands[s-1];return p.needAnM(n,t)&&e.push(`M ${t.x0},${t.y0}`),e.push(t.asString),e}).join(" ")}get cssPaths(){return this.splitOnMove().map(t=>t.cssPath)}get rawPaths(){return this.splitOnMove().map(t=>t.rawPath)}splitOnMove(){const t=[];let s=[];return this.commands.forEach(e=>{p.needAnM(s.at(-1),e)&&(s=[],t.push(s)),s.push(e)}),t.map(e=>new p(e))}static join(t){return new p(t.flatMap(({Δx:s,Δy:e,shape:n})=>n.translate(s,e).commands))}convertToCubics(){return new p(this.commands.map(t=>t.toCubic()))}translate(t,s){return new p(this.commands.map(e=>e.translate(t,s)))}static fixAngleRounding(t){return t+400-400}static toDegrees(t){return Math.round(t*c.degreesPerRadian*100)/100}dump(){const t=this.commands.map((s,e)=>{const{x0:n,y0:r,x:o,y:i,incomingAngle:a,outgoingAngle:u,command:g}=s,l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",new p([s]).rawPath);const h=l.getTotalLength(),f=this.commands[e-1],x=p.needAnM(f,s)?{}:{difference:p.toDegrees(c.angleBetween(f.outgoingAngle,a))};return{x0:n,y0:r,x:o,y:i,incomingAngle:p.toDegrees(a),outgoingAngle:p.toDegrees(u),length:h,c:g,...x}});console.table(t),console.log(this.rawPath),console.log(JSON.stringify(this))}}function k(m,t){if(c.assertFinite(m.x0,m.y0,m.angle,t.x0,t.y0,t.angle),isNaN(m.angle)||isNaN(t.angle)||m.angle==t.angle)return;const s=Math.tan(m.angle),e=Math.tan(t.angle),n=Math.abs(s)*100>Number.MAX_SAFE_INTEGER,r=Math.abs(e)*100>Number.MAX_SAFE_INTEGER;if(n&&r)return;const o=Math.atan2(t.y0-m.y0,t.x0-m.x0),i=c.angleBetween(m.angle,o),a=c.angleBetween(t.angle,o);if(i==0||Math.abs(a)==Math.PI){if(Math.abs(i)==Math.PI||a==0)return;const l=(m.x0+t.x0)/2,h=(m.y0+t.y0)/2;return{x:l,y:h}}const u=Math.sign(i),g=Math.sign(a);if(!(u!=g||u==0)&&!(Math.abs(a)<=Math.abs(i)+c.radiansPerDegree))if(n||r){const l=n?m.x0:t.x0,h=n?{...t,slope:e}:{...m,slope:s},f=h.slope*(l-h.x0)+h.y0;return{x:l,y:f}}else{const l=(t.y0-e*t.x0-m.y0+s*m.x0)/(s-e),h=s*(l-m.x0)+m.y0;return{x:l,y:h}}}export{F as L,p as P,v as Q,T as a,N as b};
